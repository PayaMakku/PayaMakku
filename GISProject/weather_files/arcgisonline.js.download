// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.40/esri/copyright.txt for details.
// See https://www.arcgis.com/home/copyright.txt for further details.
//>>built
/*
 *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
**************************************************************************** Calcite Web - Calcite Design Components in CSS, JS and HTML
 @version v1.2.5
 @license Apache-2.0
 @copyright 2018 Esri
 @link https://github.com/Esri/calcite-web
*/
require({cache:{"dijit/form/VerticalRule":function(){define(["dojo/_base/declare","./HorizontalRule"],function(t,p){return t("dijit.form.VerticalRule",p,{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerV"\x3e\x3c/div\x3e',_positionPrefix:'\x3cdiv class\x3d"dijitRuleMark dijitRuleMarkV" style\x3d"top:',_isHorizontal:!1})})},"dijit/form/VerticalRuleLabels":function(){define(["dojo/_base/declare","./HorizontalRuleLabels"],function(t,p){return t("dijit.form.VerticalRuleLabels",
p,{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerV dijitRuleLabelsContainer dijitRuleLabelsContainerV"\x3e\x3c/div\x3e',_positionPrefix:'\x3cdiv class\x3d"dijitRuleLabelContainer dijitRuleLabelContainerV" style\x3d"top:',_labelPrefix:'"\x3e\x3cspan class\x3d"dijitRuleLabel dijitRuleLabelV"\x3e',_calcPosition:function(x){return 100-x},_isHorizontal:!1})})},"esri/dijit/editing/Editor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/kernel dojo/has dojo/query dojo/DeferredList dojo/dom-class dojo/dom-construct dojo/string dijit/_Widget dijit/_Templated ../../domUtils ../../graphicsUtils ../../geometry/Polyline ../../geometry/Polygon ../../graphic ../../undoManager ../../tasks/query ../../layers/FeatureLayer ../../layers/FeatureTemplate ../../toolbars/draw ../../toolbars/edit ../AttributeInspector ./Util ./Add ./Update ./Delete ./Cut ./Union ./toolbars/Drawing ./SelectionHelper ./TemplatePicker ../../kernel ../../config dojo/i18n!../../nls/jsapi dojo/text!./templates/Editor.html dijit/ProgressBar dojo/NodeList-dom".split(" "),
function(t,p,x,b,m,f,d,a,c,l,h,n,g,e,k,w,q,u,r,v,z,B,A,y,D,G,E,F,I,M,P,W,H,O,K,R,da,U){var Z=t([n,g],{declaredClass:"esri.dijit.editing.Editor",widgetsInTemplate:!0,templateString:U,onLoad:function(){},constructor:function(L,T){L=L||{};this._settings=L.settings;this._eConnects=[]},startup:function(){this.inherited(arguments);this._setDefaultOptions();this._settings.map.setInfoWindowOnClick(!1);var L=this._settings.layerInfos;this.featureReductionEnabledLayers=[];x.forEach(L,function(Y){Y=Y.featureLayer;
Y.isFeatureReductionEnabled()&&(Y.disableFeatureReduction(),this.featureReductionEnabledLayers.push(Y))},this);if(x.every(L,function(Y){return Y.featureLayer.loaded}))this._initLayers(),this._connectEvents(),this._createWidgets(),this.onLoad(),this.loaded=!0;else{var T=L.length;x.forEach(L,function(Y){Y=Y.featureLayer;if(Y.loaded)T--;else var ca=b.connect(Y,"onLoad",this,function(Q){b.disconnect(ca);ca=null;T--;T||(this._initLayers(),this._connectEvents(),this._createWidgets(),this.onLoad(),this.loaded=
!0)})},this)}this._reset();this._enableMapClickHandler()},stopEditing:function(L){this._updateCurrentFeature(p.hitch(this,function(){this._clearSelection(!1);L&&L()}))},destroy:function(){this._settings.map.setInfoWindowOnClick(!0);this.drawingToolbar&&this.drawingToolbar.destroy();this.attributeInspector&&this.attributeInspector.destroy();this.templatePicker&&this.templatePicker.destroy();this._selectionHelper&&this._selectionHelper.destroy();this._drawToolbar&&this._drawToolbar.deactivate();this._reset();
this._disableMapClickHandler();x.forEach(this._eConnects,b.disconnect);b.disconnect(this._dtConnect);b.disconnect(this._templatePickerOnSelectionChangeEvent);this._layer=this._currentGraphic=this._activeType=this._activeTemplate=this._drawingTool=this._drawToolbar=this.editToolbar=this.drawingToolbar=this.attributeInspector=this.templatePicker=this.undoManager=null;this._settings.map.infoWindow&&this._settings.map.infoWindow.clearFeatures&&this._settings.map.infoWindow.clearFeatures();x.forEach(this.featureReductionEnabledLayers,
function(L){L.enableFeatureReduction()});this.inherited(arguments)},_setDefaultOptions:function(){this._drawToolbar=this._settings.drawToolbar||new A(this._settings.map);this._settings.drawToolbar=this._drawToolbar;this.editToolbar=this._settings.editToolbar||new y(this._settings.map,{textSymbolEditorHolder:this.domNode});this._settings.editToolbar=this.editToolbar;this._settings.toolbarVisible=this._settings.toolbarVisible||!1;this._settings.toolbarOptions=p.mixin({reshapeVisible:!1,cutVisible:!1,
mergeVisible:!1},this._settings.toolbarOptions);this._settings.createOptions=p.mixin({polylineDrawTools:[Z.CREATE_TOOL_POLYLINE],polygonDrawTools:[Z.CREATE_TOOL_POLYGON],editAttributesImmediately:!0},this._settings.createOptions);this._settings.singleSelectionTolerance=this._settings.singleSelectionTolerance||3;this._settings.maxUndoRedoOperations=this._settings.maxUndoRedoOperations||10;this._settings.editor=this;this._usePopup=this._settings.usePopup=this._settings.map.infoWindow._setPagerCallbacks?
!0:!1;this._datePackage=this._settings.datePackage;var L=R.defaults;this._settings.geometryService=this._settings.geometryService||L.geometryService;L.geometryService=L.geometryService||this._settings.geometryService},_initLayers:function(){this._settings.layers=[];this._settings.userIds={};this._settings.createOnlyLayer={};x.forEach(this._settings.layerInfos,function(L){if(L.featureLayer&&L.featureLayer.loaded){this._settings.layers.push(L.featureLayer);var T=L.featureLayer.id;L.featureLayer.credential&&
(this._settings.userIds[T]=L.featureLayer.credential.userId);L.userId&&(this._settings.userIds[T]=L.userId);var Y=L.featureLayer.getEditCapabilities();this._settings.createOnlyLayer[T]=Y.canCreate&&!Y.canUpdate?!0:!1;this._isTextSymbolPointLayer(L.featureLayer)&&(L.disableAttributeUpdate=!0)}},this)},_reset:function(){this._hideAttributeInspector();this.editToolbar.deactivate();this._editVertices=!0;this._drawingTool=this._activeTemplate=this._activeType=this._currentGraphic=this._layer=null;this._attributeChanged=
!1},_saveFeatureOnClient:function(L){var T=this.templatePicker.getSelected();var Y=T.template?T.featureLayer.renderer.getSymbol(T.template.prototype):T.symbolInfo.symbol;this._tempGraphic=new u(L,Y,null,null);this._tempGraphic.setAttributes(p.mixin({},T.template.prototype.attributes));Y=this._settings.map;Y.graphics.add(this._tempGraphic);L=this._findCenterPoint(L);this._createAttributeInspector();Y.infoWindow.setTitle(T.featureLayer?T.featureLayer.name:da.widgets.attributeInspector.NLS_title);this.attributeInspector.showFeature(this._tempGraphic,
T.featureLayer);this._showInfoWindow(L,Y.getInfoWindowAnchor(L));if(this._settings.createOnlyLayer[T.featureLayer.id]||this._settings.invalidTemplate)this._infoWindowHideEvent=b.connect(Y.infoWindow,"onHide",this,"_infoWindowHide");b.disconnect(this._templatePickerOnSelectionChangeEvent);this.templatePicker.clearSelection();this._drawToolbar.deactivate();this._enableMapClickHandler();this.drawingToolbar&&this.drawingToolbar.deactivate();this._templatePickerOnSelectionChangeEvent=b.connect(this.templatePicker,
"onSelectionChange",p.hitch(this,"_onCreateFeature"))},_saveAttributesOnClient:function(L,T,Y){this._tempGraphic.attributes[T]="number"===typeof Y&&isNaN(Y)?null:Y},_infoWindowHide:function(){this._createFeature(this._tempGraphic.geometry,this._tempGraphic.attributes);b.disconnect(this._infoWindowHideEvent)},_createFeature:function(L,T){this._editClickPoint=this._findCenterPoint(L);L.rings?this._simplify(L,p.hitch(this,function(Y){this._drawingTool!==B.TOOL_AUTO_COMPLETE_POLYGON?this._applyEdits([{layer:this._layer,
adds:[this._createGraphic(Y,T)]}],p.hitch(this,function(){this._chainAttachment(this._oEdits[0].adds[0].attributes[this._oEdits[0].layer.objectIdField],this._oEdits[0].layer)})):this._autoComplete(Y,p.hitch(this,function(ca){ca&&ca.length&&this._applyEdits([{layer:this._layer,adds:x.map(ca,p.hitch(this,function(Q){return this._createGraphic(Q,T)}))}],function(){this._chainAttachment(this._oEdits[0].adds[0].attributes[this._oEdits[0].layer.objectIdField],this._oEdits[0].layer)})}))})):this._applyEdits([{layer:this._layer,
adds:[this._createGraphic(L,T)]}],p.hitch(this,function(){this._chainAttachment(this._oEdits[0].adds[0].attributes[this._oEdits[0].layer.objectIdField],this._oEdits[0].layer);this._layer&&this._layer.renderer&&"heatmap"===this._layer.renderer.type&&this._layer.refresh()}))},_chainAttachment:function(L,T){this.attributeInspector&&this.attributeInspector._attachmentEditor&&this.attributeInspector._attachmentEditor._tempUpload&&this.attributeInspector._attachmentEditor._chainAttachment(L,T)},_updateCurrentFeature:function(L){var T=
this._isModified();T?this._updateFeature(T,L):L&&L(!1)},_updateFeature:function(L,T,Y){var ca=L.geometry,Q=L.getLayer();Q.hasZ&&!Q.enableZDefaults||Q.hasM&&!Q.allowUpdateWithoutMValues||Y&&!this._isModified()?(Y=new u,Y.setAttributes(L.attributes),this._applyEdits([{layer:L.getLayer(),updates:[Y]}],T)):ca.rings?this._simplify(ca,p.hitch(this,function(X){this._applyEdits([{layer:L.getLayer(),updates:[p.mixin(L,{geometry:X})]}],T)})):this._applyEdits([{layer:L.getLayer(),updates:[L]}],T)},_deleteFeature:function(L,
T){if(this._settings.invalidTemplate&&L===this._tempGraphic)this._settings.map.graphics.remove(this._tempGraphic),this._hideAttributeInspector();else{var Y=[];L?Y.push({layer:L.getLayer(),deletes:[L]}):(Y=x.map(x.filter(this._settings.layers,function(ca){return 0<ca.getSelectedFeatures().length}),function(ca){return{layer:ca,deletes:ca.getSelectedFeatures()}}))&&Y.length||!this._currentGraphic||Y.push({layer:this._layer,deletes:[this._currentGraphic]});this._applyEdits(Y,T)}},_stopEditing:function(L,
T,Y,ca){e.hide(this.progressBar.domNode);this._settings.createOnlyLayer[L.id]||this._undoRedoAdd();if(!0===L._isSelOnly||1===L.mode||6===L.mode){if(T&&T.length){this.templatePicker.clearSelection();var Q=new v;Q.objectIds=[T[0].objectId];this._settings.createOnlyLayer[L.id]||this._settings.invalidTemplate?this._settings.map.graphics.remove(this._tempGraphic):this._selectFeatures([L],Q,p.hitch(this,"_onEditFeature"))}}else(Q=this._selectionHelper.findMapService(this._settings.map,L))&&Q.refresh(),
T&&T.length&&(this.templatePicker.clearSelection(),this._settings.createOnlyLayer[L.id]||this._settings.invalidTemplate?this._settings.map.graphics.remove(this._tempGraphic):G.findFeatures(T,L,p.hitch(this,"_onEditFeature")));ca&&ca.length&&(this._clearSelection(!0),this._undoRedo&&(Q=this._selectionHelper.findMapService(L,this._settings.map))&&Q.refresh());this._undoRedo&&Y&&Y.length&&((Q=this._selectionHelper.findMapService(L,this._settings.map))&&Q.refresh(),this.attributeInspector.refresh(),this._undoRedo=
!1);this.drawingToolbar&&this.drawingToolbar._updateUI();this._undoRedo=!1;this._settings.invalidTemplate=!1},_undoRedoAdd:function(){this._settings._isApplyEditsCall=!1;if(this._settings.undoManager){var L=this._edits&&this._edits.length?this._edits[0]:null;if(L){var T=L.adds||[],Y=L.updates||[],ca=L.deletes||[],Q=L.preUpdates||[];L={featureLayer:L.layer};"CUT"===this._activeTool?T.length&&Y.length&&Q.length&&this.undoManager.add(new M(p.mixin(L,{preUpdatedGraphics:Q,addedGraphics:T,postUpdatedGraphics:Y}))):
"UNION"===this._activeTool?ca.length&&Y.length&&Q.length&&this.undoManager.add(new P(p.mixin(L,{preUpdatedGraphics:Q,deletedGraphics:ca,postUpdatedGraphics:Y}))):T.length?this.undoManager.add(new E(p.mixin(L,{addedGraphics:T}))):ca.length?this.undoManager.add(new I(p.mixin(L,{deletedGraphics:ca}))):Y.length&&(this._rollbackGraphic||Q.length)&&this.undoManager.add(new F(p.mixin(L,{preUpdatedGraphics:Q.length?Q:[this._rollbackGraphic],postUpdatedGraphics:Y})));this._rollbackGraphic=this._edits=null}}},
_activateDrawToolbar:function(L){this._layer=L.featureLayer;this._activeType=L.type;this._drawingTool=(this._activeTemplate=L.template)?this._activeTemplate.drawingTool:null;this._drawTool=this._toDrawTool(this._drawingTool,L.featureLayer);b.disconnect(this._dtConnect);var T=this._layer.fields;this._settings.invalidTemplate=!1;if(this._activeTemplate&&this._activeTemplate.prototype){var Y=p.mixin({},this._activeTemplate.prototype.attributes);T=T.filter(function(ca){return!1===ca.nullable&&!0===ca.editable});
this._settings.invalidTemplate=T.some(function(ca){ca=Y[ca.name];return null===ca||void 0===ca})}this._dtConnect=this._settings.createOnlyLayer[L.featureLayer.id]||this._settings.invalidTemplate?b.connect(this._drawToolbar,"onDrawEnd",this,"_saveFeatureOnClient"):b.connect(this._drawToolbar,"onDrawEnd",this,"_createFeature");this.editToolbar.deactivate();this._disableMapClickHandler();this.drawingToolbar?this.drawingToolbar.activateEditing(this._drawTool,this._layer):this._drawToolbar.activate(this._drawTool)},
_activateEditToolbar:function(L,T){var Y=L.getLayer(),ca=Y?Y.geometryType:null,Q=this._isTextSymbolPoint(L),X=y.MOVE;"esriGeometryPoint"!==ca&&!0===this._isNotesFeature(L)?(X=X|y.ROTATE|y.SCALE,this._editVertices=!1):"esriGeometryPoint"!==ca&&!0===this._editVertices?(X=X|y.ROTATE|y.SCALE,this._editVertices=!1):Q?(X=X|y.ROTATE|y.SCALE|y.EDIT_TEXT,this._editVertices=!1):(X|=y.EDIT_VERTICES,this._editVertices=!0);this._attributeChanged=this._isModified();this._rollbackGraphic=new u(L.toJson());ca=Y.getEditCapabilities({feature:L,
userId:this._settings.userIds[Y.id]});var ha=x.filter(this._settings.layerInfos,function(ja){return ja.featureLayer.layerId===Y.layerId})[0];ca.canUpdate&&!ha.disableGeometryUpdate&&ca.canUpdateGeometry&&(this.editToolbar.activate(X,L),Q&&(this.editToolbar._textEditor._addTextBox(L),this.editToolbar._textSymbolEditor&&this.editToolbar._textSymbolEditor.hide()));this._settings.map.infoWindow.isShowing||this._updateAttributeDisabled(L)||(Q=T&&T.screenPoint||this._findCenterPoint(L),this._showInfoWindow(Q,
this._settings.map.getInfoWindowAnchor(Q)))},_createGraphic:function(L,T){var Y=new u(L,this._activeType&&this._activeType.symbol||this._layer.defaultSymbol,T);this._activeTemplate||T?Y.attributes=T||p.mixin({},this._activeTemplate.prototype.attributes):(Y.attributes=Y.attributes||[],x.forEach(this._layer.fields,function(ca){Y.attributes[ca.name]=null},this));return Y},_connectEvents:function(){var L=this._settings.layers;x.forEach(L,function(T){this._connect(T,"onEditsComplete",p.hitch(this,"_stopEditing",
T))},this);x.forEach(L,function(T){this._connect(T,"onBeforeApplyEdits",p.hitch(this,function(){e.show(this.progressBar.domNode);this._settings._isApplyEditsCall=!0}))},this);this._connect(this.editToolbar,"onGraphicClick",p.hitch(this,"_activateEditToolbar"));this._connect(this.editToolbar,"onGraphicFirstMove",p.hitch(this,"_hideAttributeInspector"));this._connect(this.editToolbar,"onVertexFirstMove",p.hitch(this,"_hideAttributeInspector"));this._connect(this.editToolbar,"onScaleStart",p.hitch(this,
"_hideAttributeInspector"));this._connect(this.editToolbar,"onRotateStart",p.hitch(this,"_hideAttributeInspector"))},_connect:function(L,T,Y){this._eConnects.push(b.connect(L,T,Y))},_createWidgets:function(){this._selectionHelper=new H(this._settings);this._createTemplatePicker();this._createAttributeInspector();this._createDrawingToolbar();this._createUndoRedoManager()},_createTemplatePicker:function(){if(this._settings.templatePicker)this.templatePicker=this._settings.templatePicker,e.hide(this.templatePickerDiv);
else{var L=x.filter(this._settings.layers,function(T){return T.getEditCapabilities().canCreate});this.templatePicker=new O({"class":"esriTemplatePicker",featureLayers:L,showTooltip:!0,maxLabelLength:this._settings.typesCharacterLimit,columns:"auto",rows:"auto"},this.templatePickerDiv);this.templatePicker.startup();this._settings.templatePicker=this.templatePicker}this._templatePickerOnSelectionChangeEvent=b.connect(this.templatePicker,"onSelectionChange",p.hitch(this,"_onCreateFeature"))},_createAttributeInspector:function(){var L=
this._settings.map;this._settings.attributeInspector?(this._customAttributeInspector=!0,this.attributeInspector=this._settings.attributeInspector):(this._customAttributeInspector=!1,this.attributeInspector=new D({layerInfos:this._settings.layerInfos,hideNavButtons:this._usePopup,datePackage:this._datePackage},l.create("div")),this.attributeInspector.startup(),L.infoWindow.setContent(this.attributeInspector.domNode),L.infoWindow.setTitle(da.widgets.attributeInspector.NLS_title),L.infoWindow.resize(350,
375),m.query(".esriAttributeInspector .atiLayerName").style({display:"none"}));this._connect(this.attributeInspector,"onDelete",p.hitch(this,"_deleteFeature"));this._connect(this.attributeInspector,"onNext",p.hitch(this,function(T){this._updateCurrentFeature(p.hitch(this,function(){this._attributeChanged=!1;this._onEditFeature(T)}))}));this._usePopup&&L.infoWindow._setPagerCallbacks(this.attributeInspector,p.hitch(this.attributeInspector,"previous"),p.hitch(this.attributeInspector,"next"));this._connect(this.attributeInspector,
"onAttributeChange",p.hitch(this,function(T,Y,ca){if(this._settings.createOnlyLayer[this._layer.id]||this._settings.invalidTemplate)this._saveAttributesOnClient(T,Y,ca);else{var Q=T.getLayer();(Q=x.filter(Q.fields,function(X){return X.name===Y})[0])&&""===ca&&(ca=null);this._rollbackGraphic=new u(p.clone(T.toJson()));this.attributeInspector._rollbackInfo={field:Q,graphic:this._rollbackGraphic};this._currentGraphic.attributes[Y]="number"===typeof ca&&isNaN(ca)?null:ca;this._currentGraphic.setAttributes(this._currentGraphic.attributes);
this._updateFeature(this._currentGraphic,null,!0);this._attributeChanged=!1}}))},_createDrawingToolbar:function(){!0===this._settings.toolbarVisible&&(this.drawingToolbar=new W({"class":"esriDrawingToolbar",drawToolbar:this._drawToolbar,editToolbar:this.editToolbar,settings:this._settings,onDelete:p.hitch(this,"_deleteFeature"),onApplyEdits:p.hitch(this,"_applyEdits"),onShowAttributeInspector:p.hitch(this,"_onEditFeature")},this.drawingToolbarDiv))},_createUndoRedoManager:function(){if(this._settings.enableUndoRedo||
this._settings.undoManager)this._settings.enableUndoRedo=!0,this.undoManager=this._settings.undoManager,this.undoManager||(this.undoManager=this._settings.undoManager=new r({maxOperations:this._settings.maxUndoRedoOperations})),this._connect(this.undoManager,"onUndoComplete",p.hitch(this,this._updateUndoRedoOperations)),this._connect(this.undoManager,"onRedoComplete",p.hitch(this,this._updateUndoRedoOperations)),this._connect(document,"onkeypress",p.hitch(this,function(L){if(L.metaKey||L.ctrlKey)"z"===
L.charOrCode&&this._undo(),"y"===L.charOrCode&&this._redo()}))},_updateUndoRedoOperations:function(L){if(L&&L.addedIds){var T;for(T=0;T<this.undoManager.length;T++){var Y=this.undoManager.get(T);Y&&L.layer===Y._featureLayer&&Y.updateObjectIds(L.oldIds,L.addedIds)}}L&&"Update Features"===L.operation.label&&this.attributeInspector.refresh()},_enableMapClickHandler:function(){this._mapClickHandler=b.connect(this._settings.map,"onClick",p.hitch(this,function(L){this._drawToolbar._geometryType||("SELECT"===
this._activeTool?this._activeTool="":this._updateCurrentFeature(p.hitch(this,function(){this._reset();this._updateSelection(L)})))}))},_disableMapClickHandler:function(){b.disconnect(this._mapClickHandler)},_onCreateFeature:function(){var L=this.templatePicker.getSelected();L?this._updateCurrentFeature(p.hitch(this,function(){this._currentGraphic&&this._clearSelection(!1);this._reset();this._activateDrawToolbar(L)})):(this._reset(),b.disconnect(this._dtConnect),this._drawToolbar.deactivate(),this._enableMapClickHandler(),
this.drawingToolbar&&this.drawingToolbar.deactivate())},_isTextSymbolPoint:function(L){if("point"===L.geometry.type||"multipoint"===L.geometry.type){var T=L.getLayer(),Y=T.renderer;L=L.symbol||T._getSymbol(L);!L&&(Y.hasVisualVariables("sizeInfo",!1)||Y.hasVisualVariables("colorInfo",!1)||Y.hasVisualVariables("opacityInfo",!1))&&Y.addBreak&&Y.infos&&1===Y.infos.length&&(L=Y.infos[0].symbol||Y.defaultSymbol);if(L&&"textsymbol"===L.type)return!0}return!1},_isTextSymbolPointLayer:function(L){return"esriGeometryPoint"===
L.geometryType&&L.renderer&&L.renderer._symbols&&L.renderer._symbols[0]&&L.renderer._symbols[0].symbol&&"textsymbol"===L.renderer._symbols[0].symbol.type?!0:!1},_updateAttributeDisabled:function(L){L=L.getLayer();if(!L)return!1;var T,Y=!1;for(T=0;T<this._settings.layerInfos.length;T++){var ca=this._settings.layerInfos[T];if(ca.featureLayer==L){Y=ca.disableAttributeUpdate;break}}return Y},_onEditFeature:function(L,T){if(L=(p.isArray(L)?L[0]:L)||null){this._layer=L.getLayer();if(!this._customAttributeInspector&&
!this._updateAttributeDisabled(L)){T=T||this._editClickPoint||this._findCenterPoint(L);if(1<this._currentFeatureCount){var Y=this._popupFeatures.indexOf(L);Y=h.substitute(da.widgets.popup.NLS_pagingInfo,{index:Y+1,total:this._currentFeatureCount})}else Y=this._layer?this._layer.name:da.widgets.attributeInspector.NLS_title;this._settings.map.infoWindow.setTitle(Y);if(this.drawingToolbar||!this._settings.map.infoWindow.isShowing)this.attributeInspector.refresh(),this._showInfoWindow(T,this._settings.map.getInfoWindowAnchor(T));
this._editClickPoint=null}L!==this._currentGraphic&&(this._editVertices=!0,this._currentGraphic=L,L.getDojoShape()&&L.getDojoShape().moveToFront(),Y=this._layer.hasM,this._layer.hasZ&&!this._layer.enableZDefaults||Y&&!this._layer.allowUpdateWithoutMValues||this._activateEditToolbar(L))}},_applyEdits:function(L,T){L=L||[];if(!(0>=L.length)){this._edits=this._oEdits=L;var Y=[];x.forEach(L,function(ca){ca.layer&&Y.push(ca.layer.applyEdits(ca.adds,ca.updates,ca.deletes))});0<Y.length&&(this._deferredsList=
(new a(Y)).addCallback(p.hitch(this,function(){e.hide(this.progressBar.domNode);T&&T();var ca=this._settings.map;ca&&ca.infoWindow.reposition&&ca.infoWindow.isShowing&&ca.infoWindow.reposition()})))}},_undo:function(){this._settings.undoManager&&!this._settings._isApplyEditsCall&&(this.editToolbar.deactivate(),this._undoRedo=!0,this._settings.undoManager.undo())},_redo:function(){this._settings.undoManager&&!this._settings._isApplyEditsCall&&(this.editToolbar.deactivate(),this._undoRedo=!0,this._settings.undoManager.redo())},
_simplify:function(L,T){q.prototype.isSelfIntersecting(L)?this._settings.geometryService.simplify([L],function(Y){var ca=Y&&Y.length?Y[0]:ca;T&&T(ca)}):T&&T(L)},_autoComplete:function(L,T){var Y=this._getLayers("esriGeometryPolygon"),ca=new v;ca.geometry=L;ca.returnGeometry=!0;this._selectFeatures(Y,ca,p.hitch(this,function(Q){!Q||0>=Q.length?T&&T([L]):this._settings.geometryService.autoComplete(k.getGeometries(Q),this._toPolylines([ca.geometry]),function(X){T&&T(X)})}))},_getLayers:function(L){return x.filter(this._settings.layers,
function(T){return T.geometryType===L})},_selectFeatures:function(L,T,Y,ca){this._selectionHelper.selectFeatures(L,T,ca||z.SELECTION_NEW,Y)},_updateSelection:function(L){var T=L.mapPoint,Y=L.graphic,ca=this._settings.layerInfos,Q;this._selectionHelper.selectFeaturesByGeometry(this._settings.layers,T,z.SELECTION_NEW,p.hitch(this,function(X){var ha=x.some(X,p.hitch(this,function(aa){return aa==Y}));if(Y&&!ha)if(ha=Y.getLayer(),this._isValidLayer(ha)){var ja=new v;ja.objectIds=[Y.attributes[ha.objectIdField]];
this._selectionHelper.selectFeatures([ha],ja,z.SELECTION_ADD,p.hitch(this,function(aa){aa&&aa.length&&(aa=aa.concat(X),Q=G.sortFeaturesById(ca,aa),this._updatePopupButtons(Q),this._onEditFeature(Q,T))}))}else X&&X.length?(Q=G.sortFeaturesById(ca,X),this._updatePopupButtons(Q),this._onEditFeature(Q,T)):this._clearSelection();else X&&X.length?(Q=G.sortFeaturesById(ca,X),this._updatePopupButtons(Q),this._onEditFeature(Q,T)):this._clearSelection()}));Y&&this._isTextSymbolPoint(Y)&&this._isValidLayer(Y.getLayer())&&
this.editToolbar.activate(0|y.MOVE|y.ROTATE|y.SCALE|y.EDIT_TEXT,Y)},_updatePopupButtons:function(L){if(this._usePopup&&L){var T=L.length;x.forEach([this._settings.map.infoWindow._prevFeatureButton,this._settings.map.infoWindow._nextFeatureButton],p.hitch(this,function(ca){1<T?c.remove(ca,"hidden"):c.add(ca,"hidden")}));var Y=1<T?"block":"none";m.query(".esriAttributeInspector .atiLayerName").style({display:Y});this._currentFeatureCount=T;this._popupFeatures=L}else this._currentFeatureCount=this._popupFeatures=
null},_clearSelection:function(L){this._currentFeatureCount=0;this._popupFeatures=null;this._selectionHelper.clearSelection(L||!1);this._reset()},_findCenterPoint:function(L){L=L.geometry||L;switch(L.type){case "point":var T=L;break;case "polyline":T=L.getPoint(0,Math.ceil(L.paths[0].length/2));break;case "polygon":T=L.rings.length-1,T=L.getPoint(T,L.rings[T].length-1)}return this._settings.map.toScreen(T)},_hideAttributeInspector:function(){!this._customAttributeInspector&&this._settings.map.infoWindow&&
this._settings.map.infoWindow.hide()},_toPolylines:function(L){return x.map(L,function(T){var Y=new w(T.spatialReference);x.forEach(T.rings,function(ca){Y.addPath(ca)});return Y})},_isNotesFeature:function(L){var T=L.getLayer(),Y=T?T.types||null:null;if(!Y)return!1;var ca=L.attributes[T.typeIdField],Q;x.some(Y,function(X){return X.id===ca?(Q=X.templates,!0):!1});return Q?(L=Q[0]||null)?this._isShapeTool(L.drawingTool)?!0:!1:!1:!1},_isValidLayer:function(L){var T,Y=this._settings.layerInfos;for(T=
0;T<Y.length;T++){var ca=Y[T];if(L.id==(ca.featureLayer?ca.featureLayer.id:ca.layerId))return!0}return!1},_isShapeTool:function(L){switch(L){case B.TOOL_ARROW:return A.ARROW;case B.TOOL_LEFT_ARROW:return A.LEFT_ARROW;case B.TOOL_RIGHT_ARROW:return A.RIGHT_ARROW;case B.TOOL_UP_ARROW:return A.UP_ARROW;case B.TOOL_DOWN_ARROW:return A.DOWN_ARROW;case B.TOOL_CIRCLE:return A.CIRCLE;case B.TOOL_ELLIPSE:return A.ELLIPSE;case B.TOOL_TRIANGLE:return A.TRIANGLE;case B.TOOL_RECTANGLE:return A.RECTANGLE;default:return null}},
_toDrawTool:function(L,T){var Y=T.geometryType;switch(L){case B.TOOL_POINT:return A.POINT;case B.TOOL_ARROW:return A.ARROW;case B.TOOL_LEFT_ARROW:return A.LEFT_ARROW;case B.TOOL_RIGHT_ARROW:return A.RIGHT_ARROW;case B.TOOL_UP_ARROW:return A.UP_ARROW;case B.TOOL_DOWN_ARROW:return A.DOWN_ARROW;case B.TOOL_CIRCLE:return A.CIRCLE;case B.TOOL_ELLIPSE:return A.ELLIPSE;case B.TOOL_TRIANGLE:return A.TRIANGLE;case B.TOOL_RECTANGLE:return A.RECTANGLE;case B.TOOL_LINE:return A.POLYLINE;case B.TOOL_POLYGON:return A.POLYGON;
case B.TOOL_FREEHAND:return"esriGeometryPolyline"===Y?A.FREEHAND_POLYLINE:A.FREEHAND_POLYGON;default:var ca=A.POINT;"esriGeometryPolyline"===Y?(ca=A.POLYLINE,this._settings.createOptions.polylineDrawTools[0]===Z.CREATE_TOOL_FREEHAND_POLYLINE&&(ca=A.FREEHAND_POLYLINE)):"esriGeometryPolygon"===Y&&(ca=A.POLYGON,this._settings.createOptions.polygonDrawTools[0]===Z.CREATE_TOOL_FREEHAND_POLYGON&&(ca=A.FREEHAND_POLYGON));return ca}},_isModified:function(){var L=this.editToolbar.getCurrentState();return(L.isModified||
this._attributeChanged)&&L.graphic?L.graphic:null},_showInfoWindow:function(L,T){this._customAttributeInspector||this._settings.map.infoWindow.show(L,T)}});p.mixin(Z,{CREATE_TOOL_POLYLINE:"polyline",CREATE_TOOL_FREEHAND_POLYLINE:"freehandpolyline",CREATE_TOOL_POLYGON:"polygon",CREATE_TOOL_FREEHAND_POLYGON:"freehandpolygon",CREATE_TOOL_AUTOCOMPLETE:"autocomplete",CREATE_TOOL_RECTANGLE:"rectangle",CREATE_TOOL_TRIANGLE:"triangle",CREATE_TOOL_CIRCLE:"circle",CREATE_TOOL_ELLIPSE:"ellipse",CREATE_TOOL_ARROW:"arrow",
CREATE_TOOL_UP_ARROW:"uparrow",CREATE_TOOL_DOWN_ARROW:"downarrow",CREATE_TOOL_RIGHT_ARROW:"rightarrow",CREATE_TOOL_LEFT_ARROW:"leftarrow"});p.setObject("dijit.editing.Editor",Z,K);return Z})},"esri/undoManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/when ./kernel ./Evented ./OperationBase".split(" "),function(t,p,x,b,m,f){t=t([f],{declaredClass:"esri.UndoManager",maxOperations:10,canUndo:!1,canRedo:!1,position:0,length:0,onUndo:function(){},onRedo:function(){},onUndoComplete:function(){},
onRedoComplete:function(){},onAdd:function(){},onChange:function(){},constructor:function(d){d=d||{};d.maxOperations&&(this.maxOperations=d.maxOperations);this._historyStack=[]},add:function(d){if(0<this.maxOperations)for(;this._historyStack.length>=this.maxOperations;)this._historyStack.shift();this._historyStack.splice(this.position,0,d);this.position++;this.clearRedo();this.onAdd();this._checkAvailability()},undo:function(){if(0===this.position)return null;var d=this.peekUndo();this.position--;
d?(d=d.performUndo(),this.onUndo(),this._checkAvailability(),b(d).then(p.hitch(this,this.onUndoComplete))):(this.onUndo(),this._checkAvailability())},redo:function(){if(this.position===this._historyStack.length)return null;var d=this.peekRedo();this.position++;d?(d=d.performRedo(),this.onRedo(),this._checkAvailability(),b(d).then(p.hitch(this,this.onRedoComplete))):(this.onRedo(),this._checkAvailability())},_checkAvailability:function(){this.length=this._historyStack.length;0===this.length?this.canUndo=
this.canRedo=!1:0===this.position?(this.canRedo=!0,this.canUndo=!1):this.position===this.length?(this.canUndo=!0,this.canRedo=!1):this.canRedo=this.canUndo=!0;this.onChange()},clearUndo:function(){this._historyStack.splice(0,this.position);this.position=0;this._checkAvailability()},clearRedo:function(){this._historyStack.splice(this.position,this._historyStack.length-this.position);this.position=this._historyStack.length;this._checkAvailability()},peekUndo:function(){if(0<this._historyStack.length&&
0<this.position)return this.get(this.position-1)},peekRedo:function(){if(0<this._historyStack.length&&this.position<this._historyStack.length)return this.get(this.position)},get:function(d){return this._historyStack[d]},remove:function(d){0<this._historyStack.length&&(this._historyStack.splice(d,1),0<this.position&&d<this.position&&this.position--,this._checkAvailability())},destroy:function(){this._historyStack=null}});return m.UndoManager=t})},"esri/OperationBase":function(){define(["dojo/_base/declare",
"dojo/has","./kernel"],function(t,p,x){t=t(null,{declaredClass:"esri.OperationBase",type:"not implemented",label:"not implemented",constructor:function(b){b=b||{};b.label&&(this.label=b.label)},performUndo:function(){},performRedo:function(){}});return x.OperationBase=t})},"esri/toolbars/edit":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/Color dojo/has dojo/dom-construct dojo/dom-style ../kernel ../lang ../sniff ./_toolbar ./_Box ./_GraphicMover ./_VertexEditor ./TextEditor ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/TextSymbol ../graphic".split(" "),
function(t,p,x,b,m,f,d,a,c,l,h,n,g,e,k,w,q,u,r,v,z){var B=p(g,{declaredClass:"esri.toolbars.Edit",constructor:function(A,y){this._map=A;this._tool=0;if(this._map.loaded)this._scratchGL=A.graphics;else var D=b.connect(this._map,"onLoad",this,function(){b.disconnect(D);D=null;this._scratchGL=this._map.graphics});var G=d("esri-mobile");this._defaultOptions=x.mixin({vertexSymbol:new u(u.STYLE_CIRCLE,G?20:12,new r(r.STYLE_SOLID,new f([0,0,0,.5]),1),new f([128,128,128])),ghostVertexSymbol:new u(u.STYLE_CIRCLE,
G?18:10,new r(r.STYLE_SOLID,new f([0,0,0,.5]),1),new f([255,255,255,.75])),ghostLineSymbol:new r(r.STYLE_DOT,new f([128,128,128]),2),allowDeleteVertices:!0,allowAddVertices:!0,rotateHandleOffset:G?24:16,boxLineSymbol:new r(r.STYLE_DASH,new f([64,64,64]),1),boxHandleSymbol:new u(u.STYLE_SQUARE,G?16:9,new r(r.STYLE_SOLID,new f([0,0,0,.5]),1),new f([255,255,255,.75])),textAnchorSymbol:new u(u.STYLE_CIRCLE,10,null,new f([255,0,0]))},y||{})},activate:function(A,y,D){this.deactivate();this._graphic=y;this._options=
x.mixin(x.mixin({},this._defaultOptions),D||{});var G=B.MOVE;D=B.EDIT_VERTICES;var E=B.SCALE,F=B.ROTATE,I=B.EDIT_TEXT,M=!1,P=!1,W=!1,H=this._map,O=H.spatialReference,K=y.geometry.spatialReference;this._geo=!(!O||!K||O.equals(K)||!O.isWebMercator()||4326!==K.wkid);this._isTextPoint=this._prepareTextSymbolEditing(y,A);(A&G)===G&&(M=this._enableMove(y));G=(A&E)===E;F=(A&F)===F;if(G||F)W=this._enableBoxEditing(y,G,F);(A&D)===D&&(P=this._enableVertexEditing(y));(A&I)===I&&this._enableTextEditing(y);if(!(M||
P||W))throw Error("[esri.toolbars.Edit::activate] Unable to activate the tool. Check if the tool is valid for the given geometry type.");if(this._tool=A)this._mapPanEndHandle=b.connect(H,"onPanEnd",this,this._mapPanEndHandler),this._mapExtChgHandle=b.connect(H,"onExtentChange",this,this._mapExtentChangeHandler),this.onActivate(this._tool,y);H.snappingManager&&(M||P)&&H.snappingManager._startSelectionLayerQuery()},deactivate:function(){this._isTextPoint=null;var A=this._tool,y=this._graphic;if(A){var D=
!!this._modified;this._clear();b.disconnect(this._mapPanEndHandle);b.disconnect(this._mapExtChgHandle);this._graphic=this._geo=this._mapPanEndHandle=this._mapExtChgHandle=null;this.onDeactivate(A,y,{isModified:D});this._map.snappingManager&&this._map.snappingManager._stopSelectionLayerQuery()}},refresh:function(){this._refreshMoveables(!0)},getCurrentState:function(){return{tool:this._tool,graphic:this._graphic,isModified:!!this._modified}},onActivate:function(A,y){},onDeactivate:function(A,y,D){},
onGraphicMoveStart:function(A){},onGraphicFirstMove:function(A){this._modified=!0},onGraphicMove:function(A,y){},onGraphicMoveStop:function(A,y){},onGraphicClick:function(A,y){},onVertexMoveStart:function(A,y){},onVertexFirstMove:function(A,y){this._modified=!0},onVertexMove:function(A,y,D){},onVertexMoveStop:function(A,y,D){},onVertexAdd:function(A,y){this._modified=!0},onVertexClick:function(A,y){},onVertexMouseOver:function(A,y){},onVertexMouseOut:function(A,y){},onVertexDelete:function(A,y){this._modified=
!0},onTextEditStart:function(A,y){},onTextEditEnd:function(A){},onScaleStart:function(A){},onScaleFirstMove:function(A){this._modified=!0},onScale:function(A,y){},onScaleStop:function(A,y){},onRotateStart:function(A){},onRotateFirstMove:function(A){this._modified=!0},onRotate:function(A,y){},onRotateStop:function(A,y){},_eventMap:{activate:["tool","graphic"],deactivate:["tool","graphic","info"],"graphic-move-start":["graphic"],"graphic-first-move":["graphic"],"graphic-move":["graphic","transform"],
"graphic-move-stop":["graphic","transform"],"graphic-click":["graphic","info"],"vertex-move-start":["graphic","vertexinfo"],"vertex-first-move":["graphic","vertexinfo"],"vertex-move":["graphic","vertexinfo","transform"],"vertex-move-stop":["graphic","vertexinfo","transform"],"vertex-add":["graphic","vertexinfo"],"vertex-click":["graphic","vertexinfo"],"vertex-mouse-over":["graphic","vertexinfo"],"vertex-mouse-out":["graphic","vertexinfo"],"vertex-delete":["graphic","vertexinfo"],"scale-start":["graphic"],
"scale-first-move":["graphic"],scale:["graphic","info"],"scale-stop":["graphic","info"],"rotate-start":["graphic"],"rotate-first-move":["graphic"],rotate:["graphic","info"],"rotate-stop":["graphic","info"]},_prepareTextSymbolEditing:function(A,y){if("point"===A.geometry.type||"multipoint"===A.geometry.type){var D=A.getLayer(),G=D.renderer;D=A.symbol||D._getSymbol(A);!D&&(G.hasVisualVariables("sizeInfo",!1)||G.hasVisualVariables("colorInfo",!1)||G.hasVisualVariables("opacityInfo",!1))&&G.addBreak&&
G.infos&&1===G.infos.length&&(D=G.infos[0].symbol||G.defaultSymbol);if(D&&"textsymbol"===D.type){if((y&B.SCALE)===B.SCALE||(y&B.ROTATE)===B.ROTATE||(y&B.EDIT_TEXT)===B.EDIT_TEXT){A.setSymbol(new v(D.toJson()));var E=this;this._textSymbolEditor?(this._textSymbolEditor.createForm(A),this._textSymbolEditor.show()):this._options&&this._options.textSymbolEditor?(this._textSymbolEditor=this._options.textSymbolEditor,this._textSymbolEditor.on("symbol-change",function(){E._boxEditor&&E._boxEditor.refresh()})):
t(["../dijit/SymbolEditor"],function(F){if(!E._textSymbolEditor){var I=E._options.textSymbolEditorHolder?a.create("div",null,E._options.textSymbolEditorHolder):a.create("div",null,E._map.root);E._textSymbolEditor=new F({graphic:A},I);F=E._textSymbolEditor.domNode.parentNode.id;c.set(E._textSymbolEditor.domNode,{position:"map_root"===F?"absolute":"relative",left:"map_root"===F?E._map.width/2-100+"px":"5px",top:"20px","z-index":50});E._textSymbolEditor.startup();E._textSymbolEditor.createForm(A);E._textSymbolEditor.show();
E._textSymbolEditor.on("symbol-change",function(){E._boxEditor&&E._boxEditor.refresh()})}})}if((y&B.MOVE)===B.MOVE||(y&B.ROTATE)===B.ROTATE||(y&B.SCALE)===B.SCALE)this._textAnchor=new z(A.geometry,this._options.textAnchorSymbol),this._scratchGL.add(this._textAnchor);return!0}}return!1},_enableMove:function(A){var y=this._map;switch(A.geometry.type){case "point":case "polyline":case "polygon":return this._graphicMover=new k(A,y,this,this._textAnchor),!0}return!1},_enableVertexEditing:function(A){var y=
this._map;switch(A.geometry.type){case "multipoint":case "polyline":case "polygon":return this._vertexEditor=w.create(A,y,this),!0}return!1},_enableBoxEditing:function(A,y,D){var G=this._map,E=A.geometry.type;return"polyline"===E||"polygon"===E||this._isTextPoint?(this._boxEditor=new e(A,G,this,y,D,this._options.uniformScaling,this._isTextPoint),!0):!1},_enableTextEditing:function(A){return this._isTextPoint?(this._textEditor=new q(A,this._map,this),b.connect(this._textEditor,"onEditStart",x.hitch(this,
function(){this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._map.disableKeyboardNavigation();this._disableMove();this._disableBoxEditing()})),!0):!1},_disableMove:function(){var A=this._graphicMover;A&&(A.destroy(),this._graphicMover=null)},_disableVertexEditing:function(){var A=this._vertexEditor;A&&(A.destroy(),this._vertexEditor=null)},_disableBoxEditing:function(){var A=this._boxEditor;A&&(A.destroy(),this._boxEditor=null)},_disableTextEditing:function(){this._textEditor&&
(this._textEditor.destroy(),this._textEditor=null);this._map.enableKeyboardNavigation()},_disableSymbolEditing:function(){this._textSymbolEditor&&this._textSymbolEditor.hide()},_clear:function(){this._disableMove();this._disableVertexEditing();this._disableBoxEditing();this._disableTextEditing();this._disableSymbolEditing();this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._tool=0;this._modified=!1},_mapPanEndHandler:function(){this._refreshMoveables()},
_mapExtentChangeHandler:function(A,y,D){D&&this._refreshMoveables()},_refreshMoveables:function(A){var y=m.filter([this._graphicMover,this._vertexEditor,this._boxEditor],h.isDefined);m.forEach(y,function(D){D.refresh(A)})},_beginOperation:function(A){m.forEach(this._getAffectedTools(A),function(y){y.suspend()})},_endOperation:function(A){m.forEach(this._getAffectedTools(A),function(y){y.resume()})},_getAffectedTools:function(A){var y=[];switch(A){case "MOVE":y=[this._vertexEditor,this._boxEditor];
break;case "VERTICES":y=[this._boxEditor];break;case "BOX":y=[this._vertexEditor]}return y=m.filter(y,h.isDefined)}});x.mixin(B,{MOVE:1,EDIT_VERTICES:2,SCALE:4,ROTATE:8,EDIT_TEXT:16});x.setObject("toolbars.Edit",B,l);return B})},"esri/toolbars/_Box":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/has dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../lang ../geometry/Point ../geometry/Polyline ../symbols/SimpleMarkerSymbol ../geometry/webMercatorUtils ../geometry/jsonUtils ../graphic".split(" "),
function(t,p,x,b,m,f,d,a,c,l,h,n,g,e,k,w,q){t=t(null,{declaredClass:"esri.toolbars._Box",constructor:function(u,r,v,z,B,A,y){this._graphic=u;this._map=r;this._toolbar=v;this._scale=z;this._rotate=B;this._defaultEventArgs={};this._scaleEvent="Scale";this._rotateEvent="Rotate";this._uniformScaling=A;u=v._options;this._markerSymbol=u.boxHandleSymbol;this._lineSymbol=u.boxLineSymbol;this._moveStartHandler=p.hitch(this,this._moveStartHandler);this._firstMoveHandler=p.hitch(this,this._firstMoveHandler);
this._moveStopHandler=p.hitch(this,this._moveStopHandler);this._moveHandler=p.hitch(this,this._moveHandler);this._isTextPoint=y;this._init()},destroy:function(){this._cleanUp();this._graphic=this._map=this._toolbar=this._markerSymbol=this._lineSymbol=null},refresh:function(){this._draw()},suspend:function(){x.forEach(this._getAllGraphics(),function(u){u.hide()})},resume:function(){x.forEach(this._getAllGraphics(),function(u){u.show()});this._draw()},_init:function(){this._draw()},_cleanUp:function(){this._connects&&
x.forEach(this._connects,b.disconnect);var u=this._toolbar._scratchGL;this._anchors&&x.forEach(this._anchors,function(r){u.remove(r.graphic);(r=r.moveable)&&r.destroy()});this._box&&u.remove(this._box);this._box=this._anchors=this._connects=null},_draw:function(){if(this._graphic.getDojoShape()){var u=this._map,r=this._toolbar._scratchGL,v=this._getBoxCoords(),z=new g(u.spatialReference),B=p.clone(x.filter(v,function(A,y){return 8!==y&&0===y%2}));B[0]&&B.push([B[0][0],B[0][1]]);z.addPath(B);this._rotate&&
z.addPath([v[1],v[8]]);this._box?this._box.setGeometry(z):(this._box=new q(z,this._lineSymbol),r.add(this._box));this._anchors?x.forEach(this._anchors,function(A,y){this._scale||(y=8);var D=new n(v[y],u.spatialReference);A.graphic.setGeometry(D);D=A.moveable;var G=A.graphic.getDojoShape();G&&(D?G!==D.shape&&(D.destroy(),A.moveable=this._getMoveable(A.graphic,y)):A.moveable=this._getMoveable(A.graphic,y))},this):(this._anchors=[],this._connects=[],x.forEach(v,function(A,y){if(this._scale||!(8>y)){A=
new n(A,u.spatialReference);var D=new q(A,this._markerSymbol);this._isTextPoint&&1===y%2&&D.hide();r.add(D);this._anchors.push({graphic:D,moveable:this._getMoveable(D,y)})}},this))}else this._cleanUp()},_getBoxCoords:function(u){var r=this._map,v=[],z,B,A;if(this._isTextPoint){var y=this._graphic.getNode().getBoundingClientRect();var D=r.__container.getBoundingClientRect();y=[{x:y.left-D.left,y:y.top-D.top},{x:y.right-D.left,y:y.top-D.top},{x:y.right-D.left,y:y.bottom-D.top},{x:y.left-D.left,y:y.bottom-
D.top}]}else y=this._getTransformedBoundingBox(this._graphic);x.forEach(y,function(G,E,F){z=G;(B=F[E+1])||(B=F[0]);A={x:(z.x+B.x)/2,y:(z.y+B.y)/2};u||(z=r.toMap(z),A=r.toMap(A));v.push([z.x,z.y]);v.push([A.x,A.y])});this._rotate&&(y=p.clone(v[1]),y=u?{x:y[0],y:y[1]}:r.toScreen({x:y[0],y:y[1],spatialReference:r.spatialReference}),y.y-=this._toolbar._options.rotateHandleOffset,u||(y=r.toMap(y)),v.push([y.x,y.y]));return v},_getTransformedBoundingBox:function(u){var r=this._map,v=u.geometry.getExtent(),
z=u.geometry.spatialReference;u=new n(v.xmin,v.ymax,z);v=new n(v.xmax,v.ymin,z);u=r.toScreen(u);v=r.toScreen(v);return[{x:u.x,y:u.y},{x:v.x,y:u.y},{x:v.x,y:v.y},{x:u.x,y:v.y}]},_getAllGraphics:function(){var u=[this._box];this._anchors&&x.forEach(this._anchors,function(r){u.push(r.graphic)});return u=x.filter(u,h.isDefined)},_getMoveable:function(u,r){var v=u.getDojoShape();if(v){var z=new a(v);z._index=r;this._connects.push(b.connect(z,"onMoveStart",this._moveStartHandler));this._connects.push(b.connect(z,
"onFirstMove",this._firstMoveHandler));this._connects.push(b.connect(z,"onMoveStop",this._moveStopHandler));z.onMove=this._moveHandler;(v=v.getEventSource())&&d.set(v,"cursor",this._toolbar._cursors["box"+r]);return z}},_moveStartHandler:function(u){this._toolbar["on"+(8===u.host._index?this._rotateEvent:this._scaleEvent)+"Start"](this._graphic)},_firstMoveHandler:function(u){this._toolbar._deactivateScrollWheel();var r=u.host._index,v=this._wrapOffset=u.host.shape._wrapOffsets[0]||0,z=this._graphic.getLayer().getNavigationTransform();
u=x.map(this._getBoxCoords(!0),function(A){return{x:A[0]+v,y:A[1]}});var B=this._isTextPoint?this._map.toScreen(this._graphic.geometry):{x:u[1].x,y:u[3].y};this._centerCoord=c.multiplyPoint(c.invert(z),B);if(8===r)B=c.multiplyPoint(c.invert(z),u[1]),this._isTextPoint&&(this._centerCoord=this._deNormalizePoint(this._centerCoord,B)),this._startLine=[this._centerCoord,B],this._moveLine=p.clone(this._startLine);else if(B=c.multiplyPoint(c.invert(z),u[r]),z=c.multiplyPoint(c.invert(z),u[(r+4)%8]),this._isTextPoint&&
(this._centerCoord=this._deNormalizePoint(this._centerCoord,B)),this._firstMoverToAnchor=Math.sqrt((B.x-this._centerCoord.x)*(B.x-this._centerCoord.x)+(B.y-this._centerCoord.y)*(B.y-this._centerCoord.y)),this._startBox=z,this._startBox.width=u[4].x-u[0].x,this._startBox.height=u[4].y-u[0].y,this._moveBox=p.clone(this._startBox),this._xfactor=B.x>z.x?1:-1,this._yfactor=B.y>z.y?1:-1,1===r||5===r)this._xfactor=0;else if(3===r||7===r)this._yfactor=0;this._toolbar._beginOperation("BOX");this._toolbar["on"+
(8===r?this._rotateEvent:this._scaleEvent)+"FirstMove"](this._graphic)},_moveHandler:function(u,r){var v=u.host._index,z=this._defaultEventArgs,B;z.angle=0;z.scaleX=1;z.scaleY=1;if(8===v){var A=this._startLine;var y=this._moveLine;var D=y[1];D.x+=r.dx;D.y+=r.dy;D=this._getAngle(A,y);this._isTextPoint&&(D+=this._graphic.symbol.angle);y=c.rotategAt(D,A[0]);this._graphic.getDojoShape().setTransform(y);z.transform=y;z.angle=D;z.around=A[0]}else{A=this._startBox;y=this._moveBox;y.width+=r.dx*this._xfactor;
y.height+=r.dy*this._yfactor;this._uniformScaling||this._isTextPoint?(A=y.x+this._xfactor*y.width,y=y.y+this._yfactor*y.height,A=Math.sqrt((A-this._centerCoord.x)*(A-this._centerCoord.x)+(y-this._centerCoord.y)*(y-this._centerCoord.y)),this._scaleRatio=D=B=A/this._firstMoverToAnchor,A=this._centerCoord):(D=y.width/A.width,B=y.height/A.height,A={x:A.x,y:A.y});if(isNaN(D)||Infinity===D||-Infinity===D)D=1;if(isNaN(B)||Infinity===B||-Infinity===B)B=1;y=c.scaleAt(D,B,A);if(this._isTextPoint){var G=c.rotategAt(this._graphic.symbol.angle,
A);this._graphic.getDojoShape().setTransform([G,y])}else this._graphic.getDojoShape().setTransform(y);z.transform=y;z.scaleX=D;z.scaleY=B;z.around=A}this._toolbar["on"+(8===v?this._rotateEvent:this._scaleEvent)](this._graphic,z)},_moveStopHandler:function(u){this._toolbar._activateScrollWheel();var r=this._graphic,v=this._toolbar,z=v._geo?k.geographicToWebMercator(r.geometry):r.geometry,B=z.spatialReference,A=r.getDojoShape(),y=A.getTransform(),D=r.getLayer().getNavigationTransform();this._isTextPoint?
(r=this._graphic.symbol,8===u.host._index?r.angle+=this._getAngle(this._startLine,this._moveLine):r.font.setSize(Math.round(r.font.size*this._scaleRatio*100)/100),this._graphic.setSymbol(r)):(z=z.toJson(),this._updateSegments(z.paths||z.rings,y,D,B),A.setTransform(null),z=w.fromJson(z),r.setGeometry(v._geo?k.webMercatorToGeographic(z,!0):z));this._draw();this._startLine=this._moveLine=this._startBox=this._moveBox=this._xfactor=this._yfactor=null;v._endOperation("BOX");this._defaultEventArgs.transform=
y;v["on"+(8===u.host._index?this._rotateEvent:this._scaleEvent)+"Stop"](this._graphic,this._defaultEventArgs)},_updateSegments:function(u,r,v,z){var B=this._map,A=this._wrapOffset||0;x.forEach(u,function(y){x.forEach(y,function(D){this._updatePoint(D,z,A,c,B,v,r)},this)},this)},_updatePoint:function(u,r,v,z,B,A,y){r=B.toScreen({x:u[0],y:u[1],spatialReference:r},!0);r.x+=v;r=z.multiplyPoint([A,y,z.invert(A)],r);r.x-=v;v=B.toMap(r);u[0]=v.x;u[1]=v.y},_getAngle:function(u,r){return 180*Math.atan2(r[0].y-
r[1].y,r[0].x-r[1].x)/Math.PI-180*Math.atan2(u[0].y-u[1].y,u[0].x-u[1].x)/Math.PI},_deNormalizePoint:function(u,r){var v=this._map._getFrameWidth();if(-1===v)return u;for(var z={x:u.x,y:u.y};Math.abs(z.x-r.x)>=v;)z.x=z.x<r.x?z.x+v:z.x-v;var B=Math.abs(z.x-r.x);Math.abs(z.x-r.x+v)<B?z.x+=v:Math.abs(z.x-r.x-v)<B&&(z.x-=v);return z}});p.setObject("toolbars._Box",t,l);return t})},"dojox/gfx/Moveable":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/array dojo/_base/event dojo/topic dojo/touch dojo/dom-class dojo/_base/window ./Mover dojo/mouse".split(" "),
function(t,p,x,b,m,f,d,a,c,l){return p("dojox.gfx.Moveable",null,{constructor:function(h,n){this.shape=h;this.delay=n&&0<n.delay?n.delay:0;this.mover=n&&n.mover?n.mover:c;this.leftButtonOnly=n&&n.leftButtonOnly;this.events=[this.shape.on(f.press,t.hitch(this,"onMouseDown"))]},destroy:function(){x.forEach(this.events,function(h){h.remove()});this.events=this.shape=null},onMouseDown:function(h){this.delay?(this.events.push(this.shape.on(f.move,t.hitch(this,"onMouseMove")),this.shape.on(f.release,t.hitch(this,
"onMouseUp"))),this._lastX=h.clientX,this._lastY=h.clientY):this.leftButtonOnly&&!l.isLeft(h)||new this.mover(this.shape,h,this);b.stop(h)},onMouseMove:function(h){var n=h.clientY;if(Math.abs(h.clientX-this._lastX)>this.delay||Math.abs(n-this._lastY)>this.delay)this.onMouseUp(h),new this.mover(this.shape,h,this);b.stop(h)},onMouseUp:function(h){this.events.pop().remove()},onMoveStart:function(h){m.publish("/gfx/move/start",h);d.add(a.body(),"dojoMove")},onMoveStop:function(h){m.publish("/gfx/move/stop",
h);d.remove(a.body(),"dojoMove")},onFirstMove:function(h){},onMove:function(h,n,g){this.onMoving(h,n,g);this.shape.applyLeftTransform(n);this.onMoved(h,n)},onMoving:function(h,n){},onMoved:function(h,n){}})})},"dojox/gfx/Mover":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/on dojo/touch dojo/_base/event".split(" "),function(t,p,x,b,m,f){return x("dojox.gfx.Mover",null,{constructor:function(d,a,c){this.shape=d;this.lastX=a.clientX;this.lastY=a.clientY;d=this.host=c;a=
document;c=b(a,m.move,t.hitch(this,"onFirstMove"));this.events=[b(a,m.move,t.hitch(this,"onMouseMove")),b(a,m.release,t.hitch(this,"destroy")),b(a,"dragstart",t.hitch(f,"stop")),b(a,"selectstart",t.hitch(f,"stop")),c];if(d&&d.onMoveStart)d.onMoveStart(this)},onMouseMove:function(d){var a=d.clientX,c=d.clientY;this.host.onMove(this,{dx:a-this.lastX,dy:c-this.lastY},d);this.lastX=a;this.lastY=c;f.stop(d)},onFirstMove:function(){this.host.onFirstMove(this);this.events.pop().remove()},destroy:function(){p.forEach(this.events,
function(a){a.remove()});var d=this.host;if(d&&d.onMoveStop)d.onMoveStop(this);this.events=this.shape=null}})})},"esri/toolbars/_GraphicMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/json dojo/dom-style dojox/gfx/Moveable dojox/gfx/Mover dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/webMercatorUtils ../geometry/ScreenPoint ../geometry/Point".split(" "),function(t,p,x,b,m,f,d,a,c,l,h,n,g,e){var k=t(null,{declaredClass:"esri.toolbars._GraphicMover",
constructor:function(w,q,u,r){this.graphic=w;this.map=q;this.toolbar=u;this.tempPt=r;this._enableGraphicMover();this._moved=!1},refresh:function(w){var q=this.graphic.getDojoShape();!q||!w&&q._hostGraphic||(this._disableGraphicMover(),this._enableGraphicMover())},destroy:function(){this._disableGraphicMover()},hasMoved:function(){return this._moved},_enableGraphicMover:function(){var w=this.graphic,q=w.getDojoShape();q&&(q._hostGraphic=w,this._moveable=new f(q,{mover:k.Mover}),this._moveStartHandle=
x.connect(this._moveable,"onMoveStart",this,this._moveStartHandler),this._firstMoveHandle=x.connect(this._moveable,"onFirstMove",this,this._firstMoveHandler),this._movingHandle=x.connect(this._moveable,"onMoving",this,this._movingHandler),this._moveStopHandle=x.connect(this._moveable,"onMoveStop",this,this._moveStopHandler),(w=q.getEventSource())&&m.set(w,"cursor",this.toolbar._cursors.move))},_disableGraphicMover:function(){var w=this._moveable;if(w){x.disconnect(this._moveStartHandle);x.disconnect(this._firstMoveHandle);
x.disconnect(this._movingHandle);x.disconnect(this._moveStopHandle);var q=w.shape;q&&(q._hostGraphic=null,(q=q.getEventSource())&&m.set(q,"cursor","inherit"));w.destroy()}this._moveable=null},_moveStartHandler:function(){var w=this.graphic,q=this.map;this._startTx=w.getDojoShape().getTransform();"point"===this.graphic.geometry.type&&q.snappingManager&&q.snappingManager._setUpSnapping();this.toolbar.onGraphicMoveStart(w)},_firstMoveHandler:function(){this.toolbar._beginOperation("MOVE");this.toolbar.onGraphicFirstMove(this.graphic)},
_movingHandler:function(w,q,u){w=w.shape.getTransform();q=this.map;var r;h("esri-pointer")?r=q.navigationManager.pointerEvents._processTouchEvent(u,u):u&&"pointermove"===u.type&&(r=l.prototype._processTouchEvent.call({map:q},u,u));r&&q.snappingManager&&q.snappingManager._onSnappingMouseMoveHandler(r);this.tempPt&&this.tempPt.getDojoShape().setTransform(w);this.toolbar.onGraphicMove(this.graphic,w)},_moveStopHandler:function(w){var q=this.graphic,u=this.toolbar,r=this.map,v=u._geo?n.geographicToWebMercator(q.geometry):
q.geometry,z=v.type,B=q.getDojoShape(),A=B.getTransform();if(b.toJson(A)!==b.toJson(this._startTx)){this._moved=!0;switch(z){case "point":z=[A,a.invert(this._startTx)];if(r.snappingManager)var y=r.snappingManager._snappingPoint;v=y||r.toMap(a.multiplyPoint(z,r.toScreen(v,!0)));r.snappingManager&&r.snappingManager._killOffSnapping();break;case "polyline":v=this._updatePolyGeometry(v,v.paths,A);break;case "polygon":v=this._updatePolyGeometry(v,v.rings,A)}B.setTransform(null);q.setGeometry(u._geo?n.webMercatorToGeographic(v,
!0):v);this.tempPt&&this.tempPt.setGeometry(new e(q.geometry.toJson()))}else this._moved=!1;u._endOperation("MOVE");u.onGraphicMoveStop(q,A);this._moved||(w=w.__e,r=this.map.position,w=new g(w.pageX-r.x,w.pageY-r.y),u.onGraphicClick(q,{screenPoint:w,mapPoint:this.map.toMap(w)}))},_updatePolyGeometry:function(w,q,u){var r=this.map,v=w.getPoint(0,0);r=r.toMap(r.toScreen(v).offset(u.dx,u.dy));u=r.x-v.x;v=r.y-v.y;var z;for(r=0;r<q.length;r++){var B=q[r];for(z=0;z<B.length;z++){var A=w.getPoint(r,z);w.setPoint(r,
z,A.offset(u,v))}}return w}});k.Mover=t(d,{declaredClass:"esri.toolbars._Mover",constructor:function(w,q,u){this.__e=q}});p.setObject("toolbars._GraphicMover",k,c);p.setObject("toolbars._Mover",k.Mover,c);return k})},"esri/toolbars/_VertexEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/has dijit/Menu dijit/MenuItem ../kernel ./_VertexMover ../geometry/Point ../geometry/jsonUtils dojo/i18n!../nls/jsapi".split(" "),function(t,p,x,b,m,f,d,a,c,l,
h,n){var g=t(null,{declaredClass:"esri.toolbars._GraphicVertexEditor",constructor:function(e,k,w){this.graphic=e;this.map=k;this.toolbar=w;e=w._options;this._symbol1=e.vertexSymbol;this._symbol2=e.ghostVertexSymbol;k=e.ghostLineSymbol;this._lineStroke={style:k.style,width:k.width,color:k.color};this._canDel=e.allowDeleteVertices;this._canAdd=e.allowAddVertices;this._addControllers()},destroy:function(){this._removeControllers()},refresh:function(e){e?(this._removeControllers(),this._addControllers()):
(this._refresh(this._vertexMovers),this._refresh(this._mpVertexMovers))},suspend:function(){this._suspended||this._removeControllers();this._suspended=!0},resume:function(){this._suspended&&this._addControllers();this._suspended=!1},_addControllers:function(){this._firstMoveHandle=x.connect(c,"onFirstMove",this,this._firstMoveHandler);this._moveStopHandle=x.connect(c,"onMoveStop",this,this._moveStopHandler);this._vertexMovers=this._add(this._getSegments(this.graphic.geometry),this._symbol1);this._canAdd&&
(this._mpVertexMovers=this._add(this._getMidpointSegments(this.graphic.geometry),this._symbol2,!0));var e=this._getGraphicsLayer();this._mouseOverHandle=x.connect(e,"onMouseOver",this,this._mouseOverHandler);this._mouseOutHandle=x.connect(e,"onMouseOut",this,this._mouseOutHandler);this._canDel&&(this._ctxMenu=new f({style:"font-size: 12px; margin-left: 5px; margin-top: 5px;"}),e=this._ctxDelete=new d({label:n.toolbars.edit.deleteLabel,iconClass:"vertexDeleteIcon",style:"outline: none;"}),this._deleteHandle=
x.connect(e,"onClick",this,this._deleteHandler),this._ctxMenu.addChild(e),this._ctxMenu.startup())},_removeControllers:function(){x.disconnect(this._firstMoveHandle);x.disconnect(this._moveStopHandle);x.disconnect(this._mouseOverHandle);x.disconnect(this._mouseOutHandle);x.disconnect(this._deleteHandle);this._ctxMenu&&(this._ctxDelete=null,this._unbindCtxNode(),this._ctxMenu.destroyRecursive());this._remove(this._vertexMovers);this._remove(this._mpVertexMovers);this._vertexMovers=this._mpVertexMovers=
null},_add:function(e,k,w){var q,u,r=this.graphic,v=[];for(q=0;q<e.length;q++){var z=e[q],B=[];for(u=0;u<z.length;u++)B.push(new c(z[u],k,r,q,u,z.length,this,w));v.push(B)}return v},_remove:function(e){e&&b.forEach(e,function(k){b.forEach(k,function(w){w.destroy()})})},_refresh:function(e){e&&b.forEach(e,function(k){b.forEach(k,function(w){w.refresh()})})},_isNew:function(e){return-1===b.indexOf(this._vertexMovers[e.segIndex],e)?!0:!1},_getGraphicsLayer:function(){return this.toolbar._scratchGL},
_deleteHandler:function(e){e=this._selectedMover;this._updateRelatedGraphic(e,e.relatedGraphic,e.graphic.geometry,e.segIndex,e.ptIndex,e.segLength,!1,!0);this._canAdd&&this._deleteMidpoints(e);this._deleteVertex(e);this.toolbar._endOperation("VERTICES")},_mouseOverHandler:function(e){e=e.graphic;var k=this._findMover(e);k&&(this.toolbar.onVertexMouseOver(this.graphic,k._getInfo()),k._placeholder||(this._selectedMover=k,this._canDel&&this._bindCtxNode(e.getDojoShape().getNode())))},_mouseOutHandler:function(e){if(e=
this._findMover(e.graphic))this.toolbar.onVertexMouseOut(this.graphic,e._getInfo())},_bindCtxNode:function(e){this._unbindCtxNode();this._ctxDelete.set("disabled",this._selectedMover.segLength<=this.minLength?!0:!1);this._ctxMenu.bindDomNode(e);this._bindNode=e},_unbindCtxNode:function(){var e=this._bindNode;e&&this._ctxMenu.unBindDomNode(e)},_findMover:function(e){var k=[];var w=this._mpVertexMovers;b.forEach(this._vertexMovers,function(u){k=k.concat(u)});w&&b.forEach(w,function(u){k=k.concat(u)});
for(w=0;w<k.length;w++){var q=k[w];if(q.graphic===e)return q}},_firstMoveHandler:function(e){!this._isNew(e)&&this._canAdd&&this._hideRelatedMidpoints(e);this.toolbar._beginOperation("VERTICES")},_moveStopHandler:function(e,k){var w=this._isNew(e);k&&(k.dx||k.dy)?(this._updateRelatedGraphic(e,e.relatedGraphic,e.graphic.geometry,e.segIndex,e.ptIndex,e.segLength,w),this._canAdd&&(w?this._addMidpoints(e):(this._repositionRelatedMidpoints(e),this._showRelatedMidpoints(e))),this.toolbar._endOperation("VERTICES")):
!w&&this._canAdd&&this._showRelatedMidpoints(e)},_showRelatedMidpoints:function(e){var k=this._getAdjacentMidpoints(e.ptIndex,e.segLength),w=this._mpVertexMovers[e.segIndex];for(e=0;e<k.length;e++){var q=w[k[e]];q.graphic.show();q.refresh()}},_hideRelatedMidpoints:function(e){var k=this._getAdjacentMidpoints(e.ptIndex,e.segLength),w=this._mpVertexMovers[e.segIndex];for(e=0;e<k.length;e++)w[k[e]].graphic.hide()},_repositionRelatedMidpoints:function(e){var k,w=this._getAdjacentMidpoints(e.ptIndex,e.segLength),
q=this._mpVertexMovers[e.segIndex];for(k=0;k<w.length;k++){var u=this._getAdjacentVertices(w[k],e.segLength),r=e.relatedGraphic.geometry.getPoint(e.segIndex,u[0]);u=e.relatedGraphic.geometry.getPoint(e.segIndex,u[1]);r=new l({x:(r.x+u.x)/2,y:(r.y+u.y)/2,spatialReference:r.spatialReference.toJson()});q[w[k]].graphic.setGeometry(r)}},_addMidpoints:function(e){var k=e.segIndex,w=e.ptIndex,q=e.segLength,u=w+1,r,v=q+1;this._mpVertexMovers[k].splice(w,1);var z=this._vertexMovers[k];for(r=0;r<u;r++)z[r].segLength+=
1;for(r=u;r<z.length;r++)z[r].ptIndex+=1,z[r].segLength+=1;e.ptIndex=u;e.segLength=z.length+1;z.splice(u,0,e);e.graphic.setSymbol(this._symbol1);z=this._mpVertexMovers[k];for(r=0;r<w;r++)z[r].segLength+=1;for(r=w;r<q-1;r++)z[r].ptIndex+=1,z[r].segLength+=1;u=this._getAdjacentVertices(w,v);k=this._getAdjacentVertices(w+1,v);q=e.relatedGraphic.geometry.getPoint(e.segIndex,u[0]);r=e.relatedGraphic.geometry.getPoint(e.segIndex,u[1]);u=new l({x:(q.x+r.x)/2,y:(q.y+r.y)/2,spatialReference:q.spatialReference.toJson()});
q=e.relatedGraphic.geometry.getPoint(e.segIndex,k[0]);r=e.relatedGraphic.geometry.getPoint(e.segIndex,k[1]);k=new l({x:(q.x+r.x)/2,y:(q.y+r.y)/2,spatialReference:q.spatialReference.toJson()});q=new c(u,this._symbol2,this.graphic,e.segIndex,w,v,this,!0);e=new c(k,this._symbol2,this.graphic,e.segIndex,w+1,v,this,!0);z.splice(w,0,q,e)},_deleteVertex:function(e){var k,w=e.ptIndex,q=this._vertexMovers[e.segIndex];for(k=0;k<w;k++)--q[k].segLength;for(k=w+1;k<q.length;k++){var u=q[k];--u.ptIndex;--u.segLength}q.splice(w,
1);k=e._getInfo();e.destroy();this.toolbar.onVertexDelete(this.graphic,k)}});p.mixin(g,{create:function(e,k,w){switch(e.geometry.type){case "multipoint":return new g.MultipointVertexEditor(e,k,w);case "polyline":return new g.PolylineVertexEditor(e,k,w);case "polygon":return new g.PolygonVertexEditor(e,k,w)}}});g.MultipointVertexEditor=t(g,{declaredClass:"esri.toolbars._MultipointVertexEditor",minLength:1,constructor:function(){this._moveStartHandle=x.connect(c,"onMoveStart",this,this._moveStartHandler);
x.disconnect(this._firstMoveHandle)},destroy:function(){this.inherited(arguments);x.disconnect(this._moveStartHandle)},_getSegments:function(e){var k=e.points,w=[],q=e.spatialReference;for(e=0;e<k.length;e++){var u=k[e];w.push(new l({x:u[0],y:u[1],spatialReference:q.toJson()}))}return[w]},_getMidpointSegments:function(e){return[]},_getControlPoints:function(e,k,w,q,u){return[]},_getGraphicsLayer:function(){return this.graphic._graphicsLayer},_mouseOverHandler:function(e){var k=e.graphic;if(e=this._findMover(e))this.toolbar.onVertexMouseOver(k,
e._getInfo()),this._selectedMover=e,this._canDel&&this._bindCtxNode(e.graphic.getDojoShape().getNode())},_mouseOutHandler:function(e){var k=e.graphic;if(e=this._findMover(e))this.toolbar.onVertexMouseOut(k,e._getInfo())},_findMover:function(e){var k=[].concat(this._vertexMovers[0]),w=e.target;for(e=0;e<k.length;e++){var q=k[e];if(q.graphic.getDojoShape().getNode()===w)return q}},_moveStartHandler:function(e){var k=e.ptIndex,w=e.segLength-1,q=e.relatedGraphic.geometry.points;e=q.splice(k,1);q.push(e[0]);
q=this._vertexMovers[0];for(e=w;e>k;e--)--q[e].ptIndex;e=q.splice(k,1);q.push(e[0]);e[0].ptIndex=w},_moveStopHandler:function(e){this._updateRelatedGraphic(e,e.relatedGraphic,e.graphic.geometry,e.segIndex,e.ptIndex,e.segLength);this.toolbar._endOperation("VERTICES")},_updateRelatedGraphic:function(e,k,w,q,u,r,v,z){e=k.geometry;z?e.removePoint(u):e.setPoint(u,w);k.setGeometry(e)},_deleteMidpoints:function(e){}});g.PolylineVertexEditor=t(g,{declaredClass:"esri.toolbars._PolylineVertexEditor",minLength:2,
_getSegments:function(e){var k,w,q=e.paths,u=[];for(k=0;k<q.length;k++){var r=q[k],v=[];for(w=0;w<r.length;w++)v.push(e.getPoint(k,w));u.push(v)}return u},_getMidpointSegments:function(e){var k,w,q=e.paths,u=[],r=e.spatialReference;for(k=0;k<q.length;k++){var v=q[k],z=[];for(w=0;w<v.length-1;w++){var B=e.getPoint(k,w),A=e.getPoint(k,w+1);B=new l({x:(B.x+A.x)/2,y:(B.y+A.y)/2,spatialReference:r.toJson()});z.push(B)}u.push(z)}return u},_getControlPoints:function(e,k,w,q,u){var r=this.map,v,z;this._isNew(e)?
(e=q,q+=1,0<=e&&(v=r.toScreen(k.getPoint(w,e))),q<=u&&(z=r.toScreen(k.getPoint(w,q)))):(e=q-1,q+=1,0<=e&&(v=r.toScreen(k.getPoint(w,e))),q<u&&(z=r.toScreen(k.getPoint(w,q))));return[v,z]},_getAdjacentMidpoints:function(e,k){var w=[],q=e-1;0<=q&&w.push(q);e<k-1&&w.push(e);return w},_getAdjacentVertices:function(e,k){return[e,e+1]},_deleteMidpoints:function(e){var k=this._mpVertexMovers[e.segIndex],w=k.length-1,q=this._getAdjacentMidpoints(e.ptIndex,e.segLength).sort(),u,r=q[0];for(u=0;u<r;u++)--k[u].segLength;
for(u=r+1;u<k.length;u++){var v=k[u];--v.ptIndex;--v.segLength}if(1===q.length)k.splice(r,1)[0].destroy();else for(v=this._getAdjacentVertices(r,w),u=e.relatedGraphic.geometry.getPoint(e.segIndex,v[0]),v=e.relatedGraphic.geometry.getPoint(e.segIndex,v[1]),u=new l({x:(u.x+v.x)/2,y:(u.y+v.y)/2,spatialReference:u.spatialReference.toJson()}),e=new c(u,this._symbol2,this.graphic,e.segIndex,r,w,this,!0),k=k.splice(r,q.length,e),u=0;u<k.length;u++)k[u].destroy()},_updateRelatedGraphic:function(e,k,w,q,u,
r,v,z){e=k.geometry;v?e.insertPoint(q,u+1,h.fromJson(w.toJson())):z?e.removePoint(q,u):e.setPoint(q,u,h.fromJson(w.toJson()));k.setGeometry(e)}});g.PolygonVertexEditor=t(g,{declaredClass:"esri.toolbars._PolygonVertexEditor",minLength:3,_getSegments:function(e){var k,w,q=e.rings,u=[];for(k=0;k<q.length;k++){var r=q[k],v=[];for(w=0;w<r.length-1;w++)v.push(e.getPoint(k,w));u.push(v)}return u},_getMidpointSegments:function(e){var k,w,q=e.rings,u=[],r=e.spatialReference;for(k=0;k<q.length;k++){var v=q[k],
z=[];for(w=0;w<v.length-1;w++){var B=e.getPoint(k,w),A=e.getPoint(k,w+1);B=new l({x:(B.x+A.x)/2,y:(B.y+A.y)/2,spatialReference:r.toJson()});z.push(B)}u.push(z)}return u},_getControlPoints:function(e,k,w,q,u){var r=this.map;this._isNew(e)?e=q:(e=q-1,e=0>e?(u+e)%u:e);q=(q+1)%u;u=r.toScreen(k.getPoint(w,e));k=r.toScreen(k.getPoint(w,q));return[u,k]},_getAdjacentMidpoints:function(e,k){var w=e-1;return[0>w?(k+w)%k:w,e]},_getAdjacentVertices:function(e,k){return[e,(e+1)%k]},_deleteMidpoints:function(e){var k=
e.ptIndex,w=this._mpVertexMovers[e.segIndex],q=w.length-1,u=this._getAdjacentMidpoints(k,e.segLength).sort();var r=u[0];var v=u[u.length-1];if(0===k){var z=this._getAdjacentVertices(q-1,q);k=e.relatedGraphic.geometry.getPoint(e.segIndex,z[0]);z=e.relatedGraphic.geometry.getPoint(e.segIndex,z[1]);k=new l({x:(k.x+z.x)/2,y:(k.y+z.y)/2,spatialReference:k.spatialReference.toJson()});e=new c(k,this._symbol2,this.graphic,e.segIndex,q-1,q,this,!0);w.splice(v,1,e)[0].destroy();w.splice(r,1)[0].destroy();for(u=
0;u<w.length-1;u++)r=w[u],--r.ptIndex,--r.segLength}else{z=this._getAdjacentVertices(r,q);k=e.relatedGraphic.geometry.getPoint(e.segIndex,z[0]);z=e.relatedGraphic.geometry.getPoint(e.segIndex,z[1]);k=new l({x:(k.x+z.x)/2,y:(k.y+z.y)/2,spatialReference:k.spatialReference.toJson()});e=new c(k,this._symbol2,this.graphic,e.segIndex,r,q,this,!0);v=w.splice(r,u.length,e);for(u=0;u<v.length;u++)v[u].destroy();for(u=0;u<r;u++)--w[u].segLength;for(u=r+1;u<w.length;u++)r=w[u],--r.ptIndex,--r.segLength}},_updateRelatedGraphic:function(e,
k,w,q,u,r,v,z){e=k.geometry;v?e.insertPoint(q,u+1,h.fromJson(w.toJson())):z?(e.removePoint(q,u),0===u&&e.setPoint(q,r-1,h.fromJson(e.getPoint(q,0).toJson()))):(e.setPoint(q,u,h.fromJson(w.toJson())),0===u&&e.setPoint(q,r,h.fromJson(w.toJson())));k.setGeometry(e)}});p.setObject("toolbars._GraphicVertexEditor",g,a);p.setObject("toolbars._MultipointVertexEditor",g.MultipointVertexEditor,a);p.setObject("toolbars._PolylineVertexEditor",g.PolylineVertexEditor,a);p.setObject("toolbars._PolygonVertexEditor",
g.PolygonVertexEditor,a);return g})},"esri/toolbars/_VertexMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/sniff dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/Point ../graphic ../geometry/webMercatorUtils".split(" "),function(t,p,x,b,m,f,d,a,c,l,h,n,g){t=t(null,{declaredClass:"esri.toolbars.VertexMover",constructor:function(e,k,w,q,u,r,v,z){this.point=e;this.symbol=k;this.relatedGraphic=w;this.segIndex=q;this.ptIndex=
u;this.segLength=r;this.editor=v;this.map=v.map;this._scratchGL=v.toolbar._scratchGL;this._placeholder=z||!1;this._type=w.geometry.type;this._init();this._enable()},refresh:function(e){if(e||this._needRefresh())this._disable(),this._enable()},destroy:function(){this._disable();this.graphic&&this._scratchGL.remove(this.graphic);this.point=this.symbol=this.graphic=this.relatedGraphic=this.segIndex=this.ptIndex=this.segLength=this.editor=this.map=this._scratchGL=null},_init:function(){var e=new h(this.point.toJson());
e=new n(e,this.symbol);switch(this._type){case "multipoint":e._shape=this.relatedGraphic.getDojoShape().children[this.ptIndex];break;case "polyline":case "polygon":this._scratchGL.add(e)}this.graphic=e},_enable:function(){var e=this.graphic.getDojoShape();e&&(e._hasMover=!0,this._moveable=this._getMoveable(e),(e=e.getEventSource())&&m.set(e,"cursor",this.editor.toolbar._cursors[this._placeholder?"move-gv":"move-v"]))},_disable:function(){var e=this._moveable;if(e){x.disconnect(this._startHandle);
x.disconnect(this._firstHandle);x.disconnect(this._movingHandle);x.disconnect(this._stopHandle);var k=e.shape;k&&(k=k.getEventSource())&&m.set(k,"cursor","inherit");e.destroy();this._moveable=null}},_needRefresh:function(){var e=this.graphic.getDojoShape(),k=!1;if(e)switch(this._type){case "multipoint":var w=this.relatedGraphic.getDojoShape();w&&(w=w.children[this.ptIndex],e!==w&&(this.graphic._shape=w,k=!0));break;case "polyline":case "polygon":k=!e._hasMover}return k},_getMoveable:function(e){e=
new f(e,b("mac")&&b("ff")&&!l("esri-touch")&&{leftButtonOnly:!0});this._startHandle=x.connect(e,"onMoveStart",this,this._moveStartHandler);this._firstHandle=x.connect(e,"onFirstMove",this,this._firstMoveHandler);this._movingHandle=x.connect(e,"onMoving",this,this._movingHandler);this._stopHandle=x.connect(e,"onMoveStop",this,this._moveStopHandler);return e},_getPtIndex:function(){return this.ptIndex+(this._placeholder?1:0)},_getInfo:function(){return{graphic:this.graphic,isGhost:this._placeholder,
segmentIndex:this.segIndex,pointIndex:this._getPtIndex()}},_moveStartHandler:function(e){var k=this.map;k.snappingManager&&k.snappingManager._setUpSnapping();this.editor.toolbar._deactivateScrollWheel();this._startTx=this.graphic.getDojoShape().getTransform();e.shape.moveToFront();this.constructor.onMoveStart(this);this.editor.toolbar.onVertexMoveStart(this.relatedGraphic,this._getInfo())},_firstMoveHandler:function(e){var k=e.shape,w=this._getControlEdges(),q=this._scratchGL._div,u,r=[],v=e.host.shape._wrapOffsets[0]||
0;for(u=0;u<w.length;u++){var z=w[u];z.x1+=v;z.x2+=v;r.push([q.createLine({x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2}).setStroke(this.editor._lineStroke),z.x1,z.y1,z.x2,z.y2])}k._lines=r;e.shape.moveToFront();this.constructor.onFirstMove(this);this.editor.toolbar.onVertexFirstMove(this.relatedGraphic,this._getInfo())},_movingHandler:function(e,k,w){k=this.map;var q;l("esri-pointer")?q=k.navigationManager.pointerEvents._processTouchEvent(w,w):w&&"pointermove"===w.type&&(q=c.prototype._processTouchEvent.call({map:k},
w,w));q&&k.snappingManager&&k.snappingManager._onSnappingMouseMoveHandler(q);w=e.shape;e=w.getTransform();w=w._lines;for(q=0;q<w.length;q++)k=w[q],k[0].setShape({x1:k[1]+e.dx,y1:k[2]+e.dy,x2:k[3],y2:k[4]});this.editor.toolbar.onVertexMove(this.relatedGraphic,this._getInfo(),e)},_moveStopHandler:function(e){e=e.shape;var k=this.editor.toolbar,w=e.getTransform(),q=this.map,u=this.graphic,r=k._geo?g.geographicToWebMercator(u.geometry):u.geometry;k._activateScrollWheel();var v,z=e._lines;if(z){for(v=
0;v<z.length;v++)z[v][0].removeShape();e._lines=null}v=!1;z=!0;var B=this._getInfo();w&&(w.dx||w.dy)?this._placeholder&&(this._placeholder=!1,v=!0):z=!1;if(q.snappingManager)var A=q.snappingManager._snappingPoint;var y=[w,d.invert(this._startTx)];A=A||q.toMap(d.multiplyPoint(y,q.toScreen(r,!0)));q.snappingManager&&q.snappingManager._killOffSnapping();e.setTransform(null);u.setGeometry(k._geo?g.webMercatorToGeographic(A,!0):A);this.constructor.onMoveStop(this,w);k.onVertexMoveStop(this.relatedGraphic,
B,w);if(!z)k.onVertexClick(this.relatedGraphic,B);if(v)k.onVertexAdd(this.relatedGraphic,this._getInfo())},_getControlEdges:function(){var e=this.map,k=this.relatedGraphic.geometry,w=this.segIndex,q=this.ptIndex,u=this.segLength,r=this._scratchGL.getNavigationTransform(),v=r.dx;r=r.dy;var z=e.toScreen(this.graphic.geometry);e=z.x-v;z=z.y-r;var B=[];k=this.editor._getControlPoints(this,k,w,q,u);k[0]&&B.push({x1:e,y1:z,x2:k[0].x-v,y2:k[0].y-r});k[1]&&B.push({x1:e,y1:z,x2:k[1].x-v,y2:k[1].y-r});return B}});
p.setObject("toolbars.VertexMover",t,a);p.mixin(t,{onMoveStart:function(){},onFirstMove:function(){},onMoveStop:function(){}});return t})},"esri/toolbars/TextEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/event dojo/has dojo/dom-construct dojo/dom-class dojo/dom-style dojo/keys ../kernel".split(" "),function(t,p,x,b,m,f,d,a,c,l){t=t(null,{declaredClass:"esri.toolbars.TextEditor",constructor:function(h,n,g){this._graphic=h;this._map=n;this._toolbar=g;this._enable(this._graphic)},
destroy:function(){this._disable()},onEditStart:function(){},onEditEnd:function(){},_enable:function(h){this._editBox?(x.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null):(this._map.navigationManager.setImmediateClick(!0),this._addEditBoxHandler=x.connect(h.getLayer(),"onDblClick",this,function(n){this._map.navigationManager.setImmediateClick(!1);n.graphic==h&&(b.stop(n),x.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null,this._addTextBox(h))}))},_disable:function(){this._applyEdit();
this._addEditBoxHandler&&(x.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null);this._removeTextBox();this.onEditEnd(this._graphic);this._toolbar.onTextEditEnd(this._graphic)},_addTextBox:function(h,n){if(!this._editBox){if(!h.symbol.text){h.symbol.text="Tempt text";h.setSymbol(h.symbol);var g=""}var e=this._createInputTextStyle(h,this._map);""!==g&&(g=n||h.symbol.text);this._editBox=f.create("input",{type:"text",value:g});a.set(this._editBox,e);d.add(this._editBox,"esriTextEditorInput");
this._map.container.appendChild(this._editBox);this._editBox.focus();this._editBoxKeyHandler=x.connect(this._editBox,"onkeyup",p.hitch(this,function(w){w.keyCode!=c.ENTER&&w.keyCode!==c.TAB||this._disable()}));this._editBoxBlurHandler=x.connect(this._editBox,"onblur",p.hitch(this,function(w){this._disable()}));h.symbol.text="";h.setSymbol(h.symbol);h.hide();var k=this._editBox;this._disableBoxHandler||(this._disableBoxHandler=this._map.on("zoom-start",p.hitch(this,function(){this._disable()})));this._moveBoxHandler=
this._map.on("pan",function(w){a.set(k,{left:this._editBoxLeft+w.delta.x+"px",top:this._editBoxTop+w.delta.y+"px"})});this._moveBoxStartHandler=this._map.on("pan-start",function(){this._editBoxLeft=parseFloat(a.get(k,"left"));this._editBoxTop=parseFloat(a.get(k,"top"))});this.onEditStart(h,this._editBox);this._toolbar.onTextEditStart(h,this._editBox)}},_removeTextBox:function(){this._editBoxBlurHandler&&(x.disconnect(this._editBoxBlurHandler),this._editBoxBlurHandler=null);this._editBox&&(this._editBox.parentNode.removeChild(this._editBox),
this._editBox=null);this._disableBoxHandler&&(this._disableBoxHandler.remove(),this._disableBoxHandler=null);this._moveBoxHandler&&(this._moveBoxHandler.remove(),this._moveBoxHandler=null);this._moveBoxStartHandler&&(this._moveBoxStartHandler.remove(),this._moveBoxStartHandler=null);this._editBoxKeyHandler&&(x.disconnect(this._editBoxKeyHandler),this._editBoxKeyHandler=null)},_createInputTextStyle:function(h,n){var g=h.getDojoShape().getTransformedBoundingBox(),e=h.getLayer();e=e.hasLocalNavigationTransform()?
{dx:0,dy:0}:e.getNavigationTransform();var k=h.symbol.font;return{"font-family":k.family,"font-size":k.size+"px","font-style":k.style,"font-variant":k.variant,"font-weight":k.weight,left:g[0].x+e.dx+"px",top:g[0].y+e.dy+"px",width:Math.abs(g[0].x-g[1].x)/Math.cos(h.symbol.angle/180*Math.PI)+"px"}},_applyEdit:function(){if(this._editBox)if(this._editBox.value){this._graphic.show();var h=this._graphic.symbol;h.text=this._editBox.value;this._graphic.setSymbol(h)}else this._graphic.getLayer().remove(this._graphic)}});
p.setObject("toolbars.TextEditor",t,l);return t})},"esri/dijit/editing/Add":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ./EditOperationBase".split(" "),function(t,p,x,b,m,f){p=p(f,{declaredClass:"esri.dijit.editing.Add",type:"edit",label:"Add Features",constructor:function(d){d=d||{};d.featureLayer&&(this._featureLayer=d.featureLayer,d.addedGraphics&&(this._addedGraphics=d.addedGraphics))},updateObjectIds:function(d,a){this.updateIds(this._featureLayer,
this._addedGraphics,d,a)},performUndo:function(){return this._featureLayer.applyEdits(null,null,this._addedGraphics).then(x.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))},performRedo:function(){var d=t.map(this._addedGraphics,function(a){return a.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._addedGraphics,null,null).then(x.hitch(this,function(a,c,l){a=t.map(a,function(h){return h.objectId});return{oldIds:d,addedIds:a,layer:this._featureLayer,
operation:this}}))}});x.setObject("dijit.editing.Add",p,m);return p})},"esri/dijit/editing/EditOperationBase":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/has","../../kernel","../../OperationBase"],function(t,p,x,b,m){p=p(m,{declaredClass:"esri.EditOperationBase",updateIds:function(f,d,a,c){t.forEach(d,function(l,h){var n=l[f.objectIdField];t.forEach(a,function(g,e){n===g&&(l[f.objectIdField]=c[e])})})}});return b.EditOperationBase=p})},"esri/dijit/editing/Update":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/jsonUtils ./EditOperationBase".split(" "),
function(t,p,x,b,m,f,d){t=p(d,{declaredClass:"esri.dijit.editing.Update",type:"edit",label:"Update Features",constructor:function(a){var c;a=a||{};if(a.featureLayer&&(this._featureLayer=a.featureLayer,a.preUpdatedGraphics)){this._preUpdatedGraphicsGeometries=[];this._preUpdatedGraphicsAttributes=[];for(c=0;c<a.preUpdatedGraphics.length;c++)this._preUpdatedGraphicsGeometries.push(a.preUpdatedGraphics[c].geometry.toJson()),this._preUpdatedGraphicsAttributes.push(a.preUpdatedGraphics[c].attributes);
if(a.postUpdatedGraphics)for(this._postUpdatedGraphics=a.postUpdatedGraphics,this._postUpdatedGraphicsGeometries=[],this._postUpdatedGraphicsAttributes=[],c=0;c<a.postUpdatedGraphics.length;c++)a.postUpdatedGraphics[c].geometry?this._postUpdatedGraphicsGeometries.push(a.postUpdatedGraphics[c].geometry.toJson()):this._postUpdatedGraphicsGeometries.push(a.postUpdatedGraphics[c].geometry),this._postUpdatedGraphicsAttributes.push(x.clone(a.postUpdatedGraphics[c].attributes))}},updateObjectIds:function(a,
c){this.updateIds(this._featureLayer,this._preUpdatedGraphicsAttributes,a,c);this.updateIds(this._featureLayer,this._postUpdatedGraphicsAttributes,a,c)},performUndo:function(){var a;for(a=0;a<this._postUpdatedGraphics.length;a++)this._preUpdatedGraphicsGeometries[a]?this._postUpdatedGraphics[a].setGeometry(f.fromJson(this._preUpdatedGraphicsGeometries[a])):this._postUpdatedGraphics[a].setGeometry(this._preUpdatedGraphicsGeometries[a]),this._postUpdatedGraphics[a].setAttributes(this._preUpdatedGraphicsAttributes[a]);
return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,null).then(x.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))},performRedo:function(){var a;for(a=0;a<this._postUpdatedGraphics.length;a++)this._postUpdatedGraphicsGeometries[a]?this._postUpdatedGraphics[a].setGeometry(f.fromJson(this._postUpdatedGraphicsGeometries[a])):this._postUpdatedGraphics[a].setGeometry(this._postUpdatedGraphicsGeometries[a]),this._postUpdatedGraphics[a].setAttributes(this._postUpdatedGraphicsAttributes[a]);
return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,null).then(x.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))}});x.setObject("dijit.editing.Update",t,m);return t})},"esri/dijit/editing/Delete":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ./EditOperationBase".split(" "),function(t,p,x,b,m,f){p=p(f,{declaredClass:"esri.dijit.editing.Delete",type:"edit",label:"Delete Features",constructor:function(d){d=d||{};
d.featureLayer&&(this._featureLayer=d.featureLayer,d.deletedGraphics&&(this._deletedGraphics=d.deletedGraphics))},updateObjectIds:function(d,a){this.updateIds(this._featureLayer,this._deletedGraphics,d,a)},performUndo:function(){var d=t.map(this._deletedGraphics,function(a){return a.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._deletedGraphics,null,null).then(x.hitch(this,function(a,c,l){a=t.map(a,function(h){return h.objectId});return{oldIds:d,addedIds:a,
layer:this._featureLayer,operation:this}}))},performRedo:function(){return this._featureLayer.applyEdits(null,null,this._deletedGraphics).then(x.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))}});x.setObject("dijit.editing.Delete",p,m);return p})},"esri/dijit/editing/Cut":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/jsonUtils ./EditOperationBase".split(" "),function(t,p,x,b,m,f,d){p=p(d,{declaredClass:"esri.dijit.editing.Cut",
type:"edit",label:"Cut Features",constructor:function(a){var c;a=a||{};if(a.featureLayer&&(this._featureLayer=a.featureLayer,a.addedGraphics&&(this._addedGraphics=a.addedGraphics,a.preUpdatedGraphics))){this._preUpdatedGraphicsGeometries=[];this._preUpdatedGraphicsAttributes=[];for(c=0;c<a.preUpdatedGraphics.length;c++)this._preUpdatedGraphicsGeometries.push(a.preUpdatedGraphics[c].geometry.toJson()),this._preUpdatedGraphicsAttributes.push(a.preUpdatedGraphics[c].attributes);if(a.postUpdatedGraphics)for(this._postUpdatedGraphics=
a.postUpdatedGraphics,this._postUpdatedGraphicsGeometries=[],this._postUpdatedGraphicsAttributes=[],c=0;c<a.postUpdatedGraphics.length;c++)this._postUpdatedGraphicsGeometries.push(a.postUpdatedGraphics[c].geometry.toJson()),this._postUpdatedGraphicsAttributes.push(x.clone(a.postUpdatedGraphics[c].attributes))}},updateObjectIds:function(a,c){this.updateIds(this._featureLayer,this._preUpdatedGraphicsAttributes,a,c);this.updateIds(this._featureLayer,this._postUpdatedGraphicsAttributes,a,c);this.updateIds(this._featureLayer,
this._addedGraphics,a,c)},performUndo:function(){var a;for(a=0;a<this._postUpdatedGraphics.length;a++)this._postUpdatedGraphics[a].setGeometry(f.fromJson(this._preUpdatedGraphicsGeometries[a])),this._postUpdatedGraphics[a].setAttributes(this._preUpdatedGraphicsAttributes[a]);return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,this._addedGraphics).then(x.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))},performRedo:function(){var a;for(a=0;a<this._postUpdatedGraphics.length;a++)this._postUpdatedGraphics[a].setGeometry(f.fromJson(this._postUpdatedGraphicsGeometries[a])),
this._postUpdatedGraphics[a].setAttributes(this._postUpdatedGraphicsAttributes[a]);var c=t.map(this._addedGraphics,function(l){return l.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._addedGraphics,this._postUpdatedGraphics,null).then(x.hitch(this,function(l,h,n){l=t.map(l,function(g){return g.objectId});return{oldIds:c,addedIds:l,layer:this._featureLayer,operation:this}}))}});x.setObject("dijit.editing.Cut",p,m);return p})},"esri/dijit/editing/Union":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/jsonUtils ./EditOperationBase".split(" "),
function(t,p,x,b,m,f,d){p=p(d,{declaredClass:"esri.dijit.editing.Union",type:"edit",label:"Union Features",constructor:function(a){a=a||{};this._featureLayer=a.featureLayer;this._deletedGraphics=a.deletedGraphics;this._preUpdatedGraphics=a.preUpdatedGraphics;this._postUpdatedGraphics=a.postUpdatedGraphics;this._preUpdatedGraphicsGeometries=[];this._preUpdatedGraphicsAttributes=[];this._postUpdatedGraphicsGeometries=[];this._postUpdatedGraphicsAttributes=[];var c;for(c=0;c<a.preUpdatedGraphics.length;c++)this._preUpdatedGraphicsGeometries.push(a.preUpdatedGraphics[c].geometry.toJson()),
this._preUpdatedGraphicsAttributes.push(a.preUpdatedGraphics[c].attributes);for(c=0;c<a.postUpdatedGraphics.length;c++)this._postUpdatedGraphicsGeometries.push(a.postUpdatedGraphics[c].geometry.toJson()),this._postUpdatedGraphicsAttributes.push(x.clone(a.postUpdatedGraphics[c].attributes))},updateObjectIds:function(a,c){this.updateIds(this._featureLayer,this._preUpdatedGraphicsAttributes,a,c);this.updateIds(this._featureLayer,this._postUpdatedGraphicsAttributes,a,c);this.updateIds(this._featureLayer,
this._deletedGraphics,a,c)},performUndo:function(){var a;for(a=0;a<this._postUpdatedGraphics.length;a++)this._postUpdatedGraphics[a].setGeometry(f.fromJson(this._preUpdatedGraphicsGeometries[a])),this._postUpdatedGraphics[a].setAttributes(this._preUpdatedGraphicsAttributes[a]);var c=t.map(this._deletedGraphics,function(l){return l.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._deletedGraphics,this._postUpdatedGraphics,null).then(x.hitch(this,function(l,
h,n){l=t.map(l,function(g){return g.objectId});return{oldIds:c,addedIds:l,layer:this._featureLayer,operation:this}}))},performRedo:function(){var a;for(a=0;a<this._postUpdatedGraphics.length;a++)this._postUpdatedGraphics[a].setGeometry(f.fromJson(this._postUpdatedGraphicsGeometries[a])),this._postUpdatedGraphics[a].setAttributes(this._postUpdatedGraphicsAttributes[a]);return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,this._deletedGraphics).then(x.hitch(this,function(){return{layer:this._featureLayer,
operation:this}}))}});x.setObject("dijit.editing.Union",p,m);return p})},"esri/dijit/editing/toolbars/Drawing":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has dijit/_CssStateMixin ../Util ./ToolbarBase ../tools/ButtonToolBase ../tools/Cut ../tools/Union ../tools/Reshape ../tools/Editing ../tools/EditingTools ../tools/Selection ../tools/SelectionTools ../../../kernel".split(" "),function(t,p,x,b,m,f,d,a,c,l,h,n,g,e,k,w,q){t=t([a,f],{declaredClass:"esri.dijit.editing.toolbars.Drawing",
onShowAttributeInspector:function(){},_activateTool:function(u,r){this._settings.editor._activeTool=u;"EDITING"!==u&&this._settings.templatePicker.clearSelection();"ATTRIBUTES"!==u&&this._settings.editor._hideAttributeInspector();"CLEAR"!==u&&this.inherited(arguments)},_initializeToolbar:function(){x.forEach(this._settings.layers,function(u){this._tbConnects.push(b.connect(u,"onSelectionComplete",this,"_updateUI"))},this)},activateEditing:function(u,r){this._tools.EDITING._activateTool(u,r.geometryType);
this._activeTool=this._tools.EDITING;this._activeTool.setChecked(!0)},_updateUI:function(){this._settings.undoManager&&(this._tools.UNDO.set("disabled",!1===this._settings.undoManager.canUndo),this._tools.REDO.set("disabled",!1===this._settings.undoManager.canRedo));this._selectedFeatures=d.getSelection(this._settings.layers);var u=this._selectedFeatures.length;this._tools.DELETE&&this._tools.DELETE.set("disabled",0>=u);this._tools.CLEAR&&this._tools.CLEAR.set("disabled",0>=u);this._tools.ATTRIBUTES&&
this._tools.ATTRIBUTES.set("disabled",0>=u);this._tools.UNION&&this._tools.UNION.set("disabled",2>u)},_toolFinished:function(u){if("ATTRIBUTES"===u&&this._selectedFeatures&&this._selectedFeatures.length)this.onShowAttributeInspector(this._selectedFeatures[0]);if("SELECT"===u||"CUT"===u||"RESHAPING"===u||"EDITING"===u)this._activeTool.deactivate(),this._activeTool.setChecked(!1),this._activeTool=null;if("DELETE"===u)this.onDelete();this._settings.editor._activeTool=null;this._updateUI()},_createTools:function(){this._tools.SELECT=
new k({settings:this._settings,onClick:p.hitch(this,"_activateTool","SELECT",!0),onFinished:p.hitch(this,"_toolFinished","SELECT")});this.addChild(this._tools.SELECT);this._tools.CLEAR=new c(p.mixin(w.selectClear,{settings:this._settings,onClick:p.hitch(this._settings.editor,"_clearSelection",!1)}));this.addChild(this._tools.CLEAR);this._createSeparator();this._tools.ATTRIBUTES=new c(p.mixin(e.attributes,{settings:this._settings,onClick:p.hitch(this,"_toolFinished","ATTRIBUTES")}));this.addChild(this._tools.ATTRIBUTES);
this._createSeparator();this._tools.EDITING=new g({settings:this._settings,onClick:p.hitch(this,"_activateTool","EDITING",!0),onApplyEdits:p.hitch(this,"onApplyEdits"),onFinished:p.hitch(this,"_toolFinished","EDITING")});this.addChild(this._tools.EDITING);this._tools.DELETE=new c(p.mixin(e.del,{settings:this._settings,onClick:p.hitch(this,"_toolFinished","DELETE")}));this.addChild(this._tools.DELETE);this._settings.toolbarOptions&&((this._settings.toolbarOptions.cutVisible||this._settings.toolbarOptions.mergeVisible||
this._settings.toolbarOptions.reshapeVisible)&&this._createSeparator(),this._settings.toolbarOptions.cutVisible&&(this._tools.CUT=new l({settings:this._settings,onFinished:p.hitch(this,"_toolFinished","CUT"),onClick:p.hitch(this,"_activateTool","CUT",!0),onApplyEdits:p.hitch(this,"onApplyEdits")}),this.addChild(this._tools.CUT)),this._settings.toolbarOptions.mergeVisible&&(this._tools.UNION=new h({settings:this._settings,onFinished:p.hitch(this,"_toolFinished","UNION"),onApplyEdits:p.hitch(this,"onApplyEdits")}),
this.addChild(this._tools.UNION)),this._settings.toolbarOptions.reshapeVisible&&(this._tools.RESHAPING=new n({settings:this._settings,onClick:p.hitch(this,"_activateTool","RESHAPING",!0),onFinished:p.hitch(this,"_toolFinished","RESHAPING"),onApplyEdits:p.hitch(this,"onApplyEdits")}),this.addChild(this._tools.RESHAPING)));this._settings.enableUndoRedo&&(this._createSeparator(),this._tools.UNDO=new c(p.mixin(e.undo,{settings:this._settings,disabled:!0,onClick:p.hitch(this,function(){this._tools.UNDO.set("disabled",
!0);this._tools.REDO.set("disabled",!0);this._settings.editor._undo()})})),this.addChild(this._tools.UNDO),this._tools.REDO=new c(p.mixin(e.redo,{settings:this._settings,disabled:!0,onClick:p.hitch(this,function(){this._tools.UNDO.set("disabled",!0);this._tools.REDO.set("disabled",!0);this._settings.editor._redo()})})),this.addChild(this._tools.REDO))}});p.setObject("dijit.editing.toolbars.Drawing",t,q);return t})},"esri/dijit/editing/toolbars/ToolbarBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has dijit/Toolbar dijit/ToolbarSeparator ../../../kernel ../../../lang".split(" "),
function(t,p,x,b,m,f,d,a,c){t=t([f],{declaredClass:"esri.dijit.editing.toolbars.ToolbarBase",_enabled:!0,graphicsAdded:function(){},drawEnd:function(){},onApplyEdits:function(){},onDelete:function(){},constructor:function(l,h){l&&l.settings&&(this._tools=[],this._tbConnects=[],this._initialize(l.settings))},postCreate:function(){this._createTools();this.deactivate()},destroy:function(){var l,h=this._tools;for(l in h)h.hasOwnProperty(l)&&c.isDefined(this._tools[l])&&this._tools[l].destroy();x.forEach(this._tbConnects,
b.disconnect);this.inherited(arguments)},activate:function(l){this._enabled=!0},deactivate:function(){var l;this._enabled=!1;this._geometryType=this._layer=null;var h=this._tools;for(l in h)h.hasOwnProperty(l)&&(this._tools[l].deactivate(),this._tools[l].setChecked(!1))},isEnabled:function(){return this._enabled},setActiveSymbol:function(l){this._activeSymbol=l},_getSymbol:function(){},_createTools:function(){},_initialize:function(l){this._settings=l;this._toolbar=l.drawToolbar;this._editToolbar=
l.editToolbar;this._initializeToolbar()},_activateTool:function(l,h){this._activeTool&&this._activeTool.deactivate();!0===h&&this._activeTool==this._tools[l]?(this._activeTool.setChecked(!1),this._activeTool=null):(this._activeTool=this._tools[l],this._activeTool.setChecked(!0),this._activeTool.activate(null))},_createSeparator:function(){this.addChild(new d)}});p.setObject("dijit.editing.toolbars.ToolbarBase",t,a);return t})},"esri/dijit/editing/tools/ButtonToolBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dijit/form/Button ./ToolBase ../../../kernel".split(" "),
function(t,p,x,b,m,f){t=t([b,m],{declaredClass:"esri.dijit.editing.tools.ButtonToolBase",postCreate:function(){this.inherited(arguments);this._setShowLabelAttr&&this._setShowLabelAttr(!1)},destroy:function(){b.prototype.destroy.apply(this,arguments);m.prototype.destroy.apply(this,arguments)}});p.setObject("dijit.editing.tools.ButtonToolBase",t,f);return t})},"esri/dijit/editing/tools/ToolBase":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../../../kernel","dojo/i18n!../../../nls/jsapi"],
function(t,p,x,b,m){t=t(null,{declaredClass:"esri.dijit.editing.tools.ToolBase",_enabled:!0,showLabel:!1,constructor:function(f,d){f=f||{};p.mixin(this,f);this.label=this._label?m.widgets.editor.tools[this._label]:"";this._settings=f.settings;this._toolbar=f.settings.drawToolbar;this._editToolbar=f.settings.editToolbar;this._initializeTool()},onFinished:function(){},onDrawEnd:function(){},onApplyEdits:function(){},postCreate:function(){this.deactivate();this.inherited(arguments)},destroy:function(){},
activate:function(f){this._toolbar&&this._toolbar.deactivate();this._editToolbar&&this._editToolbar.deactivate();this._enabled&&(this._checked=!0,this._layer=f,this._toolbar&&this._drawType&&this._toolbar.activate(this._drawType))},deactivate:function(){this._toolbar&&this._toolbar.deactivate();this._editToolbar&&this._editToolbar.deactivate();this.setChecked(!1);this._updateUI()},setEnabled:function(f){this._enabled=f;this._updateUI()},setChecked:function(f){this._checked=f},enable:function(f){this._updateUI()},
isEnabled:function(){return this._enabled},getToolName:function(){return this._toolName},_initializeTool:function(){},_updateUI:function(){this.disabled=!this._enabled;this.attr("iconClass",this._enabled?this._enabledIcon:this._disabledIcon)}});p.setObject("dijit.editing.tools.ToolBase",t,b);return t})},"esri/dijit/editing/tools/Cut":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has dojo/DeferredList ../../../graphicsUtils ../../../graphic ../../../tasks/query ../../../layers/FeatureLayer ../../../toolbars/draw ../Cut ./ToggleToolBase ../../../kernel".split(" "),
function(t,p,x,b,m,f,d,a,c,l,h,n,g,e){t=t([g],{declaredClass:"esri.dijit.editing.tools.Cut",id:"btnFeatureCut",_enabledIcon:"toolbarIcon cutIcon",_disabledIcon:"toolbarIcon cutIcon",_drawType:h.POLYLINE,_enabled:!0,_label:"NLS_cutLbl",_cutConnects:[],activate:function(){this._cutConnects.push(b.connect(this._toolbar,"onDrawEnd",this,"_onDrawEnd"));this.inherited(arguments)},deactivate:function(){this.inherited(arguments);x.forEach(this._cutConnects,b.disconnect);this._cutConnects=[];this._edits=[]},
_onDrawEnd:function(k){var w=this._cutLayers=x.filter(this._settings.layers,function(u){return"esriGeometryPolygon"===u.geometryType||"esriGeometryPolyline"===u.geometryType&&u.visible&&u._isMapAtVisibleScale()});this._cutConnects=this._cutConnects.concat(x.map(w,p.hitch(this,function(u){return b.connect(u,"onEditsComplete",p.hitch(this,function(r,v,z){if(this._settings.undoRedoManager){var B=this._settings.undoRedoManager;x.forEach(this._edits,p.hitch(this,function(A){B.add(new n({featureLayer:A.layer,
addedGraphics:A.adds,preUpdatedGraphics:A.preUpdates,postUpdatedGraphics:A.updates}))}),this)}this.onFinished()}))})));var q=new c;q.geometry=k;x.forEach(w,function(u,r){this._settings.editor._selectionHelper.selectFeatures([u],q,l.SELECTION_NEW,p.hitch(this,"_cutFeatures",u,q))},this)},_cutFeatures:function(k,w,q){if(q&&q.length){this._edits=[];var u=[];u.push(this._settings.geometryService.cut(d.getGeometries(q),w.geometry,p.hitch(this,"_cutHandler",k,q)));(new f(u)).addCallback(p.hitch(this,function(){this.onApplyEdits(this._edits)}))}},
_cutHandler:function(k,w,q){var u=[],r=[],v=x.map(w,function(A){return new a(p.clone(A.toJson()))}),z,B;x.forEach(q.cutIndexes,function(A,y){z!=A?(z=A,1<x.filter(q.cutIndexes,function(D){return D===A}).length&&r.push(w[A].setGeometry(q.geometries[y]))):(B=new a(q.geometries[y],null,p.mixin({},w[A].attributes),null),B.attributes[w[0].getLayer().objectIdField]=null,u.push(B))},this);this._edits.push({layer:k,adds:u,updates:r,preUpdates:v})}});p.setObject("dijit.editing.tools.Cut",t,e);return t})},"esri/dijit/editing/tools/ToggleToolBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dijit/form/ToggleButton ./ToolBase ../../../kernel".split(" "),
function(t,p,x,b,m,f){t=t([b,m],{declaredClass:"esri.dijit.editing.tools.ToggleToolBase",postCreate:function(){this.inherited(arguments);this._setShowLabelAttr&&this._setShowLabelAttr(!1)},destroy:function(){b.prototype.destroy.apply(this,arguments);m.prototype.destroy.apply(this,arguments)},setChecked:function(d){b.prototype.setChecked.apply(this,arguments)}});p.setObject("dijit.editing.tools.ToggleToolBase",t,f);return t})},"esri/dijit/editing/tools/Union":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../../../graphicsUtils ../../../graphic ../../../toolbars/draw ../Union ./ButtonToolBase ../../../kernel".split(" "),
function(t,p,x,b,m,f,d,a,c,l){t=t([c],{declaredClass:"esri.dijit.editing.tools.Union",id:"btnFeatureUnion",_enabledIcon:"toolbarIcon unionIcon",_disabledIcon:"toolbarIcon unionIcon",_drawType:d.POLYLINE,_enabled:!0,_label:"NLS_unionLbl",_onClick:function(h){this._settings.editor._activeTool="UNION";h=x.filter(this._settings.layers,function(e){return"esriGeometryPolygon"===e.geometryType&&e.visible&&e._isMapAtVisibleScale()});var n=[],g=0;x.forEach(h,function(e,k){var w=e.getSelectedFeatures();2<=
w.length&&(g++,this._settings.geometryService.union(m.getGeometries(w),p.hitch(this,function(q){var u=w.shift(),r=[],v=[];r.push(new f(u.toJson()));v.push(u.setGeometry(q));n.push({layer:e,updates:v,deletes:w,preUpdates:r});g--;if(0>=g)this.onApplyEdits(n,p.hitch(this,function(){if(this._settings.undoRedoManager){var z=this._settings.undoRedoManager;x.forEach(this._edits,p.hitch(this,function(B){z.add(new a({featureLayer:B.layer,deletedGraphics:B.deletes,preUpdatedGraphics:B.preUpdates,postUpdatedGraphics:B.updates}))}),
this)}this._settings.editor._selectionHelper.clearSelection(!1);this.onFinished()}))})))},this)}});p.setObject("dijit.editing.tools.Union",t,l);return t})},"esri/dijit/editing/tools/Reshape":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has ../../../graphic ../../../layers/FeatureLayer ../../../tasks/query ../../../toolbars/draw ./ToggleToolBase ../../../kernel".split(" "),function(t,p,x,b,m,f,d,a,c,l,h){t=t([l],{declaredClass:"esri.dijit.editing.tools.Reshape",
id:"btnFeatureReshape",_enabledIcon:"toolbarIcon reshapeIcon",_disabledIcon:"toolbarIcon reshapeIcon",_drawType:c.POLYLINE,_enabled:!0,_label:"NLS_reshapeLbl",activate:function(){b.disconnect(this._rConnect);this._rConnect=b.connect(this._toolbar,"onDrawEnd",this,"_onDrawEnd");this.inherited(arguments)},deactivate:function(){this.inherited(arguments);b.disconnect(this._rConnect);delete this._rConnect},_onDrawEnd:function(n){var g=this._settings.layers,e=new a;e.geometry=n;n=this._reshapeLayers=x.filter(g,
function(k){return"esriGeometryPolygon"===k.geometryType||"esriGeometryPolyline"});this._settings.editor._selectionHelper.selectFeatures(n,e,d.SELECTION_NEW,p.hitch(this,"_reshape",e))},_reshape:function(n,g){if(1===g.length){var e=[],k=[],w=[],q=g[0],u=q.getLayer();this._settings.geometryService.reshape(q.geometry,n.geometry,p.hitch(this,function(r){"polyline"===r.type&&r.paths&&0===r.paths.length?(this._settings.editor._selectionHelper.clearSelection(!1),this.onFinished()):"polygon"===r.type&&r.rings&&
0===r.rings.length?(this._settings.editor._selectionHelper.clearSelection(!1),this.onFinished()):(w.push(new f(q.toJson())),k.push(q.setGeometry(r)),e.push({layer:u,updates:k,preUpdates:w}),this.onApplyEdits(e,p.hitch(this,function(){this._settings.editor._selectionHelper.clearSelection(!1);this.onFinished()})))}))}}});p.setObject("dijit.editing.tools.Reshape",t,h);return t})},"esri/dijit/editing/tools/Editing":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../../../layers/FeatureTemplate ./Edit ./EditingTools ./DropDownToolBase ../../../kernel ../../../lang".split(" "),
function(t,p,x,b,m,f,d,a,c,l){t=t([a],{declaredClass:"esri.dijit.editing.tools.Editing",_enabled:!1,deactivate:function(){this._enabled&&(this._enabled=!1,this.inherited(arguments),this._settings.templatePicker.clearSelection())},onItemClicked:function(h,n){this.inherited(arguments);this._activeTool===this._tools.AUTOCOMPLETE&&(this._settings.editor._drawingTool=m.TOOL_AUTO_COMPLETE_POLYGON)},_activateTool:function(h,n){var g;this.enable(n);for(g in this._tools)this._tools.hasOwnProperty(g)&&(this.dropDown.removeChild(this._tools[g]),
!0===this._tools[g]._enabled&&this.dropDown.addChild(this._tools[g]));if(this._geometryType!==n||!1===this._activeTool._enabled)this._activeTool=this._tools[h.toUpperCase()];this._geometryType=n;this._activeTool.activate();this._activeTool.setChecked(!0);this._updateUI()},_initializeTool:function(h){this.inherited(arguments);this._initializeTools()},_initializeTools:function(){var h=this._settings.layers,n=this._settings.editor,g=!1,e=!1,k=!1,w=this._toolTypes=[],q;x.forEach(h,function(u){q=u.geometryType;
g=g||"esriGeometryPoint"===q;e=e||"esriGeometryPolyline"===q;k=k||"esriGeometryPolygon"===q;w=w.concat(x.map(this._getTemplatesFromLayer(u),p.hitch(this,function(r){return n._toDrawTool(r.drawingTool,u)})))},this);h=this._settings.createOptions;g&&this._toolTypes.push("point");e&&(this._toolTypes=this._toolTypes.concat(h.polylineDrawTools));k&&(this._toolTypes=this._toolTypes.concat(h.polygonDrawTools));this._toolTypes=this._toUnique(this._toolTypes.concat(w))},_toUnique:function(h){var n={};return x.filter(h,
function(g){return n[g]?!1:n[g]=!0})},_getTemplatesFromLayer:function(h){var n=h.templates||[];x.forEach(h.types,function(g){n=n.concat(g.templates)});return x.filter(n,l.isDefined)},_createTools:function(){x.forEach(this._toolTypes,this._createTool,this);this.inherited(arguments)},_createTool:function(h){var n=p.mixin(d[h],{settings:this._settings,onClick:p.hitch(this,"onItemClicked",d[h].id)});this._tools[h.toUpperCase()]=new f(n)}});p.setObject("dijit.editing.tools.Editing",t,c);return t})},"esri/dijit/editing/tools/Edit":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","./MenuItemBase","../../../kernel"],function(t,p,x,b,m){t=t([b],{declaredClass:"esri.dijit.editing.tools.Edit",enable:function(f){this._enabled=f===this._geomType;this.inherited(arguments)}});p.setObject("dijit.editing.tools.Edit",t,m);return t})},"esri/dijit/editing/tools/MenuItemBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dijit/MenuItem ./ToolBase ../../../kernel".split(" "),function(t,p,x,b,m,f){t=t([b,m],{declaredClass:"esri.dijit.editing.tools.MenuItemBase",
destroy:function(){b.prototype.destroy.apply(this,arguments);m.prototype.destroy.apply(this,arguments)}});p.setObject("dijit.editing.tools.MenuItemBase",t,f);return t})},"esri/dijit/editing/tools/EditingTools":function(){define(["dojo/_base/lang","dojo/has","../../../toolbars/draw","../../../kernel"],function(t,p,x,b){p={point:{id:"esriPointTool",_enabledIcon:"toolbarIcon pointIcon",_disabledIcon:"toolbarIcon pointIconDisabled",_drawType:x.POINT,_geomType:"esriGeometryPoint",_label:"NLS_pointLbl"},
polyline:{id:"toolDrawFreehandPolyline",_enabledIcon:"toolbarIcon polylineIcon",_disabledIcon:"toolbarIcon polylineIconDisabled",_drawType:x.POLYLINE,_geomType:"esriGeometryPolyline",_label:"NLS_polylineLbl"},freehandpolyline:{id:"toolDrawPolyline",_enabledIcon:"toolbarIcon freehandPolylineIcon",_disabledIcon:"toolbarIcon freehandPolylineIcon",_drawType:x.FREEHAND_POLYLINE,_geomType:"esriGeometryPolyline",_label:"NLS_freehandPolylineLbl"},polygon:{id:"toolDrawPolygon",_enabledIcon:"toolbarIcon polygonIcon",
_disabledIcon:"toolbarIcon polygonIconDisabled",_drawType:x.POLYGON,_geomType:"esriGeometryPolygon",_label:"NLS_polygonLbl"},freehandpolygon:{id:"toolDrawFreehandPolygon",_enabledIcon:"toolbarIcon freehandPolygonIcon",_disabledIcon:"toolbarIcon freehandPolygonIconDisabled",_drawType:x.FREEHAND_POLYGON,_label:"NLS_freehandPolygonLbl",_geomType:"esriGeometryPolygon"},autocomplete:{id:"btnFeatureAutoComplete",_enabledIcon:"toolbarIcon autoCompleteIcon",_disabledIcon:"toolbarIcon autoCompleteIcon",_drawType:x.POLYGON,
_label:"NLS_autoCompleteLbl",_geomType:"esriGeometryPolygon"},rectangle:{id:"toolDrawRect",_enabledIcon:"toolbarIcon rectangleIcon",_disabledIcon:"toolbarIcon rectangleIcon",_drawType:x.RECTANGLE,_geomType:"esriGeometryPolygon",_label:"NLS_rectangleLbl"},arrow:{id:"toolDrawArrow",_enabledIcon:"toolbarIcon arrowIcon",_disabledIcon:"toolbarIcon arrowIcon",_drawType:x.ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowLbl"},uparrow:{id:"toolDrawArrowUp",_enabledIcon:"toolbarIcon arrowUpIcon",_disabledIcon:"toolbarIcon arrowUpIcon",
_drawType:x.UP_ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowUpLbl"},downarrow:{id:"toolDrawDownArrow",_enabledIcon:"toolbarIcon arrowDownIcon",_disabledIcon:"toolbarIcon arrowDownIcon",_drawType:x.DOWN_ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowDownLbl"},leftarrow:{id:"toolDrawLeftArrow",_enabledIcon:"toolbarIcon arrowLeftIcon",_disabledIcon:"toolbarIcon arrowLeftIcon",_drawType:x.LEFT_ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowLeftLbl"},rightarrow:{id:"toolDrawRightArrow",
_enabledIcon:"toolbarIcon arrowIcon",_disabledIcon:"toolbarIcon arrowIcon",_drawType:x.RIGHT_ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowRightLbl"},circle:{id:"toolDrawCircle",_enabledIcon:"toolbarIcon circleIcon",_disabledIcon:"toolbarIcon circleIcon",_drawType:x.CIRCLE,_geomType:"esriGeometryPolygon",_label:"NLS_circleLbl"},ellipse:{id:"toolDrawEllipse",_enabledIcon:"toolbarIcon ellipseIcon",_disabledIcon:"toolbarIcon ellipseIcon",_drawType:x.ELLIPSE,_geomType:"esriGeometryPolygon",_label:"NLS_ellipseLbl"},
triangle:{id:"toolDrawTriangle",_enabledIcon:"toolbarIcon triangleIcon",_disabledIcon:"toolbarIcon triangleIcon",_drawType:x.TRIANGLE,_geomType:"esriGeometryPolygon",_label:"NLS_triangleLbl"},attributes:{id:"btnAttributes",_enabledIcon:"toolbarIcon attributesIcon",_disabledIcon:"toolbarIcon attributesIcon",_enabled:!1,_label:"NLS_attributesLbl"},del:{id:"btnDelete2",_enabledIcon:"toolbarIcon deleteFeatureIcon",_disabledIcon:"toolbarIcon deleteFeatureIcon",_enabled:!1,_label:"NLS_deleteLbl"},undo:{id:"btnUndo",
_enabledIcon:"dijitEditorIcon dijitEditorIconUndo",_disabledIcon:"dijitEditorIcon dijitEditorIconUndo",_enabled:!1,_label:"NLS_undoLbl"},redo:{id:"btnRedo",_enabledIcon:"dijitEditorIcon dijitEditorIconRedo",_disabledIcon:"dijitEditorIcon dijitEditorIconRedo",_enabled:!1,_label:"NLS_redoLbl"}};t.setObject("dijit.editing.tools.EditingTools",p,b);return p})},"esri/dijit/editing/tools/DropDownToolBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/dom-style dijit/registry dijit/Menu dijit/form/ComboButton ./ToolBase ../../../kernel ../../../lang".split(" "),
function(t,p,x,b,m,f,d,a,c,l){t=t([d,a],{declaredClass:"esri.dijit.editing.tools.DropDownToolBase",_enabled:!1,_checked:!1,postCreate:function(){this._tools=[];this._createTools();this.inherited(arguments);this._setShowLabelAttr&&this._setShowLabelAttr(!1)},destroy:function(){var h,n=this._tools;for(h in n)n.hasOwnProperty(h)&&l.isDefined(n[h])&&n[h].destroy();this.inherited(arguments)},_createTools:function(){var h,n=new f;this.dropDown=n;for(h in this._tools)this._tools.hasOwnProperty(h)&&n.addChild(this._tools[h]);
this._activeTool=n.getChildren()[0];this._updateUI()},activate:function(h){this.inherited(arguments);this._activeTool?this._activeTool.activate():this._activateDefaultTool()},deactivate:function(){this.inherited(arguments);this._activeTool&&this._activeTool.deactivate()},enable:function(h){for(var n in this._tools)this._tools.hasOwnProperty(n)&&this._tools[n].enable(h);this.setEnabled(!0);this.inherited(arguments)},setChecked:function(h){this._checked=h;this._updateUI()},_onDrawEnd:function(h){},
onLayerChange:function(h,n,g){this._activeTool=null;this._activeType=n;this._activeTemplate=g;this._activeLayer=h},onItemClicked:function(h,n){this._activeTool&&this._activeTool.deactivate();this._activeTool=m.byId(h);!1===this._checked?this._onClick():(this._updateUI(),this._activeTool&&(this._activeTool.activate(),this._activeTool.setChecked(!0)))},_onClick:function(h){!1!==this._enabled&&(this._checked=!this._checked,this.inherited(arguments))},_updateUI:function(){this.attr("disabled",!this._enabled);
b.set(this.focusNode,{outline:"none"});b.set(this.titleNode,{padding:"0px",border:"none"});this._checked?b.set(this.titleNode,{backgroundColor:"#D4DFF2",border:"1px solid #316AC5"}):b.set(this.titleNode,{backgroundColor:"",border:""});this._activeTool&&(this.attr("iconClass",this._checked?this._activeTool._enabledIcon:this._activeTool._disabledIcon),this.attr("label",this._activeTool.label))}});p.setObject("dijit.editing.tools.DropDownToolBase",t,c);return t})},"esri/dijit/editing/tools/Selection":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/has ../../../symbols/SimpleMarkerSymbol ../../../symbols/SimpleLineSymbol ../../../symbols/SimpleFillSymbol ./Edit ./SelectionTools ./DropDownToolBase ../../../kernel".split(" "),
function(t,p,x,b,m,f,d,a,c,l,h,n,g){t=t([n],{declaredClass:"esri.dijit.editing.tools.Selection",_enabled:!0,activate:function(){this.inherited(arguments);this._sConnect=b.connect(this._toolbar,"onDrawEnd",this,"_onDrawEnd")},deactivate:function(){this.inherited(arguments);b.disconnect(this._sConnect);delete this._sConnect},_initializeTool:function(){this._createSymbols();this._initializeLayers();this._toolTypes=["select","selectadd","selectremove"]},_onDrawEnd:function(e){this.inherited(arguments);
this._settings.editor._hideAttributeInspector();var k=this._settings.layers;this._selectMethod=this._activeTool._selectMethod;this._settings.editor._selectionHelper.selectFeaturesByGeometry(k,e,this._selectMethod,p.hitch(this,"onFinished"))},_createSymbols:function(){this._pointSelectionSymbol=new d(d.STYLE_CIRCLE,10,new a(a.STYLE_SOLID,new m([0,0,0]),1),new m([255,0,0,.5]));this._polylineSelectionSymbol=new a(a.STYLE_SOLID,new m([0,200,255]),2);this._polygonSelectionSymbol=new c(c.STYLE_SOLID,new a(a.STYLE_SOLID,
new m([0,0,0]),1),new m([0,200,255,.5]))},_initializeLayers:function(){x.forEach(this._settings.layers,this._setSelectionSymbol,this)},_setSelectionSymbol:function(e){var k=null;switch(e.geometryType){case "esriGeometryPoint":k=this._pointSelectionSymbol;break;case "esriGeometryPolyline":k=this._polylineSelectionSymbol;break;case "esriGeometryPolygon":k=this._polygonSelectionSymbol}e.setSelectionSymbol(e._selectionSymbol||k)},_createTools:function(){x.forEach(this._toolTypes,this._createTool,this);
this.inherited(arguments)},_createTool:function(e){var k=p.mixin(h[e],{settings:this._settings,onClick:p.hitch(this,"onItemClicked",h[e].id)});this._tools[e.toUpperCase()]=new l(k)}});p.setObject("dijit.editing.tools.Selection",t,g);return t})},"esri/dijit/editing/tools/SelectionTools":function(){define(["dojo/_base/lang","dojo/has","../../../layers/FeatureLayer","../../../toolbars/draw","../../../kernel"],function(t,p,x,b,m){p={select:{id:"btnNewSelection",_enabledIcon:"toolbarIcon newSelectionIcon",
_disabledIcon:"toolbarIcon newSelectionIcon",_drawType:b.EXTENT,_selectMethod:x.SELECTION_NEW,_label:"NLS_selectionNewLbl"},selectadd:{id:"btnAddToSelection",_enabledIcon:"toolbarIcon addToSelectionIcon",_disabledIcon:"toolbarIcon addToSelectionIcon",_drawType:b.EXTENT,_selectMethod:x.SELECTION_ADD,_label:"NLS_selectionAddLbl"},selectremove:{id:"btnSubtractFromSelection",_enabledIcon:"toolbarIcon removeFromSelectionIcon",_disabledIcon:"toolbarIcon removeFromSelectionIcon",_drawType:b.EXTENT,_selectMethod:x.SELECTION_SUBTRACT,
_label:"NLS_selectionRemoveLbl"},selectClear:{id:"btnClearSelection",_enabledIcon:"toolbarIcon clearSelectionIcon",_disabledIcon:"toolbarIcon clearSelectionIcon",_enabled:!1,_label:"NLS_selectionClearLbl"}};t.setObject("dijit.editing.tools.SelectionTools",p,m);return p})},"esri/dijit/editing/SelectionHelper":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/has dojo/DeferredList ../../geometry/Extent ../../geometry/Point ../../geometry/ScreenPoint ../../layers/FeatureLayer ../../tasks/query ../../kernel".split(" "),
function(t,p,x,b,m,f,d,a,c,l,h,n){t=t(null,{declaredClass:"esri.dijit.editing.SelectionHelper",constructor:function(g){this._settings=g||{};this._sConnects=[];this._mapServiceCount=0;this._map=this._settings.map;this._tolerance=this._settings.singleSelectionTolerance;this._initMapServiceInfos(this._settings.layers)},destroy:function(){for(var g in this._sConnects)this._sConnects.hasOwnProperty(g)&&x.disconnect(this._sConnects[g])},selectFeatures:function(g,e,k,w){k===l.SELECTION_NEW&&(this._resetMapServiceInfos(),
this.getSelection(g));var q=[];b.forEach(g,function(u){if(!0===u.visible&&!0===u._isMapAtVisibleScale()){var r=k;u._isSelOnly&&r===l.SELECTION_NEW&&(r=l.SELECTION_ADD);q.push(u.selectFeatures(e,r))}});(new f(q)).addCallback(p.hitch(this,function(u){var r=[];b.forEach(u,function(v,z){b.forEach(v[1],function(B){(B=g[z]._mode._getFeature(B.attributes[g[z].objectIdField])||null)&&r.push(B)},this)},this);this._mapServiceCount?((u=k===l.SELECTION_SUBTRACT)?(this._resetMapServiceInfos(),this._createLayerDefs(this._getLayerInfosFromSelection(g))):
this._createLayerDefs(this._getLayerInfosFromFeatures(r)),this._updateLayerDefs(this._mapServiceInfos,!1,!(r&&r.length||u),p.hitch(this,w,r))):w(r)}))},selectFeaturesByGeometry:function(g,e,k,w){var q=e;-1!==e.declaredClass.indexOf("Extent")&&e.xmax===e.xmin&&e.ymax===e.ymin&&(q=new a(e.xmax,e.ymax,e.spatialReference));q=-1!==q.declaredClass.indexOf("Point")?this._extentFromPoint(q):q;e=new h;e.geometry=q;this.selectFeatures(g,e,k,w)},clearSelection:function(g){b.forEach(this._nonSelOnlyLayers,function(k){k.clearSelection&&
k.clearSelection()});if(this._mapServiceCount){this._resetMapServiceInfos();var e=this._getLayerInfosFromSelection(this._settings.layers);b.some(e,function(k){return k.oids&&k.oids.length})&&(this._createLayerDefs(e),this._updateLayerDefs(this._mapServiceInfos,!0,g||!1))}},findMapService:function(g){var e=this._map,k=e.layerIds;g=g&&g._url&&g._url.path?g._url.path.toLowerCase():"";var w;for(w in k)if(k.hasOwnProperty(w)){var q=e.getLayer(k[w]);var u=q._url?q._url.path?q._url.path.toLowerCase().replace("mapserver",
"featureserver"):q._url.toLowerCase().replace("mapserver","featureserver"):"";if(g.substr(0,u.length)===u&&"esri.layers.ArcGISDynamicMapServiceLayer"===q.declaredClass)return q}},getSelection:function(g){var e=[];b.forEach(g,function(k){k._isSelOnly&&e.push(this._createLayerInfo(k))},this);b.forEach(e,function(k){var w=this._createMapServiceInfo(this.findMapService(k.layer));w&&(w.layerInfos[k.layer.layerId]=k)},this)},_initMapServiceInfos:function(g){this._nonSelOnlyLayers=[];this._mapServiceInfos=
[];b.forEach(g,function(e){var k=this.findMapService(e);k?(this._mapServiceCount++,this._createMapServiceInfo(k),k&&k.setDisableClientCaching(!0)):this._nonSelOnlyLayers.push(e)},this)},_createMapServiceInfo:function(g){if(!g)return null;var e=this._mapServiceInfos,k=e[g.id];k||(k=e[g.id]={mapService:g,layerInfos:[],layerDefs:p.mixin([],g.layerDefinitions||[]),origLayerDefs:p.mixin([],g.layerDefinitions||[])});return k},_resetMapServiceInfo:function(g){b.forEach(g.layerInfos,this._resetLayerInfo);
g.layerDefs=p.mixin([],g.origLayerDefs||[])},_resetMapServiceInfos:function(){var g=this._mapServiceInfos,e;for(e in g)g.hasOwnProperty(e)&&this._resetMapServiceInfo(g[e])},_createLayerInfo:function(g,e){var k=g.objectIdField,w=e?[]:g.getSelectedFeatures();return{layer:g,selectedFeatures:w||[],oids:b.map(w,function(q){return q.attributes[k]})}},_resetLayerInfo:function(g){g&&(g.selectedFeatures=[],g.oids=[])},_updateLayerDefs:function(g,e,k,w){for(var q in g)if(g.hasOwnProperty(q)){var u=g[q],r=u.mapService,
v=u.layerDefs=e?p.mixin([],u.origLayerDefs||[]):u.layerDefs;v?(k?w&&w():this._sConnects[r.id]=x.connect(r,"onUpdateEnd",p.hitch(this,"_onMapServiceUpdate",u,e,w)),r.setLayerDefinitions(v,k||!1)):w&&w()}},_onMapServiceUpdate:function(g,e,k){x.disconnect(this._sConnects[g.mapService.id]);b.forEach(g.layerInfos,function(w){if(e)w&&w.layer.clearSelection();else{var q=new h;q.objectIds=w?w.oids:[];q.objectIds.length&&w.layer.selectFeatures(q,l.SELECTION_SUBTRACT)}},this);e&&this._resetMapServiceInfo(g);
k&&k()},_createLayerDefs:function(g){b.forEach(g,function(e){var k=e.layer,w=this._createMapServiceInfo(this.findMapService(e.layer));if(w){w=w.layerDefs;var q=k.layerId,u='("'+k.objectIdField+'" NOT IN (',r=e.oids;r&&r.length&&(b.forEach(e.oids,function(v,z){r=!0;z&&(u+=",");u+="'"+v+"'"}),u+="))",w[q]=w.length&&w[q]&&w[q].length?w[q]+(" AND"+u):u)}},this)},_getLayerInfosFromFeatures:function(g){var e=[];b.forEach(g,function(w){var q=w.getLayer();q&&q._isSelOnly&&(e[q.id]||(e[q.id]=this._createLayerInfo(q,
!0)),e[q.id].selectedFeatures.push(w),e[q.id].oids.push(w.attributes[q.objectIdField]))},this);g=[];for(var k in e)e.hasOwnProperty(k)&&g.push(e[k]);return g},_getLayerInfosFromSelection:function(g){var e=[];b.forEach(g,function(k){k._isSelOnly&&e.push(this._createLayerInfo(k,!1))},this);return e},_extentFromPoint:function(g){var e=this._tolerance,k=this._map,w=k.toScreen(g);g=new c(w.x-e,w.y+e);e=new c(w.x+e,w.y-e);g=k.toMap(g);e=k.toMap(e);return new d(g.x,g.y,e.x,e.y,k.spatialReference)}});p.setObject("dijit.editing.SelectionHelper",
t,n);return t})},"esri/dijit/InfoWindow":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/window dojo/_base/kernel dojo/has dojo/query dojo/sniff dojo/dom-class dojo/dom-construct dojo/dom-style dijit/_Widget dijit/_Templated dijit/_Container ../kernel ../domUtils ../InfoWindowBase ./_EventedWidget dojo/text!./templates/InfoWindow.html".split(" "),function(t,p,x,b,m,f,d,a,c,l,h,n,g,e,k,w,q,u,r){var v=t([u,n,g,e,q],{declaredClass:"esri.dijit.InfoWindow",isContainer:!0,
templateString:r,anchor:"upperright",fixedAnchor:null,coords:null,isShowing:!0,isContentShowing:!0,isTitleBarShowing:!0,width:250,height:150,title:"Info Window",setMap:function(z){this.inherited(arguments);l.place(this.domNode,z.root)},startup:function(){if(!this._started){this.inherited(arguments);this._ANCHORS=[v.ANCHOR_UPPERRIGHT,v.ANCHOR_LOWERRIGHT,v.ANCHOR_LOWERLEFT,v.ANCHOR_UPPERLEFT];if(7>f("ie")){var z="progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled\x3d'true', sizingMethod\x3d'crop', src\x3d'"+
h.getComputedStyle(this._sprite).backgroundImage.replace(/url\("/i,"").replace(/"\)/,"")+"')",B=l.create("div",null,b.body());h.set(B,{width:"1px",height:"1px",display:"none",backgroundImage:"none",filter:z});var A=setTimeout(function(){l.destroy(B);clearTimeout(A);A=B=null},100);m.query(".sprite",this.domNode).forEach(function(y){y.style.backgroundImage="none";y.style.filter=z})}this.resize(this.width,this.height);this.hide()}},destroy:function(){this._destroyed||(this.__unregisterMapListeners(),
this.destroyDijits(this._title),this.destroyDijits(this._content),this._title.innerHTML=this._content.innerHTML="",this.inherited(arguments))},resize:function(z,B){if(z&&B){var A=h.set;A(this._topleft,{height:B+"px",marginLeft:z+"px"});A(this._topright,{width:z+"px",height:B+"px"});A(this._user,"width",z-8+"px");A(this._hide,"marginLeft",z-22+"px");A(this._title,"width",z-25+"px");A(this._content,"height",B-37+"px");A(this._bottomleft,{marginLeft:z+"px",marginTop:B+"px"});A(this._bottomright,{width:z-
5+"px",marginTop:B+"px"});this.width=z;this.height=B;this.coords&&this._adjustPosition(this.coords,this.anchor);this.onResize(z,B)}},_adjustPosition:function(z,B){var A=h.set;A(this._infowindow,{left:Math.round(z.x)+"px",top:Math.round(z.y)+"px"});B===v.ANCHOR_UPPERLEFT?A(this._window,{left:null,right:this.width+18+"px",top:null,bottom:this.height+50+"px"}):B===v.ANCHOR_UPPERRIGHT?A(this._window,{left:"6px",right:null,top:null,bottom:this.height+50+"px"}):B===v.ANCHOR_LOWERRIGHT?A(this._window,{left:"6px",
right:null,top:"43px",bottom:null}):B===v.ANCHOR_LOWERLEFT&&A(this._window,{left:null,right:this.width+18+"px",top:"43px",bottom:null})},_getAnchor:function(z){var B=this.map;return B&&z?(z.y<B.height/2?"lower":"upper")+(z.x<B.width/2?"right":"left"):"upperright"},show:function(z,B,A){if(z){z.spatialReference?(this.mapCoords=z,z=this.coords=this.map.toScreen(z,!0)):(this.mapCoords=null,this.coords=z);var y=this.map._getFrameWidth();if(-1!==y&&(z.x%=y,0>z.x&&(z.x+=y),this.map.width>y))for(var D=(this.map.width-
y)/2;z.x<D;)z.x+=y;B&&-1!==x.indexOf(this._ANCHORS,B)||(B=this._getAnchor(z));c.remove(this._pointer,this.anchor);B=this.anchor=this.fixedAnchor||B;this._adjustPosition(z,B);c.add(this._pointer,B);w.show(this.domNode);this.isShowing=!0;if(!A)this.onShow()}},hide:function(z,B){w.hide(this.domNode);this.isShowing=!1;if(!B)this.onHide()},showTitleBar:function(){w.show(this._titlebar);w.show(this._border);this.isTitleBarShowing=!0},hideTitleBar:function(){w.hide(this._titlebar);w.hide(this._border);this.isTitleBarShowing=
!1},showContent:function(){w.show(this._content);w.show(this._border);this.isContentShowing=!0},hideContent:function(){w.hide(this._content);w.hide(this._border);this.isContentShowing=!1},move:function(z,B){B?z=this.coords.offset(z.x,z.y):(this.coords=z,this.mapCoords&&(this.mapCoords=this.map.toMap(z)));h.set(this._infowindow,{left:Math.round(z.x)+"px",top:Math.round(z.y)+"px"})},setFixedAnchor:function(z){z&&-1===x.indexOf(this._ANCHORS,z)||(this.fixedAnchor=z,this.isShowing&&this.show(this.mapCoords||
this.coords,z),this.onAnchorChange(z))},setTitle:function(z){this.destroyDijits(this._title);this.__setValue("_title",z);return this},setContent:function(z){this.destroyDijits(this._content);this.__setValue("_content",z);return this},onShow:function(){this.__registerMapListeners();this.startupDijits(this._title);this.startupDijits(this._content)},onHide:function(){this.__unregisterMapListeners()},onResize:function(){},onAnchorChange:function(){}});p.mixin(v,{ANCHOR_UPPERRIGHT:"upperright",ANCHOR_LOWERRIGHT:"lowerright",
ANCHOR_LOWERLEFT:"lowerleft",ANCHOR_UPPERLEFT:"upperleft"});p.setObject("dijit.InfoWindow",v,k);return v})},"esri/dijit/OverviewMap":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/html dojo/has dojo/dom-class dojo/dom-style dojo/dnd/Moveable dijit/_Widget dijit/_Templated ../map ../geometry/Point ../geometry/ScreenPoint ../layers/TiledMapServiceLayer ../layers/DynamicMapServiceLayer ../layers/VectorTileLayer ../layers/ArcGISTiledMapServiceLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/ArcGISImageServiceLayer ../layers/RasterXLayer ../layers/OpenStreetMapLayer ../virtualearth/VETiledLayer ../kernel ../config ../domUtils dojo/text!./templates/OverviewMap.html dojo/i18n!../nls/jsapi".split(" "),
function(t,p,x,b,m,f,d,a,c,l,h,n,g,e,k,w,q,u,r,v,z,B,A,y,D,G,E){t=t([c,l],{declaredClass:"esri.dijit.OverviewMap",widgetsInTemplate:!0,templateString:G,constructor:function(F,I){p.mixin(this,E.widgets.overviewMap);F=F||{};if(F.map){var M={};I&&(this._detached=!0,M=b.coords(I,!0));this.map=F.map;this.baseLayer=F.baseLayer;this.width=F.width||M.w||this.map.width/4;this.height=F.height||M.h||this.map.height/4;this.attachTo=F.attachTo||"top-right";this.expandFactor=F.expandFactor||2;this.color=F.color||
"#000000";this.opacity=F.opacity||.5;this.maximizeButton=!!F.maximizeButton;this.visible=!!F.visible;if(this.map.loaded)this._initialSetup();else var P=x.connect(this.map,"onLoad",this,function(){x.disconnect(P);P=null;this._initialSetup()});this._detached&&(this.visible=!0);this._maximized=!1}},startup:function(){this.inherited(arguments);(!this.domNode.parentNode||9>m("ie")&&"DIV"!==this.domNode.parentNode.nodeName)&&this.map.container.appendChild(this.domNode);this._detached?(d.set(this._body,
"display","block"),d.set(this._controllerDiv,"display","none"),d.set(this._maximizerDiv,"display","none"),this.map.loaded?this._initialize():x.connect(this.map,"onLoad",this,this._initialize)):("bottom"===this.attachTo.split("-")[0]&&this.domNode.insertBefore(this._maximizerDiv,this._controllerDiv),this.maximizeButton||f.add(this._maximizerDiv,"ovwDisabledButton"),f.add(this.domNode,{"top-left":"ovwTL","top-right":"ovwTR","bottom-left":"ovwBL","bottom-right":"ovwBR"}[this.attachTo]),f.add(this._controllerDiv,
"ovwShow"),f.add(this._maximizerDiv,"ovwMaximize"),this.visible&&this.map.loaded&&(this.visible=!1,this.show()));d.set(this._focusDiv,"opacity",this.opacity)},destroy:function(){this._deactivate();this.overviewMap&&this.overviewMap.destroy();this.overviewMap=this.baseLayer=null;this.inherited(arguments)},resize:function(F){!F||0>=F.w||0>=F.h||this._resize(F.w,F.h)},show:function(){if(!this.visible){var F=this._controllerDiv;F.title=this.NLS_hide;f.remove(F,"ovwShow");f.add(F,"ovwHide");D.show(this._body);
D.show(this._maximizerDiv);this._initialize();this.visible=!0}},hide:function(){if(this.visible){var F=this._controllerDiv;F.title=this.NLS_show;f.remove(F,"ovwHide");f.add(F,"ovwShow");this._maximized&&this._maximizeHandler();D.hide(this._body);D.hide(this._maximizerDiv);this._deactivate();this.visible=!1}},_initialSetup:function(){if(this._mainMapLayer=this.map.getLayer(this.map.layerIds[0])){var F=this.baseLayer||this._mainMapLayer,I=this.map.spatialReference,M=F.spatialReference;if(M.wkid===I.wkid||
M.wkt===I.wkt){I=F.declaredClass;if(F instanceof e)if(-1!==I.indexOf("VETiledLayer"))this.baseLayer=new B({resourceInfo:F.getResourceInfo(),culture:F.culture,mapStyle:F.mapStyle,bingMapsKey:F.bingMapsKey});else if(-1!==I.indexOf("OpenStreetMapLayer"))this.baseLayer=new z({tileServers:F.tileServers});else if(-1!==I.indexOf("WebTiledLayer")){I=F.initialExtent;M=F.fullExtent;var P=F.tileInfo;this.baseLayer=new F.constructor(F.urlTemplate,{initialExtent:I&&new I.constructor(I.toJson()),fullExtent:M&&
new M.constructor(M.toJson()),tileInfo:P&&new P.constructor(P.toJson()),tileServers:F.tileServers&&F.tileServers.slice(0)})}else this.baseLayer=new q(F.url,{resourceInfo:F.getResourceInfo()});else if(F instanceof k)-1!==I.indexOf("ArcGISImageServiceLayer")?this.baseLayer=new r(F.url):(this.baseLayer=new u(F.url),this.baseLayer.setImageFormat("png24"));else if(F instanceof v)this.baseLayer=new v(F.url);else if(F instanceof w)this.baseLayer=new q("https://services.arcgisonline.com/arcgis/rest/services/World_Street_Map/MapServer",
{});else return;!this._detached&&this.visible&&this._controllerDiv&&(F=function(){this.visible=!1;this.show()},this.baseLayer.loaded?F.call(this):x.connect(this.baseLayer,"onLoad",this,F))}}},_visibilityHandler:function(){this.visible?this.hide():this.show()},_maximizeHandler:function(){var F=this._maximizerDiv;this._maximized?(F.title=this.NLS_maximize,f.remove(F,"ovwRestore"),f.add(F,"ovwMaximize"),this._resize(this.width,this.height)):(F.title=this.NLS_restore,f.remove(F,"ovwMaximize"),f.add(F,
"ovwRestore"),this._resize(this.map.width,this.map.height));this._maximized=!this._maximized},_resize:function(F,I){d.set(this._body,{width:F+"px",height:I+"px"});var M=y.defaults.map.panDuration,P=this.overviewMap;y.defaults.map.panDuration=0;P&&(P.resize(!0),P.centerAt(this._focusExtent.getCenter()));y.defaults.map.panDuration=M},_initialize:function(){if(this.overviewMap)this._activate();else{var F;var I=9>m("ie")?this._body.firstChild:this._body.firstElementChild;this.overviewMap=F=new h(I,{slider:!1,
showAttribution:!1,logo:!1,lods:this._overviewLods,wrapAround180:this.map.wrapAround180});x.connect(F,"onLoad",this,function(){this._map_resize_override=p.hitch(F,this._map_resize_override);F.disableMapNavigation();this._activate()});F.addLayer(this.baseLayer)}},_activate:function(){var F=this.map,I=this.overviewMap;this._moveableHandle=new a(this._focusDiv);this._soeConnect=x.connect(F,"onExtentChange",this,this._syncOverviewMap);this._ufoConnect=x.connect(F,"onPan",this,this._updateFocus);this._oecConnect=
x.connect(I,"onExtentChange",this,this._ovwExtentChangeHandler);this._opaConnect=x.connect(I,"onPan",this,this._ovwPanHandler);this._ozsConnect=x.connect(I,"onZoomStart",this,function(){D.hide(this._focusDiv)});this._ozeConnect=x.connect(I,"onZoomEnd",this,function(){D.show(this._focusDiv)});this._omsConnect=x.connect(this._moveableHandle,"onMoveStop",this,this._moveStopHandler);this._syncOverviewMap(F.extent,null,null,null)},_deactivate:function(){x.disconnect(this._soeConnect);x.disconnect(this._ufoConnect);
x.disconnect(this._oecConnect);x.disconnect(this._opaConnect);x.disconnect(this._ozsConnect);x.disconnect(this._ozeConnect);x.disconnect(this._omsConnect);this._moveableHandle&&(this._moveableHandle.destroy(),this._moveableHandle=null)},_syncOverviewMap:function(F,I,M,P){this._suspendPanHandling?this._suspendPanHandling=!1:(this._focusExtent=F,this.overviewMap.setExtent(F.expand(this.expandFactor),!0))},_updateFocus:function(F){this._suspendPanHandling||(this._focusExtent=F,this._drawFocusDiv(F))},
_drawFocusDiv:function(F,I){var M=this.overviewMap,P=M.toScreen(new n(F.xmin,F.ymax,M.spatialReference)),W=M.toScreen(new n(F.xmax,F.ymin,M.spatialReference));M=W.x-P.x;W=W.y-P.y;var H=!0;M>this.overviewMap.width&&W>this.overviewMap.height&&(H=!1);d.set(this._focusDiv,{left:P.x+(I?I.x:0)+"px",top:P.y+(I?I.y:0)+"px",width:M+"px",height:W+"px",display:H?"block":"none"})},_moveStopHandler:function(F){var I=this._moveableHandle.node.style;F=this._focusExtent;var M=this.overviewMap;I=M.toMap(new g(parseInt(I.left,
10),parseInt(I.top,10)));var P=new n(F.xmin,F.ymax,M.spatialReference);this._focusExtent=F.offset(I.x-P.x,I.y-P.y);this._maximized?this._maximizeHandler():M.centerAt(this._focusExtent.getCenter());this._suspendPanHandling=!0;this.map.setExtent(this._focusExtent)},_ovwExtentChangeHandler:function(){this._drawFocusDiv(this._focusExtent)},_ovwPanHandler:function(F,I){this._drawFocusDiv(this._focusExtent,I)}});p.setObject("dijit.OverviewMap",t,A);return t})},"esri/layers/VectorTileLayer":function(){(function(){var t=
function(){try{var x=window.WebGLRenderingContext}catch(c){x=!1}try{for(var b=document.createElement("canvas"),m=["webgl","experimental-webgl","webkit-3d","moz-webgl"],f=null,d=0;d<m.length;++d){try{f=b.getContext(m[d])}catch(c){}if(f)break}var a=f}catch(c){a=!1}return x&&a?!0:!1}(),p=["dojo/_base/lang","dojo/has","dojo/Deferred","../sniff","./layer"];t&&p.push("./VectorTileLayerImpl");define(p,function(x,b,m,f,d,a){b=a?a:d.createSubclass({declaredClass:"esri.layers.VectorTileLayer",constructor:function(){var c=
new m;c.reject(Error("esri.layers.VectorTileLayer is not supported"));c.promise.otherwise(x.hitch(this,function(l){this._errorHandler(l)}))}});b.ACCESS_TOKEN=null;b.supported=function(){return t};x.setObject("layers.VectorTileLayer",b,f);return b})})()},"esri/layers/rasterLib/raster/rasterFactory":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/sniff dojo/when ../../../kernel ../../../Evented ../../../request ../../../deferredUtils ../../../urlUtils ./ImageServiceRaster ./TileServiceRaster ./TileRaster ./FunctionRaster".split(" "),
function(t,p,x,b,m,f,d,a,c,l,h,n,g,e,k,w,q){t={customDrivers:[],create:function(u){if(u){if(u.url){var r=g.urlToObject(u.url);var v=r.path;var z=r.query}r=u.serviceInfo;var B=u.rasterFxArgs||{},A=new b,y=x.hitch(this,function(F){this._trycustomDrivers(x.mixin({url:v},u),0,A)});if(v)if(-1===v.toLowerCase().indexOf("imageserver")&&-1===v.toLowerCase().indexOf("mapserver")){var D=new w(x.mixin({},u,{url:v}));u.rasterFx&&(D=new q({rasterFx:u.rasterFx,rasterFxArgs:x.mixin({},B,{raster:D})}));var G=D}else{G=
new b;r=r||this._getServiceInfo(v,z);var E=x.hitch(this,function(F){F.bandCount?D=new e(x.mixin({},{serviceInfo:F},z,u,{url:v})):F.tileInfo&&(D=new k(x.mixin({},{serviceInfo:F},z,this._options,{url:v})));u.rasterFx&&(D=new q({rasterFx:u.rasterFx,rasterFxArgs:x.mixin({},B,{raster:D})}));G.resolve(D)});a(r,E,y)}else G=D=new q({rasterFx:u.rasterFx,rasterFxArgs:x.mixin({},B,{raster:D})});a(G,x.hitch(this,function(F){F?F.open().then(x.hitch(this,function(I){A.resolve(F)}),y):y(Error("There is no raster to open"))}),
y);return A.promise}},register:function(u){this.customDrivers=this.customDrivers||[];0<this.customDrivers.filter(function(r){return r.sourceType===u.prototype.sourceType}).length||this.customDrivers.push(u)},_trycustomDrivers:function(u,r,v){v=v||new b;var z=this.customDrivers[r];if(z){var B=new z(u);B.open().then(x.hitch(this,function(A){v.resolve(B)}),x.hitch(this,function(A){this._trycustomDrivers(u,r+1,v)}))}else v.reject("cannot load layer "+(u&&u.url||""));return v.promise},_getServiceInfo:function(u,
r){r=r||{};var v=r.bandIds,z=r.renderingRule,B=new b(n._dfdCanceller),A={f:"json"};v&&(A.bandIds=v);z&&(A.renderingRule=z.toJson?JSON.stringify(z.toJson()):JSON.stringify(z));B._pendingDfd=h({url:u,content:A,handleAs:"json",callbackParamName:"callback"});B._pendingDfd.then(function(y){B.callback(y)},function(y){B.errback(y)});return B.promise}};x.setObject("layers.rasterLib.raster.rasterFactory",t,c);return t})},"esri/layers/rasterLib/raster/ImageServiceRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff dojo/DeferredList dojo/when ../../../kernel ../../../Evented ../../../request ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../WKIDUnitConversion ../../../deferredUtils ../../../urlUtils ../../MosaicRule ../../ImageServiceParameters ../../PixelBlock ./RasterInfo ./BasicRaster ../../rasterFormats/rasterCodec ../tile/RasterTileInfo".split(" "),
function(t,p,x,b,m,f,d,a,c,l,h,n,g,e,k,w,q,u,r,v,z,B,A,y,D,G){t=p([y],{declaredClass:"esri.layers.rasterLib.raster.ImageServiceRaster",sourceType:"ImageService",constructor:function(E){E&&(this._imageServiceParams=E.imageServiceParameters,this._commonReqParams=E._commonReqParams,this._imageServiceParams||(this._imageServiceParams={interpolation:E.interpolation,pixelType:E.pixelType,format:E.format||"lerc",compressionQuality:E.compressionQuality,bandIds:E.bandIds,noDataInterpretation:E.noDataInterpretation,
adjustAspectRatio:E.adjustAspectRatio,mosaicRule:E.mosaicRule,renderingRule:E.interpolation}))},open:function(){var E=new b;if(this.serviceInfo&&this.rasterInfo)return this.loaded=!0,this._findCredential(),this.setFetchParameters(this._imageServiceParams),E.resolve(this),E.promise;var F=this.serviceInfo||this._generateServiceInfo(this._imageServiceParams&&this._imageServiceParams.renderingRule),I=x.hitch(this,function(P){this._fixServiceInfo(P);this.serviceInfo=P;this._findCredential();var W=this._parseRasterInfo(P),
H={};P.defaultMosaicMethod?(H.method=P.defaultMosaicMethod,H.operation=P.mosaicOperator,H.sortField=P.sortField,H.sortValue=P.sortValue):H.method=v.METHOD_NONE;this.serviceInfo.defaultMosaicRule=new v(H);this.serviceInfo.defaultMosaicRule.ascending=!0;P=this._getColormap(this);H=this._getHistograms(this);var O=this._getRasterAttributeTable(this),K=this._getKeyProperties(this),R=this._getMultidimensionalInfo(),da=this._getSlices();(new c([P,H,O,K,R,da])).then(x.hitch(this,function(U){U[0][0]&&(W.colormap=
U[0][1]);U[1][0]&&(W.histograms=U[1][1]);U[2][0]&&(W.vat=U[2][1]);U[3][0]&&(W.keyProperties=U[3][1]);U[4][0]&&(W.multidimensionalInfo=U[4][1]);this._slices=U[5][0]?U[5][1]:null;W.keyProperties&&W.keyProperties.DataType&&(this.dataType=W.keyProperties.DataType);this.loaded=!0;this.rasterInfo=W;this.setFetchParameters(this._imageServiceParams);E.resolve(this)}))}),M=x.hitch(this,function(P){this.loaded=!0;E.reject(P)});l(F,I,M);return E.promise},setFetchParameters:function(E,F){if(F)this.imageServiceParams=
E;else{var I=this.imageServiceParams;I&&E?Object.keys(E).forEach(function(M){I[M]=E[M]}):this.imageServiceParams=E}this._constructGetImageParams();this._getRasterIdentifier(!0)},read:function(E){if(E.pixelBlock||E.texture){var F=new b;F.resolve(E);return F.promise}if(!1===E.virtual&&this.tileInfo&&!this.tileInfo.virtual)return this.readTile(E);if(this._slices){var I=this._getSliceId();if(null==I)return F=new b,F.resolve(E),F.promise}var M=E.extent,P=M.spatialReference.wkid||d.toJson(M.spatialReference.toJson(!1)),
W=E.timeExtent?E.timeExtent.toJson().join(","):null;F=this.url+"/exportImage";var H={};this._slices&&(H.sliceid=I);this.disableClientCaching&&(H._ts=(new Date).getTime());I=x.mixin({},this._commonReqParams,{bbox:M.xmin+","+M.ymin+","+M.xmax+","+M.ymax,imageSR:P,bboxSR:P,size:E.width+","+E.height,time:W},H);return this._requestPixels({url:F,payload:I,decodeParams:{width:E.width,height:E.height,planes:null,pixelType:null,format:null,decodeFunc:null,isPoint:!1},tileOptions:E})},readTile:function(E){var F=
this.tileBoundary&&this.tileBoundary[E.level];if(F&&(F.minRow>E.row||F.maxRow<E.row||F.minCol>E.col||F.maxCol<E.col)){var I=new b;I.resolve(E);return I.promise}if(this._slices&&(I=this._getSliceId(),null==I))return I=new b,I.resolve(E),I.promise;F=this.url+"/tile/"+E.level+"/"+E.row+"/"+E.col;var M={width:this.tileInfo.cols,height:this.tileInfo.rows,planes:null,pixelType:null,format:null,decodeFunc:null,useWasm:!0,isPoint:"elevation"===E.tileType.toLowerCase()?!0:!1};I=this._slices?"sliceid\x3d"+
I+"\x26":"";I=this.disableClientCaching?"_ts\x3d "+(new Date).getTime():I.replace(/&$/,"");return this._requestPixels({url:F+(0<I.length?"?"+I:""),payload:{},decodeParams:M,tileOptions:E})},toJson:function(){return{url:this.url,tileInfo:this.tileInfo,rasterInfo:this.rasterInfo,serviceInfo:this.serviceInfo,sourceType:this.sourceType,_commonReqParams:this._commonReqParams,_rasterId:this._rasterId}},_getSliceId:function(){var E=x.clone(this._imageServiceParams.multidimensionalDefinition),F=x.clone(this._imageServiceParams.time);
if(null==this._slices||null==F&&(null==E||0===E.length))return 0;var I=E||this.defaultMultidimensionalDefinition,M=I[0].variableName;I=this._getAllDimensionDefinition(I,M).definition;E=null;if(null==I||0===I.length)return null;if(F&&this.serviceInfo.timeInfo){if(null==F[1]||F[1]===F[0])var P=F[0];else{var W=this.serviceInfo.timeInfo.startTimeField;P=this.rasterInfo.multidimensionalInfo.variables.find(function(K){return K.name===M}).dimensions.find(function(K){return K.name===W}).values.filter(function(K){return Array.isArray(K)?
Math.max(K[0],F[0])<Math.min(K[1],F[1]):K>=F[0]&&K<=F[1]}).sort(function(K,R){K=Array.isArray(K)?K[1]:K;R=Array.isArray(R)?K[1]:R;return Math.abs(F[1]-K)-Math.abs(F[1]-R)})[0]||[F[1]]}I.some(function(K){if(K.dimensionName===W)return K.values[0]=P,!0;if(!K.dimensionName)return K.dimensionName=W,K.isSlice=!0,K.values=[P],!0})||I.push({variableName:M,dimensionName:W,isSlice:!0,values:[P]})}for(var H=0;H<this._slices.length;H++){var O=this._slices[H].multidimensionalDefinition;if(O.length===I.length&&
!O.some(function(K){var R=I.filter(function(U){return K.variableName===U.variableName&&U.dimensionName===K.dimensionName})[0];if(!R)return!0;var da=Array.isArray(K.values[0])?K.values[0][0]:K.values[0];R=Array.isArray(R.values[0])?R.values[0][0]:R.values[0];return da!==R})){E=H;break}}return E},_getAllDimensionDefinition:function(E,F){var I=E.map(function(P){return P.dimensionName}),M=!1;this.rasterInfo.multidimensionalInfo.variables.forEach(function(P){P.name!==F||P.dimensions.length===E.length&&
I[0]||(P.dimensions.forEach(function(W){0>I.indexOf(W.name)&&(I[0]?E.push({variableName:F,dimensionName:W.name,values:[W.values[0]]}):(E[0].dimensionName=W.name,E[0].values=[W.values[0]],W[0]=W.name))}),M=!0)},this);return{defChanged:M,definition:E}},_generateServiceInfo:function(E){var F=this.url,I=new b(u._dfdCanceller);I._pendingDfd=g({url:F,content:{f:"json",renderingRule:E?d.toJson(E.toJson()):null},handleAs:"json",callbackParamName:"callback"});I._pendingDfd.then(function(M){I.callback(M)},
function(M){I.errback(M)});return I},_fixServiceInfo:function(E){var F=E.spatialReference.wkid;E.tileInfo&&0===E.extent.xmin&&360===E.extent.xmax&&F&&null==q[F]&&(E.tileInfo.applyGCS360Transform=!0)},_parseRasterInfo:function(E){var F=new A;F.bandCount=E.bandCount;F.extent=new e(E.fullExtent);F.spatialReference=E.spatialReference;F.pixelType=E.pixelType;F.width=Math.floor((E.fullExtent.xmax-E.fullExtent.xmin)/E.pixelSizeX+.5);F.height=Math.floor((E.fullExtent.ymax-E.fullExtent.ymin)/E.pixelSizeY+
.5);F.cellSize=new k({x:E.pixelSizeX,y:E.pixelSizeY,spatialReference:E.spatialReference});var I;if(E.minValues&&0<E.minValues.length&&E.maxValues&&E.stdvValues&&E.meanValues){var M=[];for(I=0;I<E.minValues.length;I++)M.push({min:E.minValues[I],max:E.maxValues[I],mean:E.meanValues[I],stddev:E.stdvValues[I]});E.bandCount!==M.length&&(M=null)}this.dataType=E.serviceDataType?E.serviceDataType.replace("esriImageServiceDataType",""):"Generic";F.statistics=M;E.objectIdField&&E.fields&&(F.catalogInfo={objectIdField:E.objectIdField,
fields:E.fields});F.timeInfo=E.timeInfo;if(E.tileInfo){this.tileInfo=new G(E.tileInfo);this.tileInfo.tileType=E.cacheType||"Map";F.tileInfo=this.tileInfo;var P=F.extent,W=this.tileInfo.origin,H=this.tileInfo.cols,O=this.tileInfo.rows;this.tileBoundary=this.tileInfo.lods.map(function(K){return{minCol:Math.floor((P.xmin-W.x+.1*K.resolution)/H/K.resolution),maxCol:Math.floor((P.xmax-W.x-.1*K.resolution)/H/K.resolution),minRow:Math.floor((W.y-P.ymax+.1*K.resolution)/O/K.resolution),maxRow:Math.floor((W.y-
P.ymin-.1*K.resolution)/O/K.resolution)}})}return F},_getColormap:function(E){E=this.url+"/colormap";var F=new b(u._dfdCanceller),I={f:"json"},M=this.serviceInfo.hasColormap||this.rasterInfo&&this.rasterInfo.hasColormap;10<this.serviceInfo.currentVersion&&M?(F._pendingDfd=g({url:E,content:I,handleAs:"json",callbackParamName:"callback"}),F._pendingDfd.then(function(P){F.callback(P.colormap)},function(P){F.errback(P)})):F.callback(null);return F},_getHistograms:function(E){var F=this.url+"/histograms",
I=new b(u._dfdCanceller),M={f:"json"},P=this.serviceInfo.hasHistograms||this.rasterInfo&&this.rasterInfo.hasHistograms;E&&E.renderingRule&&(M.renderingRule=d.toJson(E.renderingRule.toJson()),P=!0);10<this.serviceInfo.currentVersion&&P?(I._pendingDfd=g({url:F,content:M,handleAs:"json",callbackParamName:"callback"}),I._pendingDfd.then(function(W){I.callback(W.histograms)},function(W){I.errback(W)})):I.callback(null);return I},_getRasterAttributeTable:function(E){var F=this.url+"/rasterAttributeTable",
I=new b(u._dfdCanceller),M={f:"json"},P=this.serviceInfo.hasRasterAttributeTable;E&&E.renderingRule&&(M.renderingRule=d.toJson(E.renderingRule.toJson()),P=!0);10<this.serviceInfo.currentVersion&&P?(I._pendingDfd=g({url:F,content:M,handleAs:"json",callbackParamName:"callback"}),I._pendingDfd.then(function(W){I.callback(W)},function(W){I.errback(W)})):I.callback(null);return I},_getKeyProperties:function(E){var F=this.url+"/keyProperties",I=new b(u._dfdCanceller),M={f:"json"};E&&E.renderingRule&&(M.renderingRule=
d.toJson(E.renderingRule.toJson()));10<this.serviceInfo.currentVersion?(I._pendingDfd=g({url:F,content:M,handleAs:"json",callbackParamName:"callback"}),I._pendingDfd.then(function(P){I.callback(P)},function(P){I.errback(P)})):I.callback(null);return I},_getMultidimensionalInfo:function(){var E=this.url+"/multidimensionalInfo",F=new b(u._dfdCanceller);10.3<=this.serviceInfo.currentVersion&&this.serviceInfo.hasMultidimensions?(F._pendingDfd=g({url:E,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),
F._pendingDfd.then(x.hitch(this,function(I){F.callback(I.multidimensionalInfo)}),function(I){F.errback(I)})):F.callback(null);return F},_getSlices:function(){var E=this.url+"/slices",F=new b(u._dfdCanceller);this.serviceInfo.hasMultidimensions?(F._pendingDfd=g({url:E,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),F._pendingDfd.then(x.hitch(this,function(I){F.callback(I.slices)}),function(I){F.errback(I)})):F.callback(null);return F},_initializationFailed:function(){},_constructGetImageParams:function(){var E=
this.imageServiceParams||{},F=x.mixin({},this._query,{f:"image",interpolation:E.interpolation,pixelType:E.pixelType,format:E.format||"lerc",compressionQuality:E.compressionQuality,bandIds:E.bandIds?E.bandIds.join(","):null,noData:null!=E.noData?E.noData.join(","):null,noDataInterpretation:E.noDataInterpretation,adjustAspectRatio:null==E.adjustAspectRatio?null:E.adjustAspectRatio,mosaicRule:E.mosaicRule?d.toJson(E.mosaicRule.toJson()):null,renderingRule:E.renderingRule?d.toJson(E.renderingRule.toJson()):
null,token:this.credential&&this.credential.token||null});"lerc"===F.format.toLowerCase()?(F.compressionTolerance=E.compressionTolerance,10.5<=this.serviceInfo.currentVersion&&(F.lercVersion=E.lercVersion||2)):"tiff"===F.format.toLowerCase()?F.compression=E.compression:-1<["jpg","jpeg","jpg","jpgpng"].indexOf(F.format.toLowerCase())&&(F.compression=E.compression);this._commonReqParams=F},_getRasterIdentifier:function(E){if(this._rasterId)return this._rasterId;E=this.url.replace("http:","").replace("https:",
"");var F=[],I=this.imageServiceParams||{};F.push(E);F.push(I.interpolation);F.push(I.pixelType);F.push(I.compressionQuality);F.push(I.bandIds?I.bandIds.join(","):"");F.push(I.mosaicRule?d.toJson(I.mosaicRule.toJson()):"");F.push(I.renderingRule?d.toJson(I.renderingRule.toJson()):"");E=F.join("|");return this._rasterId=this._computeSignature(E)},_wrapExtent:function(E){var F=E.spatialReference._getInfo();if(F){var I=F.valid[0];F=F.valid[1];if(E.xmin<I-this.resolution.x||E.xmax>F+this.resolution.y){var M=
new e((E.xmin-I)%(F-I),E.ymin,(E.xmax-F)%(F-I),E.ymax,E.spatialReference);M.xmax<M.xmin&&(M=null)}}return M||E}});x.setObject("layers.rasterLib.raster.ImageServiceRaster",t,h);return t})},"esri/layers/rasterLib/raster/RasterInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","../../../geometry/Extent","../../../SpatialReference","../tile/RasterTileInfo"],function(t,p,x,b,m){return t(null,{declaredClass:"esri.layers.rasterLib.raster.RasterInfo",bandCount:null,pixelType:null,extent:null,
spatialReference:null,width:null,height:null,colormap:null,attributeTable:null,multiDimensionalInfo:null,statistics:null,histograms:null,catalogInfo:null,keyProperties:null,cellSize:null,format:null,compression:null,compressionQuality:null,packetSize:null,geodataXform:null,constructor:function(f){p.mixin(this,f);this.extent=this.extent?this.extent.toJson?this.extent:new x(this.extent):null;this.spatialReference=this.spatialReference?this.spatialReference.toJson?this.spatialReference:new b(this.spatialReference):
null;this.tileInfo=this.tileInfo?this.tileInfo.toJson?this.tileInfo:new m(this.tileInfo):null},toJson:function(){return{bandCount:this.bandCount,pixelType:this.pixelType,extent:this.extent&&this.extent.toJson?this.extent.toJson():this.extent,spatialReference:this.spatialReference&&this.spatialReference.toJson?this.spatialReference.toJson():this.spatialReference,width:this.width,height:this.height,colormap:this.colormap?p.clone(this.colormap):null,attributeTable:this.attributeTable?p.clone(this.attributeTable):
null,multiDimensionalInfo:this.multiDimensionalInfo?p.clone(this.multiDimensionalInfo):null,statistics:this.statistics?p.clone(this.statistics):null,histograms:this.histograms?p.clone(this.histograms):null,catalogInfo:this.catalogInfo?p.clone(this.catalogInfo):null,keyProperties:this.keyProperties?p.clone(this.keyProperties):null,cellSize:this.cellSize&&this.cellSize.toJson?this.cellSize.toJson():this.cellSize,tileInfo:this.tileInfo&&this.tileInfo.toJson?this.tileInfo.toJson():this.tileInfo,format:this.format,
compression:this.compression,compressionQuality:this.compressionQuality,packetSize:this.packetSize,geodataXform:this.geodataXform?p.clone(this.geodataXform):null}},clone:function(){return new this.constructor(this.toJson())}})})},"esri/layers/rasterLib/tile/RasterTileInfo":function(){define("dojo/_base/declare dojo/_base/lang ../../../geometry/Extent ../../../SpatialReference ../../../geometry/Point ../../../lang ../../TileInfo".split(" "),function(t,p,x,b,m,f,d){return t([d],{declaredClass:"esri.layers.rasterLib.tile.RasterTileInfo",
rows:512,cols:512,compressionQuality:95,lercError:.01,spatialReference:null,origin:null,virtual:!0,tileType:"Raster",constructor:function(a,c){if(a||c){var l=c&&c.refTileInfo;a?this.virtual=!1:(this.virtual=!0,p.mixin(this,{rows:c.rows||this.rows,cols:c.cols||this.cols,compressionQuality:c.compressionQuality||95,lercError:c.compressionTolerance||.01,spatialReference:c.spatialReference,origin:c.origin}),this.width=this.cols,this.height=this.rows,this.origin||(l?this.origin=l.origin:c.spatialReference.isWebMercator()||
c.extent&&360<=Math.max(Math.abs(c.extent.xmin),Math.abs(c.extent.xmax))?this.origin={x:-2.0037508342787E7,y:2.0037508342787E7}:-1<[4326,4269].indexOf(c.spatialReference.wkid)||360>Math.max(Math.abs(c.extent.xmin),Math.abs(c.extent.xmax))?this.origin={x:-180,y:90}:this.origin={x:c.extent.xmin,y:c.extent.ymax}))}},toJson:function(){var a=d.prototype.toJson.apply(this);a.tileType=this.tileType;a.virtual=this.virtual;a.lercError=this.lercError;return a},clone:function(){return new this.prototype(this.toJson())}})})},
"esri/layers/rasterLib/raster/BasicRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff dojo/DeferredList dojo/when ../../../kernel ../../../Evented ../../../request ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../deferredUtils ../../../urlUtils ../../MosaicRule ../../ImageServiceParameters ../../PixelBlock ../../rasterFormats/rasterCodec ../tile/RasterHandler ./rasterProjectionHelper ./RasterInfo".split(" "),
function(t,p,x,b,m,f,d,a,c,l,h,n,g,e,k,w,q,u,r,v,z,B,A,y,D){return p([n],{url:null,dataType:null,rasterInfo:null,tileInfo:null,serviceInfo:null,loaded:null,constructor:function(G){if(G){var E=G.url;E&&(E=u.urlToObject(E),this.url=E.path,this._query=E.query);this.dataType=G.dataType;this.serviceInfo=G.serviceInfo;this.rasterInfo=G.rasterInfo;this.tileInfo=G.tileInfo;this.serviceInfo=G.serviceInfo}},open:function(){},read:function(G){},identify:function(G){var E=new b,F=this.rasterInfo.extent;if(y.requirePE(F.spatialReference,
G.spatialReference))y.load().then(x.hitch(this,function(){I=y.project(G,F.spatialReference);E.resolve(I)}),function(){E.reject(Error("cannot project into this spatial reference"))});else{var I=y.project(G,F.spatialReference);E.resolve(I)}return E.then(x.hitch(this,function(M){var P=this.tileInfo,W=P.origin,H=P.lods[P.lods.length-1],O=(M.x-W.x)/P.cols/H.resolution;M=(W.y-M.y)/P.rows/H.resolution;var K=Math.round((M-Math.floor(M))*P.rows)*P.cols+Math.round((O-Math.floor(O))*P.cols);W=new e(W.x+H.resolution*
P.cols*O,W.y-H.resolution*P.rows*(M+1),W.x+H.resolution*P.cols*(O+1),W.y-H.resolution*P.rows*M,F.spatialReference);var R=this.getMemberRasters?this.getMemberRasters()[0]:this;return R.read({level:H.level,row:Math.floor(M),col:Math.floor(O),extent:W,width:P.cols,height:P.rows,virtual:R.tileInfo.virtual,tileType:R.tileInfo.tileType}).then(function(da){return(da=da&&da.pixelBlock)&&da.pixels&&0<da.pixels.length&&(!da.mask||da.mask[K])?{pixelValue:da.pixels.map(function(U){return U[K]})}:{pixelValue:null}})}))},
getProjectedFullExtent:function(G,E){var F=new b;if(this.projectedFullExtent&&!E)return F.resolve(this.projectedFullExtent),F.promise;var I=this.rasterInfo.extent;if(y.requirePE(this.rasterInfo.extent.spatialReference,G))y.load().then(x.hitch(this,function(){M=y.project(I,G);this.projectedFullExtent=M=new e(M.toJson());F.resolve(M)}),function(){F.reject(Error("cannot project into this spatial reference"))});else{var M=y.project(I,G);this.projectedFullExtent=M=new e(M.toJson());F.resolve(M)}return F.promise},
setFetchParameters:function(G,E){},_setRasterHandler:function(G){this._rasterHandler=G;this.getMemberRasters&&this.getMemberRasters().forEach(x.hitch(this,function(E){E._rasterHandler=G}))},_findCredential:function(){this.url&&((this._credential=h.id&&h.id.findCredential(this.url))&&this._credential.ssl||this.serviceInfo&&this.serviceInfo._ssl)&&(this.url=this.url.replace(/^http:/i,"https:"))},_initWorker:function(){this._rasterHandler=new A;this._rasterHandler.start().then(function(){this._rasterHandlerInitialized=
!0}.bind(this))},_requestPixels:function(G){var E=G.url,F=G.payload,I=G.decodeParams,M=G.tileOptions,P=new b(q._dfdCanceller);this._rasterHandler||this._initWorker();var W=this._rasterHandler,H={};E={url:E,handleAs:"arraybuffer",content:F};G.headers&&(E.headers=G.headers);P._pendingDfd=g(E).then(x.hitch(this,function(O){(W&&this._rasterHandlerInitialized?W.decode({encodedData:O,decodeParams:I}):B.decode(O,I)).then(function(K){H.pixelBlock=new z(K);H.extent=M.extent;H.level=M.level;H.row=M.row;H.col=
M.col;H.width=M.width;H.height=M.height;q._resDfd(P,[H])},function(K){q._resDfd(P,[K],!0)})}),function(O){q._resDfd(P,[O],!0)});return P},_computeSignature:function(G){if("string"===typeof G){for(var E=new Uint8Array(G.length),F=0;F<G.length;F++)E[F]=G.charCodeAt(F);G=E}F=E=65535;for(var I=G.length,M=Math.floor(I/2),P=0;M;){var W=359<=M?359:M;M-=W;do E+=G[P++]<<8,F+=E+=G[P++];while(--W);E=(E&65535)+(E>>>16);F=(F&65535)+(F>>>16)}I&1&&(F+=E+=G[P]<<8);return((F&65535)+(F>>>16)<<16|(E&65535)+(E>>>16))>>>
0}})})},"esri/layers/rasterFormats/rasterCodec":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred ../PixelBlock ./LercCodec ./Lerc2Codec ./Lerc ./JpgPlus ./Png ./Raw ./TiffDecoder".split(" "),function(t,p,x,b,m,f,d,a,c,l,h,n){return{validPixelTypes:"U1 U2 U4 U8 U16 U32 S8 S16 S32 F32".split(" "),supportedFormats:"lerc jpeg jpg jpgpng png png8 png24 png32 bip bsq tiff".split(" "),_isPlatformLittleEndian:function(){var g=new ArrayBuffer(4),e=new Uint8Array(g);(new Uint32Array(g))[0]=
1;return 1===e[0]}(),decode:function(g,e){if(void 0===e||null===e)throw"missing decode options";var k;e.format&&(k=e.format.toUpperCase());"BSQ"!==k&&"BIP"!==k&&(k=this._getFormat(g));var w=e.decodeFunc;if(void 0===w||null===w)w=this._getFormatDecoderDfd(k,e.useWasm);return w(g,e)},_getFormatDecoderDfd:function(g,e){if(e&&("LERC"===g||"LERC2"===g))return this._decodeLercWasm.bind(this);var k=null;switch(g){case "LERC":k=this._decodeLerc;break;case "LERC2":k=this._decodeLerc2;break;case "JPEG":k=this._decodeJpeg;
break;case "PNG":k=this._decodePng;break;case "BSQ":k=this._decodeBsq;break;case "BIP":k=this._decodeBip;break;case "TIFF":k=this._decodeTiff;break;default:k=function(w,q){throw"The raster format is not supported";}}k=x.hitch(this,k);return function(w,q){var u=new b;q.isPoint&&q.width&&(q.width++,q.height++);var r=k(w,q);q.isPoint&&q.width&&(this._interpolatePointGrid(r),q.width--,q.height--);u.resolve(r);return u}.bind(this)},_getFormat:function(g){g=new Uint8Array(g,0,10);var e="";if(255===g[0]&&
216===g[1])e="JPEG";else if(137===g[0]&&80===g[1]&&78===g[2]&&71===g[3])e="PNG";else if(67===g[0]&&110===g[1]&&116===g[2]&&90===g[3]&&73===g[4]&&109===g[5]&&97===g[6]&&103===g[7]&&101===g[8]&&32===g[9])e="LERC";else if(76===g[0]&&101===g[1]&&114===g[2]&&99===g[3]&&50===g[4]&&32===g[5])e="LERC2";else if(-1<String.fromCharCode.apply(null,g).toLowerCase().indexOf("error"))e="ERROR";else if(73===g[0]&&73===g[1]&&42===g[2]&&0===g[3]||77===g[0]&&77===g[1]&&0===g[2]&&42===g[3])e="TIFF";return e},_validateDecodeParams:function(g){if(!g.height||
Math.floor(g.height)!==g.height)throw"Height not provided.";if(!g.width||Math.floor(g.width)!==g.width)throw"Width not provided.";},_decodeJpeg:function(g,e){if(!c)throw"The jpeg decoder module is not loaded.";this._validateDecodeParams(e);var k=(new c).decode(g);if(!this._verifyResult(k,e))throw"The decoded image dimensions are incorrect.";k=new m({width:k.width,height:k.height,pixels:k.pixels,pixelType:"U8",mask:k.mask,statistics:null});k.calculateStatistics();return k},_decodePng:function(g,e){if(!l)throw"The png decoder module is not loaded.";
this._validateDecodeParams(e);var k=new Uint8Array(g),w=new l(k);k=new Uint8Array(e.width*e.height*4);w.copyToImageData(k,w.decodePixels());var q=w=0;q=new Uint8Array(e.width*e.height);for(w=0;w<e.width*e.height;w++)q[w]=k[4*w+3];var u=new m({width:e.width,height:e.height,pixels:[],pixelType:"U8",mask:q,statistics:[]});for(w=0;3>w;w++){var r=new Uint8Array(e.width*e.height);for(q=0;q<e.width*e.height;q++)r[q]=k[4*q+w];u.addData({pixels:r})}u.calculateStatistics();return u},_decodeBsq:function(g,e){if(!h)throw"The bsq decoder module is not loaded.";
this._validateDecodeParams(e);var k=e.noDataValue;e.pixelType=this._getpixelTypeAndNoData(e.pixelType);k=h.decodeBSQ(g,{bandCount:e.planes,width:e.width,height:e.height,pixelType:e.pixelType,noDataValue:k});k=new m({width:e.width,height:e.height,pixels:k.pixels,pixelType:e.pixelType,mask:k.maskData,statistics:null});k.calculateStatistics();return k},_decodeBip:function(g,e){this._validateDecodeParams(e);var k=e.noDataValue;e.pixelType=this._getpixelTypeAndNoData(e.pixelType);k=h.decodeBIP(g,{bandCount:e.planes,
width:e.width,height:e.height,pixelType:e.pixelType,noDataValue:k});k=new m({width:e.width,height:e.height,pixels:k.pixels,pixelType:e.pixelType,mask:k.maskData,statistics:null});k.calculateStatistics();return k},_decodeTiff:function(g,e){this._validateDecodeParams(e);e.pixelType=this._getpixelTypeAndNoData(e.pixelType);var k=n.decode(g);k=new m({width:k.width,height:k.height,pixels:k.pixels,pixelType:k.pixelType,mask:k.maskData,statistics:null});k.calculateStatistics();return k},_decodeLerc:function(g,
e){if(!this._isPlatformLittleEndian)throw"lerc decoder is not supported on big endian platform";this._validateDecodeParams(e);var k=e.noDataValue;e.pixelType=this._getpixelTypeAndNoData(e.pixelType);for(var w=0,q,u=0,r,v=g.byteLength-10;u<v;){var z=f.decode(g,{inputOffset:u,encodedMaskData:q,returnMask:0===w?!0:!1,returnEncodedMask:0===w?!0:!1,returnFileInfo:!0,pixelType:e.pixelType,noDataValue:k});u=z.fileInfo.eofOffset;0===w&&(q=z.encodedMaskData,r=new m({width:e.width,height:e.height,pixels:[],
pixelType:e.pixelType,mask:z.maskData,statistics:[]}));w++;if(!this._verifyResult(z,e))throw"The decoded image dimensions are incorrect";r.addData({pixels:z.pixelData,statistics:{minValue:z.minValue,maxValue:z.maxValue,noDataValue:z.noDataValue}})}return r},_decodeLerc2:function(g,e){if(!this._isPlatformLittleEndian)throw"lerc2 decoder is not supported on big endian platform";this._validateDecodeParams(e);e.pixelType=this._getpixelTypeAndNoData(e.pixelType);for(var k=0,w,q,u,r=0,v,z=g.byteLength-
10,B=[],A,y=0;r<z;){q=d.decode(g,{inputOffset:r,maskData:w,returnFileInfo:!0});r=q.fileInfo.eofOffset;w=q.maskData;0===k&&(u=q.fileInfo.numValidPixel,v=new m({width:e.width,height:e.height,pixels:[],dimCount:q.dimCount||1,pixelType:q.fileInfo.pixelType,mask:w,statistics:[]}));q.fileInfo.mask&&0<q.fileInfo.mask.numBytes&&y++;w&&B.push(w);k++;if(!this._verifyResult(q,e))throw"The decoded image dimensions are incorrect";v.addData({pixels:q.pixelData,statistics:{minValue:q.minValue,maxValue:q.maxValue,
noDataValue:q.noDataValue,dimStats:q.dimStats}})}if(1<y){q=v.width*v.height;v.bandMasks=B;w=new Uint8Array(q);w.set(B[0]);for(u=1;u<B.length;u++)for(A=B[u],k=0;k<q;k++)w[k]&=A[k];for(k=u=0;k<q;k++)u+=A[k];v.mask=w}v.validPixelCount=u;return v},_decodeLercWasm:function(g,e){if(!this._isPlatformLittleEndian)throw"lerc decoder is not supported on big endian platform";this._validateDecodeParams(e);var k=new b;a.load().then(function(){var w=a.decode(g,{inputOffset:0,noDataValue:e.noDataValue,pixelType:e.pixelType&&
e.pixelType.toUpperCase()});w=new m({width:w.width,height:w.height,pixelType:w.pixelType.toUpperCase(),pixels:w.pixels,mask:w.mask,statistics:w.statistics,validPixelCount:w.validPixelCount});e.isPoint&&e.width&&(this._interpolatePointGrid(w),e.width--,e.height--);k.resolve(w)}.bind(this),function(){k.reject("Cannot load lerc wasm decoder")});return k},_interpolatePointGrid:function(g,e){var k=g.pixels;if(k&&0!==k.length){var w=k.length,q=g.width,u=g.mask,r=q-1,v=g.height-1,z=[],B,A,y;if(0===(null==
e?1:e)){for(B=0;B<w;B++){var D=k[B];var G=new D.constructor(r*v);for(A=0;A<v;A++){var E=A*q;for(y=0;y<r;y++)G[A*r+y]=D[E+y]}z.push(G)}if(u){var F=new Uint8Array(r*v);for(A=0;A<v;A++)for(E=A*q,y=0;y<r;y++)F[A*r+y]=u[E+y]}}else{for(B=0;B<w;B++){D=k[B];G=new D.constructor(r*v);for(A=0;A<v;A++)for(E=A*q,y=0;y<r;y++)G[A*r+y]=(D[E+y]+D[E+y+1]+D[E+q+y]+D[E+q+y+1])/4;z.push(G)}if(u)for(F=new Uint8Array(r*v),A=0;A<v;A++)for(E=A*q,y=0;y<r;y++)F[A*r+y]=Math.min.apply(null,[u[E+y],u[E+y+1],u[E+q+y],u[E+q+y+1]])}g.width=
r;g.height=v;g.mask=F;g.pixels=z;return g}},_getpixelTypeAndNoData:function(g){return"U1"===g||"U2"===g||"U4"===g||"U8"===g?"U8":g},_verifyResult:function(g,e){return g.height!==e.height||g.width!==e.width?!1:!0}}})},"esri/layers/rasterFormats/Lerc":function(){var t=this&&this.__createBinding||(Object.create?function(m,f,d,a){void 0===a&&(a=d);Object.defineProperty(m,a,{enumerable:!0,get:function(){return f[d]}})}:function(m,f,d,a){void 0===a&&(a=d);m[a]=f[d]}),p=this&&this.__setModuleDefault||(Object.create?
function(m,f){Object.defineProperty(m,"default",{enumerable:!0,value:f})}:function(m,f){m["default"]=f}),x=this&&this.__importStar||function(m){if(m&&m.__esModule)return m;var f={};if(null!=m)for(var d in m)"default"!==d&&Object.prototype.hasOwnProperty.call(m,d)&&t(f,m,d);p(f,m);return f},b=this&&this.__read||function(m,f){var d="function"===typeof Symbol&&m[Symbol.iterator];if(!d)return m;var a=d.call(m),c,l=[];try{for(;(void 0===f||0<f--)&&!(c=a.next()).done;)l.push(c.value)}catch(n){var h={error:n}}finally{try{c&&
!c.done&&(d=a["return"])&&d.call(a)}finally{if(h)throw h.error;}}return l};define(["require","exports"],function(m,f){function d(n){var g=n._malloc,e=n._free,k=n._lerc_getBlobInfo,w=n._lerc_getDataRanges,q=n._lerc_decode_4D,u,r=Object.values(n.asm).find(function(z){return z&&"buffer"in z&&z.buffer===n.HEAPU8.buffer}),v=function(z){z=z.map(function(D){return(D>>3<<3)+16});var B=z.reduce(function(D,G){return D+G}),A=g(B);u=new Uint8Array(r.buffer);B=z[0];z[0]=A;for(A=1;A<z.length;A++){var y=z[A];z[A]=
z[A-1]+B;B=y}return z};h.getBlobInfo=function(z){var B,A=new Uint8Array(48),y=new Uint8Array(24),D=b(v([z.length,A.length,y.length]),3),G=D[0],E=D[1];D=D[2];u.set(z,G);u.set(A,E);u.set(y,D);if(B=k(G,z.length,E,D,12,3))throw e(G),"lerc-getBlobInfo: error code is ".concat(B);u=new Uint8Array(r.buffer);A.set(u.slice(E,E+A.length));y.set(u.slice(D,D+y.length));A=new Uint32Array(A.buffer);D=new Float64Array(y.buffer);E=b(A,11);y=E[2];A=E[5];var F=E[10];E={version:E[0],dimCount:y,width:E[3],height:E[4],
validPixelCount:E[6],bandCount:A,blobSize:E[7],maskCount:E[8],dataType:E[1],minValue:D[0],maxValue:D[1],maxZerror:D[2],statistics:[],bandCountWithNoData:F};if(F)return E;if(1===y&&1===A)return e(G),E.statistics.push({minValue:D[0],maxValue:D[1]}),E;var I=y*A*8,M=new Uint8Array(I),P=new Uint8Array(I);D=G;F=0;var W=!1;if(u.byteLength<G+2*I){e(G);W=!0;B=b(v([z.length,I,I]),3);D=B[0];F=B[1];var H=B[2];u.set(z,D)}else B=b(v([I,I]),2),F=B[0],H=B[1];u.set(M,F);u.set(P,H);if(B=w(G,z.length,y,A,F,H))throw e(D),
W||e(F),"lerc-getDataRanges: error code is ".concat(B);u=new Uint8Array(r.buffer);M.set(u.slice(F,F+I));P.set(u.slice(H,H+I));z=new Float64Array(M.buffer);G=new Float64Array(P.buffer);B=E.statistics;for(P=0;P<A;P++)if(1<y){I=z.slice(P*y,(P+1)*y);M=G.slice(P*y,(P+1)*y);H=Math.min.apply(null,I);var O=Math.max.apply(null,M);B.push({minValue:H,maxValue:O,dimStats:{minValues:I,maxValues:M}})}else B.push({minValue:z[P],maxValue:G[P]});e(D);W||e(F);return E};h.decode=function(z,B){var A=B.maskCount,y=B.dimCount,
D=B.bandCount,G=B.width,E=B.height,F=B.dataType,I=B.bandCountWithNoData,M=a[F],P=G*E,W=new Uint8Array(P*D),H=P*y*D*M.size;M=new Uint8Array(H);var O=new Uint8Array(D),K=8*D,R=new Uint8Array(K),da=b(v([z.length,W.length,M.length,O.length,R.length]),5),U=da[0],Z=da[1],L=da[2],T=da[3];da=da[4];u.set(z,U);u.set(W,Z);u.set(M,L);u.set(O,T);u.set(R,da);if(A=q(U,z.length,A,Z,y,G,E,D,F,L,T,da))throw e(U),"lerc-decode: error code is ".concat(A);u=new Uint8Array(r.buffer);M.set(u.slice(L,L+H));W.set(u.slice(Z,
Z+P));P=null;if(I)for(O.set(u.slice(T,T+D)),R.set(u.slice(da,da+K)),P=[],D=0;D<O.length;D++)P.push(O[D]?R[D]:null);e(U);return{data:M,maskData:W,noDataValues:P}}}Object.defineProperty(f,"__esModule",{value:!0});f.getBlobInfo=f.decode=f.isLoaded=f.load=void 0;var a=[{pixelType:"S8",size:1,ctor:Int8Array,range:[-128,128]},{pixelType:"U8",size:1,ctor:Uint8Array,range:[0,255]},{pixelType:"S16",size:2,ctor:Int16Array,range:[-32768,32767]},{pixelType:"U16",size:2,ctor:Uint16Array,range:[0,65536]},{pixelType:"S32",
size:4,ctor:Int32Array,range:[-2147483648,2147483647]},{pixelType:"U32",size:4,ctor:Uint32Array,range:[0,4294967296]},{pixelType:"F32",size:4,ctor:Float32Array,range:[-3.4027999387901484E38,3.4027999387901484E38]},{pixelType:"F64",size:8,ctor:Float64Array,range:[-1.7976931348623157E308,1.7976931348623157E308]}],c=null,l=!1;f.load=function(){return c?c:c=(new Promise(function(n,g){m(["./lerc-wasm"],n,g)})).then(x).then(function(n){n=n["default"];return n({locateFile:function(g){return m.toUrl("./"+
g)}})}).then(function(n){d(n);l=!0})};f.isLoaded=function(){return l};var h={getBlobInfo:null,decode:null};f.decode=function(n,g){var e;void 0===g&&(g={});var k=null!==(e=g.inputOffset)&&void 0!==e?e:0;k=n instanceof Uint8Array?n.subarray(k):new Uint8Array(n,k);e=h.getBlobInfo(k);var w=h.decode(k,e),q=w.maskData;k=e.width;var u=e.height,r=e.bandCount,v=e.dimCount,z=e.maskCount,B=e.statistics,A=a[e.dataType],y=new A.ctor(w.data.buffer);w=[];for(var D=[],G=k*u,E=G*v,F=0;F<r;F++){var I=y.subarray(F*
E,(F+1)*E);if(g.returnPixelInterleavedDims)w.push(I);else{var M=G,P=v;if(!(2>P)){for(var W=new A.ctor(M*P),H=0,O=0;H<M;H++)for(var K=0,R=H;K<P;K++,R+=M)W[R]=I[O++];I=W}w.push(I)}D.push(q.subarray(F*E,(F+1)*E))}q=0===z?null:1===z?D[0]:new Uint8Array(G);if(1<z)for(q.set(D[0]),F=1;F<D.length;F++)for(y=D[F],E=0;E<G;E++)q[E]&=y[E];F=g.noDataValue;F=null!=F&&A.range[0]<=F&&A.range[1]>=F;if(0<z&&F)for(M=g.noDataValue,F=0;F<r;F++)for(I=w[F],y=D[F]||q,E=0;E<G;E++)0===y[E]&&(I[E]=M);return{width:k,height:u,
bandCount:r,pixelType:g.pixelType&&0===e.version?g.pixelType:A.pixelType,dimCount:v,statistics:B,pixels:w,mask:q,bandMasks:z===r&&1<r?D:null}};f.getBlobInfo=function(n,g){var e,k;void 0===g&&(g={});var w=n instanceof Uint8Array?n.subarray(null!==(e=g.inputOffset)&&void 0!==e?e:0):new Uint8Array(n,null!==(k=g.inputOffset)&&void 0!==k?k:0);return h.getBlobInfo(w)}})},"esri/layers/rasterFormats/JpgPlus":function(){define(["dojo/_base/declare","./Zlib","./Jpg"],function(t,p,x){return t(null,{constructor:function(){},
decode:function(b){var m=new Uint8Array(b);b=new x;b.parse(m);var f=b.numComponents,d=b.getData(b.width,b.height,!0),a=b.width*b.height,c=b.eof,l=0,h=0,n=0;if(c<m.length-1){h=(new p(m.subarray(c))).getBytes();var g=new Uint8Array(a);for(l=m=0;l<h.length;l++)for(n=7;0<=n;n--)g[m++]=h[l]>>n&1}m=[];if(1===f)m=[d,d,d];else{for(l=0;3>l;l++)f=new Uint8Array(a),m.push(f);for(h=n=0;h<a;h++)for(l=0;3>l;l++)m[l][h]=d[n++]}return{width:b.width,height:b.height,pixels:m,mask:g}}})})},"esri/layers/rasterFormats/Zlib":function(){define([],
function(){var t=function(){function p(){this.bufferLength=this.pos=0;this.eof=!1;this.buffer=null}p.prototype={ensureBuffer:function(x){var b=this.buffer,m=b?b.byteLength:0;if(x<m)return b;for(var f=512;f<x;)f<<=1;x=new Uint8Array(f);for(f=0;f<m;++f)x[f]=b[f];return this.buffer=x},getByte:function(){for(var x=this.pos;this.bufferLength<=x;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},getBytes:function(x){var b=this.pos;if(x){this.ensureBuffer(b+x);for(x=b+x;!this.eof&&
this.bufferLength<x;)this.readBlock();var m=this.bufferLength;x>m&&(x=m)}else{for(;!this.eof;)this.readBlock();x=this.bufferLength}this.pos=x;return this.buffer.subarray(b,x)},lookChar:function(){for(var x=this.pos;this.bufferLength<=x;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var x=this.pos;this.bufferLength<=x;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(x,
b,m){for(var f=x+b;this.bufferLength<=f&&!this.eof;)this.readBlock();return new Stream(this.buffer,x,b,m)},skip:function(x){x||(x=1);this.pos+=x},reset:function(){this.pos=0}};return p}();return function(){function p(c){throw Error(c);}function x(c){var l=0,h=c[l++],n=c[l++];-1!=h&&-1!=n||p("Invalid header in flate stream");8!=(h&15)&&p("Unknown compression method in flate stream");0!=((h<<8)+n)%31&&p("Bad FCHECK in flate stream");n&32&&p("FDICT bit set in flate stream");this.bytes=c;this.bytesPos=
l;this.codeBuf=this.codeSize=0;t.call(this)}if(!self||!self.Uint32Array)return null;var b=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),m=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),f=new Uint32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,
724993,727041,794625,798721,868353,876545]),d=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59E4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,
590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,
590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,
590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,
590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,
590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,
590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,
590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],a=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];x.prototype=Object.create(t.prototype);x.prototype.getBits=function(c){for(var l=this.codeSize,h=this.codeBuf,n=this.bytes,g=this.bytesPos,
e;l<c;)"undefined"==typeof(e=n[g++])&&p("Bad encoding in flate stream"),h|=e<<l,l+=8;this.codeBuf=h>>c;this.codeSize=l-=c;this.bytesPos=g;return h&(1<<c)-1};x.prototype.getCode=function(c){var l=c[0],h=c[1];c=this.codeSize;for(var n=this.codeBuf,g=this.bytes,e=this.bytesPos;c<h;){var k;"undefined"==typeof(k=g[e++])&&p("Bad encoding in flate stream");n|=k<<c;c+=8}h=l[n&(1<<h)-1];l=h>>16;h&=65535;(0==c||c<l||0==l)&&p("Bad encoding in flate stream");this.codeBuf=n>>l;this.codeSize=c-l;this.bytesPos=
e;return h};x.prototype.generateHuffmanTable=function(c){for(var l=c.length,h=0,n=0;n<l;++n)c[n]>h&&(h=c[n]);for(var g=1<<h,e=new Uint32Array(g),k=1,w=0,q=2;k<=h;++k,w<<=1,q<<=1)for(var u=0;u<l;++u)if(c[u]==k){var r=0,v=w;for(n=0;n<k;++n)r=r<<1|v&1,v>>=1;for(n=r;n<g;n+=q)e[n]=k<<16|u;++w}return[e,h]};x.prototype.readBlock=function(){function c(r,v,z,B,A){for(r=r.getBits(z)+B;0<r--;)v[w++]=A}var l=this.getBits(3);l&1&&(this.eof=!0);l>>=1;if(0==l){var h=this.bytes,n=this.bytesPos,g;"undefined"==typeof(g=
h[n++])&&p("Bad block header in flate stream");var e=g;"undefined"==typeof(g=h[n++])&&p("Bad block header in flate stream");e|=g<<8;"undefined"==typeof(g=h[n++])&&p("Bad block header in flate stream");l=g;"undefined"==typeof(g=h[n++])&&p("Bad block header in flate stream");(l|g<<8)!=(~e&65535)&&p("Bad uncompressed block length in flate stream");this.codeSize=this.codeBuf=0;g=this.bufferLength;l=this.ensureBuffer(g+e);this.bufferLength=e=g+e;for(var k=g;k<e;++k){if("undefined"==typeof(g=h[n++])){this.eof=
!0;break}l[k]=g}this.bytesPos=n}else{if(1==l)n=d,g=a;else if(2==l){l=this.getBits(5)+257;g=this.getBits(5)+1;h=this.getBits(4)+4;n=Array(b.length);for(var w=0;w<h;)n[b[w++]]=this.getBits(3);n=this.generateHuffmanTable(n);w=h=0;g=l+g;for(e=Array(g);w<g;)k=this.getCode(n),16==k?c(this,e,2,3,h):17==k?c(this,e,3,3,h=0):18==k?c(this,e,7,11,h=0):e[w++]=h=k;n=this.generateHuffmanTable(e.slice(0,l));g=this.generateHuffmanTable(e.slice(l,g))}else p("Unknown block type in flate stream");e=(l=this.buffer)?l.length:
0;for(k=this.bufferLength;;){var q=this.getCode(n);if(256>q)k+1>=e&&(l=this.ensureBuffer(k+1),e=l.length),l[k++]=q;else{if(256==q){this.bufferLength=k;break}q-=257;q=m[q];var u=q>>16;0<u&&(u=this.getBits(u));h=(q&65535)+u;q=this.getCode(g);q=f[q];u=q>>16;0<u&&(u=this.getBits(u));q=(q&65535)+u;k+h>=e&&(l=this.ensureBuffer(k+h),e=l.length);for(u=0;u<h;++u,++k)l[k]=l[k-q]}}}};return x}()})},"esri/layers/rasterFormats/Jpg":function(){define([],function(){var t=function(){function p(x){this.message="JPEG error: "+
x}p.prototype=Error();p.prototype.name="JpegError";return p.constructor=p}();return function(){function p(){this.decodeTransform=null;this.colorTransform=-1}function x(a,c){for(var l=0,h=[],n,g,e=16;0<e&&!a[e-1];)e--;h.push({children:[],index:0});var k=h[0],w;for(n=0;n<e;n++){for(g=0;g<a[n];g++){k=h.pop();for(k.children[k.index]=c[l];0<k.index;)k=h.pop();k.index++;for(h.push(k);h.length<=n;)h.push(w={children:[],index:0}),k.children[k.index]=w.children,k=w;l++}n+1<e&&(h.push(w={children:[],index:0}),
k.children[k.index]=w.children,k=w)}return h[0].children}function b(a,c,l,h,n,g,e,k,w){function q(){if(0<I)return I--,F>>I&1;F=a[c++];if(255===F){var ca=a[c++];if(ca)throw new t("unexpected marker "+(F<<8|ca).toString(16));}I=7;return F>>>7}function u(ca){for(;;){ca=ca[q()];if("number"===typeof ca)return ca;if("object"!==typeof ca)throw new t("invalid huffman sequence");}}function r(ca){for(var Q=0;0<ca;)Q=Q<<1|q(),ca--;return Q}function v(ca){if(1===ca)return 1===q()?1:-1;var Q=r(ca);return Q>=1<<
ca-1?Q:Q+(-1<<ca)+1}function z(ca,Q){var X=u(ca.huffmanTableDC);X=0===X?0:v(X);ca.blockData[Q]=ca.pred+=X;for(X=1;64>X;){var ha=u(ca.huffmanTableAC),ja=ha&15;ha>>=4;if(0===ja){if(15>ha)break;X+=16}else X+=ha,ca.blockData[Q+d[X]]=v(ja),X++}}function B(ca,Q){var X=u(ca.huffmanTableDC);X=0===X?0:v(X)<<w;ca.blockData[Q]=ca.pred+=X}function A(ca,Q){ca.blockData[Q]|=q()<<w}function y(ca,Q){if(0<M)M--;else for(var X=g;X<=e;){var ha=u(ca.huffmanTableAC),ja=ha&15;ha>>=4;if(0===ja){if(15>ha){M=r(ha)+(1<<ha)-
1;break}X+=16}else X+=ha,ca.blockData[Q+d[X]]=v(ja)*(1<<w),X++}}function D(ca,Q){for(var X=g,ha=0,ja;X<=e;){ja=d[X];switch(P){case 0:ha=u(ca.huffmanTableAC);ja=ha&15;ha>>=4;if(0===ja)15>ha?(M=r(ha)+(1<<ha),P=4):(ha=16,P=1);else{if(1!==ja)throw new t("invalid ACn encoding");W=v(ja);P=ha?2:3}continue;case 1:case 2:ca.blockData[Q+ja]?ca.blockData[Q+ja]+=q()<<w:(ha--,0===ha&&(P=2===P?3:0));break;case 3:ca.blockData[Q+ja]?ca.blockData[Q+ja]+=q()<<w:(ca.blockData[Q+ja]=W<<w,P=0);break;case 4:ca.blockData[Q+
ja]&&(ca.blockData[Q+ja]+=q()<<w)}X++}4===P&&(M--,0===M&&(P=0))}var G=l.mcusPerLine,E=c,F=0,I=0,M=0,P=0,W,H=h.length,O,K,R,da;k=l.progressive?0===g?0===k?B:A:0===k?y:D:z;var U=0;l=1===H?h[0].blocksPerLine*h[0].blocksPerColumn:G*l.mcusPerColumn;for(var Z,L;U<l;){var T=n?Math.min(l-U,n):l;for(O=0;O<H;O++)h[O].pred=0;M=0;if(1===H){var Y=h[0];for(da=0;da<T;da++)k(Y,64*((Y.blocksPerLine+1)*(U/Y.blocksPerLine|0)+U%Y.blocksPerLine)),U++}else for(da=0;da<T;da++){for(O=0;O<H;O++)for(Y=h[O],Z=Y.h,L=Y.v,K=0;K<
L;K++)for(R=0;R<Z;R++)k(Y,64*((Y.blocksPerLine+1)*((U/G|0)*Y.v+K)+(U%G*Y.h+R)));U++}I=0;(Y=f(a,c))&&Y.invalid&&(c=Y.offset);Y=Y&&Y.marker;if(!Y||65280>=Y)throw new t("marker was not found");if(65488<=Y&&65495>=Y)c+=2;else break}(Y=f(a,c))&&Y.invalid&&(c=Y.offset);return c-E}function m(a,c){for(var l=c.blocksPerLine,h=c.blocksPerColumn,n=new Int16Array(64),g=0;g<h;g++)for(var e=0;e<l;e++){var k=void 0,w=void 0,q=void 0,u=void 0,r=void 0,v=void 0,z=void 0,B=void 0,A=r=v=u=w=k=void 0,y=void 0,D=void 0,
G=void 0,E=64*((c.blocksPerLine+1)*g+e),F=n,I=c.quantizationTable,M=c.blockData;if(!I)throw new t("missing required Quantization Table.");for(var P=0;64>P;P+=8)k=M[E+P],B=M[E+P+1],z=M[E+P+2],v=M[E+P+3],r=M[E+P+4],u=M[E+P+5],q=M[E+P+6],w=M[E+P+7],k*=I[P],0===(B|z|v|r|u|q|w)?(k=5793*k+512>>10,F[P]=k,F[P+1]=k,F[P+2]=k,F[P+3]=k,F[P+4]=k,F[P+5]=k,F[P+6]=k,F[P+7]=k):(B*=I[P+1],z*=I[P+2],v*=I[P+3],r*=I[P+4],u*=I[P+5],q*=I[P+6],w*=I[P+7],G=5793*k+128>>8,D=5793*r+128>>8,y=z,A=q,r=2896*(B-w)+128>>8,w=2896*
(B+w)+128>>8,v<<=4,u<<=4,G=G+D+1>>1,D=G-D,k=3784*y+1567*A+128>>8,y=1567*y-3784*A+128>>8,A=k,r=r+u+1>>1,u=r-u,w=w+v+1>>1,v=w-v,G=G+A+1>>1,A=G-A,D=D+y+1>>1,y=D-y,k=2276*r+3406*w+2048>>12,r=3406*r-2276*w+2048>>12,w=k,k=799*v+4017*u+2048>>12,v=4017*v-799*u+2048>>12,u=k,F[P]=G+w,F[P+7]=G-w,F[P+1]=D+u,F[P+6]=D-u,F[P+2]=y+v,F[P+5]=y-v,F[P+3]=A+r,F[P+4]=A-r);for(I=0;8>I;++I)k=F[I],B=F[I+8],z=F[I+16],v=F[I+24],r=F[I+32],u=F[I+40],q=F[I+48],w=F[I+56],0===(B|z|v|r|u|q|w)?(k=5793*k+8192>>14,k=-2040>k?0:2024<=
k?255:k+2056>>4,M[E+I]=k,M[E+I+8]=k,M[E+I+16]=k,M[E+I+24]=k,M[E+I+32]=k,M[E+I+40]=k,M[E+I+48]=k,M[E+I+56]=k):(G=5793*k+2048>>12,D=5793*r+2048>>12,y=z,A=q,r=2896*(B-w)+2048>>12,w=2896*(B+w)+2048>>12,G=(G+D+1>>1)+4112,D=G-D,k=3784*y+1567*A+2048>>12,y=1567*y-3784*A+2048>>12,A=k,r=r+u+1>>1,u=r-u,w=w+v+1>>1,v=w-v,G=G+A+1>>1,A=G-A,D=D+y+1>>1,y=D-y,k=2276*r+3406*w+2048>>12,r=3406*r-2276*w+2048>>12,w=k,k=799*v+4017*u+2048>>12,v=4017*v-799*u+2048>>12,u=k,k=G+w,w=G-w,B=D+u,q=D-u,z=y+v,u=y-v,v=A+r,r=A-r,k=16>
k?0:4080<=k?255:k>>4,B=16>B?0:4080<=B?255:B>>4,z=16>z?0:4080<=z?255:z>>4,v=16>v?0:4080<=v?255:v>>4,r=16>r?0:4080<=r?255:r>>4,u=16>u?0:4080<=u?255:u>>4,q=16>q?0:4080<=q?255:q>>4,w=16>w?0:4080<=w?255:w>>4,M[E+I]=k,M[E+I+8]=B,M[E+I+16]=z,M[E+I+24]=v,M[E+I+32]=r,M[E+I+40]=u,M[E+I+48]=q,M[E+I+56]=w)}return c.blockData}function f(a,c,l){var h=a.length-1;l=l<c?l:c;if(c>=h)return null;var n=a[c]<<8|a[c+1];if(65472<=n&&65534>=n)return{invalid:null,marker:n,offset:c};for(c=a[l]<<8|a[l+1];!(65472<=c&&65534>=
c);){if(++l>=h)return null;c=a[l]<<8|a[l+1]}return{invalid:n.toString(16),marker:c,offset:l}}if(!self||!self.Uint8ClampedArray)return null;var d=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]);p.prototype={parse:function(a){function c(){var F=a[n]<<8|a[n+1];n+=2;return F}function l(){var F=c();F=n+F-2;var I=f(a,F,n);I&&I.invalid&&(F=I.offset);F=a.subarray(n,
F);n+=F.length;return F}function h(F){for(var I=Math.ceil(F.samplesPerLine/8/F.maxH),M=Math.ceil(F.scanLines/8/F.maxV),P=0;P<F.components.length;P++){E=F.components[P];var W=Math.ceil(Math.ceil(F.samplesPerLine/8)*E.h/F.maxH),H=Math.ceil(Math.ceil(F.scanLines/8)*E.v/F.maxV);E.blockData=new Int16Array(64*M*E.v*(I*E.h+1));E.blocksPerLine=W;E.blocksPerColumn=H}F.mcusPerLine=I;F.mcusPerColumn=M}var n=0,g=null,e=null,k=[],w=[],q=[],u=c();if(65496!==u)throw new t("SOI not found");for(u=c();65497!==u;){switch(u){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var r=
l();65504===u&&74===r[0]&&70===r[1]&&73===r[2]&&70===r[3]&&0===r[4]&&(g={version:{major:r[5],minor:r[6]},densityUnits:r[7],xDensity:r[8]<<8|r[9],yDensity:r[10]<<8|r[11],thumbWidth:r[12],thumbHeight:r[13],thumbData:r.subarray(14,14+3*r[12]*r[13])});65518===u&&65===r[0]&&100===r[1]&&111===r[2]&&98===r[3]&&101===r[4]&&(e={version:r[5]<<8|r[6],flags0:r[7]<<8|r[8],flags1:r[9]<<8|r[10],transformCode:r[11]});break;case 65499:u=c()+n-2;for(var v;n<u;){var z=a[n++],B=new Uint16Array(64);if(0===z>>4)for(r=
0;64>r;r++)v=d[r],B[v]=a[n++];else if(1===z>>4)for(r=0;64>r;r++)v=d[r],B[v]=c();else throw new t("DQT - invalid table spec");k[z&15]=B}break;case 65472:case 65473:case 65474:if(A)throw new t("Only single frame JPEGs supported");c();var A={};A.extended=65473===u;A.progressive=65474===u;A.precision=a[n++];A.scanLines=c();A.samplesPerLine=c();A.components=[];A.componentIds={};r=a[n++];for(u=B=z=0;u<r;u++){v=a[n];var y=a[n+1]>>4;var D=a[n+1]&15;z<y&&(z=y);B<D&&(B=D);y=A.components.push({h:y,v:D,quantizationId:a[n+
2],quantizationTable:null});A.componentIds[v]=y-1;n+=3}A.maxH=z;A.maxV=B;h(A);break;case 65476:v=c();for(u=2;u<v;){z=a[n++];B=new Uint8Array(16);for(r=y=0;16>r;r++,n++)y+=B[r]=a[n];D=new Uint8Array(y);for(r=0;r<y;r++,n++)D[r]=a[n];u+=17+y;(0===z>>4?q:w)[z&15]=x(B,D)}break;case 65501:c();var G=c();break;case 65498:c();v=a[n++];r=[];for(u=0;u<v;u++){z=A.componentIds[a[n++]];var E=A.components[z];z=a[n++];E.huffmanTableDC=q[z>>4];E.huffmanTableAC=w[z&15];r.push(E)}u=a[n++];v=a[n++];z=a[n++];u=b(a,n,
A,r,G,u,v,z>>4,z&15);n+=u;break;case 65535:255!==a[n]&&n--;break;default:if(255===a[n-3]&&192<=a[n-2]&&254>=a[n-2])n-=3;else throw new t("unknown marker "+u.toString(16));}u=c()}this.width=A.samplesPerLine;this.height=A.scanLines;this.jfif=g;this.eof=n;this.adobe=e;this.components=[];for(u=0;u<A.components.length;u++){E=A.components[u];if(g=k[E.quantizationId])E.quantizationTable=g;this.components.push({output:m(A,E),scaleX:E.h/A.maxH,scaleY:E.v/A.maxV,blocksPerLine:E.blocksPerLine,blocksPerColumn:E.blocksPerColumn})}this.numComponents=
this.components.length},_getLinearizedBlockData:function(a,c){var l=this.width/a,h=this.height/c,n,g,e=0,k=this.components.length,w=a*c*k,q=new Uint8ClampedArray(w),u=new Uint32Array(a);for(g=0;g<k;g++){var r=this.components[g];var v=r.scaleX*l;var z=r.scaleY*h;e=g;var B=r.output;var A=r.blocksPerLine+1<<3;for(n=0;n<a;n++)r=0|n*v,u[n]=(r&4294967288)<<3|r&7;for(v=0;v<c;v++)for(r=0|v*z,r=A*(r&4294967288)|(r&7)<<3,n=0;n<a;n++)q[e]=B[r+u[n]],e+=k}if(h=this.decodeTransform)for(g=0;g<w;)for(l=r=0;r<k;r++,
g++,l+=2)q[g]=(q[g]*h[l]>>8)+h[l+1];return q},_isColorConversionNeeded:function(){return this.adobe?!!this.adobe.transformCode:3===this.numComponents?0===this.colorTransform?!1:!0:1===this.colorTransform?!0:!1},_convertYccToRgb:function(a){for(var c,l,h,n=0,g=a.length;n<g;n+=3)c=a[n],l=a[n+1],h=a[n+2],a[n]=c-179.456+1.402*h,a[n+1]=c+135.459-.344*l-.714*h,a[n+2]=c-226.816+1.772*l;return a},_convertYcckToRgb:function(a){for(var c,l,h,n,g=0,e=0,k=a.length;e<k;e+=4)c=a[e],l=a[e+1],h=a[e+2],n=a[e+3],a[g++]=
-122.67195406894+l*(-6.60635669420364E-5*l+4.37130475926232E-4*h-5.4080610064599E-5*c+4.8449797120281E-4*n-.154362151871126)+h*(-9.57964378445773E-4*h+8.17076911346625E-4*c-.00477271405408747*n+1.53380253221734)+c*(9.61250184130688E-4*c-.00266257332283933*n+.48357088451265)+n*(-3.36197177618394E-4*n+.484791561490776),a[g++]=107.268039397724+l*(2.19927104525741E-5*l-6.40992018297945E-4*h+6.59397001245577E-4*c+4.26105652938837E-4*n-.176491792462875)+h*(-7.78269941513683E-4*h+.00130872261408275*c+7.70482631801132E-4*
n-.151051492775562)+c*(.00126935368114843*c-.00265090189010898*n+.25802910206845)+n*(-3.18913117588328E-4*n-.213742400323665),a[g++]=-20.810012546947+l*(-5.70115196973677E-4*l-2.63409051004589E-5*h+.0020741088115012*c-.00288260236853442*n+.814272968359295)+h*(-1.53496057440975E-5*h-1.32689043961446E-4*c+5.60833691242812E-4*n-.195152027534049)+c*(.00174418132927582*c-.00255243321439347*n+.116935020465145)+n*(-3.43531996510555E-4*n+.24165260232407);return a},_convertYcckToCmyk:function(a){for(var c,
l,h,n=0,g=a.length;n<g;n+=4)c=a[n],l=a[n+1],h=a[n+2],a[n]=434.456-c-1.402*h,a[n+1]=119.541-c+.344*l+.714*h,a[n+2]=481.816-c-1.772*l;return a},_convertCmykToRgb:function(a){for(var c,l,h,n,g=0,e=1/255,k=0,w=a.length;k<w;k+=4)c=a[k]*e,l=a[k+1]*e,h=a[k+2]*e,n=a[k+3]*e,a[g++]=255+c*(-4.387332384609988*c+54.48615194189176*l+18.82290502165302*h+212.25662451639585*n-285.2331026137004)+l*(1.7149763477362134*l-5.6096736904047315*h-17.873870861415444*n-5.497006427196366)+h*(-2.5217340131683033*h-21.248923337353073*
n+17.5119270841813)-n*(21.86122147463605*n+189.48180835922747),a[g++]=255+c*(8.841041422036149*c+60.118027045597366*l+6.871425592049007*h+31.159100130055922*n-79.2970844816548)+l*(-15.310361306967817*l+17.575251261109482*h+131.35250912493976*n-190.9453302588951)+h*(4.444339102852739*h+9.8632861493405*n-24.86741582555878)-n*(20.737325471181034*n+187.80453709719578),a[g++]=255+c*(.8842522430003296*c+8.078677503112928*l+30.89978309703729*h-.23883238689178934*n-14.183576799673286)+l*(10.49593273432072*
l+63.02378494754052*h+50.606957656360734*n-112.23884253719248)+h*(.03296041114873217*h+115.60384449646641*n-193.58209356861505)-n*(22.33816807309886*n+180.12613974708367);return a},getData:function(a,c,l){if(4<this.numComponents)throw new t("Unsupported color mode");a=this._getLinearizedBlockData(a,c);if(1===this.numComponents&&l){l=a.length;c=new Uint8ClampedArray(3*l);for(var h=0,n=0;n<l;n++){var g=a[n];c[h++]=g;c[h++]=g;c[h++]=g}return c}if(3===this.numComponents&&this._isColorConversionNeeded())return this._convertYccToRgb(a);
if(4===this.numComponents){if(this._isColorConversionNeeded())return l?this._convertYcckToRgb(a):this._convertYcckToCmyk(a);if(l)return this._convertCmykToRgb(a)}return a}};return p}()})},"esri/layers/rasterFormats/Png":function(){define(["./Zlib"],function(t){return function(){function p(b){var m,f;this.data=b;this.pos=8;this.palette=[];this.imgData=[];this.transparency={};this.animation=null;this.text={};for(f=null;;){var d=this.readUInt32();var a=b=void 0;b=[];for(a=0;4>a;++a)b.push(String.fromCharCode(this.data[this.pos++]));
b=b.join("");switch(b){case "IHDR":this.width=this.readUInt32();this.height=this.readUInt32();this.bits=this.data[this.pos++];this.colorType=this.data[this.pos++];this.compressionMethod=this.data[this.pos++];this.filterMethod=this.data[this.pos++];this.interlaceMethod=this.data[this.pos++];break;case "acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||Infinity,frames:[]};break;case "PLTE":this.palette=this.read(d);break;case "fcTL":f&&this.animation.frames.push(f);this.pos+=
4;f={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()};b=this.readUInt16();d=this.readUInt16()||100;f.delay=1E3*b/d;f.disposeOp=this.data[this.pos++];f.blendOp=this.data[this.pos++];f.data=[];break;case "IDAT":case "fdAT":"fdAT"===b&&(this.pos+=4,d-=4);b=(null!=f?f.data:void 0)||this.imgData;for(a=0;0<=d?a<d:a>d;0<=d?++a:--a)b.push(this.data[this.pos++]);break;case "tRNS":this.transparency={};switch(this.colorType){case 3:this.transparency.indexed=
this.read(d);d=255-this.transparency.indexed.length;if(0<d)for(b=0;0<=d?b<d:b>d;0<=d?++b:--b)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(d)[0];break;case 2:this.transparency.rgb=this.read(d)}break;case "tEXt":a=this.read(d);d=a.indexOf(0);b=String.fromCharCode.apply(String,a.slice(0,d));this.text[b]=String.fromCharCode.apply(String,a.slice(d+1));break;case "IEND":f&&this.animation.frames.push(f);a:{switch(this.colorType){case 0:case 3:case 4:f=1;break a;
case 2:case 6:f=3;break a}f=void 0}this.colors=f;this.hasAlphaChannel=4===(m=this.colorType)||6===m;m=this.colors+(this.hasAlphaChannel?1:0);this.pixelBitlength=this.bits*m;a:{switch(this.colors){case 1:m="DeviceGray";break a;case 3:m="DeviceRGB";break a}m=void 0}this.colorSpace=m;this.imgData=new Uint8Array(this.imgData);return;default:this.pos+=d}this.pos+=4;if(this.pos>this.data.length)throw Error("Incomplete or corrupt PNG file");}}p.load=function(b,m,f){"function"===typeof m&&(f=m);var d=new XMLHttpRequest;
d.open("GET",b,!0);d.responseType="arraybuffer";d.onload=function(){var a=new Uint8Array(d.response||d.mozResponseArrayBuffer);a=new p(a);"function"===typeof(null!=m?m.getContext:void 0)&&a.render(m);return"function"===typeof f?f(a):void 0};return d.send(null)};p.prototype.read=function(b){var m;var f=[];for(m=0;0<=b?m<b:m>b;0<=b?++m:--m)f.push(this.data[this.pos++]);return f};p.prototype.readUInt32=function(){var b=this.data[this.pos++]<<24;var m=this.data[this.pos++]<<16;var f=this.data[this.pos++]<<
8;var d=this.data[this.pos++];return b|m|f|d};p.prototype.readUInt16=function(){var b=this.data[this.pos++]<<8;var m=this.data[this.pos++];return b|m};p.prototype.decodePixels=function(b){var m,f,d,a,c,l,h,n;null==b&&(b=this.imgData);if(0===b.length)return new Uint8Array(0);b=new t(b);b=b.getBytes();var g=this.pixelBitlength/8;var e=g*this.width;var k=new Uint8Array(e*this.height);var w=b.length;for(f=a=c=0;a<w;){switch(b[a++]){case 0:for(d=m=0;m<e;d=m+=1)k[f++]=b[a++];break;case 1:for(d=l=0;l<e;d=
l+=1){m=b[a++];var q=d<g?0:k[f-g];k[f++]=(m+q)%256}break;case 2:for(d=q=0;q<e;d=q+=1){m=b[a++];var u=(d-d%g)/g;l=c&&k[(c-1)*e+u*g+d%g];k[f++]=(l+m)%256}break;case 3:for(d=n=0;n<e;d=n+=1)m=b[a++],u=(d-d%g)/g,q=d<g?0:k[f-g],l=c&&k[(c-1)*e+u*g+d%g],k[f++]=(m+Math.floor((q+l)/2))%256;break;case 4:for(d=n=0;n<e;d=n+=1){m=b[a++];u=(d-d%g)/g;q=d<g?0:k[f-g];0===c?l=h=0:(l=k[(c-1)*e+u*g+d%g],h=u&&k[(c-1)*e+(u-1)*g+d%g]);var r=q+l-h;d=Math.abs(r-q);u=Math.abs(r-l);r=Math.abs(r-h);q=d<=u&&d<=r?q:u<=r?l:h;k[f++]=
(m+q)%256}break;default:throw Error("Invalid filter algorithm: "+b[a-1]);}c++}return k};p.prototype.decodePalette=function(){var b,m,f,d,a;var c=this.palette;var l=this.transparency.indexed||[];var h=new Uint8Array((l.length||0)+c.length);var n=f=b=m=0;for(d=c.length;f<d;n=f+=3)h[m++]=c[n],h[m++]=c[n+1],h[m++]=c[n+2],h[m++]=null!=(a=l[b++])?a:255;return h};p.prototype.copyToImageData=function(b,m){var f,d;var a=this.colors;var c=null;var l=this.hasAlphaChannel;this.palette.length&&(c=null!=(f=this._decodedPalette)?
f:this._decodedPalette=this.decodePalette(),a=4,l=!0);f=b.data||b;var h=f.length;var n=c||m;var g=d=0;if(1===a)for(;g<h;)a=c?4*m[g/4]:d,d=n[a++],f[g++]=d,f[g++]=d,f[g++]=d,f[g++]=l?n[a++]:this.transparency.grayscale&&this.transparency.grayscale===d?0:255,d=a;else for(;g<h;)a=c?4*m[g/4]:d,f[g++]=n[a++],f[g++]=n[a++],f[g++]=n[a++],f[g++]=l?n[a++]:this.transparency.rgb&&this.transparency.rgb[1]===n[a-3]&&this.transparency.rgb[3]===n[a-2]&&this.transparency.rgb[5]===n[a-1]?0:255,d=a};p.prototype.decode=
function(){var b=new Uint8Array(this.width*this.height*4);this.copyToImageData(b,this.decodePixels());return b};var x=function(b){(void 0).clearRect(0,0,b.width,b.height);(void 0).putImageData(b,0,0);b=new Image;b.src=(void 0).toDataURL();return b};p.prototype.decodeFrames=function(b){var m,f;if(this.animation){var d=this.animation.frames;var a=[];var c=m=0;for(f=d.length;m<f;c=++m){c=d[c];var l=b.createImageData(c.width,c.height);var h=this.decodePixels(new Uint8Array(c.data));this.copyToImageData(l,
h);c.imageData=l;a.push(c.image=x(l))}return a}};p.prototype.renderFrame=function(b,m){var f=this.animation.frames;var d=f[m];f=f[m-1];0===m&&b.clearRect(0,0,this.width,this.height);1===(null!=f?f.disposeOp:void 0)?b.clearRect(f.xOffset,f.yOffset,f.width,f.height):2===(null!=f?f.disposeOp:void 0)&&b.putImageData(f.imageData,f.xOffset,f.yOffset);0===d.blendOp&&b.clearRect(d.xOffset,d.yOffset,d.width,d.height);return b.drawImage(d.image,d.xOffset,d.yOffset)};p.prototype.animate=function(b){var m,f=
this;var d=0;var a=this.animation;var c=a.numFrames;var l=a.frames;var h=a.numPlays;return(m=function(){var n=d++%c;var g=l[n];f.renderFrame(b,n);if(1<c&&d/c<h)return f.animation._timeout=setTimeout(m,g.delay)})()};p.prototype.stopAnimation=function(){var b;return clearTimeout(null!=(b=this.animation)?b._timeout:void 0)};p.prototype.render=function(b){b._png&&b._png.stopAnimation();b._png=this;b.width=this.width;b.height=this.height;b=b.getContext("2d");if(this.animation)return this.decodeFrames(b),
this.animate(b);var m=b.createImageData(this.width,this.height);this.copyToImageData(m,this.decodePixels());return b.putImageData(m,0,0)};return p}()})},"esri/layers/rasterFormats/Raw":function(){define([],function(){return{decodeBIP:function(t,p){var x=p.pixelType,b=p.bandCount,m=[],f=p.width*p.height,d=this.getBandCount(t,p);b=b||d;var a=t.byteLength-t.byteLength%(f*this._getPixelLength(x)),c=new x(t,0,f*d),l,h,n;for(l=0;l<b;l++){var g=new x(f);for(h=0;h<f;h++)g[h]=c[h*d+l];m.push(g)}a<t.byteLength-
1&&(n=this._decodeMask(t.slice(a),p));return{pixels:m,maskData:n}},decodeBSQ:function(t,p){var x=p.pixelType,b=p.bandCount;if(void 0===b||null===b)b=this.getBandCount(t,p);var m=[],f=p.width*p.height,d=f*b,a=t.byteLength-t.byteLength%(f*this._getPixelLength(x));x=new x(t,0,d);var c;for(d=0;d<b;d++)m.push(x.subarray(d*f,(d+1)*f));a<t.byteLength-1&&(c=this._decodeMask(t.slice(a),p));return{pixels:m,maskData:c}},getBandCount:function(t,p){return Math.floor(t.byteLength/(p.width*p.height*this._getPixelLength(p.pixelType)))},
_getPixelLength:function(t){var p=1;switch(t){case Uint8Array:case Int8Array:case Uint8ClampedArray:p=1;break;case Uint16Array:case Int16Array:p=2;break;case Uint32Array:case Int32Array:case Float32Array:p=4;break;case Float64Array:p=8}return p},_decodeMask:function(t,p){var x=p.width*p.height;if(8*t.byteLength<x)return null;var b=new Uint8Array(t,0,Math.ceil(x/8)),m=new Uint8Array(p.width*p.height),f=0,d=0,a=0,c=0;for(a=0;a<b.length-1;a++)for(d=b[a],c=7;0<=c;c--)m[f++]=d>>c&1;for(c=7;f<x-1;)d=b[b.length-
1],m[f++]=d>>c&1,c--;return m}}})},"esri/layers/rasterFormats/TiffDecoder":function(){define(["./Jpg","./Zlib"],function(t,p){var x=function(){var d=new ArrayBuffer(4),a=new Uint8Array(d);d=new Uint32Array(d);a[0]=1;a[1]=2;a[2]=3;a[3]=4;return 67305985===d[0]},b=function(){var d=[];d[254]="NEWSUBFILETYPE";d[255]="SUBFILETYPE";d[256]="IMAGEWIDTH";d[257]="IMAGELENGTH";d[258]="BITSPERSAMPLE";d[259]="COMPRESSION";d[262]="PHOTOMETRICINTERPRETATION";d[263]="THRESHHOLDING";d[264]="CELLWIDTH";d[265]="CELLLENGTH";
d[266]="FILLORDER";d[269]="DOCUMENTNAME";d[270]="IMAGEDESCRIPTION";d[271]="MAKE";d[272]="MODEL";d[273]="STRIPOFFSETS";d[274]="ORIENTATION";d[277]="SAMPLESPERPIXEL";d[278]="ROWSPERSTRIP";d[279]="STRIPBYTECOUNTS";d[280]="MINSAMPLEVALUE";d[281]="MAXSAMPLEVALUE";d[282]="XRESOLUTION";d[283]="YRESOLUTION";d[284]="PLANARCONFIGURATION";d[285]="PAGENAME";d[286]="XPOSITION";d[287]="YPOSITION";d[288]="FREEOFFSETS";d[289]="FREEBYTECOUNTS";d[290]="GRAYRESPONSEUNIT";d[291]="GRAYRESPONSECURVE";d[292]="T4OPTIONS";
d[293]="T6OPTIONS";d[296]="RESOLUTIONUNIT";d[297]="PAGENUMBER";d[300]="COLORRESPONSEUNIT";d[301]="TRANSFERFUNCTION";d[305]="SOFTWARE";d[306]="DATETIME";d[315]="ARTIST";d[316]="HOSTCOMPUTER";d[317]="PREDICTOR";d[318]="WHITEPOINT";d[319]="PRIMARYCHROMATICITIES";d[320]="COLORMAP";d[321]="HALFTONEHINTS";d[322]="TILEWIDTH";d[323]="TILELENGTH";d[324]="TILEOFFSETS";d[325]="TILEBYTECOUNTS";d[326]="BADFAXLINES";d[327]="CLEANFAXDATA";d[328]="CONSECUTIVEBADFAXLINES";d[330]="SUBIFD";d[332]="INKSET";d[333]="INKNAMES";
d[334]="NUMBEROFINKS";d[336]="DOTRANGE";d[337]="TARGETPRINTER";d[338]="EXTRASAMPLES";d[339]="SAMPLEFORMAT";d[340]="SMINSAMPLEVALUE";d[341]="SMAXSAMPLEVALUE";d[342]="TRANSFERRANGE";d[347]="JPEGTABLES";d[512]="JPEGPROC";d[513]="JPEGIFOFFSET";d[514]="JPEGIFBYTECOUNT";d[515]="JPEGRESTARTINTERVAL";d[517]="JPEGLOSSLESSPREDICTORS";d[518]="JPEGPOINTTRANSFORM";d[519]="JPEGQTABLES";d[520]="JPEGDCTABLES";d[521]="JPEGACTABLES";d[529]="YCBCRCOEFFICIENTS";d[530]="YCBCRSUBSAMPLING";d[531]="YCBCRPOSITIONING";d[532]=
"REFERENCEBLACKWHITE";d[33550]="GEOPIXELSCALE";d[33922]="GEOTIEPOINTS";d[33432]="COPYRIGHT";d[42112]="GDAL_METADATA";d[42113]="GDAL_NODATA";d[50844]="RPCCOEFFICIENT";d[34735]="GEOKEYDIRECTORY";d[34736]="GEODOUBLEPARAMS";d[34737]="GEOASCIIPARAMS";return d}(),m=[0,1,1,2,4,8,1,1,2,4,8,4,8],f=function(d,a){var c="UNKNOWN";3===d?c="F32":1===d?8>=a?c="U8":16>=a?c="U16":32>=a&&(c="U32"):2===d&&(8>=a?c="S8":16>=a?c="S16":32>=a&&(c="S32"));return c};return{decode:function(d){var a=new DataView(d,0,8),c=a.getUint16(0,
!1);if(18761===c)var l=!0;else if(19789===c)l=!1;else throw"unexpected endianess byte";if(42!==a.getUint16(2,l))throw"unexpected tiff identifier";var h=a.getUint32(4,l);var n=l;var g,e;var k=h;for(var w=[];k;){var q=(new DataView(d,k,2)).getUint16(0,n);var u=k+2;k=(new DataView(d,u+12*q,4)).getUint32(0,n);var r={};for(g=0;g<q;g++){var v=new DataView(d,u,12);var z=v.getUint16(0,n);var B=v.getUint16(2,n);var A=v.getUint32(4,n);var y=v.getUint32(8,n);u+=12;if(!(7===B||12<B)){var D=e={fieldTag:z,fieldType:B,
fieldValueCount:A,fieldValueOffset:y},G=void 0,E=void 0,F=d,I=n,M=[],P=e.fieldType,W=e.fieldValueCount,H=e.fieldValueOffset,O=H,K=m[P],R=8*K,da=W*K,U=W*m[P]*8;if(32>=U)if(I||(H>>>=32-U),1===W)M=[H];else for(G=0;G<W;G++)M.push(H<<R*G>>>32-R);else for(O=H;O<H+da;O+=K){switch(P){case 1:E=(new DataView(F,O,1)).getUint8(0);break;case 2:E=(new DataView(F,O,1)).getUint8(0);break;case 3:E=(new DataView(F,O,2)).getUint16(0,I);break;case 4:E=(new DataView(F,O,4)).getUint32(0,I);break;case 5:E=(new DataView(F,
O,4)).getUint32(0,I)/(new DataView(F,O+4,4)).getUint32(0,I);break;case 6:E=(new DataView(F,O,1)).getInt8(0);break;case 8:E=(new DataView(F,O,2)).getInt16(0,I);break;case 9:E=(new DataView(F,O,4)).getInt32(0,I);break;case 10:E=(new DataView(F,O,4)).getInt32(0,I)/(new DataView(F,O+4,4)).getInt32(0,I);break;case 11:E=(new DataView(F,O,4)).getFloat32(0,I);break;case 12:E=(new DataView(F,O,8)).getFloat64(0,I);break;case 7:E=null;break;default:E=null}M.push(E)}if(2===P){var Z="",L=M;M=[];for(G=0;G<L.length;G++)0===
L[G]&&""!==Z?(M.push(Z),Z=""):Z+=String.fromCharCode(L[G]);""===Z&&0!==M.length||M.push(Z)}D.fieldValues=M;var T=r,Y=b[z];void 0===Y&&(Y="unknown"+z);T[Y]={type:B,values:e.fieldValues}}}w.push(r)}if(0===w.length)throw"no valid image file directory";var ca,Q=w[0],X=void 0===Q.GDAL_NODATA||null===Q.GDAL_NODATA?null:parseFloat(Q.GDAL_NODATA.values[0]);if(Q.TILEOFFSETS){var ha=x()===n,ja=Q.TILEOFFSETS?Q.TILEOFFSETS.values:void 0;if(void 0===ja)var aa=void 0;else{var la=Q.TILEBYTECOUNTS.values,oa=Q.TILEWIDTH.values[0],
wa=Q.TILELENGTH.values[0],za=Q.IMAGEWIDTH.values[0],Fa=Q.IMAGELENGTH.values[0],Ba=za*Fa,Ca=Q.BITSPERSAMPLE.values[0],va=Q.SAMPLESPERPIXEL.values[0],Va=Q.SAMPLEFORMAT?Q.SAMPLEFORMAT.values[0]:1,Sa=f(Va,Ca);if(1!==(Q.PLANARCONFIGURATION?Q.PLANARCONFIGURATION.values[0]:1))throw"can only handle PLANARCONFIGURATION\x3d1";var Ra=Q.COMPRESSION?Q.COMPRESSION.values[0]:1;if(1!==Ra&&6!==Ra&&8!==Ra&&32946!==Ra)throw"this compression is not supported at this moment";if(3<Va)aa=void 0;else{if(3===Va){var Ta=new Float32Array(Ba*
va);var Wa=Float32Array}else 1===Va?8>=Ca?(Ta=new Uint8Array(Ba*va),Wa=Uint8Array):16>=Ca?(Ta=new Uint16Array(Ba*va),Wa=Uint16Array):32>=Ca&&(Ta=new Uint32Array(Ba*va),Wa=Uint32Array):2===Va&&(8>=Ca?(Ta=new Int8Array(Ba*va),Wa=Int8Array):16>=Ca?(Ta=new Int16Array(Ba*va),Wa=Int16Array):32>=Ca&&(Ta=new Int32Array(Ba*va),Wa=Int32Array));var La,$a,ya,Xa,bb,cb=Math.ceil(za/oa);if(0===Ca%8)for(La=0;La<ja.length;La++){var ab=Math.floor(La/cb)*wa;var Ua=La%cb*oa;var db=(ab*za+Ua)*va;if("U8"===Sa||"S8"===
Sa||ha)if(8===Ra||32946===Ra){var C=new Uint8Array(d,ja[La],la[La]);var J=new p(C);var N=J.getBytes();var V=new ArrayBuffer(N.length);C=new Uint8Array(V);C.set(N)}else if(6===Ra){C=new Uint8Array(d,ja[La],la[La]);var S=new t;S.parse(C);var ba=S.getData(S.width,S.height);V=new ArrayBuffer(ba.length);C=new Uint8Array(V);C.set(ba)}else 1===Ra&&(V=d.slice(ja[La],ja[La]+la[La]));else{if(8===Ra||32946===Ra){C=new Uint8Array(d,ja[La],la[La]);J=new p(C);C=J.getBytes();V=new ArrayBuffer(C.length);var ea=new Uint8Array(V)}else 1===
Ra&&(V=new ArrayBuffer(la[La]),C=new Uint8Array(d,ja[La],la[La]),ea=new Uint8Array(V));switch(Sa){case "U16":case "S16":for(ya=0;ya<C.length;ya+=2)ea[ya]=C[ya+1],ea[ya+1]=C[ya];break;case "U32":case "S32":case "F32":for(ya=0;ya<C.length;ya+=4)ea[ya]=C[ya+3],ea[ya+1]=C[ya+2],ea[ya+2]=C[ya+1],ea[ya+3]=C[ya]}}var ia=new Wa(V);var fa=0;var ka=db;var ma=Math.min(oa,za-Ua);var na=Math.min(wa,Fa-ab);for(Xa=0;Xa<na;Xa++)for(ka=db+Xa*za*va,fa=Xa*oa*va,bb=0;bb<ma*va;bb++,ka++,fa++)Ta[ka]=ia[fa]}var qa={width:za,
height:Fa,pixelType:Sa};if(1===va)qa.pixels=[Ta];else for(qa.pixels=[],La=0;La<va;La++){var xa=new Wa(Ba);for($a=0;$a<Ba;$a++)xa[$a]=Ta[$a*va+La];qa.pixels.push(xa)}aa=qa}}}else if(Q.STRIPOFFSETS){var ta=x()===n,ua=Q.STRIPOFFSETS?Q.STRIPOFFSETS.values:void 0;if(void 0===ua)aa=void 0;else{var Da=Q.STRIPBYTECOUNTS.values,Ma=Q.ROWSPERSTRIP.values,Ha=Q.IMAGEWIDTH.values[0],Ia=Q.IMAGELENGTH.values[0],Aa=Ha*Ia,ra=Q.BITSPERSAMPLE.values[0],sa=Q.SAMPLESPERPIXEL.values[0],Ka=Q.SAMPLEFORMAT?Q.SAMPLEFORMAT.values[0]:
1,Pa=f(Ka,ra);if(1!==(Q.PLANARCONFIGURATION?Q.PLANARCONFIGURATION.values[0]:1))throw"can only handle PLANARCONFIGURATION\x3d1";var Qa=Q.COMPRESSION?Q.COMPRESSION.values[0]:1;if(1!==Qa&&6!==Qa&&8!==Qa&&32946!==Qa)throw"compressed tiff is not supported at this moment";if(3<Ka)aa=void 0;else{if(3===Ka){var Ya=new Float32Array(Aa*sa);var Za=Float32Array}else 1===Ka?8>=ra?(Ya=new Uint8Array(Aa*sa),Za=Uint8Array):16>=ra?(Ya=new Uint16Array(Aa*sa),Za=Uint16Array):32>=ra&&(Ya=new Uint32Array(Aa*sa),Za=Uint32Array):
2===Ka&&(8>=ra?(Ya=new Int8Array(Aa*sa),Za=Int8Array):16>=ra?(Ya=new Int16Array(Aa*sa),Za=Int16Array):32>=ra&&(Ya=new Int32Array(Ha*Ia*sa),Za=Int32Array));var Na,eb,Oa;if(0===ra%8)for(Na=0;Na<ua.length;Na++){var ib=Na*Ma*Ha*sa;if("U8"===Pa||"S8"===Pa||ta)if(8===Qa||32946===Qa){var pa=new Uint8Array(d,ua[Na],Da[Na]);var Ea=new p(pa);var Ja=Ea.getBytes();var Ga=new ArrayBuffer(Ja.length);pa=new Uint8Array(Ga);pa.set(Ja)}else if(6===Qa){pa=new Uint8Array(d,ua[Na],Da[Na]);var fb=new t;fb.parse(pa);var jb=
fb.getData(fb.width,fb.height);Ga=new ArrayBuffer(jb.length);pa=new Uint8Array(Ga);pa.set(jb)}else 1===Qa&&(Ga=d.slice(ua[Na],ua[Na]+Da[Na]));else{if(6===Qa||8===Qa||32946===Qa){pa=new Uint8Array(d,ua[Na],Da[Na]);Ea=new p(pa);pa=Ea.getBytes();Ga=new ArrayBuffer(pa.length);var gb=new Uint8Array(Ga)}else 1===Qa&&(Ga=new ArrayBuffer(Da[Na]),pa=new Uint8Array(d,ua[Na],Da[Na]),gb=new Uint8Array(Ga));switch(Pa){case "U16":case "S16":for(Oa=0;Oa<pa.length;Oa+=2)gb[Oa]=pa[Oa+1],gb[Oa+1]=pa[Oa];break;case "U32":case "S32":case "F32":for(Oa=
0;Oa<pa.length;Oa+=4)gb[Oa]=pa[Oa+3],gb[Oa+1]=pa[Oa+2],gb[Oa+2]=pa[Oa+1],gb[Oa+3]=pa[Oa]}}var lb=new Za(Ga);Ya.set(lb,ib)}var hb={width:Ha,height:Ia,pixelType:Pa};if(1===sa)hb.pixels=[Ya];else for(hb.pixels=[],Na=0;Na<sa;Na++){var kb=new Za(Aa);for(eb=0;eb<Aa;eb++)kb[eb]=Ya[eb*sa+Na];hb.pixels.push(kb)}aa=hb}}}if(null!==X){aa.maskData=new Uint8Array(aa.width*aa.height);if(1E24<Math.abs(X))for(ca=0;ca<aa.width*aa.height;ca++)aa.maskData[ca]=1E-6>Math.abs((aa.pixels[0][ca]-X)/X)?0:1;else for(ca=0;ca<
aa.width*aa.height;ca++)aa.maskData[ca]=aa.pixels[0][ca]===X?0:1;aa.noDataValue=X}return aa}}})},"esri/layers/rasterLib/tile/RasterHandler":function(){define("require exports module dojo/Deferred dojo/promise/all ../../PixelBlock ../../vectorTiles/core/workers ../../vectorTiles/core/promiseUtils ../../vectorTiles/core/requireUtils ../../vectorTiles/request ../../rasterLib/function/rasterFunctionHelper ../../rasterLib/renderer/rasterRendererHelper".split(" "),function(t,p,x,b,m,f,d,a,c,l,h,n){function g(e){var k=
new b;m(e).then(function(w){k.resolve()});return k.promise}return function(){function e(k){this.customModules=k&&k.customModules}e.prototype.destroy=function(){this.stop();this.customModules=this.rasterLayer=null};e.prototype.start=function(){this.stop();var k=new b,w=0,q=this.customModules?this.customModules.length+1:1,u=c.getAbsMid("esri/layers/rasterLib/tile/RasterWorker",t,x),r=d.open(u,{client:this}).then(function(v){this._connection=v;w++;w===q&&(this._connected=!0,k.resolve())}.bind(this));
this._openDL=[r];this.customModules&&this.customModules.forEach(function(v){r=d.open(v,{client:this}).then(function(z){w++;w===q&&(this._connected=!0,k.resolve())});this._openDL.push(r)}.bind(this));return this._connectionPromise=k.promise};e.prototype.stop=function(){this._openDL?this._openDL.forEach(function(k){k.isFulfilled()||k.cancel()}.bind(this)):this._connectionPromise&&!this._connectionPromise.isFulfilled()&&this._connectionPromise.cancel();this._connection&&(this._connection.close(),this._connection=
null)};e.prototype.decode=function(k){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));var w={id:null};return this._connection.invoke("decode",k,[],w).then(function(q){q.targetWorker=w;return q})};e.prototype.process=function(k){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));var w={id:null};k.layerId=this.rasterLayer.layerId;var q=new b;this._connection.invoke("process",k,[],w).then(function(u){u.targetWorker=
w;u.src?Object.keys(u.src).forEach(function(r){u.src[r].pixelBlock=new f(u.src[r].pixelBlock)}):u.src=null;u.pixelBlock&&(u.pixelBlock=new f(u.pixelBlock));q.resolve(u)});return q.promise};e.prototype.render=function(k){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));var w={id:null};k.layerId=this.rasterLayer.layerId;return this._connection.invoke("render",k,[],w).then(function(q){q.targetWorker=w;q.pixelBlock=q.pixelBlock?new f(q.pixelBlock):null;
return q})};e.prototype.setLayer=function(k){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));this.rasterLayer=k;k=this._connection.broadcast("setLayer",k,[],{id:null});return g(k)};e.prototype.setRasterFunction=function(k){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));k=this._connection.broadcast("setRasterFunction",k,[],{id:null});return g(k)};e.prototype.setRasterRenderer=function(k){if(!this._connectionPromise.isFulfilled()||
!this._connection)return a.reject(Error("no connection"));k=this._connection.broadcast("setRasterRenderer",k,[],{id:null});return g(k)};return e}()})},"esri/layers/vectorTiles/core/workers":function(){define(["require","exports","./workers/workers"],function(t,p,x){Object.defineProperty(p,"__esModule",{value:!0});for(var b in x)p.hasOwnProperty(b)||(p[b]=x[b])})},"esri/layers/vectorTiles/core/workers/workers":function(){define("require exports dojo/sniff dojo/promise/all ../Logger ../promiseUtils ./Connection ./RemoteClient ./WorkerOwner".split(" "),
function(t,p,x,b,m,f,d,a,c){function l(){if(w)return w;for(var q=h+n,u=[],r=function(z){var B=c.create(z).then(function(A){return k[z]=A});u.push(B)},v=0;v<q;v++)r(v);return w=b(u).then(function(){})}Object.defineProperty(p,"__esModule",{value:!0});p.Connection=d;p.RemoteClient=a;(d=navigator.hardwareConcurrency)||(d=x("safari")&&x("mac")||x("trident")?8:2);var h=x("esri-workers-debug")?1:Math.max(1,Math.ceil(d/2)),n=x("esri-workers-debug")?1:Math.max(1,Math.floor(d/2)),g=m.getLogger("esri.core.workers"),
e=0,k=[];p.initialize=function(){l()};p.open=function(q,u,r){void 0===u&&(u={});if(Array.isArray(q))return new p.Connection(q.map(function(B){return new p.RemoteClient(B,u.client)}));if("string"!==typeof q){g.warn("workers-open:signature-deprecated","DEPRECATED: workers.open() changed signature.");var v=q;q=u;u={client:v,strategy:r?"dedicated":"distributed"}}var z=u.strategy||"distributed";return"local"===z?f.create(function(B){t([q],function(A){B(p.RemoteClient.connect(A))})}).then(function(B){return new p.Connection([new p.RemoteClient(B,
u.client)])}):l().then(function(){if("dedicated"===z){var B=h+e++;e%=n;return k[B].open(q).then(function(A){return new p.Connection([new p.RemoteClient(A,u.client)])})}return f.all(k.map(function(A){return A.open(q)})).then(function(A){return new p.Connection(A.map(function(y){return new p.RemoteClient(y,u.client)}))})})};p.terminate=function(){for(var q=0;q<k.length;q++)k[q]&&k[q].terminate();k.length=0};var w})},"esri/layers/vectorTiles/core/Logger":function(){define(["require","exports","dojo/has"],
function(t,p,x){var b={info:0,warn:1,error:2};t=function(){function m(f){void 0===f&&(f={});this.module=f.module||"";this.writer=f.writer||null;this.level=f.level||null;null!=f.enabled&&(this.enabled=!!f.enabled);m._loggers[this.module]=this;f=this.module.lastIndexOf(".");-1!==f&&(this.parent=m.getLogger(this.module.slice(0,f)))}m.prototype.log=function(f){for(var d=[],a=1;a<arguments.length;a++)d[a-1]=arguments[a];this._isEnabled()&&this._matchLevel(f)&&(a=this._inheritedWriter())&&a.apply(void 0,
[f,this.module].concat(d))};m.prototype.error=function(){for(var f=[],d=0;d<arguments.length;d++)f[d]=arguments[d];this.log.apply(this,["error"].concat(f))};m.prototype.warn=function(){for(var f=[],d=0;d<arguments.length;d++)f[d]=arguments[d];this.log.apply(this,["warn"].concat(f))};m.prototype.info=function(){for(var f=[],d=0;d<arguments.length;d++)f[d]=arguments[d];this.log.apply(this,["info"].concat(f))};m.prototype.getLogger=function(f){return m.getLogger(this.module+"."+f)};m.getLogger=function(f){var d=
m._loggers[f];d||(d=new m({module:f}));return d};m.prototype._parentWithMember=function(f,d){for(var a=this;a&&null==a[f];)a=a.parent;return a?a[f]:d};m.prototype._inheritedWriter=function(){return this._parentWithMember("writer",this._consoleWriter)};m.prototype._consoleWriter=function(f,d){for(var a=[],c=2;c<arguments.length;c++)a[c-2]=arguments[c];console[f].apply(console,["["+d+"]"].concat(a))};m.prototype._matchLevel=function(f){return b[this._parentWithMember("level","error")]<=b[f]};m.prototype._isEnabled=
function(){return this._parentWithMember("enabled",!0)};m._loggers={};return m}();t.getLogger("esri").level="warn";return t})},"esri/layers/vectorTiles/core/promiseUtils":function(){define("require exports dojo/Deferred dojo/when dojo/promise/all ./Error".split(" "),function(t,p,x,b,m,f){function d(a){if(a){if("function"!==typeof a.forEach){var c=Object.keys(a),l=c.map(function(e){return a[e]});return d(l).then(function(e){var k={};c.forEach(function(w,q){return k[w]=e[q]});return k})}var h=new x,
n=[],g=a.length;0===g&&h.resolve(n);a.forEach(function(e){var k={promise:e};n.push(k);e.then(function(w){k.value=w})["catch"](function(w){k.error=w}).then(function(){--g;0===g&&h.resolve(n)})});return h.promise}}Object.defineProperty(p,"__esModule",{value:!0});p.all=function(a){return m(a)};p.filter=function(a,c){var l=a.slice();return m(a.map(function(h,n){return c(h,n)})).then(function(h){return l.filter(function(n,g){return h[g]})})};p.eachAlways=d;p.create=function(a,c){var l=new x(c);a(function(h){void 0===
h&&(h=null);return b(h).then(l.resolve)},l.reject);return l.promise};p.reject=function(a){var c=new x;c.reject(a);return c.promise};p.resolve=function(a){void 0===a&&(a=null);var c=new x;c.resolve(a);return c.promise};p.after=function(a,c){void 0===c&&(c=null);var l=0,h=new x(function(){l&&(clearTimeout(l),l=0)});l=setTimeout(function(){h.resolve(c)},a);return h.promise};p.timeout=function(a,c,l){var h=0,n=new x(a.cancel);a.then(function(g){n.isFulfilled()||(n.resolve(g),h&&(clearTimeout(h),h=0))});
a["catch"](function(g){n.isFulfilled()||(n.reject(g),h&&(clearTimeout(h),h=0))});h=setTimeout(function(){var g=l||new f("promiseUtils:timeout","The wrapped promise did not resolve within "+c+" ms");n.reject(g)},c);return n.promise};p.wrapCallback=function(a){var c=!1,l=new x(function(){return c=!0});a(function(h){c||l.resolve(h)});return l.promise};p.isThenable=function(a){return a&&"function"===typeof a.then};p.when=function(a){return b(a)}})},"esri/layers/vectorTiles/core/Error":function(){define(["require",
"exports","./tsSupport/extendsHelper","./lang","./Message"],function(t,p,x,b,m){t=function(f){function d(a,c,l){var h=f.call(this,a,c,l)||this;return h instanceof d?h:new d(a,c,l)}x(d,f);d.prototype.toJSON=function(){return{name:this.name,message:this.message,details:b.clone(this.details),dojoType:this.dojoType}};d.fromJSON=function(a){var c=new d(a.name,a.message,a.details);null!=a.dojoType&&(c.dojoType=a.dojoType);return c};return d}(m);t.prototype.type="error";return t})},"esri/layers/vectorTiles/core/tsSupport/extendsHelper":function(){define([],
function(){return function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,x){p.__proto__=x}||function(p,x){for(var b in x)x.hasOwnProperty(b)&&(p[b]=x[b])};return function(p,x){function b(){this.constructor=p}t(p,x);p.prototype=null===x?Object.create(x):(b.prototype=x.prototype,new b)}}()})},"esri/layers/vectorTiles/core/lang":function(){define("dojo/_base/kernel dojo/_base/lang dojo/date dojo/number dojo/date/locale dojo/i18n!../nls/common".split(" "),function(t,p,x,b,
m,f){function d(e){return void 0!==e&&null!==e}function a(e){return d(e)?e:""}function c(e,k,w){var q=w.match(/([^\(]+)(\([^\)]+\))?/i),u=p.trim(q[1]);w=k[e];q=JSON.parse((q[2]?p.trim(q[2]):"{}").replace(/^\(/,"{").replace(/\)$/,"}").replace(/([{,])\s*([0-9a-zA-Z_]+)\s*:/gi,'$1"$2":').replace(/"\s*:\s*'/gi,'":"').replace(/'\s*(,|\})/gi,'"$1'));var r=q.utcOffset;if(-1===n.indexOf(u))u=p.getObject(u),p.isFunction(u)&&(w=u(w,e,k,q));else if("number"===typeof w||"string"===typeof w&&w&&!isNaN(Number(w)))switch(w=
Number(w),u){case "NumberFormat":e=p.mixin({},q);k=parseFloat(e.places);if(isNaN(k)||0>k)e.places=Infinity;return b.format(w,e);case "DateString":w=new Date(w);if(q.local||q.systemLocale)return q.systemLocale?w.toLocaleDateString()+(q.hideTime?"":" "+w.toLocaleTimeString()):w.toDateString()+(q.hideTime?"":" "+w.toTimeString());w=w.toUTCString();q.hideTime&&(w=w.replace(/\s+\d\d:\d\d:\d\d\s+(utc|gmt)/i,""));return w;case "DateFormat":return w=new Date(w),d(r)&&(w=x.add(w,"minute",w.getTimezoneOffset()-
r)),m.format(w,q)}return a(w)}function l(e,k){var w;if(k)for(w in e)e.hasOwnProperty(w)&&(void 0===e[w]?delete e[w]:e[w]instanceof Object&&l(e[w],!0));else for(w in e)e.hasOwnProperty(w)&&void 0===e[w]&&delete e[w];return e}function h(e){if(!e||"object"!=typeof e||p.isFunction(e))return e;if(e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Int32Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Float32Array||
e instanceof Float64Array||e instanceof Date)return new e.constructor(e);if(e instanceof ArrayBuffer)return e.slice(0,e.byteLength);if("function"===typeof e.clone)e=e.clone();else if("function"===typeof e.map&&"function"===typeof e.forEach)e=e.map(h);else if("function"===typeof e.notifyChange&&"function"===typeof e.watch)e=e.clone();else{var k={},w,q={};for(w in e){var u=e[w];var r=!(w in q)||q[w]!==u;if(!(w in k)||k[w]!==u&&r)k[w]=h?h(u):u}e=k}return e}var n=["NumberFormat","DateString","DateFormat"],
g=/<\/?[^>]+>/g;return{equals:function(e,k){return e===k||"number"===typeof e&&isNaN(e)&&"number"===typeof k&&isNaN(k)||p.isFunction((e||{}).getTime)&&p.isFunction((k||{}).getTime)&&e.getTime()==k.getTime()||p.isFunction((e||{}).equals)&&e.equals(k)||p.isFunction((k||{}).equals)&&k.equals(e)||!1},mixin:p.mixin,valueOf:function(e,k){for(var w in e)if(e[w]==k)return w;return null},stripTags:function(e){if(e){var k=typeof e;if("string"===k)e=e.replace(g,"");else if("object"===k)for(var w in e)(k=e[w])&&
"string"===typeof k&&(k=k.replace(g,"")),e[w]=k}return e},substitute:function(e,k,w){if(d(w))if(p.isObject(w)){var q=w.first;var u=w.dateFormat;var r=w.numberFormat}else q=w;if(k&&"{*}"!==k)return p.replace(k,p.hitch({obj:e},function(z,B){var A=B.split(":");return 1<A.length?(B=A[0],A.shift(),c(B,this.obj,A.join(":"))):u&&-1!==(u.properties||[]).indexOf(B)?c(B,this.obj,u.formatter||"DateString"):r&&-1!==(r.properties||[]).indexOf(B)?c(B,this.obj,r.formatter||"NumberFormat"):a(this.obj[B])}));k=[];
var v;k.push('\x3ctable class\x3d"esri-widget__table" summary\x3d"'+f.fieldsSummary+'"\x3e\x3ctbody\x3e');for(v in e)if(w=e[v],u&&-1!==(u.properties||[]).indexOf(v)?w=c(v,e,u.formatter||"DateString"):r&&-1!==(r.properties||[]).indexOf(v)&&(w=c(v,e,r.formatter||"NumberFormat")),k.push("\x3ctr\x3e\x3cth\x3e"+v+"\x3c/th\x3e\x3ctd\x3e"+a(w)+"\x3c/td\x3e\x3c/tr\x3e"),q)break;k.push("\x3c/tbody\x3e\x3c/table\x3e");return k.join("")},filter:function(e,k,w){k=[p.isString(e)?e.split(""):e,w||t.global,p.isString(k)?
new Function("item","index","array",k):k];w={};var q;e=k[0];for(q in e)k[2].call(k[q],e[q],q,e)&&(w[q]=e[q]);return w},startsWith:function(e,k,w){w=w||0;return e.indexOf(k,w)===w},endsWith:function(e,k,w){if("number"!==typeof w||!isFinite(w)||Math.floor(w)!==w||w>e.length)w=e.length;w-=k.length;e=e.indexOf(k,w);return-1!==e&&e===w},isDefined:d,fixJson:l,clone:h}})},"esri/layers/vectorTiles/core/Message":function(){define(["require","exports","dojo/string"],function(t,p,x){return function(){function b(m,
f,d){this instanceof b&&(this.name=m,this.message=f&&x.substitute(f,d,function(a){return null==a?"":a})||"",this.details=d)}b.prototype.toString=function(){return"["+this.name+"]: "+this.message};return b}()})},"esri/layers/vectorTiles/core/workers/Connection":function(){define(["require","exports","../promiseUtils"],function(t,p,x){return function(){function b(m){this._clientIdx=0;this._clients=m}b.prototype.broadcast=function(m,f,d){for(var a=[],c=0,l=this._clients;c<l.length;c++)a.push(l[c].invoke(m,
f,d));return a};b.prototype.close=function(){for(var m=0,f=this._clients;m<f.length;m++)f[m].close();this._clients=[]};b.prototype.invoke=function(m,f,d,a){var c=a&&a.client;if(!this._clients||!this._clients.length)return x.reject(Error("Connection closed"));null!=c&&-1!==this._clients.indexOf(c)||this._clients.some(function(l){return l.isBusy()?!1:(c=l,!0)})||(this._clientIdx=(this._clientIdx+1)%this._clients.length,c=this._clients[this._clientIdx]);m=c.invoke(m,f,d);a&&(a.client=c);return m};b.prototype.openPorts=
function(){return x.all(this._clients.map(function(m){return m.openPort()}))};return b}()})},"esri/layers/vectorTiles/core/workers/RemoteClient":function(){define("require exports dojo/Deferred ../Error ../promiseUtils ./utils".split(" "),function(t,p,x,b,m,f){function d(e,k){e["delete"](k)}var a=f.MessageType.CLOSE,c=f.MessageType.CANCEL,l=f.MessageType.INVOKE,h=f.MessageType.RESPONSE,n=f.MessageType.OPEN_PORT,g=function(){function e(k){this._timer=null;this._cancelledJobIds=new Set;this._invokeMessages=
[];this._invoke=k;this._timer=null;this._process=this._process.bind(this)}e.prototype.push=function(k){k.type===f.MessageType.CANCEL?this._cancelledJobIds.add(k.jobId):(this._invokeMessages.push(k),null===this._timer&&(this._timer=setTimeout(this._process,0)))};e.prototype.clear=function(){this._invokeMessages.length=0;this._cancelledJobIds.clear();this._timer=null};e.prototype._process=function(){this._timer=null;for(var k=0,w=this._invokeMessages;k<w.length;k++){var q=w[k];this._cancelledJobIds.has(q.jobId)||
this._invoke(q)}this._cancelledJobIds.clear();this._invokeMessages.length=0};return e}();return function(){function e(k,w,q){this._outJobs=new Map;this._inJobs=new Map;this._queue=new g(this._onInvoke.bind(this));this._onMessage=this._onMessage.bind(this);this._client=w;this._port=k;this._port.addEventListener("message",this._onMessage);this._port.start();this._channel=q}e.connect=function(k){var w=new MessageChannel;k="function"===typeof k?new k:"default"in k&&"function"===typeof k["default"]?new k["default"]:
k;k.remoteClient=new e(w.port1,k,w);return w.port2};e.prototype.close=function(){this._post({type:a});this._close()};e.prototype.isBusy=function(){return 0<this._outJobs.size};e.prototype.invoke=function(k,w,q){var u=this;if(!this._port)return m.reject(new b("remote-client:port-closed","Can't invoke(), port is closed"));var r=f.newJobId(),v=new x(function(){d(u._outJobs,r);u._post({type:c,jobId:r})});this._outJobs.set(r,v);this._post({type:l,jobId:r,methodName:k},w,q);return v.promise};e.prototype.openPort=
function(){var k=this,w=f.newJobId(),q=new x(function(){d(k._outJobs,w);k._post({type:c,jobId:w})});this._outJobs.set(w,q);this._post({type:n,jobId:w});return q.promise};e.prototype._close=function(){this._channel&&(this._channel=null);this._port.removeEventListener("message",this._onMessage);this._port.close();this._outJobs.forEach(function(k){k.cancel()});this._inJobs.clear();this._outJobs.clear();this._queue.clear();this._port=this._client=null};e.prototype._onMessage=function(k){if(k=f.receiveMessage(k))switch(k.type){case h:this._onResponse(k);
break;case l:this._queue.push(k);break;case c:this._onCancel(k);break;case a:this._close();break;case n:this._onOpenPort(k)}};e.prototype._onCancel=function(k){var w=this._inJobs,q=k.jobId,u=w.get(q);this._queue.push(k);u&&(d(w,q),u.cancel())};e.prototype._onInvoke=function(k){var w=this,q=k.methodName,u=k.jobId;k=k.data;var r=this._inJobs,v=this._client,z=v[q];try{if(!z&&q&&-1!==q.indexOf("."))for(var B=q.split("."),A=0;A<B.length-1;A++)v=v[B[A]],z=v[B[A+1]];if("function"!==typeof z)throw new TypeError(q+
" is not a function");var y=z.call(v,k,this)}catch(D){this._post({type:h,jobId:u,error:f.toInvokeError(D)});return}m.isThenable(y)?(r.set(u,y),y.then(function(D){r.has(u)&&(d(r,u),w._post({type:h,jobId:u},D))})["catch"](function(D){r.has(u)&&(d(r,u),D&&"cancel"===D.dojoType||w._post({type:h,jobId:u,error:f.toInvokeError(D||{message:"Error encountered at method "+q})}))})):this._post({type:h,jobId:u},y)};e.prototype._onOpenPort=function(k){var w=new MessageChannel;new e(w.port1,this._client);this._post({type:h,
jobId:k.jobId},w.port2,[w.port2])};e.prototype._onResponse=function(k){var w=k.jobId,q=k.error;k=k.data;var u=this._outJobs;if(u.has(w)){var r=u.get(w);d(u,w);q?r.reject(b.fromJSON(JSON.parse(q))):r.resolve(k)}};e.prototype._post=function(k,w,q){return f.postMessage(this._port,k,w,q)};return e}()})},"esri/layers/vectorTiles/core/workers/utils":function(){define(["require","exports","dojo/has"],function(t,p,x){function b(f){return f&&"object"===typeof f&&("result"in f||"transferList"in f)}Object.defineProperty(p,
"__esModule",{value:!0});(function(f){f[f.HANDSHAKE=0]="HANDSHAKE";f[f.CONFIGURE=1]="CONFIGURE";f[f.CONFIGURED=2]="CONFIGURED";f[f.OPEN=3]="OPEN";f[f.OPENED=4]="OPENED";f[f.RESPONSE=5]="RESPONSE";f[f.INVOKE=6]="INVOKE";f[f.CANCEL=7]="CANCEL";f[f.CLOSE=8]="CLOSE";f[f.OPEN_PORT=9]="OPEN_PORT"})(p.MessageType||(p.MessageType={}));var m=0;p.newJobId=function(){return m++};p.isTranferableResult=b;p.toInvokeError=function(f){return f?f.toJSON?JSON.stringify(f):JSON.stringify({name:f.name,message:f.message,
details:f.details,stack:f.stack}):null};p.postMessage=function(f,d,a,c){2===arguments.length||void 0===a&&void 0===c?f.postMessage(d):(x("esri-workers-supports-transfer-arraybuffer")||(c?(c=c.filter(function(l){return!(l instanceof ArrayBuffer)}),c.length||(c=null)):b(a)&&a.transferList&&(a.transferList=a.transferList.filter(function(l){return!(l instanceof ArrayBuffer)}),a.transferList.length||(a.transferList=null))),c?(d.data=a,f.postMessage(d,c)):b(a)?(d.data=a.result,a.transferList?f.postMessage(d,
a.transferList):f.postMessage(d)):(d.data=a,f.postMessage(d)))};p.receiveMessage=function(f){return f?(f=f.data)?"string"===typeof f?JSON.parse(f):f:null:null}})},"esri/layers/vectorTiles/core/workers/WorkerOwner":function(){define("require exports dojo/Deferred ../../kernel ../Error ../Logger ../promiseUtils ./utils ./workerFactory".split(" "),function(t,p,x,b,m,f,d,a,c){var l=f.getLogger("esri.core.workers"),h=a.MessageType.CANCEL,n=a.MessageType.INVOKE,g=a.MessageType.OPEN,e=a.MessageType.OPENED,
k=a.MessageType.RESPONSE;return function(){function w(q,u){this._outJobs=new Map;this._inJobs=new Map;this.worker=q;this.id=u;q.addEventListener("message",this._onMessage.bind(this));q.addEventListener("error",function(r){r.preventDefault();l.error(r)})}w.create=function(q){return c.createWorker().then(function(u){return new w(u,q)})};w.prototype.terminate=function(){this.worker.terminate()};w.prototype.open=function(q){var u=this,r=a.newJobId(),v=new x(function(z){u._outJobs["delete"](r);u._post({type:h,
jobId:r})});this._outJobs.set(r,v);this._post({type:g,jobId:r,modulePath:q});return v.promise};w.prototype._onMessage=function(q){if(q=a.receiveMessage(q))switch(q.type){case e:case k:this._onResponse(q);break;case h:this._onCancel(q);break;case n:this._onInvoke(q)}};w.prototype._onCancel=function(q){(q=this._inJobs.get(q.jobId))&&q.cancel()};w.prototype._onInvoke=function(q){var u=this,r=q.methodName,v=q.jobId;q=q.data;var z=this._inJobs,B=b.workerMessages[r];try{if("function"!==typeof B)throw new TypeError(r+
" is not a function");var A=B.call(null,q)}catch(y){this._post({type:k,jobId:v,error:a.toInvokeError(y)});return}d.isThenable(A)?(z.set(v,A),A.then(function(y){z["delete"](v);u._post({type:k,jobId:v},y)})["catch"](function(y){z["delete"](v);y||(y={message:"Error encountered at method"+r});y.dojoType&&"cancel"===y.dojoType||u._post({type:k,jobId:v,error:a.toInvokeError(y)})})):this._post({type:k,jobId:v},A)};w.prototype._onResponse=function(q){var u=q.jobId,r=q.error;q=q.data;var v=this._outJobs.get(u);
v&&(this._outJobs["delete"](u),r?v.reject(m.fromJSON(JSON.parse(r))):v.resolve(q))};w.prototype._post=function(q,u,r){return a.postMessage(this.worker,q,u,r)};return w}()})},"esri/layers/vectorTiles/kernel":function(){define(["require","exports","esri/kernel","./identity/IdentityManager"],function(t,p,x,b){return function(){function m(){}Object.defineProperty(m,"id",{get:function(){return x.id?b:null},enumerable:!0,configurable:!0});m.workerMessages={};return m}()})},"esri/layers/vectorTiles/identity/IdentityManager":function(){define(["require",
"exports","esri/IdentityManager"],function(t,p,x){Object.defineProperty(p,"__esModule",{value:!0});p.findCredential=function(b){return x.findCredential(b)}})},"esri/layers/vectorTiles/core/workers/workerFactory":function(){define("require exports ../tsSupport/assignHelper dojo/_base/kernel ../../config ../../request ../Logger ../promiseUtils ../sniff ../urlUtils ./loaderConfig ./utils ./WorkerFallback".split(" "),function(t,p,x,b,m,f,d,a,c,l,h,n,g){function e(B){return a.create(function(A){function y(G){if(G=
n.receiveMessage(G))switch(G.type){case z:G=B;var E=m.workers.loaderUrl||h.DEFAULT_LOADER_URL;if(null!=m["default"]){var F=x({},m);delete F["default"];F=JSON.parse(JSON.stringify(F))}else F=JSON.parse(JSON.stringify(m));var I=m.workers.loaderConfig;I=h["default"]({baseUrl:I.baseUrl,locale:b.locale,has:x({"config-deferredInstrumentation":0,"dojo-test-sniff":0,"esri-cors":1,"esri-secure-context":c("esri-secure-context"),"esri-workers-supports-transfer-arraybuffer":c("esri-workers-supports-transfer-arraybuffer"),
"events-keypress-typed":0,"host-webworker":1},I.has),map:x({},I.map),paths:x({},I.paths),packages:I.packages||[]});G.postMessage({type:v,configure:{esriConfig:F,loaderUrl:E,loaderConfig:I}});break;case r:B.removeEventListener("message",y),B.removeEventListener("error",D),A(B)}}function D(G){G.preventDefault();B.removeEventListener("message",y);B.removeEventListener("error",D);q.warn("Failed to create Worker. Fallback to execute module in main thread",G);B=new g;B.addEventListener("message",y);B.addEventListener("error",
D)}B.addEventListener("message",y);B.addEventListener("error",D)})}Object.defineProperty(p,"__esModule",{value:!0});var k=l.normalize(t.toUrl("./worker.js")),w=!l.hasSameOrigin(k,location.href),q=d.getLogger("esri.core.workers"),u=null,r=n.MessageType.CONFIGURED,v=n.MessageType.CONFIGURE,z=n.MessageType.HANDSHAKE;p.createWorker=function(){if(!c("esri-workers"))return e(new g);if(!w){var B=void 0;try{B=new Worker(k)}catch(A){q.warn("Failed to create Worker. Fallback to execute module in main thread",
event),B=new g}return e(B)}u||(u=f(k,{responseType:"text"}));return u.then(function(A){return new Worker(URL.createObjectURL(new Blob([A.data],{type:"text/javascript"})))})["catch"](function(A){q.warn("Failed to create Worker. Fallback to execute module in main thread",A);return new g}).then(function(A){return e(A)})}})},"esri/layers/vectorTiles/core/tsSupport/assignHelper":function(){define([],function(){return Object.assign||function(t){for(var p,x=1,b=arguments.length;x<b;x++){p=arguments[x];for(var m in p)Object.prototype.hasOwnProperty.call(p,
m)&&(t[m]=p[m])}return t}})},"esri/layers/vectorTiles/config":function(){define(["require","exports","esri/config"],function(t,p,x){Object.defineProperty(x,"workers",{get:function(){return x.defaults.workers},set:function(b){return x.defaults.workers=b}});return x})},"esri/layers/vectorTiles/request":function(){define(["require","exports","esri/request","dojo/_base/lang","dojo/Deferred"],function(t,p,x,b,m){return function(f,d){var a=b.mixin({},{url:f,failOk:!0},d);"array-buffer"===d.responseType?
(a.handleAs="arraybuffer",delete a.responseType):d.responseType&&(a.handleAs=d.responseType,delete a.responseType);null!==d.query&&(a.content=a.query,delete a.query);if(d.hasOwnProperty("allowImageDataAccess")){var c={allowImageDataAccess:d.allowImageDataAccess};delete a.allowImageDataAccess}var l=new m(function(){h.isFulfilled()||h.cancel()});var h=x(a,c).then(function(n){l.resolve({data:n})})["catch"](function(n){n&&null!=n.httpCode&&(n.details=n.details||{},n.details.httpStatus=n.httpCode);l.reject(n)});
return l.promise}})},"esri/layers/vectorTiles/core/sniff":function(){define(["require","exports","dojo/sniff","./global","../views/webgl/context-util"],function(t,p,x,b,m){function f(){var l={available:!1,version:0,majorPerformanceCaveat:!1,supportsHighPrecisionFragment:!1,supportsVertexShaderSamplers:!1,supportsElementIndexUint:!1,supportsStandardDerivatives:!1},h=document.createElement("canvas");if(!h)return l;var n=m.createContext(h,{failIfMajorPerformanceCaveat:!0},"webgl");!n&&(n=m.createContext(h,
{},"webgl"))&&(l.majorPerformanceCaveat=!0);if(!n)return l;h=n.getParameter(n.VERSION);if(!h)return l;if(h=h.match(/^WebGL\s+([\d.]*)/))l.version=parseFloat(h[1]),l.available=.94<=l.version,h=n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT),l.supportsHighPrecisionFragment=h&&0<h.precision,l.supportsVertexShaderSamplers=0<n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),l.supportsElementIndexUint=null!==n.getExtension("OES_element_index_uint"),l.supportsStandardDerivatives=null!==n.getExtension("OES_standard_derivatives");
return l}function d(){var l={available:!1,version:0},h=document.createElement("canvas");if(!h)return l;h=m.createContext(h,{},"webgl2");if(!h)return l;l.available=!0;h=h.getParameter(h.VERSION);if(!h)return l;if(h=h.match(/^WebGL\s+([\d.]*)/))l.version=parseFloat(h[1]);return l}(function(){var l=navigator.userAgent,h=l.match(/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i);l=l.match(/iPhone/i);h&&x.add("esri-mobile",h);l&&x.add("esri-iPhone",l);x.add("esri-phonegap",!!b.cordova);
x.add("esri-cors",x("esri-phonegap")||"XMLHttpRequest"in b&&"withCredentials"in new XMLHttpRequest);x.add("esri-geolocation",function(){return!!navigator.geolocation});x.add("esri-canvas-svg-support",function(){return!(x("trident")||x("ie"))});x.add("esri-secure-context",function(){if("isSecureContext"in b)return b.isSecureContext;if(b.location&&b.location.origin)return 0===b.location.origin.indexOf("https:")});x.add("esri-wasm","WebAssembly"in b);x("host-webworker")||(x.add("esri-workers","Worker"in
b),x.add("esri-script-sandbox",function(){return"MessageChannel"in b&&"HTMLIFrameElement"in b&&"sandbox"in HTMLIFrameElement.prototype}),x.add("esri-url-encodes-apostrophe",function(){var n=b.document.createElement("a");n.href="?'";return-1<n.href.indexOf("?%27")}),a||(a=f()),x.add("esri-webgl",a.available),x.add("esri-webgl-high-precision-fragment",a.supportsHighPrecisionFragment),x.add("esri-webgl-vertex-shader-samplers",a.supportsVertexShaderSamplers),x.add("esri-webgl-element-index-uint",a.supportsElementIndexUint),
x.add("esri-webgl-standard-derivatives",a.supportsStandardDerivatives),x.add("esri-webgl-major-performance-caveat",a.majorPerformanceCaveat),x.add("esri-featurelayer-webgl-labeling",!0),c||(c=d()),x.add("esri-webgl2",c.available))})();var a=null,c=null;return x})},"esri/layers/vectorTiles/core/global":function(){define(["require","exports"],function(t,p){return function(){if("undefined"!==typeof global)return global;if("undefined"!==typeof window)return window;if("undefined"!==typeof self)return self}()})},
"esri/layers/vectorTiles/views/webgl/context-util":function(){define(["require","exports"],function(t,p){function x(d,a,c){void 0===a&&(a={});switch(c){case "webgl":var l=["webgl","experimental-webgl","webkit-3d","moz-webgl"];break;case "webgl2":l=["webgl2"];break;default:l=["webgl","experimental-webgl","webkit-3d","moz-webgl"]}c=null;for(var h=0;h<l.length;h++){var n=l[h];try{c=d.getContext(n,a)}catch(g){}if(c)break}return c}function b(d,a){var c=d.parentNode;c&&(c.innerHTML='\x3ctable style\x3d"background-color: #8CE; width: 100%; height: 100%;"\x3e\x3ctr\x3e\x3ctd align\x3d"center"\x3e\x3cdiv style\x3d"display: table-cell; vertical-align: middle;"\x3e\x3cdiv style\x3d""\x3e'+
a+"\x3c/div\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e")}Object.defineProperty(p,"__esModule",{value:!0});p.createContextOrErrorHTML=function(d,a,c){void 0===a&&(a={});if(!window.WebGLRenderingContext)return b(d,m),null;a=x(d,a,c);return a?a:(b(d,f),null)};p.createContext=x;var m='This page requires a browser that supports WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org"\x3eClick here to upgrade your browser.\x3c/a\x3e',f='It doesn\'t appear your computer can support WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org/troubleshooting/"\x3eClick here for more information.\x3c/a\x3e'})},
"esri/layers/vectorTiles/core/urlUtils":function(){define(["require","exports","esri/urlUtils","dojo/_base/url"],function(t,p,x,b){function m(v){return x.normalize(v)}function f(v){return"data:"===v.slice(0,5)}function d(v){return a(v)||u.test(v)}function a(v){return v&&"/"===v[0]&&"/"===v[1]}function c(v){return x.urlToObject(v)}function l(v){if("string"===typeof v)return new b(n(v));v.scheme||(v.scheme=p.appUrl.scheme);return v}function h(v){if(f(v))return null;var z=v.indexOf("://");if(-1===z&&
a(v))z=2;else if(-1!==z)z+=3;else return null;z=v.indexOf("/",z);return-1===z?v:v.slice(0,z)}function n(v,z,B){void 0===z&&(z=p.appBaseUrl);if(a(v))return B&&B.preserveProtocolRelative?v:"http"===p.appUrl.scheme&&p.appUrl.authority===h(v).slice(2)?"http:"+v:"https:"+v;if(u.test(v))return v;"/"===v[0]&&(B=z.indexOf("//"),B=z.indexOf("/",B+2),z=-1===B?z:z.slice(0,B));return e(z,v)}function g(v,z,B){void 0===B&&(B=!1);v=l(v);z=l(z);return B||v.scheme===z.scheme?v.host.toLowerCase()===z.host.toLowerCase()&&
v.port===z.port:!1}function e(){for(var v=[],z=0;z<arguments.length;z++)v[z]=arguments[z];if(v&&v.length){z=[];if(d(v[0])){var B=v[0],A=B.indexOf("//");z.push(B.slice(0,A+1));q.test(v[0])&&(z[0]+="/");v[0]=B.slice(A+2)}else"/"===v[0][0]&&z.push("");v=v.reduce(function(y,D){return D?y.concat(D.split("/")):y},[]);for(B=0;B<v.length;B++)A=v[B],".."===A&&0<z.length?z.pop():!A||"."===A&&0!==z.length||z.push(A);return z.join("/")}}function k(v,z,B){if(!(z&&B&&v&&d(v)))return v;var A=v.indexOf("//"),y=v.indexOf("/",
A+2),D=v.indexOf(":",A+2);y=Math.min(0>y?v.length:y,0>D?v.length:D);if(v.slice(A+2,y).toLowerCase()!==z.toLowerCase())return v;z=v.slice(0,A+2);v=v.slice(y);return""+z+B+v}function w(v,z,B){void 0===z&&(z=p.appBaseUrl);if(!d(v))return v;var A=m(v),y=A.toLowerCase();z=m(z).toLowerCase().replace(/\/+$/,"");if((B=B?m(B).toLowerCase().replace(/\/+$/,""):null)&&0!==z.indexOf(B))return v;for(var D=function(F,I,M){M=F.indexOf(I,M);return-1===M?F.length:M},G=D(y,"/",y.indexOf("//")+2),E=-1;y.slice(0,G+1)===
z.slice(0,G)+"/";){E=G+1;if(G===y.length)break;G=D(y,"/",G+1)}if(-1===E||B&&E<B.length)return v;v=A.slice(E);A=z.slice(E-1).replace(/[^/]+/g,"").length;if(0<A)for(y=0;y<A;y++)v="../"+v;else v="./"+v;return v}Object.defineProperty(p,"__esModule",{value:!0});p.normalize=m;p.canUseXhr=function(v){return x.canUseXhr(v)};p.removeTrailingSlash=function(v){return v.replace(/\/+$/,"")};t=Function("return this")();p.appUrl=new b(t.location);p.appBaseUrl=function(){var v=p.appUrl.path;v=v.substring(0,v.lastIndexOf(v.split("/")[v.split("/").length-
1]));return p.appUrl.scheme+"://"+p.appUrl.host+(null!=p.appUrl.port?":"+p.appUrl.port:"")+v}();var q=/^\s*file:/i,u=/^\s*[a-z][a-z0-9-+.]*:[^0-9]/i;p.isDataProtocol=f;p.isAbsolute=d;p.isProtocolRelative=a;p.urlToObject=c;p.getOrigin=h;p.makeAbsolute=n;p.hasSameOrigin=g;p.join=e;p.removeFile=function(v){var z=0;if(d(v)){var B=v.indexOf("//");-1!==B&&(z=B+2)}B=v.lastIndexOf("/");return B<z?v:v.slice(0,B+1)};p.addProxy=function(v){return x.addProxy(v)};p.makeData=function(v){return v.isBase64?"data:"+
v.mediaType+";base64,"+v.data:"data:"+v.mediaType+","+v.data};var r=/^data:(.*?)(;base64)?,(.*)$/;p.dataComponents=function(v){return(v=v.match(r))?{mediaType:v[1],isBase64:!!v[2],data:v[3]}:null};p.changeDomain=k;p.read=function(v,z){var B=z&&z.url&&z.url.path;v&&B&&(v=n(v,B,{preserveProtocolRelative:!0}));B=v;var A=z&&z.portal;if(A&&!A.isPortal&&A.urlKey&&A.customBaseUrl){var y=A.urlKey+"."+A.customBaseUrl;B=g(p.appUrl,p.appUrl.scheme+"://"+y)?k(B,A.portalHostname,y):k(B,y,A.portalHostname)}return B};
p.write=function(v,z){if(!v)return v;!d(v)&&z&&z.blockedRelativeUrls&&z.blockedRelativeUrls.push(v);var B=n(v);if(z){var A=z.verifyItemRelativeUrls&&z.verifyItemRelativeUrls.rootPath||z.url&&z.url.path;A&&(B=w(B,A,A),B!==v&&z.verifyItemRelativeUrls&&z.verifyItemRelativeUrls.writtenUrls.push(B))}B=(A=z&&z.portal)&&!A.isPortal&&A.urlKey&&A.customBaseUrl?k(B,A.urlKey+"."+A.customBaseUrl,A.portalHostname):B;return B};p.makeRelative=w;p.removeQueryParameters=function(v){v=c(v);Object.keys(v.query||{});
return v.path}})},"esri/layers/vectorTiles/core/workers/loaderConfig":function(){define(["require","exports","../tsSupport/assignHelper","dojo/has","../urlUtils"],function(t,p,x,b,m){Object.defineProperty(p,"__esModule",{value:!0});p.DEFAULT_LOADER_URL=m.makeAbsolute(m.removeQueryParameters(t.toUrl("./worker-init.js")));p.DEFAULT_CONFIG={baseUrl:function(){var f=m.removeQueryParameters(t.toUrl("dojo/x.js"));return m.makeAbsolute(f.slice(0,f.length-5))}(),packages:[{name:"esri"},{name:"dojo"},{name:"dojox"},
{name:"dstore"},{name:"moment",main:"moment"},{name:"@dojo"},{name:"cldrjs",main:"dist/cldr"},{name:"globalize",main:"dist/globalize"},{name:"maquette",main:"dist/maquette.umd"},{name:"maquette-css-transitions",main:"dist/maquette-css-transitions.umd"},{name:"maquette-jsx",main:"dist/maquette-jsx.umd"},{name:"tslib",main:"tslib"}],map:{globalize:{cldr:"cldrjs/dist/cldr","cldr/event":"cldrjs/dist/cldr/event","cldr/supplemental":"cldrjs/dist/cldr/supplemental","cldr/unresolved":"cldrjs/dist/cldr/unresolved"}}};
p["default"]=function(f){var d={async:f.async,isDebug:f.isDebug,locale:f.locale,baseUrl:f.baseUrl,has:x({},f.has),map:x({},f.map),packages:f.packages&&f.packages.concat()||[],paths:x({},f.paths)};f.hasOwnProperty("async")||(d.async=!0);f.hasOwnProperty("isDebug")||(d.isDebug=!1);f.baseUrl||(d.baseUrl=p.DEFAULT_CONFIG.baseUrl);p.DEFAULT_CONFIG.packages.forEach(function(h){a:{for(var n=d.packages,g=0;g<n.length;g++)if(n[g].name===h.name)break a;h=x({},h);g=m.removeQueryParameters(t.toUrl(h.name+"/x.js"));
g=g.slice(0,g.length-5);h.location=m.makeAbsolute(g);n.push(h)}});f=d.map=d.map||{};for(var a=0,c=Object.keys(p.DEFAULT_CONFIG.map);a<c.length;a++){var l=c[a];f[l]||(f[l]=p.DEFAULT_CONFIG.map[l])}return d}})},"esri/layers/vectorTiles/core/workers/WorkerFallback":function(){define(["require","exports","dojo/has","../global","./utils"],function(t,p,x,b,m){var f=function(){return function(){var c=this,l=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(function(h){c[h]=
function(){for(var n=[],g=0;g<arguments.length;g++)n[g]=arguments[g];return l[h].apply(l,n)}})}}(),d=b.MutationObserver||b.WebKitMutationObserver,a=function(){if(b.process&&b.process.nextTick)var c=function(n){b.process.nextTick(n)};else if(b.Promise)c=function(n){b.Promise.resolve().then(n)};else if(d){var l=[],h=document.createElement("div");(new d(function(){for(;0<l.length;)l.shift()()})).observe(h,{attributes:!0});c=function(n){l.push(n);h.setAttribute("queueStatus","1")}}return c}();return function(){function c(){this._dispatcher=
new f;this._isInitialized=!1;this._workerPostMessage({type:m.MessageType.HANDSHAKE})}c.prototype.terminate=function(){};Object.defineProperty(c.prototype,"onmessage",{get:function(){return this._onmessageHandler},set:function(l){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler);(this._onmessageHandler=l)&&this.addEventListener("message",l)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"onerror",{get:function(){return this._onerrorHandler},set:function(l){this._onerrorHandler&&
this.removeEventListener("error",this._onerrorHandler);(this._onerrorHandler=l)&&this.addEventListener("error",l)},enumerable:!0,configurable:!0});c.prototype.postMessage=function(l,h){var n=this;a(function(){n._workerMessageHandler(new MessageEvent("message",{data:l}))})};c.prototype.dispatchEvent=function(l){return this._dispatcher.dispatchEvent(l)};c.prototype.addEventListener=function(l,h,n){this._dispatcher.addEventListener(l,h,n)};c.prototype.removeEventListener=function(l,h,n){this._dispatcher.removeEventListener(l,
h,n)};c.prototype._workerPostMessage=function(l,h){var n=this;a(function(){n.dispatchEvent(new MessageEvent("message",{data:l}))})};c.prototype._workerMessageHandler=function(l){var h=this;if(l=m.receiveMessage(l)){var n=l.jobId;switch(l.type){case m.MessageType.CONFIGURE:this._isInitialized||this._workerPostMessage({type:m.MessageType.CONFIGURED});break;case m.MessageType.OPEN:l=l.modulePath,x("esri-webpack")?t(["esri/core/workers/RemoteClient","esri/views/vectorTiles/WorkerTileHandler","esri/views/2d/layers/features/Pipeline",
"esri/views/3d/layers/PointCloudWorker","esri/views/3d/layers/SceneLayerWorker","esri/layers/graphics/sources/support/CSVSourceWorker","esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker",l],function(g,e,k,w,q,u,r,v){switch(v){case "esri/views/vectorTiles/WorkerTileHandler":break;case "esri/views/2d/layers/features/Pipeline":e=k;break;case "esri/views/3d/layers/PointCloudWorker":e=w;break;case "esri/views/3d/layers/SceneLayerWorker":e=q;break;case "esri/layers/graphics/sources/support/CSVSourceWorker":e=
u;break;case "esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker":e=r;break;default:e=v}g=g.connect(e);h._workerPostMessage({type:m.MessageType.OPENED,jobId:n,data:g})}):t(["./RemoteClient",l],function(g,e){var k=g.connect(e);h._workerPostMessage({type:m.MessageType.OPENED,jobId:n,data:k})})}}};return c}()})},"esri/layers/vectorTiles/core/requireUtils":function(){define(["require","exports","dojo/Deferred"],function(t,p,x){function b(m,f){if(Array.isArray(f)){var d=new x;m(f,function(){for(var a=
[],c=0;c<arguments.length;c++)a[c]=arguments[c];d.resolve(a)});return d.promise}return b(m,[f]).then(function(a){return a[0]})}Object.defineProperty(p,"__esModule",{value:!0});p.when=b;p.getAbsMid=function(m,f,d){return f.toAbsMid?f.toAbsMid(m):d.id.replace(/\/[^\/]*$/gi,"/")+m}})},"esri/layers/rasterLib/function/rasterFunctionHelper":function(){define(["dojo/_base/declare","dojo/_base/lang","./rasterFunctionRegistry"],function(t,p,x){return{create:function(b,m){if(b){var f=b.renderTexture,d=Object.keys(b);
if(b.read&&!m)return b;b.read&&m&&(b=b.toJson());-1<d.indexOf("name")&&d.indexOf(!1)?(d=p.mixin({},b),d=this._parseV2(d,m)):(d="esri.layers.RasterFunction"===b.declaredClass?b.toJson():p.mixin({},b),d=this._parseV1(d,m));d.branchCount=d.updateBranchStructure();d.renderTexture||(d.renderTexture=!!f);return d}},_parseV1:function(b,m){var f=b.rasterFunction,d=b.rasterFunctionArguments,a=b.renderTexture||b.rasterFunctionArguments.renderTexture||!1,c,l,h,n,g,e,k;(n=d.raster||d.Raster)&&n.rasterFunction&&
(c=this._parseV1(n,m));(n=d.raster2||d.Raster2)&&n.rasterFunction&&(l=this._parseV1(n,m));(n=d.rasters||d.Rasters)&&0<n.length&&(h=n.map(p.hitch(this,function(w){return w&&w.rasterFunction?this._parseV1(w,m):w})));(n=d.dem||d.DEM)&&(n.functionName||n.rasterFunction)&&(g=this._parseV1(n,m));(n=d.fillRaster||d.FillRaster)&&(n.functionName||n.rasterFunction)&&(e=this._parseV1(n,m));n=x.functions[f];if(!n)return null;f=new n(d);f.variableName&&(n=d[f.variableName])&&(n.functionName||n.rasterFunction)&&
(k=this._parseV1(n,m));b.outputPixelType&&(f.pixelType=b.outputPixelType);"$$"===c?f.functionArguments.raster=m&&m.raster:null!=c?f.functionArguments.raster=c:f.functionArguments.raster||(f.functionArguments.raster=m&&m.raster);null!=l&&(f.functionArguments.raster2=l);null!=h&&(f.functionArguments.rasters=h.map(function(w){"$$"===w&&(w=m&&m.raster);return w}));null!=g&&(f.functionArguments.dem=g);null!=e&&(f.functionArguments.fillRaster=e);null!=k&&(f.functionArguments[f.variableName]=k);f.renderTexture=
a;return f},_parseV2:function(b,m){if(!b)return null;var f=p.clone(b);this._bindV2Args(f,m);var d={};this._convertTov1(f,d);return this._parseV1(d,m)},_bindV2Args:function(b,m){(b||m)&&Object.keys(b).forEach(function(f){b[f]["function"]&&b[f].arguments?this._bindV2Args(b[f].arguments,m):null!=m[b[f].name]&&(b[f].value=m[b[f].name])}.bind(this))},_convertV2Types:function(b){if(!b)return null;"ArgumentArray"===b.type?b.elements&&"RasterStatistics"===b.elements[0].type&&(b=b.elements):b instanceof Array&&
0===b.length&&(b=null);return b},_convertTov1:function(b,m){if((b||m)&&b["function"]){var f=b["function"],d=b.arguments;m.rasterFunction=f.type.replace("Function","");m.outputPixelType="UNKNOWN"===f.pixelType?"Unknown":f.pixelType;m.rasterFunctionArguments={};var a;Object.keys(d).forEach(function(c){d[c]["function"]&&d[c].arguments?(m.rasterFunctionArguments[c]={},this._convertTov1(d[c],m.rasterFunctionArguments[c])):(a=d[c].value,m.rasterFunctionArguments[c]="object"!==typeof a||a.functionArguments?
a:this._convertV2Types(a))}.bind(this))}}}})},"esri/layers/rasterLib/function/rasterFunctionRegistry":function(){define("dojo/_base/declare dojo/_base/lang ../../rasterLib/function/AspectFunction ../../rasterLib/function/BandArithmeticFunction ../../rasterLib/function/ColormapFunction ../../rasterLib/function/CompositeBandFunction ../../rasterLib/function/ContrastBrightnessFunction ../../rasterLib/function/ConvolutionFunction ../../rasterLib/function/ExtractBandFunction ../../rasterLib/function/HillshadeFunction ../../rasterLib/function/LocalFunction ../../rasterLib/function/MaskFunction ../../rasterLib/function/NDVIFunction ../../rasterLib/function/SlopeFunction ../../rasterLib/function/StretchFunction ../../rasterLib/function/RemapFunction ../../rasterLib/function/IdentityFunction ../../rasterLib/function/ResampleFunction".split(" "),
function(t,p,x,b,m,f,d,a,c,l,h,n,g,e,k,w,q,u){return function(){function r(A){A.prototype.supportWebGL&&(z[A.prototype.functionName]=A);A.prototype.support2D&&(v[A.prototype.functionName]=A);B[A.prototype.functionName]=A}var v={},z={},B={};r(x);r(b);r(m);r(f);r(d);r(a);r(c);r(l);r(h);r(n);r(g);r(e);r(k);r(w);r(q);r(u);return{cpu:v,gpu:z,functions:B,register:r,getFunction:function(A){return B[A]},support:function(A,y){return!!("gpu"===y?z:"cpu"===y?v:B)[A]}}}()})},"esri/layers/rasterLib/function/AspectFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../../WKIDUnitConversion ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./surfaceUtils".split(" "),
function(t,p,x,b,m,f,d,a){return t([x,d],{declaredClass:"esri.layers.rasterLib.function.AspectFunction",functionName:"Aspect",supportWebGL:!0,support2D:!0,constructor:function(c){this.functionArguments=this.mixinIgnoreCase({raster:null},c)},bind:function(){var c=this.getSourceRasterInfo();if(!c.raster)return Error("The raster input to aspect function is invalid.");this.rasterInfo=p.mixin(c.raster,{bandCount:1,pixelType:this._calculatePixelType(this.pixelType,"F32"),statistics:[{min:0,max:360}],histograms:null});
this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(c){this._performance.start();c=a.aspect(c.raster);this._addPerformanceMetric(this._performance.elapsed());return c},readGL:function(c){this._performance.start();this._initializeProgram({fragment:f.aspect,fragmentName:"Aspect"});var l=this._setupTextureData(c.raster),h=this.bindFrameBuffer(),n=this.gl,g=n.drawingBufferWidth;n=n.drawingBufferHeight;var e=l.extent;
this._setUniforms({u_resolution:c&&c.raster&&c.raster.pixelBlock?[1/c.raster.pixelBlock.width,1/c.raster.pixelBlock.height]:[1/g,1/n],u_cellSize:[(e.xmax-e.xmin)/g,(e.ymax-e.ymin)/n]});this._bindTexture(l.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:l.extent,texture:h.texture}}})})},"esri/layers/rasterLib/function/RasterFunctionX":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/config ../raster/RasterInfo ../../../geometry/Extent ../../PixelBlock".split(" "),
function(t,p,x,b,m,f){return t(null,{functionName:null,functionArguments:null,pixelType:"Unknown",rasterInfo:null,constructor:function(d){d&&(this.pixelType=d.outputPixelType||d.OutputPixelType||this.pixelType,this.renderTexture=d.renderTexture,this._initFunction())},mixinIgnoreCase:function(d,a){var c=Object.keys(d),l=Object.keys(a),h,n,g=c.length;for(h=0;h<l.length;h++){var e=a[l[h]];if(null!=e)for(n=0;n<g;n++)if(c[n].toLowerCase()===l[h].toLowerCase()){d[c[n]]=e;break}}return d},bind:function(d){},
setProcessingContext:function(d){if(!d)throw"cannot bind to layer without options";this.useWebGL=!!d.useWebGL;this._tileMode=!!d.tileMode;this._glSetting=d.glSetting;this._rawRasterInfo=d.rawRasterInfo;this._xformSetting=d.xformSetting||this._xformSetting;if(!this.useWebGL||this._glSetting&&this._glSetting.gl){this.gl=this.useWebGL?this._glSetting.gl:null;this._glSetting&&(this._glSetting.pingpong=null,this._glSetting.branches=null);var a=this.functionArguments.raster,c=this.functionArguments.raster2,
l=this.functionArguments.dem,h=this.functionArguments.fillRaster,n=this.functionArguments.rasters;a&&a.functionArguments&&a.setProcessingContext(d);c&&c.functionArguments&&c.setProcessingContext(d);l&&l.functionArguments&&l.setProcessingContext(d);h&&h.functionArguments&&h.setProcessingContext(d);if(n)for(a=0;a<n.length;a++)n[a]&&n[a].functionArguments&&n[a].setProcessingContext(d);this.bind()}},updateBranchStructure:function(){var d=0,a=this.functionArguments;a.raster&&a.raster.read&&a.raster.functionArguments&&
(d+=a.raster.updateBranchStructure());a.raster2&&a.raster2.read&&a.raster2.functionArguments&&(d+=a.raster2.updateBranchStructure(),a.raster2.isBranch=!0,a.raster&&a.raster.read&&(a.raster.isBranch=!0));a.rasters&&(d=a.rasters.length,a.rasters.forEach(function(c){c.read&&c.functionArguments&&(c.isBranch=!0)}));a.dem&&a.dem.read&&a.dem.functionArguments&&(d+=a.dem.updateBranchStructure());return 1===d?0:d},read:function(d){d=this.processRasterArgument(d);return this.useWebGL?this.readGL(d):this.read2D(d)},
hasTilingEffects:function(){return!1},read2D:function(){},readGL:function(){},getSourceRasterInfo:function(){var d,a={};if(this.functionArguments.raster2)a.functionArguments.raster=this._bindRaster(this.functionArguments.raster),a.functionArguments.raster2=this._bindRaster(this.functionArguments.raster2);else if(this.functionArguments.rasters)for(a.rasters=[],d=0;d<this.functionArguments.rasters.length;d++)a.rasters[d]=this._bindRaster(this.functionArguments.rasters[d]);else a.raster=this._bindRaster(this.functionArguments.raster);
return this.sourceRasterInfo=a},processRasterArgument:function(d){var a=this.bind();if(!0!==a)throw a;var c={};if(this.functionArguments.raster2)c.raster=this._readRaster(this.functionArguments.raster,d),c.raster2=this._readRaster(this.functionArguments.raster2,d);else if(this.functionArguments.rasters)for(c.rasters=[],a=0;a<this.functionArguments.rasters.length;a++)c.rasters[a]=this._readRaster(this.functionArguments.rasters[a],d);else c.raster=this._readRaster(this.functionArguments.raster,d);return c},
toJson:function(){var d=this.functionArguments,a=d.raster,c=d.raster2;d=d.rasters;a=a?a.toJson?a.toJson():a:null;c=c?c.toJson?c.toJson():c:null;var l;d&&0<d.length&&(l=d.map(function(h){return h.toJson?h.toJson():h}));d=p.mixin({},this.functionArguments);d.raster=a;d.raster2=c;d.rasters=l;d=this._fixRasterFunctionJson(d);return{rasterFunction:this.functionName,rasterFunctionArguments:d,outputPixelType:this.pixelType}},_initFunction:function(d){},_getIntegerRange:function(d){switch(d){case "U8":var a=
[0,255];break;case "U16":a=[0,65535];break;case "U32":a=[0,4294967295];break;case "S8":a=[-128,127];break;case "S16":a=[-32768,32767];break;case "S32":a=[-2147483648,2147483647]}return a},_calculatePixelType:function(d,a){return d&&"unknown"!==d.toLowerCase()?d:a},_clonePixelData:function(d){if(null==d)return d;var a={};d.extent&&(a.extent=new m(d.extent.xmin,d.extent.ymin,d.extent.xmax,d.extent.ymax,d.extent.spatialReference));d=d.pixelBlock;if(null==d)return a;a.pixelBlock=d.clone?d.clone():f.prototype.clone(d);
return a},_readRaster:function(d,a){if(null==d||"$$"===d)var c=this._clonePixelData(a.src[Object.keys(a.src)[0]]);else if(d&&d.rasterInfo&&!d.functionArguments)c=this._clonePixelData(a.src[d._rasterId]);else if(isNaN(d))d.read&&(c=d.functionArguments?d.read(a):this._clonePixelData(a));else{c=a.src?a.src[Object.keys(a.src)[0]]:a;var l=c.pixelBlock;l=new Float32Array(l.width*l.height);l.fill(parseFloat(d));c=this._clonePixelData(c);c.pixelBlock.pixels=[l];c.isConstant=!0}return c},_bindRaster:function(d){if(d&&
"$$"!==d)isNaN(d)?d.rasterInfo?a=d.rasterInfo:d.bind&&d.bind()&&(a=d.rasterInfo):a={};else var a=this._rawRasterInfo;a&&(a=a.clone?a.clone():new b(a),a.bandCount=a.bandCount||3);return a},_getOutputBand:function(d,a){switch(d){case "U8":var c=new Uint8Array(a);break;case "U16":c=new Uint16Array(a);break;case "U32":c=new Uint32Array(a);break;case "S8":c=new Int8Array(a);break;case "S16":c=new Int16Array(a);break;case "S32":c=new Int32Array(a);break;case "U32":c=new Uint32Array(a);break;case "F32":c=
new Float32Array(a);break;case "F64":c=new Float64Array(a);break;default:c=new Float32Array(a)}return c},_clampBand:function(d,a,c){if(("F64"===a||"F32"===a)&&!c)return d;var l,h=this._getIntegerRange(a),n=d.length;if(h)for(c=h[1],h=h[0],a=this._getOutputBand(a,n),l=0;l<n;l++){var g=d[l];a[l]=g>c?c:g<h?h:g}else a=d;return a},_performance:{start:function(){return this._start=self.performance&&self.performance.now()||new Date}.bind(this),elapsed:function(){return(self.performance&&self.performance.now()||
new Date)-this._start}.bind(this)},_addPerformanceMetric:function(d){x.isDebug&&(self.rasterFunctionPerformance||(self.rasterFunctionPerformance=[]),self.rasterFunctionPerformance.push(d),50<self.rasterFunctionPerformance.length&&self.rasterFunctionPerformance.shift())},_fixRasterFunctionJson:function(d){for(var a in d)d.hasOwnProperty(a)&&(null==d[a]?delete d[a]:d[a]instanceof Object&&!d[a].sourceType&&this._fixRasterFunctionJson(d[a],!0));return d}})})},"esri/layers/rasterLib/function/pixelShaders":function(){define(["dojo/_base/declare",
"dojo/_base/lang","./pixelShaderScripts"],function(t,p,x){t={shaderType:"fragment",getShader:function(b,m){var f=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(f,m);b.compileShader(f);b.getShaderParameter(f,b.COMPILE_STATUS)||(f=null);return f}};p.mixin(t,x);return t})},"esri/layers/rasterLib/function/pixelShaderScripts":function(){define([],function(){return{aspect:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform vec2 u_cellSize;\nfloat getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\nif (a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0) {\nreturn 0.0;\n}\nelse {\nreturn e;\n}\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nfloat pi \x3d 3.141592653589793238;\nfloat dz_dx \x3d 0.0;\nfloat dz_dy \x3d 0.0;\nvec4 va, vb, vc,vd,ve,vf,vg,vh,vi;\nvec2 axy \x3d vec2(-1.0,-1.0);\nvec2 bxy \x3d vec2(0.0, -1.0);\nvec2 cxy \x3d vec2(1.0, -1.0);\nvec2 dxy \x3d vec2(-1.0, 0.0);\nvec2 fxy \x3d vec2(1.0, 0.0);\nvec2 gxy \x3d vec2(-1.0, 1.0);\nvec2 hxy \x3d vec2(0.0, 1.0);\nvec2 ixy \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s)\n{\naxy[0] \x3d 1.0;\ndxy[0] \x3d 1.0;\ngxy[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t)\n{\naxy[1] \x3d 1.0;\nbxy[1] \x3d 1.0;\ncxy[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e1.0-u_resolution.s)\n{\ncxy[0] \x3d -1.0;\nfxy[0] \x3d -1.0;\nixy[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0- u_resolution.t)\n{\ngxy[1] \x3d -1.0;\nhxy[1] \x3d -1.0;\nixy[1] \x3d -1.0;\n}\nif (v_texCoord.s \x3e\x3d u_resolution.s \x26\x26 (1.0-u_resolution.s)\x3e\x3dv_texCoord.s \x26\x26 v_texCoord.t \x3e\x3d u_resolution.t \x26\x26 (1.0-u_resolution.t)\x3e\x3dv_texCoord.t)\n{\nva \x3d texture2D(u_image, v_texCoord + u_resolution* axy);\nvb \x3d texture2D(u_image, v_texCoord + u_resolution* bxy);\nvc \x3d texture2D(u_image, v_texCoord + u_resolution* cxy);\nvd \x3d texture2D(u_image, v_texCoord + u_resolution* dxy);\nve \x3d texture2D(u_image, v_texCoord + u_resolution* vec2(0, 0));\nvf \x3d texture2D(u_image, v_texCoord + u_resolution* fxy);\nvg \x3d texture2D(u_image, v_texCoord + u_resolution* gxy);\nvh \x3d texture2D(u_image, v_texCoord + u_resolution* hxy);\nvi \x3d texture2D(u_image, v_texCoord + u_resolution* ixy);\n}\ndz_dx \x3d (vc+2.0*vf+vi - va - 2.0*vd - vg).r/(8.0*u_cellSize[0]);\ndz_dy \x3d -(vg+2.0*vh+vi - va - 2.0*vb - vc).r/(8.0*u_cellSize[1]);\nfloat alpha \x3d getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\nfloat aspect_rad \x3d 0.0;\nif (dz_dx \x3d\x3d 0.0)\n{\nif (dz_dy \x3e 0.0)\naspect_rad \x3d 0.5 * pi;\nelse if (dz_dy \x3c 0.0)\naspect_rad \x3d 1.5 * pi;\nelse\nalpha \x3d 0.0;//undefined make it nodata\n}\nelse\n{\naspect_rad \x3d 0.5*pi + atan(dz_dy, -dz_dx);\nif (aspect_rad \x3c 0.0)\naspect_rad \x3d 2.0*pi + aspect_rad;\n}\nfloat aspect \x3d aspect_rad * 180.0 / pi;\ngl_FragColor \x3d vec4(aspect, aspect, aspect, alpha);\n}",
bandArithmetic:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandId_nir;\nuniform int u_bandId_red;\nuniform bool u_scaled;\nuniform int u_bandCount;\nuniform int u_method;\nuniform float u_constants[6];\nvec4 calculateNDVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat ndvi_denom \x3d nir + red;\nfloat ndvi;\nif (ndvi_denom \x3d\x3d 0.0) {\nndvi \x3d 0.0;\n} else {\nndvi \x3d (nir - red) / ndvi_denom;\nif (u_scaled) {\nndvi \x3d float(floor(ndvi * 100.0 + 100.5));\n}\n}\nreturn vec4(ndvi, ndvi, ndvi, currentPixel.a);\n}\nvec4 calculateSAVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat savi_denom \x3d nir + red + u_constants[0];\nfloat savi;\nif (savi_denom \x3d\x3d 0.0) {\nsavi \x3d 0.0;\n} else {\nsavi \x3d (nir - red) / savi_denom * (1.0 + u_constants[0]);\n}\nreturn vec4(savi, savi, savi, currentPixel.a);\n}\nvec4 calculateMSAVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat msavi \x3d 0.5 * (2.0 * (nir + 1.0) - sqrt(pow((2.0 * nir + 1.0), 2.0) - 8.0 * (nir - red)));\nreturn vec4(msavi, msavi, msavi, currentPixel.a);\n}\nvec4 calculateTSAVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat s \x3d u_constants[0];\nfloat a \x3d u_constants[1];\nfloat x \x3d u_constants[2];\nfloat tsavi_denom \x3d a * nir + red - a * s + x * (1.0 + s * s);\nfloat tsavi;\nif (tsavi_denom \x3d\x3d 0.0) {\ntsavi \x3d 0.0;\n} else {\ntsavi \x3d s * (nir - s * red - a) / tsavi_denom;\n}\nreturn vec4(tsavi, tsavi, tsavi, currentPixel.a);\n}\nvec4 calculatePVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat a \x3d u_constants[0];\nfloat b \x3d u_constants[1];\nfloat pvi \x3d (nir - a * red - b) / sqrt(1.0 + a * 2.0);\nreturn vec4(pvi, pvi, pvi, currentPixel.a);\n}\nvec4 calculateGEMI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat gemi;\nif (red \x3d\x3d 1.0) {\ngemi \x3d 0.0;\n} else {\nfloat eta \x3d (2.0 * (nir * nir - red * red) + 1.5 * nir + 0.5 * red) / (nir + red + 0.5);\nfloat gemi \x3d eta * (1.0 - 0.25*eta) - (red - 0.125) / (1.0 - red);\n}\nreturn vec4(gemi, gemi, gemi, currentPixel.a);\n}\nvec4 calculateVARI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(currentPixel.r);\nfloat green \x3d float(currentPixel.g);\nfloat blue \x3d float(currentPixel.b);\nfloat vari \x3d (green - red) /(green + red - blue);\nreturn vec4(vari, vari, vari, currentPixel.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 pv;\nif (u_method \x3c 4) {\nif (u_method \x3d\x3d 1) {\npv \x3d calculateNDVI();\n} else if (u_method \x3d\x3d 2) {\npv \x3d calculateSAVI();\n} else if (u_method \x3d\x3d 3) {\npv \x3d calculateTSAVI();\n} else if (u_method \x3d\x3d 4) {\npv \x3d calculateMSAVI();\n}\n} else {\nif (u_method \x3d\x3d 5) {\npv \x3d calculateGEMI();\n} else if (u_method \x3d\x3d 6) {\npv \x3d calculatePVI();\n} else if (u_method \x3d\x3d 7) {\npv \x3d calculateGEMI();\n} else if (u_method \x3d\x3d 9) {\npv \x3d calculateVARI();\n}\n}\ngl_FragColor \x3d pv;\n}",
colormap:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform float u_indexedColormapOffset;\nuniform float u_indexedColormapMaxIndex;\nvec4 colorize() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat clrIndex \x3d currentPixel.r - u_indexedColormapOffset;\nvec4 result;\nif (currentPixel.a \x3d\x3d 0.0 || clrIndex \x3e u_indexedColormapMaxIndex) {\nresult \x3d vec4(0.0, 0.0, 0.0, 0.0);\n}\nelse {\nvec2 clrPosition \x3d vec2(clrIndex / u_indexedColormapMaxIndex, 0.0);\nvec4 color \x3d texture2D(u_image1, clrPosition);\nresult \x3d vec4(color.r, color.g, color.b, color.a);\n}\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d colorize();\n}",
compositeBand:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nvarying vec2 v_texCoord;\nuniform int u_rasterCount;\nvec4 composite() {\nvec4 p0, p1, p2;\np0 \x3d texture2D(u_image, v_texCoord);\nvec4 result;\nif (u_rasterCount \x3d\x3d 1){\nresult \x3d p0;\n}\nelse if (u_rasterCount \x3d\x3d 2){\np1 \x3d texture2D(u_image1, v_texCoord);\nresult \x3d vec4(p0.r,p1.r,0.0,min(p0.a,p1.a));\n}\nelse if (u_rasterCount \x3d\x3d 3){\np1 \x3d texture2D(u_image1, v_texCoord);\np2 \x3d texture2D(u_image2, v_texCoord);\nresult \x3d vec4(p0.r,p1.r,p2.r,min(min(p0.a,p1.a),p2.a));\n}\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d composite();\n}",
constant:"precision mediump float;\nuniform vec4 u_color;\nvoid main() {\ngl_FragColor \x3d u_color;\n}",contrastBrightness:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform float u_contrastOffset;\nuniform float u_brightnessOffset;\nuniform float u_scaleFactor;\nvec4 adjustContrastBrightness() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat c \x3d u_contrastOffset;\nfloat b \x3d u_brightnessOffset;\nfloat maxI \x3d 255.0;\nfloat mid \x3d 128.0;\nvec4 v;\nif (c \x3e 0.0 \x26\x26 c \x3c 100.0) {\nv \x3d (200.0 * currentPixel - 100.0 * maxI + 2.0 * maxI * b) / (2.0 * (100.0 - c)) + mid;\n} else if (c \x3c\x3d 0.0 \x26\x26 c \x3e -100.0) {\nv \x3d (200.0 * currentPixel - 100.0 * maxI + 2.0 * maxI * b) * (100.0 + c) / 20000.0 + mid;\n} else if (c \x3d\x3d 100.0) {\nv \x3d (200.0 * currentPixel - 100.0 * maxI + (maxI + 1.0) * (100.0 - c) + 2.0 * maxI * b);\nv \x3d (sign(v) + 1.0) / 2.0; //binary contrast with extra mid tone at 0.5\n} else if (c \x3d\x3d -100.0) {\nv \x3d vec4(mid, mid, mid, currentPixel.a); //no contrast\n}\nreturn vec4(v.r / u_scaleFactor, v.g / u_scaleFactor, v.b / u_scaleFactor, currentPixel.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d adjustContrastBrightness();\n}",
convolution:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform float u_kernel[25];\nuniform int u_kernelSize;\nvec4 convolve33(){\nvec4 vp11, vp12, vp13, vp21, vp22, vp23, vp31, vp32, vp33;\nvec2 xy11 \x3d vec2(-1.0, -1.0);\nvec2 xy12 \x3d vec2(0.0, -1.0);\nvec2 xy13 \x3d vec2(1.0, -1.0);\nvec2 xy21 \x3d vec2(-1.0, 0.0);\nvec2 xy23 \x3d vec2(1.0, 0.0);\nvec2 xy31 \x3d vec2(-1.0, 1.0);\nvec2 xy32 \x3d vec2(0.0, 1.0);\nvec2 xy33 \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s) {\nxy11[0] \x3d 1.0;\nxy21[0] \x3d 1.0;\nxy31[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t) {\nxy11[1] \x3d 1.0;\nxy12[1] \x3d 1.0;\nxy13[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\nxy13[0] \x3d -1.0;\nxy23[0] \x3d -1.0;\nxy33[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\nxy31[1] \x3d -1.0;\nxy32[1] \x3d -1.0;\nxy33[1] \x3d -1.0;\n}\nvec4 convolResult \x3d\ntexture2D(u_image, v_texCoord + u_resolution * xy11) * u_kernel[0] +\ntexture2D(u_image, v_texCoord + u_resolution * xy12) * u_kernel[1] +\ntexture2D(u_image, v_texCoord + u_resolution * xy13) * u_kernel[2] +\ntexture2D(u_image, v_texCoord + u_resolution * xy21) * u_kernel[3] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(0, 0)) * u_kernel[4] +\ntexture2D(u_image, v_texCoord + u_resolution * xy23) * u_kernel[5] +\ntexture2D(u_image, v_texCoord + u_resolution * xy31) * u_kernel[6] +\ntexture2D(u_image, v_texCoord + u_resolution * xy32) * u_kernel[7] +\ntexture2D(u_image, v_texCoord + u_resolution * xy33) * u_kernel[8];\nreturn vec4(convolResult.rgb, texture2D(u_image, v_texCoord).a);\n}\nvec4 convolve55(){\nvec4 vp11, vp12, vp13, vp21, vp22, vp23, vp31, vp32, vp33;\nfloat xdif[5];//https://www.opengl.org/wiki/Data_Type_(GLSL) array constructor ES3.0\nfloat ydif[5];\nfloat a \x3d -2.0;\nfor (int i\x3d0; i\x3c5; i++){\nxdif[i] \x3d a;\nydif[i] \x3d a;\na++;\n}\nif (v_texCoord.s \x3c u_resolution.s *2.0) { //2 pixel\nxdif[0] \x3d 2.0;\nif (v_texCoord.s \x3c u_resolution.s) { //1 pixel\nxdif[1] \x3d 1.0;\n}\n}\nelse if (v_texCoord.s \x3e 1.0 - u_resolution.s *2.0) {\nxdif[0] \x3d -2.0;\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\nxdif[1] \x3d -1.0;\n}\n}\nif (v_texCoord.t \x3c u_resolution.t *2.0) {\nydif[0] \x3d 2.0;\nif (v_texCoord.t \x3c u_resolution.t) {\nydif[1] \x3d 1.0;\n}\n}\nelse if (v_texCoord.t \x3e 1.0 - u_resolution.t*2.0) {\nydif[0] \x3d -2.0;\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\nydif[1] \x3d -1.0;\n}\n}\nvec4 convolResult \x3d\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[0])) * u_kernel[0] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[0])) * u_kernel[1] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[0])) * u_kernel[2] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[0])) * u_kernel[3] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[0])) * u_kernel[4] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[1])) * u_kernel[5] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[1])) * u_kernel[6] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[1])) * u_kernel[7] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[1])) * u_kernel[8] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[1])) * u_kernel[9] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[2])) * u_kernel[10] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[2])) * u_kernel[11] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[2])) * u_kernel[12] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[2])) * u_kernel[13] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[2])) * u_kernel[14] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[3])) * u_kernel[15] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[3])) * u_kernel[16] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[3])) * u_kernel[17] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[3])) * u_kernel[18] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[3])) * u_kernel[19] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[4])) * u_kernel[20] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[4])) * u_kernel[21] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[4])) * u_kernel[22] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[4])) * u_kernel[23] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[4])) * u_kernel[24];\nreturn vec4(convolResult.rgb, texture2D(u_image, v_texCoord).a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nif (u_kernelSize \x3d\x3d 9){\ngl_FragColor \x3d convolve33();\n}\nelse {\ngl_FragColor \x3d convolve55();\n}\n}",
extractBand:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandIDs[3];\nuniform bool u_alterBand;\nvec4 extractBand() {\nvec4 p \x3d texture2D(u_image, v_texCoord);\nif (!u_alterBand){\nreturn p;\n}\nfloat r, g, b;\nif (u_bandIDs[0] \x3d\x3d0){\nr \x3d p.r;\n}\nelse if (u_bandIDs[0] \x3d\x3d1){\nr \x3d p.g;\n}\nelse if (u_bandIDs[0] \x3d\x3d2){\nr \x3d p.b;\n}\nif (u_bandIDs[1] \x3d\x3d0){\ng \x3d p.r;\n}\nelse if (u_bandIDs[1] \x3d\x3d1){\ng \x3d p.g;\n}\nelse if (u_bandIDs[1] \x3d\x3d2){\ng \x3d p.b;\n}\nif (u_bandIDs[2] \x3d\x3d0){\nb \x3d p.r;\n}\nelse if (u_bandIDs[2] \x3d\x3d1){\nb \x3d p.g;\n}\nelse if (u_bandIDs[2] \x3d\x3d2){\nb \x3d p.b;\n}\nreturn vec4(r, g, b, p.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d extractBand();\n}",
hillshade:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform int u_slopeType;\nuniform int u_hillshadeType;\nuniform int u_lightSourceCount;\nuniform float u_sinZcosA;\nuniform float u_sinZsinA;\nuniform float u_cosZ;\nuniform float u_sinZcosAs[6];\nuniform float u_sinZsinAs[6];\nuniform float u_cosZs[6];\nuniform float u_weights[6];\nuniform float u_xFactor;\nuniform float u_yFactor;\nuniform bool u_scaled;\nuniform float u_minValue;\nuniform float u_maxValue;\nuniform bool u_applyColorramp;\nuniform float u_indexedColormapOffset;\nuniform float u_indexedColormapMaxIndex;\nuniform vec2 u_rawResolution;\nuniform int u_resampling;\nvec4 getPixelValue(vec2 coords) {\nif (u_resampling \x3d\x3d 0) {\nreturn texture2D(u_image, coords);\n}\nvec2 pos_ul \x3d floor(coords / u_rawResolution) * u_rawResolution;\nvec2 pos_ur \x3d pos_ul + vec2(1.0, 0.0) * u_rawResolution;\nvec2 pos_ll \x3d pos_ul + vec2(0.0, 1.0) * u_rawResolution;\nvec2 pos_lr \x3d pos_ul + vec2(1.0, 1.0) * u_rawResolution;\nvec2 weight \x3d fract(coords / u_rawResolution);\nvec4 vp_ul \x3d texture2D(u_image, pos_ul);\nvec4 vp_ur \x3d texture2D(u_image, pos_ur);\nvec4 vp_ll \x3d texture2D(u_image, pos_ll);\nvec4 vp_lr \x3d texture2D(u_image, pos_lr);\nvec4 vp \x3d mix(mix(vp_ul, vp_ur, weight.x), mix(vp_ll, vp_lr, weight.x), weight.y);\nreturn vp;\n}\nfloat getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\nif (a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0) {\nreturn 0.0;\n}\nelse {\nreturn e;\n}\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvec3 rgb2hsv(vec3 c) {\nvec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\nvec4 p \x3d c.g \x3c c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\nvec4 q \x3d c.r \x3c p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\nfloat d \x3d q.x - min(q.w, q.y);\nfloat e \x3d 1.0e-10;\nreturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n}\nvec3 hsv2rgb(vec3 c) {\nvec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\nvec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\nreturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\nvec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {\nfloat clrIndex \x3d clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);\nvec4 rgb \x3d texture2D(u_image1, vec2(clrIndex, 0.0));\nvec3 hsv \x3d rgb2hsv(rgb.xyz);\nhsv.z \x3d hillshade;\nreturn vec4(hsv2rgb(hsv) * alpha, alpha);\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 va, vb, vc, vd, ve, vf, vg, vh, vi;\nvec2 axy \x3d vec2(-1.0, -1.0);\nvec2 bxy \x3d vec2(0.0, -1.0);\nvec2 cxy \x3d vec2(1.0, -1.0);\nvec2 dxy \x3d vec2(-1.0, 0.0);\nvec2 fxy \x3d vec2(1.0, 0.0);\nvec2 gxy \x3d vec2(-1.0, 1.0);\nvec2 hxy \x3d vec2(0.0, 1.0);\nvec2 ixy \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s) {\naxy[0] \x3d 1.0;\ndxy[0] \x3d 1.0;\ngxy[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t) {\naxy[1] \x3d 1.0;\nbxy[1] \x3d 1.0;\ncxy[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\ncxy[0] \x3d -1.0;\nfxy[0] \x3d -1.0;\nixy[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\ngxy[1] \x3d -1.0;\nhxy[1] \x3d -1.0;\nixy[1] \x3d -1.0;\n}\nva \x3d texture2D(u_image, v_texCoord + u_resolution * axy);\nvb \x3d texture2D(u_image, v_texCoord + u_resolution * bxy);\nvc \x3d texture2D(u_image, v_texCoord + u_resolution * cxy);\nvd \x3d texture2D(u_image, v_texCoord + u_resolution * dxy);\nve \x3d texture2D(u_image, v_texCoord + u_resolution * vec2(0, 0));\nvf \x3d texture2D(u_image, v_texCoord + u_resolution * fxy);\nvg \x3d texture2D(u_image, v_texCoord + u_resolution * gxy);\nvh \x3d texture2D(u_image, v_texCoord + u_resolution * hxy);\nvi \x3d texture2D(u_image, v_texCoord + u_resolution * ixy);\nfloat alpha \x3d getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\nfloat dzx \x3d (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_xFactor;\nfloat dzy \x3d (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_yFactor; //flip\nfloat s2 \x3d sqrt(1.0 + dzx * dzx + dzy * dzy);\nfloat hillshade \x3d 0.0;\nif (u_hillshadeType \x3d\x3d 0){\nfloat cosDelta \x3d u_sinZsinA * dzy - u_sinZcosA * dzx;\nfloat z \x3d (u_cosZ + cosDelta) / s2;\nif (z \x3c 0.0)  z \x3d 0.0;\nhillshade \x3d z;\n}\nelse if (u_hillshadeType \x3d\x3d 1){\nfor (int k \x3d 0; k \x3c 6; k++) {\nfloat cosDelta \x3d u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;\nfloat z \x3d (u_cosZs[k] + cosDelta) / s2;\nif (z \x3c 0.0) z \x3d 0.0;\nhillshade \x3d hillshade + z * u_weights[k];\nif (k \x3d\x3d u_lightSourceCount-1) break;\n}\n}\nif (u_applyColorramp) {\nvec4 result \x3d overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha);\nif (u_scaled) {\nresult \x3d vec4(result.rgb * 255.0, result.a);\n}\ngl_FragColor \x3d result;\n} else {\nif (u_scaled) {\nhillshade \x3d hillshade * 255.0;\nif (hillshade\x3e 255.0) {\nhillshade \x3d 255.0;\n}\n}\ngl_FragColor \x3d vec4(hillshade, hillshade, hillshade, alpha);\n}\n}",
identity:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandCount;\nfloat shift_right(float v, float amt) {\nv \x3d floor(v) + 0.5;\nreturn floor(v / exp2(amt));\n}\nfloat shift_left(float v, float amt) {\nreturn floor(v * exp2(amt) + 0.5);\n}\nfloat mask_last(float v, float bits) {\nreturn mod(v, shift_left(1.0, bits));\n}\nfloat extract_bits(float num, float from, float to) {\nfrom \x3d floor(from + 0.5);\nto \x3d floor(to + 0.5);\nreturn mask_last(shift_right(num, from), to - from);\n}\nvec4 encode_float(float val) {\nif (val \x3d\x3d 0.0)\nreturn vec4(0, 0, 0, 0);\nfloat sign \x3d val \x3e 0.0 ? 0.0 : 1.0;\nval \x3d abs(val);\nfloat exponent \x3d floor(log2(val));\nfloat biased_exponent \x3d exponent + 127.0;\nfloat fraction \x3d ((val / exp2(exponent)) - 1.0) * 8388608.0;\nfloat t \x3d biased_exponent / 2.0;\nfloat last_bit_of_biased_exponent \x3d fract(t) * 2.0;\nfloat remaining_bits_of_biased_exponent \x3d floor(t);\nfloat byte4 \x3d extract_bits(fraction, 0.0, 8.0) / 255.0;\nfloat byte3 \x3d extract_bits(fraction, 8.0, 16.0) / 255.0;\nfloat byte2 \x3d (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0;\nfloat byte1 \x3d (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\nreturn vec4(byte4, byte3, byte2, byte1);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 currentPixel \x3d  texture2D(u_image, v_texCoord);\ngl_FragColor \x3d vec4( currentPixel.rgb, currentPixel.a); //encode_float(currentPixel.r);\n}",
local:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nvarying vec2 v_texCoord;\nuniform int u_rasterCount;\nvec4 polyfill;\nvec4 localOp1() {\nvec4 a \x3d texture2D(u_image, v_texCoord);\nvec4 result;\nvec4 replaceme1;\nreturn result;\n}\nvec4 localOp2() {\nvec4 a \x3d texture2D(u_image, v_texCoord);\nvec4 b \x3d texture2D(u_image1, v_texCoord);\nvec4 result;\nvec4 replaceme2;\nreturn result;\n}\nvec4 localOp3() {\nvec4 a \x3d texture2D(u_image, v_texCoord);\nvec4 b \x3d texture2D(u_image1, v_texCoord);\nvec4 c \x3d texture2D(u_image2, v_texCoord);\nvec4 result;\nvec4 replaceme3;\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d localOp1();\n}",
local0:"precision mediump float;\nuniform sampler2D u_image0;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput[3];\nuniform float u_maxOutput[3];\nuniform float u_factor[3];\nuniform int u_operation;\nuniform int u_constant[3];\nuniform vec4 gamma;\nfloat localOperate1(float a, float b, float c){\nfloat result;\nif (u_operation \x3d\x3d 1){\nresult \x3d a + b;\n}\nelse if (u_operation \x3d\x3d 2){\nresult \x3d a - b;\n}\nelse if (u_operation \x3d\x3d3){\nresult \x3d a * b;\n}\nelse if (u_operation \x3d\x3d4){\nresult \x3d sqrt(a);\n}\nelse if (u_operation \x3d\x3d5){\nresult \x3d pow(a, b);\n}\nelse if (u_operation \x3d\x3d6){\nresult \x3d acos(a);\n}\nelse if (u_operation \x3d\x3d7){\nresult \x3d asin(a);\n}\nelse if (u_operation \x3d\x3d8){\nresult \x3d atan(a);\n}\nelse if (u_operation \x3d\x3d9){\nresult \x3d 999.0; //atanh not available\n}\nelse if (u_operation \x3d\x3d10){\nresult \x3d abs(a);\n}\nelse if (u_operation \x3d\x3d13){\nresult \x3d 999.0; //bitwise not available\n}\nelse if (u_operation \x3d\x3d17){\nresult \x3d a !\x3d 0.0 \x26\x26 b !\x3d0.0;\n}\nelse if (u_operation \x3d\x3d18){\nresult \x3d a \x3d\x3d0.0? 1.0:0.0;\n}\nelse if (u_operation \x3d\x3d19){\nresult \x3d a !\x3d 0.0 || b !\x3d0.0;\n}\nelse if (u_operation \x3d\x3d20){\nresult \x3d a !\x3d 0.0 ^^ b !\x3d0.0; //exclusive or\n}\nelse if (u_operation \x3d\x3d21){\nresult \x3d cos(a);\n}\nelse if (u_operation \x3d\x3d23){\nresult \x3d a / b;\n}\nelse if (u_operation \x3d\x3d24){\nresult \x3d a \x3d\x3d b ? 1.0:0.0;\n}\nelse if (u_operation \x3d\x3d25){\nresult \x3d exp(a);\n}\nelse if (u_operation \x3d\x3d26){\nresult \x3d pow(10.0, a);\n}\nelse if (u_operation \x3d\x3d27){\nresult \x3d exp2(a);\n}\nelse if (u_operation \x3d\x3d28){\nresult \x3d a \x3e b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d29){\nresult \x3d  a \x3e\x3d b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d30){\nresult \x3d floor(a); //int\n}\nelse if (u_operation \x3d\x3d31){\nresult \x3d a \x3d\x3d0? 1.0:0.0; //null pass mask\n}\nelse if (u_operation \x3d\x3d32){\nresult \x3d a; //float\n}\nelse if (u_operation \x3d\x3d33){\nresult \x3d a \x3c b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d34){\nresult \x3d a \x3c\x3d b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d35){\nresult \x3d log(a);\n}\nelse if (u_operation \x3d\x3d36){\nresult \x3d log2(a) / log2(10.0);\n}\nelse if (u_operation \x3d\x3d37){\nresult \x3d log2(a);\n}\nelse if (u_operation \x3d\x3d44){\nresult \x3d mod(a, b);\n}\nelse if (u_operation \x3d\x3d45){\nresult \x3d -a;\n}\nelse if (u_operation \x3d\x3d46){\nresult \x3d a !\x3d b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d48){\nresult \x3d ceil(a);\n}\nelse if (u_operation \x3d\x3d49){\nresult \x3d floor(a);\n}\nelse if (u_operation \x3d\x3d51){\nresult \x3d sin(a);\n}\nelse if (u_operation \x3d\x3d53){\nresult \x3d a * a;\n}\nelse if (u_operation \x3d\x3d56){\nresult \x3d tan(a);\n}\nelse if (u_operation \x3d\x3d57){\nresult \x3d 999.0; //tanh not available\n}\nelse if (u_operation \x3d\x3d59){\nresult \x3d 999.0; //acosh not available\n}\nelse if (u_operation \x3d\x3d60){\nresult \x3d 999.0; //asinh not available\n}\nelse if (u_operation \x3d\x3d61){\nresult \x3d atan(a, b);\n}\nelse if (u_operation \x3d\x3d64){\nresult \x3d a / b;\n}\nelse if (u_operation \x3d\x3d65){\nresult \x3d floor(a/b);\n}\nelse if (u_operation \x3d\x3d76){\nresult \x3d a !\x3d0? b:c;\n}\n}\nvoid main() {\nvec4 currentPixel0 \x3d  texture2D(u_image0, v_texCoord);\nfloat graya, reda, greena, bluea;\nif (u_bandCount \x3d\x3d 1) {\ngraya \x3d stretchOneaue(float(currentPixel.r), u_minCutOff[0], u_maxCutOff[0], u_minOutput[0], u_maxOutput[0], u_factor[0]);\ngl_FragColor \x3d vec4(graya, graya, graya, currentPixel.a);\n}\nelse if (u_bandCount \x3d\x3d 3) {\nreda \x3d stretchOneaue(float(currentPixel.r), u_minCutOff[0], u_maxCutOff[0], u_minOutput[0], u_maxOutput[0], u_factor[0]);\ngreena \x3d stretchOneaue(float(currentPixel.g), u_minCutOff[1], u_maxCutOff[1], u_minOutput[1], u_maxOutput[1], u_factor[1]);\nbluea \x3d stretchOneaue(float(currentPixel.b), u_minCutOff[2], u_maxCutOff[2], u_minOutput[2], u_maxOutput[2], u_factor[2]);\ngl_FragColor \x3d vec4(reda, greena, bluea, currentPixel.a);\n}\n}",
mask:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform float u_includedRanges[6];\nuniform bool u_includedRanges_specified;\nuniform float u_noDataValues[6];\nuniform bool u_noDataValues_specified;\nuniform int u_noDataInterpretation;\nuniform int u_bandCount;\nvec4 mask() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nvec4 processedPixel \x3d currentPixel;\nif (u_includedRanges_specified) {\nif (u_bandCount \x3d\x3d 1) {\nif (currentPixel.r \x3e u_includedRanges[0] \x26\x26 currentPixel.r \x3c u_includedRanges[1])\nprocessedPixel \x3d vec4(currentPixel.rgb, currentPixel.a);\nelse\nprocessedPixel \x3d vec4(currentPixel.rgb, 0);\n} else if (u_bandCount \x3d\x3d 3) {\nif (currentPixel.r \x3e u_includedRanges[0] \x26\x26 currentPixel.r \x3c u_includedRanges[1] \x26\x26 currentPixel.g \x3e u_includedRanges[2] \x26\x26 currentPixel.g \x3c u_includedRanges[3] \x26\x26 currentPixel.b \x3e u_includedRanges[4] \x26\x26 currentPixel.b \x3c u_includedRanges[5])\nprocessedPixel \x3d vec4(currentPixel.rgb, currentPixel.a);\nelse\nprocessedPixel \x3d vec4(currentPixel.rgb, 0);\n}\n}\nif (u_noDataValues_specified) {\nif (u_bandCount \x3d\x3d 1) {\nif (processedPixel.r \x3d\x3d u_noDataValues[0])\nprocessedPixel \x3d vec4(processedPixel.rgb, 0);\nelse\nprocessedPixel \x3d vec4(processedPixel.rgb, processedPixel.a);\n} else if (u_bandCount \x3d\x3d 3) {\nif (u_noDataInterpretation \x3d\x3d1 \x26\x26 processedPixel.r \x3d\x3d u_noDataValues[0] \x26\x26 processedPixel.g \x3d\x3d u_noDataValues[1] \x26\x26 processedPixel.b \x3d\x3d u_noDataValues[2])\nprocessedPixel \x3d vec4(processedPixel.rgb, 0);\nelse if (processedPixel.r \x3d\x3d u_noDataValues[0] || processedPixel.g \x3d\x3d u_noDataValues[1] || processedPixel.b \x3d\x3d u_noDataValues[2])\nprocessedPixel \x3d vec4(processedPixel.rgb, 0);\nelse\nprocessedPixel \x3d vec4(processedPixel.rgb, processedPixel.a);\n}\n}\nreturn processedPixel;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d mask();\n}",
ndvi:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandId_red;\nuniform int u_bandId_nir;\nuniform bool u_scaled;\nuniform int u_bandCount;\nvec4 calculateNDVI(){\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat ndvi_denom \x3d nir + red;\nfloat ndvi;\nif (ndvi_denom \x3d\x3d 0.0) {\nndvi \x3d 0.0;\n}\nelse {\nndvi \x3d (nir - red) / ndvi_denom;\nif (u_scaled) {\nndvi \x3d float(floor(ndvi * 100.0 + 100.5));\n}\n}\nreturn vec4(ndvi, ndvi, ndvi, currentPixel.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d calculateNDVI();\n}",
remap:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform float u_indexedColormapOffset;\nuniform float u_indexedColormapMaxIndex;\nuniform float u_breaks[16];\nuniform vec2 u_rawResolution;\nuniform int u_resampling;\nvec4 getPixelValue(vec2 coords) {\nif (u_resampling \x3d\x3d 0) {\nreturn texture2D(u_image, coords);\n}\nvec2 pos_ul \x3d floor(coords / u_rawResolution) * u_rawResolution;\nvec2 pos_ur \x3d pos_ul + vec2(1.0, 0.0) * u_rawResolution;\nvec2 pos_ll \x3d pos_ul + vec2(0.0, 1.0) * u_rawResolution;\nvec2 pos_lr \x3d pos_ul + vec2(1.0, 1.0) * u_rawResolution;\nvec2 weight \x3d fract(coords / u_rawResolution);\nvec4 vp_ul \x3d texture2D(u_image, pos_ul);\nvec4 vp_ur \x3d texture2D(u_image, pos_ur);\nvec4 vp_ll \x3d texture2D(u_image, pos_ll);\nvec4 vp_lr \x3d texture2D(u_image, pos_lr);\nvec4 vp \x3d mix(mix(vp_ul, vp_ur, weight.x), mix(vp_ll, vp_lr, weight.x), weight.y);\nreturn vp;\n}\nfloat getRemapIndex(float pixelValue) {\nif (pixelValue \x3c u_breaks[0] || pixelValue \x3e u_breaks[15]) {\nreturn -1.0;\n}\nfor (int i \x3d 0; i \x3c 16; i++) {\nif (pixelValue \x3c u_breaks[i]) {\nreturn float(i - 1);\n}\n}\nif (pixelValue \x3d\x3d u_breaks[15]) {\nreturn 15.0;\n}\nreturn 0.0;\n}\nvec4 colorize(float pv) {\nfloat clrIndex \x3d pv - u_indexedColormapOffset;\nvec4 result;\nif (clrIndex \x3e u_indexedColormapMaxIndex) {\nresult \x3d vec4(0.0, 0.0, 0.0, 0.0);\n}\nelse {\nvec2 clrPosition \x3d vec2(clrIndex / u_indexedColormapMaxIndex, 0.0);\nvec4 color \x3d texture2D(u_image1, clrPosition);\nresult \x3d vec4(color.r, color.g, color.b, color.a);\n}\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nif (currentPixel.a \x3d\x3d 0.0) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nfloat remappedIndex \x3d getRemapIndex(currentPixel.r);\nif (remappedIndex \x3c 0.0) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\ngl_FragColor \x3d colorize(remappedIndex);\n}",
resample:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resamplingRatio;\nuniform int u_resamplingType;\nuniform vec2 u_anchor;\nuniform vec2 u_resolution;\nvec4 resample(){\nvec2 pos_nn, pos_ul, pos_ur, pos_ll, pos_lr, pos_offset;\nfloat weight,weight_total, weight_ul, weight_ur, weight_ll, weight_lr;\nvec4 vp;  //v_texCoord is canvas space 0-1\nvec2 originalResolution \x3d vec2(u_resolution.s*u_resamplingRatio.s, u_resolution.t*u_resamplingRatio.t);\nvec2 pos \x3d vec2(u_anchor.s+(v_texCoord.s-u_anchor.s),(u_anchor.t+(v_texCoord.t-u_anchor.t)));\nif (u_resamplingType \x3d\x3d 0)\n{//shift and scaling, y \x3d ax+b so x \x3d (y-b)/a\npos_nn \x3d vec2(floor(pos.s/originalResolution.s+0.5)*originalResolution.s,floor(pos.t/originalResolution.t+0.5)*originalResolution.t);\nif (pos_nn.s \x3c0.0 || pos_nn.s \x3e 1.0 || pos_nn.t \x3c0.0 || pos_nn.t \x3e 1.0){\nvp \x3d vec4(1.0, 0.0, 0.0, 1.0);//vec4(0.0, 1.0, 0.0, vp.a);\n}\nelse {\nvp \x3d texture2D(u_image, vec2(pos_nn.s, pos_nn.t));\n}\n}\nelse if (u_resamplingType \x3d\x3d 1)\n{//shift and scaling, 4 neighbors y \x3d ax+b so x \x3d (y-b)/a\npos_ul \x3d vec2(floor(pos.s/originalResolution.s)*originalResolution.s,floor(pos.t/originalResolution.t)*originalResolution.t);\npos_ur \x3d vec2(pos_ul.s+originalResolution.s, pos_ul.t);\npos_ll \x3d vec2(pos_ul.s, pos_ul.t+originalResolution.t);\npos_lr \x3d vec2(pos_ul.s+originalResolution.s, pos_ul.t+originalResolution.t);\npos_offset \x3d vec2(pos.s - floor(pos_ul.s),pos.t - floor(pos_ul.t));\nweight_lr \x3d sqrt(pow(pos_offset.s,2.0) + pow(pos_offset.t,2.0));\nweight_ul \x3d sqrt(pow( originalResolution.s- pos_offset.s,2.0)+ pow(originalResolution.t- pos_offset.t,2.0));\nweight_ur \x3d sqrt(pow( pos_offset.s,2.0)+ 1.0- pow(originalResolution.t - pos_offset.t,2.0));\nweight_ll \x3d sqrt(pow( originalResolution.s- pos_offset.s,2.0)+ pow(pos_offset.t,2.0));\nvp \x3d (texture2D(u_image, pos_ul) * weight_ul + texture2D(u_image, pos_ur) * weight_ur + texture2D(u_image, pos_ll) * weight_ll + texture2D(u_image, pos_lr) * weight_lr)/(weight_ul+weight_ur+weight_ll+weight_lr);\n}\nelse if (u_resamplingType \x3d\x3d 2)\n{//shift and scaling, 16 neighbors\nweight_total \x3d 0.0;\nvp \x3d vec4(0.0,0.0,0.0,0.0);\npos_ul \x3d vec2(floor(pos.s/originalResolution.s)*originalResolution.s-originalResolution.s,floor(pos.t/originalResolution.t)*originalResolution.t-originalResolution.t);\npos_offset \x3d vec2(pos.s - floor(pos_ul.s),pos.t - floor(pos_ul.t));\nfor (int i\x3d0; i\x3c4; i++){//row\nfor (int j\x3d0; j\x3c4; j++){//col\nweight \x3d sqrt(pow(pos_offset.s-float(j),2.0)+ pow(pos_offset.t-float(i),2.0));\nvp +\x3dtexture2D(u_image, vec2(pos_ul.s+float(i)*originalResolution.s,pos_ul.t+float(j)*originalResolution.t)) * weight;\nweight_total +\x3d weight;\n}\n}\nvp \x3d vp/weight_total;\n}\nreturn vp;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d resample();\n}",
slope:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform vec2 u_cellSize;\nuniform float u_zfactor;\nuniform float u_altitude;\nuniform float u_azimuth;\nfloat shift_right(float v, float amt) {\nv \x3d floor(v) + 0.5;\nreturn floor(v / exp2(amt));\n}\nfloat shift_left(float v, float amt) {\nreturn floor(v * exp2(amt) + 0.5);\n}\nfloat mask_last(float v, float bits) {\nreturn mod(v, shift_left(1.0, bits));\n}\nfloat extract_bits(float num, float from, float to) {\nfrom \x3d floor(from + 0.5);\nto \x3d floor(to + 0.5);\nreturn mask_last(shift_right(num, from), to - from);\n}\nvec4 encode_float(float val) {\nif (val \x3d\x3d 0.0)\nreturn vec4(0, 0, 0, 0);\nfloat sign \x3d val \x3e 0.0 ? 0.0 : 1.0;\nval \x3d abs(val);\nfloat exponent \x3d floor(log2(val));\nfloat biased_exponent \x3d exponent + 127.0;\nfloat fraction \x3d ((val / exp2(exponent)) - 1.0) * 8388608.0;\nfloat t \x3d biased_exponent / 2.0;\nfloat last_bit_of_biased_exponent \x3d fract(t) * 2.0;\nfloat remaining_bits_of_biased_exponent \x3d floor(t);\nfloat byte4 \x3d extract_bits(fraction, 0.0, 8.0) / 255.0;\nfloat byte3 \x3d extract_bits(fraction, 8.0, 16.0) / 255.0;\nfloat byte2 \x3d (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0;\nfloat byte1 \x3d (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\nreturn vec4(byte4, byte3, byte2, byte1);\n}\nfloat getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\nif (a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0) {\nreturn 0.0;\n}\nelse {\nreturn e;\n}\n}\nvec4 calculateSlope() {\nfloat pi \x3d 3.141592653589793238;\nfloat dzx \x3d 0.0;\nfloat dzy \x3d 0.0;\nvec4 va,  vb,  vc,  vd,  ve,  vf,  vg,  vh,  vi;\nvec2 axy \x3d vec2(-1.0, -1.0);\nvec2 bxy \x3d vec2(0.0, -1.0);\nvec2 cxy \x3d vec2(1.0, -1.0);\nvec2 dxy \x3d vec2(-1.0, 0.0);\nvec2 fxy \x3d vec2(1.0, 0.0);\nvec2 gxy \x3d vec2(-1.0, 1.0);\nvec2 hxy \x3d vec2(0.0, 1.0);\nvec2 ixy \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s) {\naxy[0] \x3d 1.0;\ndxy[0] \x3d 1.0;\ngxy[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t) {\naxy[1] \x3d 1.0;\nbxy[1] \x3d 1.0;\ncxy[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\ncxy[0] \x3d -1.0;\nfxy[0] \x3d -1.0;\nixy[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\ngxy[1] \x3d -1.0;\nhxy[1] \x3d -1.0;\nixy[1] \x3d -1.0;\n}\nif (v_texCoord.s \x3e\x3d u_resolution.s \x26\x26 (1.0 - u_resolution.s) \x3e\x3d v_texCoord.s \x26\x26 v_texCoord.t \x3e\x3d u_resolution.t \x26\x26 (1.0 - u_resolution.t) \x3e\x3d v_texCoord.t) {\nva \x3d texture2D(u_image, v_texCoord + u_resolution * axy);\nvb \x3d texture2D(u_image, v_texCoord + u_resolution * bxy);\nvc \x3d texture2D(u_image, v_texCoord + u_resolution * cxy);\nvd \x3d texture2D(u_image, v_texCoord + u_resolution * dxy);\nve \x3d texture2D(u_image, v_texCoord + u_resolution * vec2(0, 0));\nvf \x3d texture2D(u_image, v_texCoord + u_resolution * fxy);\nvg \x3d texture2D(u_image, v_texCoord + u_resolution * gxy);\nvh \x3d texture2D(u_image, v_texCoord + u_resolution * hxy);\nvi \x3d texture2D(u_image, v_texCoord + u_resolution * ixy);\n}\ndzx \x3d (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r / (8.0 * u_cellSize[0]);\ndzy \x3d -(vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r / (8.0 * u_cellSize[1]);\nfloat alpha \x3d getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\nfloat slope \x3d atan(u_zfactor * sqrt(dzx * dzx + dzy * dzy)) * 57.2957795;\nreturn vec4(slope, slope, slope, alpha);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d calculateSlope();\n}",
stretch:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nvarying vec2 v_texCoord;\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput[3];\nuniform float u_maxOutput[3];\nuniform float u_factor[3];\nuniform int u_bandCount;\nuniform vec2 u_sourceDim;\nuniform vec2 u_targetDim;\nuniform int u_state;\nuniform bool u_minMaxTexture;\nuniform bool u_useGamma;\nuniform float u_gamma[4];\nuniform float u_gammaCorrection[4];\nuniform bool u_scaled;\nuniform vec2 u_rawResolution;\nuniform int u_resampling;\nvec4 getPixelValue(vec2 coords) {\nif (u_resampling \x3d\x3d 0) {\nreturn texture2D(u_image, coords);\n}\nvec2 pos_ul \x3d floor(coords / u_rawResolution) * u_rawResolution;\nvec2 pos_ur \x3d pos_ul + vec2(1.0, 0.0) * u_rawResolution;\nvec2 pos_ll \x3d pos_ul + vec2(0.0, 1.0) * u_rawResolution;\nvec2 pos_lr \x3d pos_ul + vec2(1.0, 1.0) * u_rawResolution;\nvec2 weight \x3d fract(coords / u_rawResolution);\nvec4 vp_ul \x3d texture2D(u_image, pos_ul);\nvec4 vp_ur \x3d texture2D(u_image, pos_ur);\nvec4 vp_ll \x3d texture2D(u_image, pos_ll);\nvec4 vp_lr \x3d texture2D(u_image, pos_lr);\nvec4 vp \x3d mix(mix(vp_ul, vp_ur, weight.x), mix(vp_ll, vp_lr, weight.x), weight.y);\nif (u_bandCount \x3d\x3d 1) {\nfloat alpha \x3d vp_ul.a * vp_ur.a * vp_ll.a * vp_lr.a;\nvec4 vp_nn \x3d texture2D(u_image, coords);\nreturn alpha \x3d\x3d 0.0 ? vp_nn : vec4(vp.rgb, alpha);\n}\nreturn vp;\n}\nvec4 findMin(vec4 p1, vec4 p2) {\nif (p1.a \x3d\x3d 0.0) {\nreturn p2;\n} else if (p2.a \x3d\x3d 0.0) {\nreturn p1;\n} else {\nreturn vec4(min(p1.r, p2.r),min(p1.g, p2.g),min(p1.b, p2.b),p1.a);\n}\n}\nvec4 findMax(vec4 p1, vec4 p2) {\nif (p1.a \x3d\x3d 0.0) {\nreturn p2;\n} else if (p2.a \x3d\x3d 0.0) {\nreturn p1;\n} else {\nreturn vec4(max(p1.r, p2.r),max(p1.g, p2.g),max(p1.b, p2.b),p1.a);\n}\n}\nvec4 findMinMax(vec4 p1, vec4 p2) {\nif (p1.a \x3d\x3d 0.0) {\nreturn p2;\n} else if (p2.a \x3d\x3d 0.0) {\nreturn p1;\n} else {\nreturn vec4(min(p1.r, p2.r), max(p1.g, p2.g), 0.0, p1.a);\n}\n}\nvec4 minMax(int state) {\nvec2 pixelFract \x3d fract(v_texCoord * u_sourceDim);\nfloat xshift \x3d ((pixelFract.s \x3e\x3d 0.5 || pixelFract.s \x3d\x3d 0.0) ? -1.0 : 1.0) / u_sourceDim.s; //take left pixel if \x3e 0.5\nfloat yshift \x3d ((pixelFract.s \x3e\x3d 0.5 || pixelFract.s \x3d\x3d 0.0) ? -1.0 : 1.0) / u_sourceDim.t; //take bottom pixel if \x3e 0.5\nif (u_sourceDim.s \x3d\x3d 1.0) {\nxshift \x3d 0.0;\n}\nif (u_sourceDim.t \x3d\x3d 1.0) {\nyshift \x3d 0.0;\n}\nvec4 p1 \x3d texture2D(u_image, v_texCoord);\nvec4 p2 \x3d texture2D(u_image, v_texCoord + vec2(xshift, 0.0));\nvec4 p3 \x3d texture2D(u_image, v_texCoord + vec2(0.0, yshift));\nvec4 p4 \x3d texture2D(u_image, v_texCoord + vec2(xshift, yshift));\nvec4 pval;\nif (state \x3d\x3d 2) {\npval \x3d findMinMax(findMinMax(p1, p2), findMinMax(p3, p4));\n} else if (state \x3d\x3d 1) {\npval \x3d findMax(findMax(p1, p2), findMax(p3, p4));\n} else if (state \x3d\x3d 0) {\npval \x3d findMin(findMin(p1, p2), findMin(p3, p4));\n}\nreturn pval;\n}\nfloat stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool scaled) {\nfloat stretchedVal;\nif (val \x3e minCutOff \x26\x26 val \x3c maxCutOff) {\nstretchedVal \x3d minOutput + (val - minCutOff) * factor;\n} else if (val \x3e\x3d maxCutOff) {\nstretchedVal \x3d maxOutput;\n} else {\nstretchedVal \x3d minOutput;\n}\nif (scaled) {\nreturn stretchedVal;\n}\nelse {\nreturn stretchedVal / maxOutput; //0-1\n}\n}\nfloat stretchOneValueGamma(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, float gamma, float gammaCorrection, bool scaled) {\nfloat stretchedVal;\nfloat tempf \x3d 1.0;\nfloat outRange \x3d maxOutput - minOutput;\nfloat relativeVal \x3d (val - minCutOff) / (maxCutOff - minCutOff);\nif (val \x3e minCutOff \x26\x26 val \x3c maxCutOff) {\nif (gamma \x3e 1.0) {\ntempf -\x3d pow(1.0 / outRange, relativeVal * gammaCorrection);\n}\nstretchedVal \x3d floor(tempf * outRange * pow(relativeVal, 1.0 / gamma)) + minOutput;\n}\nelse if (val \x3e\x3d maxCutOff) {\nstretchedVal \x3d maxOutput;\n} else {\nstretchedVal \x3d minOutput;\n}\nif (scaled) {\nreturn stretchedVal;\n}\nelse {\nreturn stretchedVal / maxOutput; //0-1\n}\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nif (u_state \x3d\x3d 100) {\nvec4 currentPixel \x3d getPixelValue(v_texCoord);\nfloat grayVal,\nredVal,\ngreenVal,\nblueVal;\nfloat min0,\nmax0,\nmin1,\nmax1,\nmin2,\nmax2,\nfactor0,\nfactor1,\nfactor2;\nvec4 minV, maxV;\nif (u_minMaxTexture) {\nif (u_bandCount \x3d\x3d 1) {\nminV \x3d texture2D(u_image1, v_texCoord);\nmin0 \x3d minV.r;\nmax0 \x3d minV.g;\nfactor0 \x3d (u_maxOutput[0] - u_minOutput[0]) / (max0 - min0);\n} else {\nminV \x3d texture2D(u_image1, v_texCoord);\nmaxV \x3d texture2D(u_image2, v_texCoord);\nmin0 \x3d minV.r;\nmax0 \x3d maxV.r;\nmin1 \x3d minV.g;\nmax1 \x3d maxV.g;\nmin2 \x3d minV.b;\nmax2 \x3d maxV.b;\nfactor0 \x3d (u_maxOutput[0] - u_minOutput[0]) / (max0 - min0);\nfactor1 \x3d (u_maxOutput[1] - u_minOutput[1]) / (max1 - min1);\nfactor2 \x3d (u_maxOutput[2] - u_minOutput[2]) / (max2 - min2);\n}\n} else {\nmin0 \x3d u_minCutOff[0];\nmax0 \x3d u_maxCutOff[0];\nmin1 \x3d u_minCutOff[1];\nmax1 \x3d u_maxCutOff[1];\nmin2 \x3d u_minCutOff[2];\nmax2 \x3d u_maxCutOff[2];\nfactor0 \x3d u_factor[0];\nfactor1 \x3d u_factor[1];\nfactor2 \x3d u_factor[2];\n}\nif (u_useGamma){\nif (u_bandCount \x3d\x3d 1) {\ngrayVal \x3d stretchOneValueGamma(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_gamma[0], u_gammaCorrection[0], u_scaled);\ngl_FragColor \x3d vec4(grayVal, grayVal, grayVal, currentPixel.a);\n} else {\nredVal \x3d stretchOneValueGamma(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_gamma[0], u_gammaCorrection[0], u_scaled);\ngreenVal \x3d stretchOneValueGamma(float(currentPixel.g), min1, max1, u_minOutput[1], u_maxOutput[1], factor1, u_gamma[1], u_gammaCorrection[1], u_scaled);\nblueVal \x3d stretchOneValueGamma(float(currentPixel.b), min2, max2, u_minOutput[2], u_maxOutput[2], factor2, u_gamma[1], u_gammaCorrection[2], u_scaled);\ngl_FragColor \x3d vec4(redVal, greenVal, blueVal, currentPixel.a);\n}\n}\nelse {\nif (u_bandCount \x3d\x3d 1) {\ngrayVal \x3d stretchOneValue(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_scaled);\ngl_FragColor \x3d vec4(grayVal, grayVal, grayVal, currentPixel.a);\n} else {\nredVal \x3d stretchOneValue(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_scaled);\ngreenVal \x3d stretchOneValue(float(currentPixel.g), min1, max1, u_minOutput[1], u_maxOutput[1], factor1, u_scaled);\nblueVal \x3d stretchOneValue(float(currentPixel.b), min2, max2, u_minOutput[2], u_maxOutput[2], factor2, u_scaled);\ngl_FragColor \x3d vec4(redVal, greenVal, blueVal, currentPixel.a);\n}\n}\n} else {\nvec4 currentPixel \x3d minMax(u_state);\ngl_FragColor \x3d currentPixel;\n}\n}"}})},
"esri/layers/rasterLib/function/RasterFunctionWebGLMixin":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ./pixelShaders ./vertexShaders ./webglHelper ./convolutionKernel".split(" "),function(t,p,x,b,m,f,d){return t(null,{gl:null,rgbaFloatData:null,originalTexture:null,lastTexture:null,renderTexture:!1,constructor:function(a){this._isProgramInitialized=!1;this.gl=a&&a.gl;a&&a.renderTexture&&(this.renderTexture=a.renderTexture);this._xformSetting=a&&a._xformSetting||{requireProjection:!1,
meshSize:[20,20]}},bindFrameBuffer:function(){var a=this.gl;this._setupPingPongTextures();this._setupBranchingTextures();var c=this._glSetting;this.isBranch?(c.branchIndex=(c.branchIndex+1)%c.branchCount,c=c.branches[c.branchIndex]):(c.pingpongIndex=(c.pingpongIndex+1)%c.pingpong.length,c=c.pingpong[c.pingpongIndex]);a.bindFramebuffer(a.FRAMEBUFFER,c.frameBuffer);a.viewport(0,0,a.drawingBufferWidth,a.drawingBufferHeight);return c},_initializeProgram:function(a){if(this.gl)try{var c=this.gl;c.viewport(0,
0,c.drawingBufferWidth,c.drawingBufferHeight);var l=this._glSetting.programUniforms,h="local"===this.functionName?"local"+this.functionArguments.operation:this.functionName,n=l[h];if(n)this._uniforms=n.uniforms,this.rasterProgram=n.program;else{var g=(this._useMesh=this._tileMode&&this._xformSetting.requireProjection)?m.mesh:m.basic,e=m.getShader(c,a.vertex||g),k=b.getShader(c,a.fragment),w=this._loadProgram(e,k),q={rasterProgram:f.getUniforms(c,w)};l[h]={uniforms:q,program:w};this.rasterProgram=
w;this._uniforms=q}c.useProgram(this.rasterProgram);var u=c.getAttribLocation(this.rasterProgram,"a_texCoord"),r=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,r);var v=f.createMesh(this._xformSetting.meshSize);c.bufferData(c.ARRAY_BUFFER,v,c.STATIC_DRAW);c.enableVertexAttribArray(u);c.vertexAttribPointer(u,2,c.FLOAT,!1,0,0);c.disable(c.DEPTH_TEST);c.blendFunc(c.SRC_ALPHA,c.ZERO);c.disable(c.BLEND);c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,!1);this._shaderInfo=
{fragment:a.fragmentName}}catch(z){}},_setUniform:function(a,c,l){null!=c&&(l&&!this._uniforms[l]&&(this._uniforms[l]=f.getUniforms(this.gl,this[l])),l=l?this._uniforms[l]:this._uniforms.rasterProgram,(a=l[a]||l[a+"[0]"])&&f.setUniform(this.gl,a,c))},_setUniforms:function(a,c){var l=Object.keys(a),h,n=l.length;for(h=0;h<n;h++)this._setUniform(l[h],a[l[h]],c);this.rawInput?this._setUniform("u_flipY",!0,c):this._setUniform("u_flipY",!1,c);this._tileMode?(this.rawInput?(l=this._xformSetting.offset,h=
this._xformSetting.scale):(l=[0,0],h=[1,1]),this._setUniform("u_xformOffset",l,c),this._setUniform("u_xformScale",h,c),this._xformSetting.requireProjection&&(this.rawInput?(this._setupXformTexture(),this._setUniform("u_projection",!0,c),this._setUniform("u_transformGridSize",this._xformSetting.gridConfig.size,c),this._setUniform("u_transformSpacing",this._xformSetting.gridConfig.spacing,c),this._setUniform("u_targetImageSize",new Float32Array([this.gl.drawingBufferWidth,this.gl.drawingBufferHeight]),
c)):this._setUniform("u_projection",!1,c))):(l=[0,0],h=[1,1],this._setUniform("u_xformOffset",l,c),this._setUniform("u_xformScale",h,c));this.rawInput&&this._rawResolution&&("RSP_BilinearInterpolation"===this.interpolation||"RSP_CubicConvolution"===this.interpolation)?(this._setUniform("u_resampling",1),this._setUniform("u_rawResolution",this._rawResolution)):this._setUniform("u_resampling",0)},_setupTextureData:function(a,c){if(a.texture)return a;a.raster&&a.raster.pixelBlock&&(a=a.raster);this.rawInput=
!0;var l=c&&c.notOriginal,h=c&&c.bandIDs;if(c&&c.reCreate)var n=!1;else(n=this._tileMode?!this._xformSetting.hasNewTexture:!this._glSetting.hasNewTexture)&&this._originalBandIDs&&(n=h?this._originalBandIDs.join("")===h.join(""):!1);0<this._glSetting.branchCount&&(n=!1);if(n&&this.originalTexture)return{extent:a.extent,texture:this.originalTexture};n=this._createTexture();l||(this.originalTexture=n,this._originalBandIDs=h);l=this.gl;var g=a.pixelBlock;this._rawResolution=g?[1/a.pixelBlock.width,1/
a.pixelBlock.height]:[1/this.gl.drawingBufferWidth,1/this.gl.drawingBufferHeight];var e=0;h&&0<h.length&&g&&(e=Math.max.apply(null,h),g.pixels.length>e&&h&&(g.pixels=h.map(function(w){return g.pixels[w]}),g.statistics&&(g.statistics=h.map(function(w){return g.statistics[w]}))));h=g.width;e=g.height;l.getExtension("OES_texture_float");var k=g.getAsRGBAFloat();l.texImage2D(l.TEXTURE_2D,0,l.RGBA,h,e,0,l.RGBA,l.FLOAT,k);return{extent:a.extent,texture:n}},_setupPingPongTextures:function(){var a=this._glSetting;
if(!a||!a.pingpong){a.pingpong=[];var c=f.createBufferTexture(this.gl,!1);a.pingpong.push(c);c=f.createBufferTexture(this.gl,!1);a.pingpong.push(c);a.pingpongIndex=1}},_setupBranchingTextures:function(){var a=this._glSetting;if(!a||!a.branches){a.branches=[];var c=0,l=a.branchCount;if(0<l){for(c=0;c<l;c++){var h=f.createBufferTexture(this.gl,!1);a.branches.push(h)}a.branchIndex=l-1}}},_setupXformTexture:function(a){for(var c=this._createTexture(),l=this.gl,h=4*this._xformSetting.gridConfig.size[0],
n=this._xformSetting.gridConfig.size[1],g=new Float32Array(h*n*4),e=0,k=0;k<this._xformSetting.gridConfig.coefficients.length;k++)g[e++]=this._xformSetting.gridConfig.coefficients[k],2===k%3&&(g[e++]=1);l.getExtension("OES_texture_float");l.texImage2D(l.TEXTURE_2D,0,l.RGBA,h,n,0,l.RGBA,l.FLOAT,g);this._bindTexture(c,"u_transformGrid",a)},_createTexture:function(a){return f.createTexture(this.gl,a)},_bindTexture:function(a,c,l){c=c||"u_image";l=this._uniforms[l||"rasterProgram"];var h=this._getTextureIndex(c);
if(-1!==h){var n=this.gl;n.uniform1i(l[c].location,h);n.activeTexture(n.TEXTURE0+h);n.bindTexture(n.TEXTURE_2D,a)}},_getTextureIndex:function(a,c){var l=this._uniforms[c||"rasterProgram"];if(!l||!l[a]||l[a].info.type!==this.gl.SAMPLER_2D)return-1;if("u_transformGrid"===a)return 0;l="u_image"===a?0:parseInt(a.replace("u_image",""));return this._xformSetting.requireProjection?l+1:l},_drawGL:function(a){var c=this.gl;this.renderTexture?(c.enable(c.BLEND),c.bindFramebuffer(c.FRAMEBUFFER,null)):c.disable(c.BLEND);
a||c.viewport(0,0,c.drawingBufferWidth,c.drawingBufferHeight);a=this._xformSetting.meshSize||[1,1];c.drawArrays(c.TRIANGLES,0,a[0]*a[1]*6);this._drawMesh()},_drawMesh:function(){if(this.renderTexture&&this._glSetting.drawMesh){this.meshProgram=this.meshProgram||this._setupMeshProgram();var a=this.gl;a.useProgram(this.meshProgram);a.bindFramebuffer(a.FRAMEBUFFER,null);var c=a.getAttribLocation(this.meshProgram,"a_texCoord"),l=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,l);l=this._xformSetting.meshSize||
[1,1];var h=f.createMesh(l,!0);a.bufferData(a.ARRAY_BUFFER,h,a.STATIC_DRAW);a.enableVertexAttribArray(c);a.vertexAttribPointer(c,2,a.FLOAT,!1,0,0);a.disable(a.DEPTH_TEST);a.blendFunc(a.ONE,a.ZERO);this._setUniforms({u_color:[0,0,1,1],u_drawMeshLines:!0},"meshProgram");a.drawArrays(a.LINES,0,l[0]*l[1]*10)}},_setupMeshProgram:function(){var a=m.getShader(this.gl,m.mesh),c=b.getShader(this.gl,b.constant);return this._loadProgram(a,c)},_loadProgram:function(a,c){return f.loadProgram(this.gl,a,c)},_getShaderScript:function(a,
c){var l=document.getElementById(c);if(!l)return null;var h="";for(l=l.firstChild;l;)3==l.nodeType&&(h+=l.textContent),l=l.nextSibling;return h}})})},"esri/layers/rasterLib/function/vertexShaders":function(){define(["dojo/_base/declare","dojo/_base/lang","./vertexShaderScripts"],function(t,p,x){t={shaderType:"vertex",getShader:function(b,m){var f=b.createShader(b.VERTEX_SHADER);b.shaderSource(f,m);b.compileShader(f);b.getShaderParameter(f,b.COMPILE_STATUS)||(f=null);return f}};p.mixin(t,x);return t})},
"esri/layers/rasterLib/function/vertexShaderScripts":function(){define([],function(){return{basic:"varying vec2 v_texCoord;\nattribute vec2 a_texCoord;\nuniform vec2 u_xformOffset;\nuniform vec2 u_xformScale;\nuniform bool u_flipY;\nvoid main() {\nv_texCoord \x3d u_xformOffset + a_texCoord * u_xformScale;\nif (u_flipY) {\nv_texCoord.t \x3d 1.0 - v_texCoord.t;\n}\nvec2 position \x3d a_texCoord * 2.0 - 1.0;\ngl_Position \x3d vec4(position, 0.0, 1.0);\n}",histogram:"attribute float a_pixelIndex;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nuniform vec2 u_sourceDim;\nuniform vec2 u_halfPixel;\nuniform vec4 u_bandSelection;\nuniform vec4 u_mins;\nuniform vec4 u_factors;\nuniform float u_size;\nuniform int u_bandCount;\nuniform bool u_minMaxTexture;\nvoid main() {\nfloat row \x3d a_pixelIndex/u_sourceDim.s;\nvec2 coord \x3d vec2(fract(row), floor(row)/u_sourceDim.t);\nvec4 pv \x3d texture2D(u_image, coord + u_halfPixel);\nvec4 minVal, maxVal, pvm;\nif (u_minMaxTexture){\nif (u_bandCount \x3d\x3d1){ //min \x3d red, max \x3d green\nvec4 minmax \x3d texture2D(u_image1, vec2(0.5,0.5));\nminVal \x3d vec4(minmax.r, minmax.r, minmax.r, 0.0);\nmaxVal \x3d vec4(minmax.g, minmax.g, minmax.g, 0.0);\n}\nelse if (u_bandCount \x3d\x3d3){ //min \x3d red, max \x3d green\nminVal \x3d texture2D(u_image1, vec2(0.5,0.5));\nmaxVal \x3d texture2D(u_image2, vec2(0.5,0.5));\n}\nvec4 factors \x3d u_size/(maxVal-minVal+vec4(0.0,0.0,0.0,1.0)) * u_factors;\npvm \x3d (pv - minVal) * factors;\n}\nelse {\npvm \x3d (pv - u_mins) * u_factors;\n}\nfloat histVal \x3d min(floor(pvm.r+pvm.g+pvm.b), u_size-1.0);\nhistVal \x3d pv.a \x3d\x3d 1.0? histVal: u_size;\ngl_Position \x3d vec4((histVal+0.1) / (u_size+1.0) * 2.0 - 1.0, 0.5, 0, 1);\ngl_PointSize \x3d 1.0;\n}",
mesh:"varying vec2 v_texCoord;\nattribute vec2 a_texCoord;\nuniform bool u_drawMeshLines;\nuniform bool u_flipY;\nuniform vec2 u_xformOffset;\nuniform vec2 u_xformScale;\nuniform sampler2D u_transformGrid;\nuniform vec2 u_transformSpacing;\nuniform vec2 u_transformGridSize;\nuniform vec2 u_targetImageSize;\nuniform vec2 u_srcImageSize;\nuniform bool u_projection;\nvec2 projectPixelLocation(vec2 coords) {\nvec2 index_image \x3d floor(coords * u_targetImageSize);\nvec2 oneTransformPixel \x3d vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);\nvec2 index_transform \x3d floor(index_image / u_transformSpacing) / u_transformGridSize;\nvec2 pos \x3d fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);\nvec2 srcLocation;\nvec2 transform_location \x3d index_transform + oneTransformPixel * 0.5;\nif (pos.s \x3c\x3d pos.t) {\nvec4 ll_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));\nvec4 ll_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));\nsrcLocation.s \x3d dot(ll_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t \x3d dot(ll_def.rgb, vec3(pos, 1.0));\n} else {\nvec4 ur_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));\nvec4 ur_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));\nsrcLocation.s \x3d dot(ur_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t \x3d dot(ur_def.rgb, vec3(pos, 1.0));\n}\nreturn srcLocation;// + halfPixel;\n}\nvoid main() {\nif (u_projection) {\nv_texCoord \x3d projectPixelLocation(a_texCoord);\n} else {\nv_texCoord \x3d u_xformOffset + a_texCoord * u_xformScale;\n}\nif (u_flipY) {\nv_texCoord.t \x3d 1.0 - v_texCoord.t;\n}\nvec2 position \x3d a_texCoord * 2.0 - 1.0;\nif (u_drawMeshLines){\nvec2 adjustedPos \x3d (v_texCoord - u_xformOffset) / u_xformScale;\ngl_Position \x3d vec4( adjustedPos * 2.0 - 1.0, 0.0, 1.0);\n}\nelse {\ngl_Position \x3d vec4(position, 0.0, 1.0);\n}\n}"}})},
"esri/layers/rasterLib/function/webglHelper":function(){define([],function(){var t={getUniforms:function(p,x){var b=p.getProgramParameter(x,p.ACTIVE_UNIFORMS),m,f,d={};for(m=0;m<b;m++)(f=p.getActiveUniform(x,m))&&(d[f.name]={location:p.getUniformLocation(x,f.name),info:f});return d},setUniform:function(p,x,b){var m=x.info;x=x.location;var f=m.type;if(null!=b)switch(f){case p.FLOAT:1<m.size?0!==b.length&&p.uniform1fv(x,b):p.uniform1f(x,b);break;case p.FLOAT_VEC2:if(0===b.length)break;p.uniform2fv(x,
b);break;case p.FLOAT_VEC3:if(0===b.length)break;p.uniform3fv(x,b);break;case p.FLOAT_VEC4:if(0===b.length)break;p.uniform4fv(x,b);break;case p.INT:case p.BOOL:1<m.size?0!==b.length&&p.uniform1iv(x,b):p.uniform1i(x,b);break;case p.INT_VEC2:case p.BOOL_VEC2:if(0===b.length)break;p.uniform2iv(x,b);break;case p.INT_VEC3:case p.BOOL_VEC3:if(0===b.length)break;p.uniform3iv(x,b);break;case p.INT_VEC4:case p.BOOL_VEC4:0!==b.length&&p.uniform4iv(x,b)}},createTexture:function(p,x){var b=p.createTexture();
p.bindTexture(p.TEXTURE_2D,b);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,x?p.LINEAR:p.NEAREST);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,x?p.LINEAR:p.NEAREST);return b},createBufferTexture:function(p,x,b){x=t.createTexture(p,x);p.getExtension("OES_texture_float");b=b||[p.drawingBufferWidth,p.drawingBufferHeight];p.texImage2D(p.TEXTURE_2D,0,p.RGBA,b[0],b[1],0,
p.RGBA,p.FLOAT,null);b=p.createFramebuffer();p.bindFramebuffer(p.FRAMEBUFFER,b);p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,x,0);return{texture:x,frameBuffer:b}},getShader:function(p,x,b){b=b?p.createShader(p.VERTEX_SHADER):p.createShader(p.FRAGMENT_SHADER);p.shaderSource(b,x);p.compileShader(b);p.getShaderParameter(b,p.COMPILE_STATUS)||(b=null);return b},loadProgram:function(p,x,b){var m=p.createProgram();p.attachShader(m,x);p.attachShader(m,b);p.linkProgram(m);p.getProgramParameter(m,
p.LINK_STATUS)||(p.deleteProgram(m),m=null);return m},createMesh:function(p,x){if(!p||1===p[0]&&1===p[1])return new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]);var b=p&&x?new Float32Array(p[0]*p[1]*20):new Float32Array(p[0]*p[1]*12);var m=.9998/p[1],f=.9998/p[0],d,a,c=0;for(d=0;d<p[1];d++)for(a=0;a<p[0];a++){var l=1E-4+m*d;var h=1E-4+f*a;p&&!x?(b[c++]=l,b[c++]=h,b[c++]=l+m,b[c++]=h,b[c++]=l,b[c++]=h+f,b[c++]=l,b[c++]=h+f,b[c++]=l+m,b[c++]=h,b[c++]=l+m,b[c++]=h+f):(b[c++]=l,b[c++]=h,b[c++]=l,b[c++]=h+
f,b[c++]=l,b[c++]=h+f,b[c++]=l+m,b[c++]=h+f,b[c++]=l+m,b[c++]=h+f,b[c++]=l+m,b[c++]=h,b[c++]=l,b[c++]=h,b[c++]=l+m,b[c++]=h,b[c++]=l,b[c++]=h+f,b[c++]=l+m,b[c++]=h)}return b}};return t})},"esri/layers/rasterLib/function/convolutionKernel":function(){define([],function(){var t={Default:[0,0,0,0,1,0,0,0,0],LineDetectionHorizontal:[-1,-1,-1,2,2,2,-1,-1,-1],LineDetectionVertical:[-1,2,-1,-1,2,-1,-1,2,-1],LineDetectionLeftDiagonal:[2,-1,-1,-1,2,-1,-1,-1,2],LineDetectionRightDiagonal:[-1,-1,2,-1,2,-1,2,
-1,-1],GradientNorth:[-1,-2,-1,0,0,0,1,2,1],GradientWest:[-1,0,1,-2,0,2,-1,0,1],GradientEast:[1,0,-1,2,0,-2,1,0,-1],GradientSouth:[1,2,1,0,0,0,-1,-2,-1],GradientNorthEast:[0,-1,-2,1,0,-1,2,1,0],GradientNorthWest:[-2,-1,0,-1,0,1,0,1,2],SmoothArithmeticMean:[.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111],Smoothing3x3:[.0625,.125,.0625,.125,.25,.125,.0625,.125,.0625],Smoothing5x5:[1,1,1,1,1,1,4,4,4,1,1,4,12,4,1,1,4,4,4,1,
1,1,1,1,1],Sharpening3x3:[-1,-1,-1,-1,9,-1,-1,-1,-1],Sharpening5x5:[-1,-3,-4,-3,-1,-3,0,6,0,-3,-4,6,21,6,-4,-3,0,6,0,-3,-1,-3,-4,-3,-1],Laplacian3x3:[0,-1,0,-1,4,-1,0,-1,0],Laplacian5x5:[0,0,-1,0,0,0,-1,-2,-1,0,-1,-2,17,-2,-1,0,-1,-2,-1,0,0,0,-1,0,0],SobelHorizontal:[-1,-2,-1,0,0,0,1,2,1],SobelVertical:[-1,0,1,-2,0,2,-1,0,1],Sharpen:[0,-.25,0,-.25,2,-.25,0,-.25,0],Sharpen2:[-.25,-.25,-.25,-.25,3,-.25,-.25,-.25,-.25],PointSpread:[-.627,.352,-.627,.352,2.923,.352,-.627,.352,-.627],getKernel:function(p){switch(p){case 0:return t.LineDetectionHorizontal;
case 1:return t.LineDetectionVertical;case 2:return t.LineDetectionLeftDiagonal;case 3:return t.LineDetectionRightDiagonal;case 4:return t.GradientNorth;case 5:return t.GradientWest;case 6:return t.GradientEast;case 7:return t.GradientSouth;case 8:return t.GradientNorthEast;case 9:return t.GradientNorthWest;case 10:return t.SmoothArithmeticMean;case 11:return t.Smoothing3x3;case 12:return t.Smoothing5x5;case 13:return t.Sharpening3x3;case 14:return t.Sharpening5x5;case 15:return t.Laplacian3x3;case 16:return t.Laplacian5x5;
case 17:return t.SobelHorizontal;case 18:return t.SobelVertical;case 19:return t.Sharpen;case 20:return t.Sharpen2;case 21:return t.PointSpread;default:return t.Default}}};return t})},"esri/layers/rasterLib/function/surfaceUtils":function(){define(["dojo/_base/lang"],function(t){return{hillshade:function(p,x){if(null!==p&&null!==p.pixelBlock&&null!==p.pixelBlock.pixels){var b=this._clonePixelBlock(p.pixelBlock),m=x.altitude,f=x.azimuth,d=x.zFactor,a=x.psPower,c=x.psFactor,l=x.hillshadeType,h=x.slopeType,
n=x.isGCS;1===l&&(d*=2);var g=b.width,e=b.height,k=b.pixels[0],w=b.mask,q=new Uint8Array(g*e);w&&q.set(w);var u=new Uint8Array(g*e),r=(p.extent.xmax-p.extent.xmin)/g,v=(p.extent.ymax-p.extent.ymin)/e,z=d/(8*r),B=d/(8*v);.001<d&&n&&(z/=111E3,B/=111E3);3===h&&(n?(z=111E3*r,B=111E3*v,z=(d+Math.pow(z,a)*c)/(8*z),B=(d+Math.pow(B,a)*c)/(8*B)):(z=(d+Math.pow(r,a)*c)/(8*r),B=(d+Math.pow(v,a)*c)/(8*v)));n=(90-m)*Math.PI/180;m=Math.cos(n);var A=(360-f+90)*Math.PI/180;f=Math.sin(n)*Math.cos(A);n=Math.sin(n)*
Math.sin(A);d=[];a=[];c=[];r=[315,270,225,360,180,0];var y=[60,60,60,60,60,90];v=[3,5,3,2,1,4];var D=v.reduce(function(O,K){return O+K});h=v.map(function(O){return O/D});if(1===l){var G=r.length;for(v=0;v<G;v++)m=y[v],f=r[v],n=(90-m)*Math.PI/180,m=Math.cos(n),A=(360-f+90)*Math.PI/180,f=Math.sin(n)*Math.cos(A),n=Math.sin(n)*Math.sin(A),d.push(m),a.push(f),c.push(n)}var E=0;for(v=1;v<e-1;v++)for(y=v*g,r=1;r<g-1;r++)if(w&&!w[y+r])u[y+r]=0;else{A=0;if(w&&(A=w[y-g+r-1]+w[y-g+r]+w[y-g+r+1]+w[y+r-1]+w[y+
r+1]+w[y+g+r-1]+w[y+g+r]+w[y+g+r+1],7>A)){u[y+r]=0;q[y+r]=0;continue}if(7===A){var F=w[y-g+r-1]?k[y-g+r-1]:k[y+r];var I=w[y-g+r]?k[y-g+r]:k[y+r];var M=w[y-g+r+1]?k[y-g+r+1]:k[y+r];A=w[y+r-1]?k[y+r-1]:k[y+r];var P=w[y+r+1]?k[y+r+1]:k[y+r];E=w[y+g+r-1]?k[y+g+r-1]:k[y+r];var W=w[y+g+r]?k[y+g+r]:k[y+r];var H=w[y+g+r+1]?k[y+g+r+1]:k[y+r]}else F=k[y-g+r-1],I=k[y-g+r],M=k[y-g+r+1],A=k[y+r-1],P=k[y+r+1],E=k[y+g+r-1],W=k[y+g+r],H=k[y+g+r+1];A=(M+P+P+H-(F+A+A+E))*z;I=(E+W+W+H-(F+I+I+M))*B;M=Math.sqrt(1+A*A+
I*I);E=0;if(0===l)W=n*I-f*A,W=255*(m+W)/M,0>W&&(W=0),E=W;else if(1===l)for(F=0;F<G;F++)W=c[F]*I-a[F]*A,W=255*(d[F]+W)/M,0>W&&(W=0),E+=W*h[F];u[y+r]=E}for(v=0;v<e;v++)u[v*g]=u[v*g+1],u[(v+1)*g-1]=u[(v+1)*g-2];for(v=1;v<g-1;v++)u[v]=u[v+g],u[v+(e-1)*g]=u[v+(e-2)*g];b.pixelType="U8";b.pixels=[u];b.statistics=[{minValue:0,maxValue:255}];w&&(b.mask=q);return{extent:p.extent,pixelBlock:b}}},slope:function(p,x){if(null!==p&&null!==p.pixelBlock&&null!==p.pixelBlock.pixels){var b=this._clonePixelBlock(p.pixelBlock),
m=x.zFactor,f=x.psPower,d=x.psFactor,a=x.slopeType,c=x.isGCS,l=b.width,h=b.height,n=b.pixels[0],g=b.mask,e=new Uint8Array(l*h);g&&e.set(g);var k=new Float32Array(l*h),w=(p.extent.xmax-p.extent.xmin)/l,q=(p.extent.ymax-p.extent.ymin)/h,u=m/(8*w),r=m/(8*q);1E-4>Math.abs(m-1)&&c&&(u/=111E3,r/=111E3);3===a&&(c?(u=111E3*w,r=111E3*q,u=(m+Math.pow(u,f)*d)/(8*u),r=(m+Math.pow(r,f)*d)/(8*r)):(u=(m+Math.pow(w,f)*d)/(8*w),r=(m+Math.pow(q,f)*d)/(8*q)));for(m=1;m<h-1;m++)for(d=m*l,f=1;f<l-1;f++)if(g&&!g[d+f])k[d+
f]=0;else{q=0;if(g&&(q=g[d-l+f-1]+g[d-l+f]+g[d-l+f+1]+g[d+f-1]+g[d+f+1]+g[d+l+f-1]+g[d+l+f]+g[d+l+f+1],7>q)){k[d+f]=0;e[d+f]=0;continue}if(7===q){q=g[d-l+f-1]?n[d-l+f-1]:n[d+f];c=g[d-l+f]?n[d-l+f]:n[d+f];w=g[d-l+f+1]?n[d-l+f+1]:n[d+f];var v=g[d+f-1]?n[d+f-1]:n[d+f];var z=g[d+f+1]?n[d+f+1]:n[d+f];var B=g[d+l+f-1]?n[d+l+f-1]:n[d+f];var A=g[d+l+f]?n[d+l+f]:n[d+f];var y=g[d+l+f+1]?n[d+l+f+1]:n[d+f]}else q=n[d-l+f-1],c=n[d-l+f],w=n[d-l+f+1],v=n[d+f-1],z=n[d+f+1],B=n[d+l+f-1],A=n[d+l+f],y=n[d+l+f+1];v=
(w+z+z+y-(q+v+v+B))*u;q=(B+A+A+y-(q+c+c+w))*r;q=Math.sqrt(v*v+q*q);k[d+f]=1===a||3===a?57.2957795*Math.atan(q):100*q}for(m=0;m<h;m++)k[m*l]=k[m*l+1],k[(m+1)*l-1]=k[(m+1)*l-2];for(m=1;m<l-1;m++)k[m]=k[m+l],k[m+(h-1)*l]=k[m+(h-2)*l];b.pixelType="F32";b.pixels=[k];b.statistics=[{minValue:0,maxValue:255}];g&&(b.mask=e);return{extent:p.extent,pixelBlock:b}}},aspect:function(p){if(null!==p&&null!==p.pixelBlock&&null!==p.pixelBlock.pixels){var x=this._clonePixelBlock(p.pixelBlock),b=x.width,m=x.height,f=
x.pixels[0],d=x.mask,a=new Uint8Array(b*m);d&&a.set(d);var c=new Float32Array(b*m),l=1/((p.extent.xmax-p.extent.xmin)/b),h=1/((p.extent.ymax-p.extent.ymin)/m),n,g;for(n=1;n<m-1;n++){var e=n*b;for(g=1;g<b-1;g++)if(d&&!d[e+g])c[e+g]=0;else{var k=0;if(d&&(k=d[e-b+g-1]+d[e-b+g]+d[e-b+g+1]+d[e+g-1]+d[e+g+1]+d[e+b+g-1]+d[e+b+g]+d[e+b+g+1],7>k)){c[e+g]=0;a[e+g]=0;continue}if(7===k){k=d[e-b+g-1]?f[e-b+g-1]:f[e+g];var w=d[e-b+g]?f[e-b+g]:f[e+g];var q=d[e-b+g+1]?f[e-b+g+1]:f[e+g];var u=d[e+g-1]?f[e+g-1]:f[e+
g];var r=d[e+g+1]?f[e+g+1]:f[e+g];var v=d[e+b+g-1]?f[e+b+g-1]:f[e+g];var z=d[e+b+g]?f[e+b+g]:f[e+g];var B=d[e+b+g+1]?f[e+b+g+1]:f[e+g]}else k=f[e-b+g-1],w=f[e-b+g],q=f[e-b+g+1],u=f[e+g-1],r=f[e+g+1],v=f[e+b+g-1],z=f[e+b+g],B=f[e+b+g+1];u=(q+r+r+B-(k+u+u+v))*l;k=(v+z+z+B-(k+w+w+q))*h;0===u&&0===k?k=-1:(k=90-57.29578*Math.atan2(k,-u),0>k&&(k+=360),360===k?k=0:360<k&&(k%=360));c[e+g]=k}}for(n=0;n<m;n++)c[n*b]=c[n*b+1],c[(n+1)*b-1]=c[(n+1)*b-2];for(n=1;n<b-1;n++)c[n]=c[n+b],c[n+(m-1)*b]=c[n+(m-2)*b];
x.pixelType="F32";x.pixels=[c];x.statistics={minValue:0,maxValue:360};d&&(x.mask=a);return{extent:p.extent,pixelBlock:x}}},_clonePixelBlock:function(p){return p.clone?p.clone():t.clone(p)}}})},"esri/layers/rasterLib/function/BandArithmeticFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterIndex".split(" "),function(t,p,x,b,m,f,d){return t([x,f],{declaredClass:"esri.layers.rasterLib.function.BandArithmeticFunction",
functionName:"BandArithmetic",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({method:1,bandIndexes:"",raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to band arithmetic function is invalid.");this.rasterInfo=p.mixin(a.raster,{bandCount:8===this.functionArguments.method?a.raster.bandCount:1,pixelType:this._calculatePixelType(this.pixelType,"F32"),statistics:null,histograms:null});this.rasterInfo.keyProperties=
this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){this._performance.start();a=a.raster;var c=d.calculate(a.pixelBlock,{bandIndexes:this.functionArguments.bandIndexes,method:this.functionArguments.method});this._addPerformanceMetric(this._performance.elapsed());"Unknown"!==this.pixelType&&(c.pixelType=this.pixelType);return{extent:a.extent,pixelBlock:c}},readGL:function(a){this._performance.start();this._initializeProgram({fragment:m.bandArithmetic,
fragmentName:"bandArithmetic"});var c=this.functionArguments.bandIndexes.trim().split(" ").map(function(g){return parseInt(g,10)});this._infraredBandID=c[0]-1;this._visibleBandID=c[1]-1;this._alterBand=2<Math.max(this._infraredBandID,this._visibleBandID)?!0:!1;a=this._setupTextureData(a.raster,this._alterBand&&2==c.length?{bandIDs:[this._infraredBandID,this._visibleBandID,this._infraredBandID]}:{bandIDs:[c[0]-1,c[1]-1,c[2]-1]});var l=this.bindFrameBuffer(),h=this.functionArguments.method,n=2<c.length?
c.slice(2):null;this._alterBand?this._setUniforms({u_method:h,u_bandId_nir:0,u_bandId_red:1,u_constants:n}):this._setUniforms({u_method:h,u_bandId_nir:c[0]-1,u_bandId_red:c[1]-1,u_constants:n});this._bindTexture(a.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:l.texture}}})})},"esri/layers/rasterLib/function/rasterIndex":function(){define(["dojo/_base/lang"],function(t){return{calculate:function(p,x){if(p&&p.pixels&&p.pixels.length){var b=
x&&x.bandIndexes,m=x&&x.method,f=b.trim().split(" ").map(function(l){return parseInt(l,10)}).filter(function(l){return null!=l}),d=this._clonePixelBlock(p),a=d.pixels,c=d.mask;switch(m){case 1:a=this._calculateNDVI(c,a[f[0]-1],a[f[1]-1]);break;case 2:a=this._calculateSAVI(c,a[f[0]-1],a[f[1]-1],f[2]);break;case 3:a=this._calculateTSAVI(c,a[f[0]-1],a[f[1]-1],f[2],f[3],f[4]);break;case 4:a=this._calculateMSAVI(c,a[f[0]-1],a[f[1]-1]);break;case 5:a=this._calculateGEMI(c,a[f[0]-1],a[f[1]-1]);break;case 6:a=
this._calculatePVI(c,a[f[0]-1],a[f[1]-1],f[2],f[3]);break;case 7:a=this._calculateGVITM(c,a[f[0]-1],a[f[1]-1],a[f[2]-1],a[f[3]-1],a[f[4]-1],a[f[5]-1]);break;case 8:a=this._calculateSultan(c,a[f[0]-1],a[f[1]-1],a[f[2]-1],a[f[3]-1],a[f[4]-1],a[f[5]-1]);break;case 9:a=this._calculateVARI(c,a[f[0]-1],a[f[1]-1],a[f[2]-1]);break;case 0:a=this._calculateUserDefined(c,a,b)}d.pixels=a;d.pixelType="F32";d.calculateStatistics();return d}},_clonePixelBlock:function(p){return p.clone?p.clone():t.clone(p)},_parseUserDefined:function(p,
x){p=p.replace(" ","");0===p.indexOf("-")&&(p="0"+p);0===p.indexOf("+")&&(p=p.slice(1,p.length));var b=p.split(""),m=[],f=[],d="+-*/()".split(""),a,c="";for(a=0;a<b.length;a++){var l=b[a];d.some(function(h){return h===l})?(""!==c&&f.push(parseFloat(c)),m.push(l),c=""):"b"===l.toLowerCase()?(a++,c=l.concat(b[a]),f.push(x[parseInt(c[1],10)-1]),c=""):(c=c.concat(l),a===b.length-1&&f.push(parseFloat(c)))}return{ops:m,nums:f}},_op:function(p,x,b,m){if(b.constructor===Number&&m.constructor===Number)return b+
m;var f;if(b.constructor===Number){var d=m.length;var a=b;b=new Float32Array(d);for(f=0;f<d;f++)b[f]=a}else if(d=b.length,m.constructor===Number)for(a=m,m=new Float32Array(d),f=0;f<d;f++)m[f]=a;a=new Float32Array(d);if(null==p)if("+"===x)for(f=0;f<d;f++)a[f]=b[f]+m[f];else if("-"===x)for(f=0;f<d;f++)a[f]=b[f]-m[f];else if("*"===x)for(f=0;f<d;f++)a[f]=b[f]*m[f];else{if("/"===x)for(f=0;f<d;f++)a[f]=b[f]/m[f]}else if("+"===x)for(f=0;f<d;f++)p[f]&&(a[f]=b[f]+m[f]);else if("-"===x)for(f=0;f<d;f++)p[f]&&
(a[f]=b[f]-m[f]);else if("*"===x)for(f=0;f<d;f++)p[f]&&(a[f]=b[f]*m[f]);else if("/"===x)for(f=0;f<d;f++)p[f]&&(a[f]=b[f]/m[f]);return a},_shrinkOp:function(p,x){p.splice(x,1);var b=0,m=0,f=0;do{for(b=f=m=0;b<p.length;b++)if("("===p[b])m=b;else if(")"===p[b]){f=b;break}f===m+1&&p.splice(m,2)}while(f===m+1);return p},_getPriorityOpIndex:function(p,x){if(1===p.length)return{opIndex:0,numIndex:0};var b=0,m=0,f=0,d=-1,a=0;for(b=0;b<p.length;b++)if("("===p[b])m=b;else if(")"===p[b]){f=b;break}var c=0===
f?p:p.slice(m+1,f);for(b=0;b<c.length;b++)if("*"===c[b]||"/"===c[b]){d=b;break}if(!(-1<d))for(b=0;b<c.length;b++)if("+"===c[b]||"-"===c[b]){d=b;break}0<f&&(d+=m+1);for(b=0;b<d;b++)"("===p[b]&&a++;return{opIndex:d,numIndex:d-a}},_calculateUserDefined:function(p,x,b){x=this._parseUserDefined(b,x);b=x.ops;for(var m=x.nums,f,d,a;0<b.length&&(x=this._getPriorityOpIndex(b,m),f=b[x.opIndex],d=m[x.numIndex],a=m[x.numIndex+1],f=this._op(p,f,d,a),1!==b.length);)b=this._shrinkOp(b,x.opIndex),m.splice(x.numIndex,
2,f);return[f]},_calculateNDVI:function(p,x,b){var m=b.length,f=new Float32Array(m),d;if(null==p)for(d=0;d<m;d++){var a=b[d];var c=x[d];f[d]=(c-a)/(c+a)}else for(d=0;d<m;d++)p[d]&&(a=b[d],c=x[d],f[d]=(c-a)/(c+a));return[f]},_calculateSAVI:function(p,x,b,m){var f=b.length,d=new Float32Array(f),a;if(null==p)for(a=0;a<f;a++){var c=b[a];var l=x[a];d[a]=(l-c)/(l+c+m)*(1+m)}else for(a=0;a<f;a++)p[a]&&(c=b[a],l=x[a],d[a]=(l-c)/(l+c+m)*(1+m));return[d]},_calculateTSAVI:function(p,x,b,m,f,d){var a=b.length,
c=new Float32Array(a),l=-f*m+d*(1+m*m);if(null==p)for(d=0;d<a;d++){var h=b[d];var n=x[d];c[d]=m*(n-m*h-f)/(f*n+h+l)}else for(d=0;d<a;d++)p[d]&&(h=b[d],n=x[d],c[d]=m*(n-m*h-f)/(f*n+h+l));return[c]},_calculateMSAVI:function(p,x,b){var m=b.length,f=new Float32Array(m),d;if(null==p)for(d=0;d<m;d++){var a=b[d];var c=x[d];f[d]=.5*(2*(c+1)-Math.sqrt(Math.pow(2*c+1,2)-8*(c-a)))}else for(d=0;d<m;d++)p[d]&&(f[d]=.5*(2*(c+1)-Math.sqrt(Math.pow(2*c+1,2)-8*(c-a))));return[f]},_calculateGEMI:function(p,x,b){var m=
b.length,f=new Float32Array(m),d;if(null==p)for(d=0;d<m;d++){var a=b[d];var c=x[d];c=(2*(c*c-a*a)+1.5*c+.5*a)/(c+a+.5);f[d]=c*(1-.25*c)-(a-.125)/(1-a)}else for(d=0;d<m;d++)p[d]&&(a=b[d],c=x[d],c=(2*(c*c-a*a)+1.5*c+.5*a)/(c+a+.5),f[d]=c*(1-.25*c)-(a-.125)/(1-a));return[f]},_calculatePVI:function(p,x,b,m,f){var d=b.length,a=new Float32Array(d),c,l=Math.sqrt(1+m*m);if(null==p)for(c=0;c<d;c++){var h=b[c];var n=x[c];a[c]=(n-m*h-f)/l}else for(c=0;c<d;c++)p[c]&&(h=b[c],n=x[c],a[c]=(n-m*h-f)/l);return[a]},
_calculateGVITM:function(p,x,b,m,f,d,a){var c=x.length,l=new Float32Array(c),h;if(null==p)for(h=0;h<c;h++)l[h]=-.2848*x[h]-.2435*b[h]-.5436*m[h]+.7243*f[h]+.084*d[h]-1.18*a[h];else for(h=0;h<c;h++)p[h]&&(l[h]=-.2848*x[h]-.2435*b[h]-.5436*m[h]+.7243*f[h]+.084*d[h]-1.18*a[h]);return[l]},_calculateSultan:function(p,x,b,m,f,d,a){b=x.length;var c=new Float32Array(b),l=new Float32Array(b),h=new Float32Array(b),n;if(null==p)for(n=0;n<b;n++)c[n]=d[n]/a[n]*100,l[n]=d[n]/x[n]*100,h[n]=m[n]/f[n]*(d[n]/f[n])*
100;else for(n=0;n<b;n++)p[n]&&(c[n]=d[n]/a[n]*100,l[n]=d[n]/x[n]*100,h[n]=m[n]/f[n]*(d[n]/f[n])*100);return[c,l,h]},_calculateVARI:function(p,x,b,m){var f=x.length,d=new Float32Array(f),a;if(null==p)for(a=0;a<f;a++){var c=x[a];var l=b[a];var h=m[a];d[a]=(l-c)/(l+c-h)}else for(a=0;a<f;a++)if(p[a])for(a=0;a<f;a++)c=x[a],l=b[a],h=m[a],d[a]=(l-c)/(l+c-h);return[d]}}})},"esri/layers/rasterLib/function/ColormapFunction":function(){define("dojo/_base/declare dojo/_base/lang ../../../renderers/colorRampGenerator ./RasterFunctionX ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),
function(t,p,x,b,m,f,d){return t([b,f],{declaredClass:"esri.layers.rasterLib.function.ColormapFunction",functionName:"Colormap",pixelType:"U8",renderTexture:!1,supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({colormap:null,colorRampName:null,colorRamp:null,colorMapName:null,raster:null},a);this.invert=a&&a.invert;a=a.colormap||a.Colormap;if(a){if(a.features||a[0].attributes){a=a.features||a;var c=Object.keys(a[0].attributes);var l=c.filter(function(w){return"alpha"===
w.toLowerCase()})[0];var h=c.filter(function(w){return"value"===w.toLowerCase()})[0];var n=c.filter(function(w){return"red"===w.toLowerCase()})[0];var g=c.filter(function(w){return"green"===w.toLowerCase()})[0];var e=c.filter(function(w){return"blue"===w.toLowerCase()})[0];if(!(h&&n&&g&&e))throw"invalid colormap";a=a.map(function(w){return l?[w.attributes[h],w.attributes[n],w.attributes[g],w.attributes[e],w.attributes[l]]:[w.attributes[h],w.attributes[n],w.attributes[g],w.attributes[e]]});var k=1.1>
Math.max.apply(null,a.map(function(w){return w[1]}));c=l&&1.1>Math.max.apply(null,a.map(function(w){return w[4]}));if(k)for(k=0;k<a.length;k++)a[k][1]=Math.round(255*a[k][1]),a[k][2]=Math.round(255*a[k][2]),a[k][3]=Math.round(255*a[k][3]),c&&(a[k][4]=Math.round(255*a[k][4]))}this.functionArguments.colormap=this._sortClr(a)}this._initialize()},bind:function(a){this._initialize();a=this.getSourceRasterInfo(a);if(!a.raster||"F32"===a.raster.pixelType)return Error("The raster input to colormap function is invalid. It must be integer type.");
this.rasterInfo=p.mixin(a.raster,{bandCount:3,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Processed";return!0},read2D:function(a){return this._colorize(a.raster)},readGL:function(a){return this._colorizeGL(a.raster)},_colorize:function(a){this._performance.start();var c=d.colorize(a.pixelBlock,{indexedColormap:this._indexedColormap,indexedColormapOffset:this._indexedColormapOffset,
indexed2DColormap:this._indexed2DColormap,alphaSpecified:this._alphaSpecified});this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,pixelBlock:c}},_binarySearchClr:function(a,c){for(var l=0,h=a.length-1,n=0,g=0;l<h;)if(n=Math.floor((l+h)/2),g=a[n],g[0]<c)l=n;else if(g[0]>c)h=n;else return g.slice(1);return null},_sortClr:function(a,c){var l,h,n=[];for(l=0;l<a.length;l++)n.push(a[l]);for(l=0;l<n.length-1;l++){var g=n[l];for(h=l+1;h<n.length;h++)g[0]>n[h][0]&&(g=n[h],n[h]=
n[l],n[l]=g)}if(c)for(l=0;l<n.length/2;l++)g=n[l],n[n.length-1-l]=n[l],n[l]=g;return n},_invertColorRamp:function(a){if(!a)return a;var c={type:a.type};"random"===a.type?c=a:"multipart"===a.type?c.colorRamps=a.colorRamps.map(function(l){return{fromColor:l.toColor,toColor:l.fromColor}}).reverse():(c.fromColor=a.toColor,c.toColor=a.fromColor);return c},_initialize:function(){this._indexedColormapOffset=0;if(this.functionArguments.colormap){var a=d.buildIndexedColormap(this.functionArguments.colormap);
this._alphaSpecified=a&&a.alphaSpecified;this._indexedColormap=a&&a.indexedColormap;this._indexedColormapOffset=a&&a.offset;this._indexedColormap||(this._indexed2DColormap=this._getIndexed2DColormap())}else this.functionArguments.colorRamp?this._indexedColormap="multipart"===this.functionArguments.colorRamp.type?this.invert?x.createMultiPartColorRamp(this._invertColorRamp(this.functionArguments.colorRamp)):x.createMultiPartColorRamp(this.functionArguments.colorRamp):this.invert?x.createAlgorithmicColorRamp(this._invertColorRamp(this.functionArguments.colorRamp)):
x.createAlgorithmicColorRamp(this.functionArguments.colorRamp):this.functionArguments.colormapName&&"random"===this.functionArguments.colormapName.toLowerCase()&&(this._indexedColormap=x.createRandomColorRamp())},_getIndexed2DColormap:function(){var a=this.functionArguments.colormap;if(!a)return null;var c=0;0>a[0][0]&&(c=a[0][0]);var l=[],h=5===a[0].length,n;for(n=0;n<a.length;n++)l[a[n][0]-c]=h?a[n].slice(1):a[n].slice(1).concat([255]);return l},_colorizeGL:function(a){this._performance.start();
this._initializeProgram({fragment:m.colormap,fragmentName:"Colormap"});var c=this._indexedColormap,l=this._indexedColormapOffset;this._clrTexture||(this._clrTexture=this._setupColormapTexture(c));var h=this._clrTexture,n=this.bindFrameBuffer();a=this._setupTextureData(a);this._setUniforms({u_indexedColormapOffset:l,u_indexedColormapMaxIndex:c.length/4-1});this._bindTexture(h,"u_image1");this._bindTexture(a.texture,"u_image");this._drawGL();return{extent:a.extent,texture:n.texture}},_setupColormapTexture:function(a){var c=
this._createTexture(),l=this.gl,h=a.length/4,n=new Float32Array(a.length),g,e=this.renderTexture?255:1;for(g=0;g<a.length;g++)n[g]=a[g]/e;l.getExtension("OES_texture_float");l.texImage2D(l.TEXTURE_2D,0,l.RGBA,h,1,0,l.RGBA,l.FLOAT,n);return c}})})},"esri/renderers/colorRampGenerator":function(){define(["dojo/_base/declare","dojo/_base/lang","../renderers/colorUtils"],function(t,p,x){return{createAlgorithmicColorRamp:function(b,m){if(!b)return null;var f=b.fromColor,d=b.toColor;if(!f||!d)return null;
void 0===f.r&&3<=f.length&&(f={r:f[0],g:f[1],b:f[2]});void 0===d.r&&3<=d.length&&(d={r:d[0],g:d[1],b:d[2]});var a=b.size||256,c=b.algorithm||"cie-lab";if(1===a)var l=[f.r,f.g,f.b,255];else if(2===a)l=[f.r,f.g,f.b,255,d.r,d.g,f.b,255];else if(-1<c.toLowerCase().indexOf("hsv")){l=x.toHSV(f);d=x.toHSV(d);a=a||256;var h=0===l.s,n=0===d.s;f=l.h;c=d.h;h&&!n?f=l.h=c:n&&!h&&(c=d.h=f);h=Math.abs(c-f);180>h?c=(c-f)/(a-1):(h=360-h,c=f>c?h/(a-1):-h/(a-1));h=(d.s-l.s)/(a-1);n=(d.v-l.v)/(a-1);var g=l.s;l=l.v;var e,
k=new Uint8Array(4*a);for(e=0;e<a-1;e++){var w=x.toRGB({h:f,s:g,v:l});k[4*e]=w.r;k[4*e+1]=w.g;k[4*e+2]=w.b;k[4*e+3]=255;f+=c;g+=h;l+=n;360<f?f-=360:0>f&&(f+=360)}w=x.toRGB(d);k[4*(a-1)]=w.r;k[4*(a-1)+1]=w.g;k[4*(a-1)+2]=w.b;k[4*(a-1)+3]=255;l=k}else if(-1<c.toLowerCase().indexOf("lch")){g=x.toLCH(f);d=x.toLCH(d);a=a||256;l=(d.l-g.l)/(a-1);f=(d.c-g.c)/(a-1);c=(d.h-g.h)/(a-1);h=g.l;n=g.c;g=g.h;k=new Uint8Array(4*a);for(e=0;e<a-1;e++)w=x.toRGB({l:h,c:n,h:g}),k[4*e]=w.r,k[4*e+1]=w.g,k[4*e+2]=w.b,k[4*
e+3]=255,h+=l,n+=f,g+=c;w=x.toRGB(d);k[4*(a-1)]=w.r;k[4*(a-1)+1]=w.g;k[4*(a-1)+2]=w.b;k[4*(a-1)+3]=255;l=k}else if(-1<c.toLowerCase().indexOf("lab")){g=x.toLAB(f);d=x.toLAB(d);a=a||256;l=(d.l-g.l)/(a-1);f=(d.a-g.a)/(a-1);c=(d.b-g.b)/(a-1);h=g.l;n=g.a;g=g.b;k=new Uint8Array(4*a);for(e=0;e<a-1;e++)w=x.toRGB({l:h,a:n,b:g}),k[4*e]=w.r,k[4*e+1]=w.g,k[4*e+2]=w.b,k[4*e+3]=255,h+=l,n+=f,g+=c;w=x.toRGB(d);k[4*(a-1)]=w.r;k[4*(a-1)+1]=w.g;k[4*(a-1)+2]=w.b;k[4*(a-1)+3]=255;l=k}if(m&&!1===m.flattened)for(d=l,
l=[],a=0;a<l/4;a++)l[a]=d.slice(4*a,4*a+4);return l},createMultiPartColorRamp:function(b,m){if(!b)return null;m=m&&p.clone(m)||{flattened:!0};var f=b.colorRamps;if(!f||0===f.length)return null;var d=b.size||256,a=Math.max(Math.floor(d/f.length),1),c=Math.max(a,d-(f.length-1)*a),l=!1!==m.flattened;m.flattened=!0;d=(f.length-1)*a+c;var h=new Uint8Array(4*d);for(d=0;d<f.length;d++){var n={fromColor:f[d].fromColor,toColor:f[d].toColor,size:d===f.length-1?c:a};h instanceof Array?h.concat(this.createAlgorithmicColorRamp(n,
m)):h.set(this.createAlgorithmicColorRamp(n,m),a*d*4)}if(!l)for(f=h,h=[],d=0;d<h/4;d++)h[d]=f.slice(4*d,4*d+4);return h},createRandomColorRamp:function(b){b=b||{};var m=b.size||256,f=!1===b.flattened;var d=f?new Uint8Array(4*m):[];for(b=0;b<m;b++)f?(d[4*b]=Math.round(255*Math.random()),d[4*b+1]=Math.round(255*Math.random()),d[4*b+2]=Math.round(255*Math.random()),d[4*b+3]=255):d[b]=[Math.round(255*Math.random()),Math.round(255*Math.random()),Math.round(255*Math.random()),255];return d}}})},"esri/layers/rasterLib/function/rasterUtils":function(){define(["dojo/_base/lang"],
function(t){return{mask:function(p,x){if(p&&p.pixels&&p.pixels.length){var b=this._clonePixelBlock(p),m=x.includedRanges,f=x.noDataInterpretation,d=x.noDataValues;if(null===m&&null===d)return b;var a=b.pixels,c=b.mask,l=b.width*b.height,h=a.length,n;if(null!==d&&d.length!==h)throw"expect "+h+" elements in noDataValues";if(null!==m&&m.length!==2*h)throw"expect "+2*h+" elements in IncludeRanges";if(null==c){c=new Uint8Array(l);for(n=0;n<l;n++)c[n]=1;b.mask=c}if(0===f)for(f=0;f<h;f++){var g=a[f];var e=
null===m?null:m[2*f];var k=null===m?null:m[2*f+1];var w=null===d?null:parseFloat(d[f]);if(null===e||null===k)for(n=0;n<l;n++){if(c[n]){var q=g[n];q===w&&(c[n]=0)}}else if(null===w)for(n=0;n<l;n++)c[n]&&(q=g[n],q<e||q>k)&&(c[n]=0);else for(n=0;n<l;n++)c[n]&&(q=g[n],q<e||q>k||q===w)&&(c[n]=0)}else{var u=new Uint8Array(l);for(n=0;n<l;n++)u[n]=c[n];for(f=0;f<h;f++)if(g=a[f],e=null===m?null:m[2*f],k=null===m?null:m[2*f+1],w=null===d?null:parseFloat(d[f]),null===e||null===k)for(n=0;n<l;n++)u[n]&&(q=g[n],
q!==w&&(u=0));else if(null===w)for(n=0;n<l;n++)u[n]&&(q=g[n],q<=e&&q<=k&&(u=0));else for(n=0;n<l;n++)u[n]&&(q=g[n],q<=e&&q<=k&&q!==w&&(u=0));for(n=0;n<l;n++)c[n]&&u[n]&&(c[n]=0)}return b}},calculateStatisticsHistograms:function(p,x){var b=this._clonePixelBlock(p),m=b.pixelType,f=b.pixels,d=b.mask,a=f.length,c,l,h=[],n;for(c=0;c<a;c++){var g={min:-.5,max:255.5,size:256,counts:new Uint32Array(256)};var e=g.counts;var k=f[c];if("U8"===m)if(d)for(l=0;l<b.width*b.height;l++)d[l]&&e[k[l]]++;else for(l=
0;l<b.width*b.height;l++)e[k[l]]++;else{var w=b.statistics[c].minValue;var q=b.statistics[c].maxValue;g.min=w;g.max=q;q=(q-w)/256;var u=new Uint32Array(257);if(d)for(l=0;l<b.width*b.height;l++)d[l]&&u[Math.floor((k[l]-w)/q)]++;else for(l=0;l<b.width*b.height;l++)u[Math.floor((k[l]-w)/q)]++;for(l=0;255>l;l++)e[l]=u[l];e[255]=u[255]+u[256]}h.push(g);w=b.statistics[c].minValue;q=b.statistics[c].maxValue;for(l=u=n=k=0;l<g.size;l++)k+=e[l],n+=l*e[l];n/=k;for(l=0;l<g.size;l++)u+=e[l]*Math.pow(l-n,2);e=
Math.sqrt(u/(k-1));l=(n+.5)*(g.max-g.min)/g.size+g.min;g=e*(g.max-g.min)/g.size;b.statistics[c]={min:w,minValue:w,max:q,maxValue:q,mean:l,stddev:g}}b.histograms=h;return b},buildIndexedColormap:function(p,x){if(!p)return null;var b=0;0>p[0][0]&&(b=p[0][0]);var m=Math.max(256,p[p.length-1][0]-b);if(65536<m)return null;var f=new Uint8Array(4*m),d=[],a,c=0,l=5===p[0].length;if(x)for(d=p[c],a=d[0]-b;a<m;a++)f[4*a]=d[1],f[4*a+1]=d[2],f[4*a+2]=d[3],f[4*a+3]=l?d[4]:255,a===d[0]-b&&(d=c===p.length-1?d:p[++c]);
else for(a=0;a<p.length;a++)d=p[a],c=4*(d[0]-b),f[c]=d[1],f[c+1]=d[2],f[c+2]=d[3],f[c+3]=l?d[4]:255;return{indexedColormap:f,offset:b,alphaSpecified:l}},colorize:function(p,x){if(null!==p&&null!==p.pixels){var b=this._clonePixelBlock(p),m=b.pixels,f=b.width*b.height,d=b.mask,a=x.indexedColormap,c=x.indexedColormapOffset,l=a&&a.length-1,h=x.indexed2DColormap,n=x.alphaSpecified;if(3<=m.length)throw"colormap only works on single band image";var g=m[0],e=new Uint8Array(g.length),k=new Uint8Array(g.length),
w=new Uint8Array(g.length),q=0;if(a)if(d)for(m=0;m<f;m++)d[m]&&(q=4*(g[m]-c),q<c||q>l?d[m]=0:(e[m]=a[q],k[m]=a[q+1],w[m]=a[q+2],d[m]=a[q+3]));else{d=new Uint8Array(f);for(m=0;m<f;m++)q=4*(g[m]-c),q<c||q>l?d[m]=0:(e[m]=a[q],k[m]=a[q+1],w[m]=a[q+2],d[m]=a[q+3]);b.mask=d}else if(d)for(m=0;m<f;m++)d[m]&&(a=h[g[m]],e[m]=a[0],k[m]=a[1],w[m]=a[2],d[m]=a[3]);else{d=new Uint8Array(f);for(m=0;m<f;m++)a=h[g[m]],e[m]=a[0],k[m]=a[1],w[m]=a[2],d[m]=a[3];b.mask=d}b.pixels=[e,k,w];b.statistics=null;b.pixelType="U8";
b.maskIsAlpha=n;return b}},convolute:function(p,x){var b=this._clonePixelBlock(p),m=b.pixels,f=b.width,d=b.height,a=f*d,c=m.length,l,h,n,g,e,k=[],w=[],q=x.normalizedKernel,u=x.kernelRows,r=x.kernelCols;for(l=0;l<c;l++){var v=m[l];var z=new Float32Array(a);z.set(v);for(g=1;g<d-1;g++){var B=g*f;for(e=1;e<f-1;e++){for(h=w=0;h<u;h++)for(n=0;n<r;n++)w+=v[B+e+(h-1)*f+n-1]*q[h*r+n];z[B+e]=w}}k.push(z)}b.pixels=k;return b},contrastBrightnessStretch:function(p,x){if(null!==p&&null!==p.pixels){var b=this._clonePixelBlock(p),
m=b.pixels,f=b.mask,d=b.width*b.height,a=m.length;var c=x&&x.contrastOffset;var l=x&&x.brightnessOffset;if("U8"!==b.pixelType)throw"the contrast and brightness function only supports 8 bit unsigned integer data";var h=this._createContrastBrightnessLUT(c,l);if(null==f)for(l=0;l<d;l++)for(c=0;c<a;c++)m[c][l]=h[m[c][l]];else for(l=0;l<d;l++)if(f[l])for(c=0;c<a;c++)m[c][l]=h[m[c][l]];b.pixelType="U8";return b}},isNull:function(p,x){if(null!==p&&null!==p.pixels){var b=this._clonePixelBlock(p),m=b.mask,
f=b.pixels[0],d=f.length,a;if(m){for(a=0;a<d;a++)f[a]=m[a]?0:1;b.mask=null}else if(f.fill)f.fill(0);else for(a=0;a<d;a++)f[a]=0;return b}},setNull:function(p){if(null!==x&&null!==x.pixels){var x=this._clonePixelBlock(p);p=x.mask;var b=x.pixels[0],m=b.length,f;p=p||new Uint8Array(m);for(f=0;f<m;f++)p[f]=b[f]?0:1;x.mask=p;return x}},local:function(p,x){if(!x)return p[0];var b=x.rasterCountNeeded,m=x.functor,f=this._clonePixelBlock(p[0]);if(null!==f&&null!==f.pixels){var d=f.width*f.height,a,c=(a=p[1])&&
a.pixels[0],l=a&&a.mask,h=f.mask,n=f.pixels[0];if(2===b)if(!h&&l)h=l;else if(h&&l)for(a=0;a<d;a++)h[a]=h[a]&&l[a]?1:0;f.mask=h;if(1===b)if(null==h)for(a=0;a<d;a++)n[a]=m(n[a]);else for(a=0;a<d;a++)h[a]&&(n[a]=m(n[a]));else if(2===b)if(null==h)for(a=0;a<d;a++)n[a]=m(n[a],c[a]);else for(a=0;a<d;a++)h[a]&&(n[a]=m(n[a],c[a]));f.mask=h;f.calculateStatistics();return f}},remapColor:function(p,x){var b=this._clonePixelBlock(p),m=b.width*b.height,f=x.length,d=Math.floor(f/2),a=x[Math.floor(d)],c=x[0].value,
l=x[x.length-1].value,h=b.pixels[0],n,g,e=!1,k=new Uint8Array(m),w=new Uint8Array(m),q=new Uint8Array(m),u=b.mask,r=4===x[0].mappedColor.length;u&&0!==u.length||(u=new Uint8Array(m),u.fill(r?255:1),b.mask=u);for(g=0;g<m;g++)if(u[g]){var v=h[g];if(v<c||v>l)k[g]=w[g]=q[g]=u[g]=0;else{e=!1;var z=d;var B=a;var A=0;for(n=f-1;1<n-A;){if(v===B.value){e=!0;break}v>B.value?A=z:n=z;z=Math.floor((A+n)/2);B=x[Math.floor(z)]}e||(B=v===x[n].value?x[n]:x[A]);k[g]=B.mappedColor[0];w[g]=B.mappedColor[1];q[g]=B.mappedColor[2];
u[g]=B.mappedColor[3]}}b.pixels=[k,w,q];b.mask=u;b.pixelType="u8";b.maskIsAlpha=r;return b},_clonePixelBlock:function(p){if(p.clone)return p.clone();var x=t.clone(p),b;if(p.pixels&&p.pixels[0]&&0<p.pixels[0].length&&!(x.pixels&&x.pixels[0]&&0<x.pixels[0].length)){x.pixels=[];var m=p.pixels.length;for(b=0;b<m;b++)x.pixels[b]=new p.pixels[b].constructor(p.pixels[b])}if(p.statistics)for(x.statistics=[],m=p.statistics.length,b=0;b<m;b++)x.statistics[b]=t.clone(p.statistics[b]);p.mask&&(x.mask=new Uint8Array(p.mask));
return x},_createContrastBrightnessLUT:function(p,x){if(this._contrastCache&&this._contrastCache.contrastOffset===p&&this._contrastCache.brightnessOffset===x)return this._contrastCache.lut;var b=Math.min(Math.max(p,-100),100),m=Math.min(Math.max(x,-100),100),f,d=new Uint8Array(256);for(f=0;256>f;f++){if(0<b&&100>b)var a=(200*f-25500+510*m)/(2*(100-b))+128;else 0>=b&&-100<b?a=(200*f-25500+510*m)*(100+b)/2E4+128:100===b?(a=200*f-25500+256*(100-b)+510*m,a=0<a?255:0):-100===b&&(a=128);d[f]=255<a?255:
0>a?0:a}this._contrastCache={contrastOffset:p,brightnessOffset:x,lut:d};return d}}})},"esri/layers/rasterLib/function/CompositeBandFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin".split(" "),function(t,p,x,b,m,f){return t([x,f],{declaredClass:"esri.layers.rasterLib.function.CompositeBandFunction",functionName:"CompositeBand",supportWebGL:!0,support2D:!0,constructor:function(d){this.functionArguments=this.mixinIgnoreCase({rasters:null},
d)},bind:function(d){d=this.getSourceRasterInfo(d);if(!d.rasters)return Error("The rasters input to composite band function is invalid.");var a=[],c=[],l=d.rasters.length,h;if(d.rasters[0].statistics)for(h=0;h<l;h++)a.push(d.rasters[h].statistics[0]);if(d.rasters[0].histograms)for(h=0;h<l;h++)c.push(d.rasters[h].histograms[0]);this.rasterInfo=p.mixin(d.rasters[0],{bandCount:l,pixelType:this._calculatePixelType(this.pixelType,d.rasters[0].pixelType),statistics:a,histograms:c});return!0},read2D:function(d){d=
d.rasters;if(null!=d&&0!==d.length){var a=this._clonePixelData(d[0]),c=a.pixelBlock,l=[],h=[];for(n=0;n<d.length;n++)l.push(d[n].pixelBlock.pixels[0]),h.push(d[n].pixelBlock.statistics[0]);c.pixels=l;c.stackedStatistics=h;c.planes=d.length;var n;h=c.width*c.height;for(n=0;n<d.length;n++)if(c=d[n].pixelBlock.mask,g&&c)for(l=0;l<h;l++)g[l]&=c[l];else var g=g||c;a.maks=g;return a}},readGL:function(d){this._performance.start();this._initializeProgram({fragment:m.compositeBand,fragmentName:"CompositeBand"});
var a=d.rasters;if(null!=a&&0!==a.length){a=a.length;var c,l=this.bindFrameBuffer();for(c=0;c<a;c++){var h=this._setupTextureData(d.rasters[c],{notOriginal:0<c});var n=0<c?c.toString():"";this._bindTexture(h.texture,"u_image"+n)}this._setUniforms({u_rasterCount:a});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:h.extent,texture:l.texture}}}})})},"esri/layers/rasterLib/function/ContrastBrightnessFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),
function(t,p,x,b,m,f,d){return t([x,f],{declaredClass:"esri.layers.rasterLib.function.ContrastBrightnessFunction",renderTexture:!0,functionName:"ContrastBrightness",supportWebGL:!0,support2D:!0,pixelType:"U8",constructor:function(a){this.functionArguments=this.mixinIgnoreCase({contrastOffset:0,brightnessOffset:0,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to contrast and brightness function is invalid.");this.rasterInfo=p.mixin(a.raster,
{bandCount:a.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Processed";return!0},read2D:function(a){a=a.raster;if(null!==a&&null!==a.pixelBlock&&null!==a.pixelBlock.pixels){var c=d.contrastBrightnessStretch(a.pixelBlock,{contrastOffset:this.functionArguments.contrastOffset,brightnessOffset:this.functionArguments.brightnessOffset});"Unknown"!==
this.pixelType&&(c.pixelType=this.pixelType,c.pixels=c.pixels.map(p.hitch(this,function(l){return this._clampBand(l,c.pixelType)})));return{extent:a.extent,pixelBlock:c}}},readGL:function(a){return this._cbGL(a.raster)},_cbGL:function(a){this._performance.start();this._initializeProgram({fragment:m.contrastBrightness,fragmentName:"ContrastBrightness"});a=this._setupTextureData(a);this._setUniforms({u_contrastOffset:Math.min(Math.max(this.functionArguments.contrastOffset,-100),100),u_brightnessOffset:Math.min(Math.max(this.functionArguments.brightnessOffset,
-100),100),u_scaleFactor:this.renderTexture?255:1});this._bindTexture(a.texture,"u_image");var c=this.bindFrameBuffer();this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:c.texture}}})})},"esri/layers/rasterLib/function/ConvolutionFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./convolutionKernel ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),function(t,p,x,b,m,f,d,a){return t([x,
d],{declaredClass:"esri.layers.rasterLib.function.ConvolutionFunction",functionName:"Convolution",supportWebGL:!0,support2D:!0,constructor:function(c){this.functionArguments=this.mixinIgnoreCase({columns:3,rows:3,type:0,kernel:null,raster:null},c)},bind:function(c){c=this.getSourceRasterInfo(c);if(!c.raster)return Error("The raster input to convolution function is invalid.");this.rasterInfo=p.mixin(c.raster,{bandCount:c.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,c.raster.pixelType),
statistics:c.raster.statistics,histograms:c.raster.histograms});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(c){this._performance.start();c=c.raster;var l=this._analyzeKernel(),h=a.convolute(c.pixelBlock,{normalizedKernel:l.normalizedKernel,kernelCols:this.functionArguments.columns,kernelRows:this.functionArguments.rows});this._addPerformanceMetric(this._performance.elapsed());"Unknown"!==this.pixelType&&
(h.pixelType=this.pixelType);h.pixels=h.pixels.map(p.hitch(this,function(n){return this._clampBand(n,h.pixelType)}));return{extent:c.extent,pixelBlock:h}},readGL:function(c){this._performance.start();this._initializeProgram({fragment:f.convolution,fragmentName:"Convolution"});var l=this._setupTextureData(c.raster),h=this.bindFrameBuffer(),n=this.gl,g=n.drawingBufferWidth;n=n.drawingBufferHeight;var e=this.functionArguments.kernel;this._setUniforms({u_resolution:c&&c.raster&&c.raster.pixelBlock?[1/
c.raster.pixelBlock.width,1/c.raster.pixelBlock.height]:[1/g,1/n],u_kernel:e,u_kernelSize:e.length});this._bindTexture(l.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:l.extent,texture:h.texture}},_analyzeKernel:function(){var c=this.functionArguments.kernel,l=c.reduce(function(g,e){return g+e});0!==l&&1!==l&&(c=c.map(function(g){return g/l}));var h,n=[];for(h=0;h<c.length;h++)n.some(function(g){return g===c[h]})||n.push(c[h]);return{normalizedKernel:c,
distinctValues:n}},_analyzeKernelPattern:function(){var c=this.functionArguments.rows,l=this.functionArguments.columns,h=this.functionArguments.kernel,n=[],g,e;for(g=0;g<c;g++)n.push({weights:h.slice(g*l,(g+1)*l)});var k;for(g=1;g<c;g++){var w=n[g].weights;for(h=0;h<g;h++)if(k=n[h].weights){var q=w[0]/k[0];for(e=1;e<l;e++)w[e]/k[e]!==q&&(q=null);null!==q&&(n[g]={row:h,factor:q})}}return n}})})},"esri/layers/rasterLib/function/ExtractBandFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin".split(" "),
function(t,p,x,b,m,f){return t([x,f],{declaredClass:"esri.layers.rasterLib.function.ExtractBandFunction",functionName:"ExtractBand",supportWebGL:!0,support2D:!0,constructor:function(d){this.functionArguments=this.mixinIgnoreCase({bandIDs:[],missingBandAction:0,raster:null},d)},bind:function(d){d=this.getSourceRasterInfo(d);if(!d.raster)return Error("The raster input to extract band function is invalid.");var a=[],c=d.raster.statistics,l=[],h=d.raster.histograms,n=this.functionArguments.bandIDs.length||
d.raster.bandCount;this.functionArguments.bandIDs.forEach(p.hitch(this,function(g){if(g>=n-1){if(1===this.functionArguments.missingBandAction)return Error("missing band "+g);g=n-1}if(0>g)return Error("missing band "+g);void 0!==c&&null!==c&&0<c.length&&a.push(c[g]);void 0!==h&&null!==h&&0<h.length&&l.push(h[g])}));this.rasterInfo=p.mixin(d.raster,{bandCount:n,pixelType:this._calculatePixelType(this.pixelType,d.raster.pixelType),statistics:a,histograms:l});return!0},read2D:function(d){d=this._clonePixelData(d.raster);
if(null!==d&&null!==d.pixelBlock&&null!==d.pixelBlock.pixels){this._performance.start();var a=d.pixelBlock,c=a.statistics,l=a.pixels,h=l.length;if(null==this.functionArguments.bandIDs)throw"missing bandIDs parameter";if(0===this.functionArguments.bandIDs.length)return d;var n=[],g=[];this.functionArguments.bandIDs.forEach(function(e){if(e>=h-1){if(1===this.functionArguments.missingBandAction)throw"missing band "+e;e=h-1}if(0>e)throw"missing band "+e;n.push(l[e]);void 0!==c&&null!==c&&0<c.length&&
g.push(c[e])});a.pixels=n;a.statistics=g;a.planes=this.functionArguments.bandIDs.length;return d}},readGL:function(d){this._performance.start();if(null==this.functionArguments.bandIDs)throw"missing bandIDs parameter";if(3<this.functionArguments.bandIDs.length)throw"this version does not support more than 3 bands yet";this._initializeProgram({fragment:m.extractBand,fragmentName:"ExtractBand"});var a=this.functionArguments.bandIDs;1===a.length&&(a=[a[0],a[0],a[0]]);this._bandIDs=a;this._alterBand=!(0===
this.functionArguments.bandIDs.length||0===a[0]&&1===a[1]&&2===a[2]);var c=!!(this._alterBand&&d.raster&&d.raster.texture);d=this._setupTextureData(d.raster,{bandIDs:a});var l=this.bindFrameBuffer();c?this._setUniforms({u_bandIDs:a,u_alterBand:this._alterBand}):this._setUniforms({u_bandIDs:a,u_alterBand:!1});this._bindTexture(d.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:d.extent,texture:l.texture}}})})},"esri/layers/rasterLib/function/HillshadeFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../../renderers/colorRampGenerator ../../../WKIDUnitConversion ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./surfaceUtils ./rasterUtils".split(" "),
function(t,p,x,b,m,f,d,a,c,l){return t([x,a],{declaredClass:"esri.layers.rasterLib.function.HillshadeFunction",functionName:"Hillshade",supportWebGL:!0,support2D:!0,renderTexture:!0,constructor:function(h){this.functionArguments=this.mixinIgnoreCase({hillshadeType:0,altitude:45,azimuth:315,zFactor:1,slopeType:1,psPower:.664,psFactor:.024,colorRamp:null,raster:null},h);this._azimuths=[315,270,225,360,180,0];this._altitudes=[60,60,60,60,60,90];this._weights=[3,5,3,2,1,4];var n=this._weights.reduce(function(g,
e){return g+e});this._weights=this._weights.map(function(g){return g/n})},bind:function(h){h=this.getSourceRasterInfo(h);if(!h.raster)return Error("The raster input to hillshade function is invalid.");h.raster.statistics&&(this.srcStatistics=h.raster.statistics);this.rasterInfo=p.mixin(h.raster,{bandCount:1,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:[{min:0,max:255}],histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType=
"Generic";this._initializeColormap();return!0},read2D:function(h){this._performance.start();h=h.raster;h=c.hillshade(h,{altitude:this.functionArguments.altitude,azimuth:this.functionArguments.azimuth,zFactor:this.functionArguments.zFactor,psPower:this.functionArguments.psPower,psFactor:this.functionArguments.psFactor,hillshadeType:this.functionArguments.hillshadeType,slopeType:this.functionArguments.slopeType,isGCS:h.extent.spatialReference.wkid&&null==m[h.extent.spatialReference.wkid]});this._addPerformanceMetric(this._performance.elapsed());
return h},readGL:function(h){this._performance.start();this._initializeProgram({fragment:d.hillshade,fragmentName:"Hillshade"});this.functionArguments.colorRamp&&this._indexedColormap&&!this._clrTexture&&(this._clrTexture=this._setupColormapTexture(this._indexedColormap));var n=this._setupTextureData(h.raster),g=this.bindFrameBuffer(),e=this.gl,k=e.drawingBufferWidth;e=e.drawingBufferHeight;var w=n.extent,q=(w.xmax-w.xmin)/k,u=(w.ymax-w.ymin)/e,r=this.functionArguments.altitude,v=this.functionArguments.azimuth,
z=this.functionArguments.zFactor;1===this.functionArguments.hillshadeType&&(z*=2);var B=z/(8*q),A=z/(8*u);.001<z&&w.spatialReference.wkid&&null==m[w.spatialReference.wkid]&&(B/=111E3,A/=111E3);var y=this.functionArguments.psPower,D=this.functionArguments.psFactor;3===this.functionArguments.slopeType&&((B=w.spatialReference.wkid&&null==m[w.spatialReference.wkid])?(B=111E3*q,A=111E3*u,B=(z+Math.pow(B,y)*D)/(8*B),A=(z+Math.pow(A,y)*D)/(8*A)):(B=(z+Math.pow(q,y)*D)/(8*q),A=(z+Math.pow(u,y)*D)/(8*u)));
var G=(90-r)*Math.PI/180;r=Math.cos(G);var E=(360-v+90)*Math.PI/180;v=Math.sin(G)*Math.cos(E);G=Math.sin(G)*Math.sin(E);y=Array(6);D=Array(6);w=Array(6);var F=this._weights,I;if(1===this.functionArguments.hillshadeType){var M=this._azimuths.length;for(I=0;I<M;I++)r=this._altitudes[I],v=this._azimuths[I],G=(90-r)*Math.PI/180,r=Math.cos(G),E=(360-v+90)*Math.PI/180,v=Math.sin(G)*Math.cos(E),G=Math.sin(G)*Math.sin(E),y[I]=r,D[I]=v,w[I]=G}else y[0]=r,D[0]=v,w[0]=G;y=y.map(function(P){return parseFloat(P)});
D=D.map(function(P){return parseFloat(P)});w=w.map(function(P){return parseFloat(P)});this._setUniforms({u_cellSize:[q,u],u_zfactor:z,u_xFactor:B,u_yFactor:A,u_sinZcosA:v,u_sinZsinA:G,u_cosZ:r,u_sinZcosAs:D,u_sinZsinAs:w,u_cosZs:y,u_weights:F,u_hillshadeType:this.functionArguments.hillshadeType,u_resolution:h&&h.raster&&h.raster.pixelBlock?[1/h.raster.pixelBlock.width,1/h.raster.pixelBlock.height]:[1/k,1/e],u_scaled:!this.renderTexture,u_applyColorramp:this._clrTexture?!0:!1,u_minValue:this.srcStatistics[0].min,
u_maxValue:this.srcStatistics[0].max,u_indexedColormapOffset:this._indexedColormapOffset||0,u_indexedColormapMaxIndex:this._indexedColormap?this._indexedColormap.length/4-1:0});this._clrTexture&&this._bindTexture(this._clrTexture,"u_image1");this._bindTexture(n.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:n.extent,texture:g.texture}},_initializeColormap:function(){this._indexedColormapOffset=0;var h=this._indexedColormap,n=this.functionArguments.colorRamp;
this.functionArguments.colormap?(this._alphaSpecified=(n=l.buildIndexedColormap(this.functionArguments.colormap))&&n.alphaSpecified,this._indexedColormap=n&&n.indexedColormap,this._indexedColormapOffset=n&&n.offset):n?(this._indexedColormap="multipart"===n.type?this.invert?b.createMultiPartColorRamp(this._invertColorRamp(n)):b.createMultiPartColorRamp(n):this.invert?b.createAlgorithmicColorRamp(this._invertColorRamp(n)):b.createAlgorithmicColorRamp(n),n.fromColor&&n.toColor&&"000"===n.fromColor.slice(0,
3).join("")&&"255255255"===n.toColor.slice(0,3).join("")&&(this._clrTexture=this._indexedColormap=null)):this.functionArguments.colormapName?"random"===this.functionArguments.colormapName.toLowerCase()&&(this._indexedColormap=b.createRandomColorRamp()):this._clrTexture=this._indexedColormap=null;if(h&&this._indexedColormap){n=!0;for(var g=0;g<h.length;g++)if(h[g]!==this._indexedColormap[g]){n=!1;break}n||(this._clrTexture=null)}},_setupColormapTexture:function(h){var n=this._createTexture(),g=this.gl,
e=h.length/4,k=new Float32Array(h.length),w;for(w=0;w<h.length;w++)k[w]=h[w]/255;g.getExtension("OES_texture_float");g.texImage2D(g.TEXTURE_2D,0,g.RGBA,e,1,0,g.RGBA,g.FLOAT,k);return n}})})},"esri/layers/rasterLib/function/LocalFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),function(t,p,x,b,m,f,d){return t([x,f],{declaredClass:"esri.layers.rasterLib.function.LocalFunction",functionName:"Local",
supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({operation:null,rasters:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);var c=0;a.raster?c=a.raster.bandCount:a.rasters&&(c=Math.max.apply(null,a.rasters.map(function(l){return l.bandCount})));if(0===c)return Error("The raster input to local function is invalid. It only takes single band input.");a=a.raster||a.rasters.filter(function(l){return!!l.extent})[0];this.rasterInfo=p.mixin(a,{bandCount:1,
pixelType:this._calculatePixelType(this.pixelType,"F32"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){var c=[];c=a.raster?a.raster2?[a.raster,a.raster2]:[a.raster]:a.rasters;a=c.map(function(e){return e.pixelBlock});var l=this.functionArguments.operation;if(null===l)return c[0];this._performance.start();var h=this._getOperations(),n=h.operators[l-1];h=h.functors[l-1];
if(!this.functionArguments.rasters){if(1!==n)throw"no sufficient rasters, require "+n;}else if(999!==n&&this.functionArguments.rasters.length!==n)throw"number of rasters does not meet (short or exceed) the operation requirment, require "+n;var g=31===l?d.isNull(a[0]):50===l?d.setNull(a[0]):d.local(a,{rasterCountNeeded:n,functor:h});"Unknown"!==this.pixelType&&(g.pixelType=this.pixelType,g.pixels=g.pixels.map(p.hitch(this,function(e){return this._clampBand(e,g.pixelType)})));g.statistics||g.calculateStatistics();
return{extent:c[0].extent,pixelBlock:g}},readGL:function(a){this._performance.start();var c=this.functionArguments.operation,l=this._getWebGLOperations(),h=l.operators[c-1],n=m.local;l="result\x3d"+l.functors[c-1]+";";31!==c&&50!==c&&(l+="result \x3d vec4(result.rgb, a.a);");n=n.replace("vec4 replaceme"+h+";",l);l=this.gl.getParameter(this.gl.VERSION);var g="";if(-1<l.toLowerCase().indexOf("webgl 1.0")||-1<l.toLowerCase().indexOf("webgl 0."))g=this._getPolyfill(c);n=n.replace("vec4 polyfill;",g);
1<h&&(n=n.replace("gl_FragColor \x3d localOp1();","gl_FragColor \x3d localOp1();".replace("1",h.toString())));this._initializeProgram({fragment:n,fragmentName:"Local"});c=a.rasters;if(null!=c&&0!==c.length){c=c.length;l=this.bindFrameBuffer();for(h=0;h<c;h++){n=0<h?h.toString():"";var e=this._setupTextureData(a.rasters[h],{reCreate:!0});this._bindTexture(e.texture,"u_image"+n)}this._setUniforms({});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:e.extent,texture:l.texture}}},
_getOperations:function(){return{operators:[2,2,2,1,2,1,1,1,1,1,2,2,1,2,2,2,2,1,2,2,1,1,2,2,1,1,1,2,2,1,1,1,2,2,1,1,1,999,999,999,999,999,999,2,1,2,999,1,1,1,1,1,1,999,999,1,1,999,1,1,2,2,2,999,999,999,999,999,999,999,999,999,999,3],functors:[function(a,c){return a+c},function(a,c){return a-c},function(a,c){return a*c},function(a){return Math.sqrt(a)},function(a,c){return Math.pow(a,c)},function(a){return Math.acos(a)},function(a){return Math.asin(a)},function(a){return Math.atan(a)},function(a){return Math.atanh(a)},
function(a){return Math.abs(a)},function(a,c){return a&c},function(a,c){return a<<c},function(a){return~a},function(a,c){return a|c},function(a,c){return a>>c},function(a,c){return a^c},function(a,c){return a&&c},function(a){return!a},function(a,c){return a||c},function(a,c){return a!=c},function(a){return Math.cos(a)},function(a,c){return Math.cosh(a)},function(a,c){return a/c},function(a,c){return a==c},function(a){return Math.exp(a)},function(a){return Math.pow(10,a)},function(a){return Math.pow(2,
a)},function(a,c){return a>c?1:0},function(a,c){return a>=c?1:0},function(a,c){return Math.floor(a)},function(a){return!a},function(a){return a},function(a,c){return a<c?1:0},function(a,c){return a<=c?1:0},function(a){return Math.log(a)},function(a,c){return Math.log10(a)},function(a,c){return Math.log2(a)},999,999,999,999,999,999,function(a,c){return a%c},function(a){return-a},function(a,c){return a!=c?1:0},999,function(a,c){return Math.floor(a)},function(a,c){return Math.ceil(a)},function(a,c){return c?
0:a},function(a,c){return Math.sin(a)},function(a,c){return Math.sinh(a)},function(a,c){return a*a},999,999,function(a){return Math.tan(a)},function(a){return Math.tanh(a)},999,function(a){return Math.acosh(a)},function(a){return Math.asinh(a)},function(a,c){return Math.atan2(a,c)},function(a,c){return a/c},function(a,c){return Math.floor(a/c)},999,999,999,999,999,999,999,999,999,999,function(a,c,l){return a?c:l}]}},_polyfill:{sinh:"vec4 sinh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn halfexp - 1.0/halfexp;\n}",
asinh:"vec4 asinh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn 1.0/(halfexp - 1.0/halfexp);\n}",cosh:"vec4 cosh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn halfexp + 1.0/halfexp;\n}",acosh:"vec4 acosh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn 1.0/(halfexp + 1.0/halfexp);\n}",tanh:"vec4 tanh(vec4 x) {\nvec4 expx \x3d exp(x);\nreturn (expx - 1.0/expx)/(expx + 1.0/expx);\n}",atanh:"vec4 atanh(vec4 x) {\nvec4 expx \x3d exp(x);\nreturn (expx + 1.0/expx)/(expx - 1.0/expx);\n}"},_getPolyfill:function(a){var c=
"";switch(a){case 9:c=this._polyfill.atanh;break;case 22:c=this._polyfill.cosh;break;case 52:c=this._polyfill.sinh;break;case 57:c=this._polyfill.tanh;break;case 59:c=this._polyfill.acosh;break;case 60:c=this._polyfill.asinh}return c},_getWebGLOperations:function(){return{operators:[2,2,2,1,2,1,1,1,1,1,2,2,1,2,2,2,2,1,2,2,1,1,2,2,1,1,1,2,2,1,1,1,2,2,1,1,1,999,999,999,999,999,999,2,1,2,999,1,1,1,1,1,1,999,999,1,1,999,1,1,2,2,2,999,999,999,999,999,999,999,999,999,999,3],functors:["(a + b)","(a - b)",
"(a * b)","sqrt(a)","pow(a, b)","acos(a)","asin(a)","atan(a)","atanh(a)","abs(a)","a","a","a","a","a","a","(a.r\x3d\x3d0.0 || b.r\x3d\x3d0.0) ? vec4(0.0,0.0,0.0,a.a) : vec4(1.0,1.0,1.0,a.a)","a.r\x3d\x3d0.0?vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","(a.r\x3d\x3d0.0 \x26\x26 b.r\x3d\x3d0.0) ? vec4(0.0,0.0,0.0,a.a) : vec4(1.0,1.0,1.0,a.a)","(a.r\x3d\x3d0.0 ^^ b.r\x3d\x3d0.0) ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","cos(a)","cosh(a)","a / b","a.r \x3d\x3d b.r? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)",
"exp(a)","pow(10.0, a)","pow(2.0, a)","a.r \x3e b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","a.r \x3e\x3d b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","floor(a)","a.a \x3d\x3d 0.0? vec4(1.0,1.0,1.0,1.0) : vec4(0.0,0.0,0.0,1.0)","a","a.r \x3c b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","a.r \x3c\x3d b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","log(a)","log2(a) / log2(10.0)","log2(a)",999,999,999,999,999,999,"mod(a, b)","-a","a.r !\x3d b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)",
999,"floor(a)","ceil(a)","a.r !\x3d 0.0 ? vec4(0.0,0.0,0.0,0.0) : a","sin(a)","sinh(a)","a * a",999,999,"tan(a)","tanh(a)",999,"acosh(a)","asinh(a)","atan(a, b)","a / b","floor(a / b)",999,999,999,999,999,999,999,999,999,999,"a.r!\x3d0 ? b : c"]}}})})},"esri/layers/rasterLib/function/MaskFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),function(t,p,x,b,m,f,d){return t([x,f],{declaredClass:"esri.layers.rasterLib.function.MaskFunction",
functionName:"Mask",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({includedRanges:null,noDataInterpretation:0,noDataValues:null,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to mask function is invalid.");this.rasterInfo=p.mixin(a.raster,{bandCount:a.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,a.raster.pixelType),statistics:a.raster.statistics,histograms:a.raster.histograms});
return!0},read2D:function(a){this._performance.start();a=a.raster;var c=d.mask(a.pixelBlock,{includedRanges:this.functionArguments.includedRanges,noDataInterpretation:this.functionArguments.noDataInterpretation,noDataValues:this.functionArguments.noDataValues});this._addPerformanceMetric(this._performance.elapsed());"Unknown"!==this.pixelType&&(c.pixelType=this.pixelType);return{extent:a.extent,pixelBlock:c}},readGL:function(a){this._performance.start();this._initializeProgram({fragment:m.mask,fragmentName:"Mask"});
a=this._setupTextureData(a.raster);var c=this.bindFrameBuffer(),l=this.functionArguments.includedRanges,h=this.functionArguments.noDataValues?this.functionArguments.noDataValues.map(function(n){return parseFloat(n,10)}):null;this._setUniforms({u_includedRanges:l,u_includedRanges_specified:l?!0:!1,u_noDataValues:h,u_noDataValues_specified:h?!0:!1,u_noDataInterpretation:this.functionArguments.noDataInterpretation,u_bandCount:Math.min(this.sourceRasterInfo.raster.bandCount,3)});this._bindTexture(a.texture,
"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:c.texture}}})})},"esri/layers/rasterLib/function/NDVIFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterIndex".split(" "),function(t,p,x,b,m,f,d){return t([x,f],{declaredClass:"esri.layers.rasterLib.function.NDVIFunction",functionName:"NDVI",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=
this.mixinIgnoreCase({visibleBandID:1,infraredBandID:2,scaled:!0,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!(a.raster&&1<a.raster.bandCount))return Error("The raster input to ndvi function is invalid. It requires more than 1 band.");this.rasterInfo=p.mixin(a.raster,{bandCount:1,pixelType:this._calculatePixelType(this.pixelType,this.scaled?"U8":"F32"),statistics:this.scaled?[{min:0,max:200}]:[{min:-1,max:1}],histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||
{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){this._performance.start();a=a.raster;var c=d.calculate(a.pixelBlock,{bandIndexes:[this.functionArguments.infraredBandID+1,this.functionArguments.visibleBandID+1].join(" "),method:1}),l;if(this.functionArguments.scaled){var h=c.pixels[0];var n=c.mask;var g=h.length;var e=new Uint8Array(g);if(null==n)for(l=0;l<g;l++)e[l]=100*h[l]+100&255;else for(l=0;l<g;l++)n[l]&&(e[l]=100*h[l]+100&255);c.pixels[0]=e;c.pixelType="U8"}this._addPerformanceMetric(this._performance.elapsed());
"Unknown"!==this.pixelType&&(c.pixelType=this.pixelType);return{extent:a.extent,pixelBlock:c}},readGL:function(a){this._performance.start();this._initializeProgram({fragment:m.ndvi,fragmentName:"NDVI"});var c=this.functionArguments.visibleBandID,l=this.functionArguments.infraredBandID,h=this.functionArguments.scaled||!1;this._alterBand=2<Math.max(l,c)?!0:!1;a=this._setupTextureData(a.raster,{bandIDs:this._alterBand?{bandIDs:[l,c,l]}:null});var n=this.bindFrameBuffer();this._alterBand?this._setUniforms({u_bandId_nir:0,
u_bandId_red:1,u_scaled:h}):this._setUniforms({u_bandId_nir:l,u_bandId_red:c,u_scaled:h});this._bindTexture(a.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:n.texture}}})})},"esri/layers/rasterLib/function/SlopeFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../../WKIDUnitConversion ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./surfaceUtils".split(" "),function(t,p,x,b,m,f,
d,a){return t([x,d],{declaredClass:"esri.layers.rasterLib.function.SlopeFunction",functionName:"Slope",supportWebGL:!0,support2D:!0,constructor:function(c){this.functionArguments=this.mixinIgnoreCase({zFactor:1,slopeType:1,psPower:.664,psFactor:.024,raster:null},c)},bind:function(c){c=this.getSourceRasterInfo(c);if(!c.raster)return Error("The raster input to slope function is invalid.");this.rasterInfo=p.mixin(c.raster,{bandCount:1,pixelType:this._calculatePixelType(this.outputPixelType,"F32"),statistics:1===
this.slopeType||3===this.slopeType?[{min:0,max:90}]:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(c){this._performance.start();c=c.raster;c=a.slope(c,{zFactor:this.functionArguments.zFactor,psPower:this.functionArguments.psPower,psFactor:this.functionArguments.psFactor,slopeType:this.functionArguments.slopeType,isGCS:c.extent.spatialReference.wkid&&null==b[c.extent.spatialReference.wkid]});
this._addPerformanceMetric(this._performance.elapsed());return c},readGL:function(c){this._performance.start();this._initializeProgram({fragment:f.slope,fragmentName:"Slope"});var l=this._setupTextureData(c.raster),h=this.bindFrameBuffer(),n=this.gl,g=n.drawingBufferWidth;n=n.drawingBufferHeight;var e=l.extent;this._setUniforms({u_resolution:c&&c.raster&&c.raster.pixelBlock?[1/c.raster.pixelBlock.width,1/c.raster.pixelBlock.height]:[1/g,1/n],u_cellSize:[(e.xmax-e.xmin)/g,(e.ymax-e.ymin)/n],u_zfactor:this.functionArguments.zFactor});
this._bindTexture(l.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:l.extent,texture:h.texture}}})})},"esri/layers/rasterLib/function/StretchFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./vertexShaders ./pixelShaders ./RasterFunctionWebGLMixin".split(" "),function(t,p,x,b,m,f,d){return t([x,d],{declaredClass:"esri.layers.rasterLib.function.StretchFunction",functionName:"Stretch",supportWebGL:!0,
support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,maxPercent:.5,useGamma:!1,gamma:null,raster:null,computeGamma:!1},a);this.functionArguments.statistics=this._convertStats(this.functionArguments.statistics);-1===[0,3,5,6].indexOf(this.functionArguments.stretchType)&&(this.functionArguments.stretchType=5);this.min=null==this.min?0:this.min;this.max=null==this.max?
255:this.max},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to stretch function is invalid.");a.raster.statistics&&(this.srcStatistics=this._convertStats(a.raster.statistics));a.raster.histograms&&(this.srcHistograms=a.raster.histograms);this.rasterInfo=p.mixin({},a.raster,{bandCount:a.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};
this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){a=a.raster;this._stretch(a);return a},hasTilingEffects:function(a){a=a||this.functionArguments;return!!(a.dra||a.raster&&"object"===typeof a.raster&&a.raster.dra)},_convertStats:function(a){return a?a.map(function(c){return c&&null!=c.min?[c.min,c.max,c.mean,c.stddev]:c}):null},_updateStatistisHistograms:function(a){var c=this.functionArguments,l=c.histograms||this.srcHistograms;if(a&&a.pixelBlock&&a.pixelBlock.pixels){if(0===
c.stretchType)this._statistics=c.statistics&&0<c.statistics.length?c.statistics:this.srcStatistics,this._histograms=l;else{var h=a.pixelBlock,n=h.pixels.length,g=6===c.stretchType&&(c.dra||!l)||3===c.stretchType&&c.dra;g&&(h.statistics||h.calculateStatistics(),this._calculateStatisticsHistograms(a));if(c.dra)if(h.statistics||h.calculateStatistics(),g)this._statistics=h.statistics,this._histograms=h.histograms;else for(c=h.statistics,this._statistics=[],a=0;a<n;a++)this._statistics[a]=[c[a].minValue,
c[a].maxValue,0,0];else this._statistics=c.statistics&&0<c.statistics.length?c.statistics:this.srcStatistics,this._histograms=l}this._statistics=this._convertStats(this._statistics);this._gammaCorrection=this._getGammaCorrection()}else this._statistics=c.statistics&&0<c.statistics.length?c.statistics:this.srcStatistics,this._histograms=l,this._gammaCorrection=this._getGammaCorrection(),this._statistics=this._convertStats(this._statistics)},_getGammaCorrection:function(){var a=this.functionArguments.gamma;
if(a){var c=[],l;for(l=0;l<a.length;l++)c[l]=1<a[l]?2<a[l]?6.5+Math.pow(a[l]-2,2.5):6.5+100*Math.pow(2-a[l],4):1;return c}},_stretch:function(a){if(null!==a&&null!==a.pixelBlock&&null!==a.pixelBlock.pixels&&0!==this.functionArguments.stretchType){this._updateStatistisHistograms(a);var c=a.pixelBlock,l=c.pixels;c=c.width*c.height;var h=l.length,n,g;this._createLUT(a);if(null==this.LUT)return this._filterNoLUT(a);var e=this.LUT,k=this.LUTOffset;for(n=0;n<h;n++){var w=e[n];for(g=0;g<c;g++){var q=l[n][g];
l[n][g]=w[q-k]}}a.pixelBlock.pixelType="U8"}},_calculateStatisticsHistograms:function(a){a=a.pixelBlock;var c=a.pixelType,l=a.pixels,h=a.mask,n=l.length,g,e,k=function(D){this.min=-.5;this.max=255.5;this.size=256;p.mixin(this,D);this.counts=this.counts||new Uint32Array(this.size)},w=[],q,u;for(g=0;g<n;g++){var r=new k;var v=r.counts;var z=l[g];if("U8"===c)if(h)for(e=0;e<a.width*a.height;e++)h[e]&&v[z[e]]++;else for(e=0;e<a.width*a.height;e++)v[z[e]]++;else{var B=a.statistics[g].minValue;var A=a.statistics[g].maxValue;
r.min=B;r.max=A;A=(A-B)/256;var y=new Uint32Array(257);if(h)for(e=0;e<a.width*a.height;e++)h[e]&&y[Math.floor((z[e]-B)/A)]++;else for(e=0;e<a.width*a.height;e++)y[Math.floor((z[e]-B)/A)]++;for(e=0;255>e;e++)v[e]=y[e];v[255]=y[255]+y[256]}w.push(r);z=[];B=a.statistics[g].minValue;A=a.statistics[g].maxValue;for(e=u=q=y=0;e<r.size;e++)y+=v[e],q+=e*v[e];q/=y;for(e=0;e<r.size;e++)u+=v[e]*Math.pow(e-q,2);v=Math.sqrt(u/(y-1));e=(q+.5)*(r.max-r.min)/r.size+r.min;r=v*(r.max-r.min)/r.size;z.push(B);z.push(A);
z.push(e);z.push(r);a.statistics[g]={min:B,minValue:B,max:A,maxValue:A,mean:e,stddev:r}}a.histograms=w},_getCutOffPoints:function(a){var c=this.functionArguments,l=999;a&&a.pixelBlock?l=a.pixelBlock.pixels.length:a&&a.texture&&(l=3);a=Math.min(l,this._statistics.length);var h=[],n=[],g,e;switch(c.stretchType){case 5:for(g=0;g<a;g++)h[g]=this._statistics[g][0],n[g]=this._statistics[g][1];break;case 3:for(g=0;g<a;g++)h[g]=this._statistics[g][2]-c.numberOfStandardDeviations*this._statistics[g][3],n[g]=
this._statistics[g][2]+c.numberOfStandardDeviations*this._statistics[g][3],h[g]<this._statistics[g][0]&&(h[g]=this._statistics[g][0]),n[g]>this._statistics[g][1]&&(n[g]=this._statistics[g][1]);break;case 6:for(g=0;g<a;g++){l=this._histograms[g];var k=new Uint32Array(l.size);var w=l.counts;var q=0;var u=-.5===l.min&&1===(l.max-l.min)/w?.5:0;for(e=0;e<l.size;e++)q+=w[e],k[e]=q;w=c.minPercent*q/100;for(e=0;e<l.size;e++)if(k[e]>w){h[g]=l.min+(l.max-l.min)/l.size*(e+u);break}w=(1-c.maxPercent/100)*q;for(e=
l.size-2;0<=e;e--)if(k[e]<w){n[g]=l.min+(l.max-l.min)/l.size*(e+2-u);break}}break;default:for(g=0;g<l;g++)h[g]=0,n[g]=255}return{minCutOff:h,maxCutOff:n}},_createLUT:function(a){var c=this.functionArguments,l=a.pixelBlock,h=l.pixelType;if("U8"===h||"U16"===h||"S8"===h||"S16"===h){if(this._LUTSignature&&(h=this._computeLutSignature(),h.length===this._LUTSignature.length&&!h.some(function(G,E){return G!==this._LUTSignature[E]}.bind(this))))return;h=l.pixels.length;var n=[],g=[],e=c.max,k=c.min,w=c.gamma,
q=e-k,u=this._getCutOffPoints(a);a=u.minCutOff;u=u.maxCutOff;var r=0,v=256;"S8"===l.pixelType?r=-127:"S16"===l.pixelType&&(r=-32767);if("U16"===l.pixelType||"S16"===l.pixelType)v=65536;for(l=0;l<h;l++)n[l]=u[l]-a[l];var z=this._gammaCorrection;if(c.useGamma)for(l=0;l<h;l++){var B=[];for(c=0;c<v;c++){var A=c+r;var y=(A-a[l])/n[l];var D=1;1<w[l]&&(D-=Math.pow(1/q,y*z[l]));A<u[l]&&A>a[l]?B[c]=Math.floor(D*q*Math.pow(y,1/w[l]))+k:A>u[l]?B[c]=e:A<a[l]&&(B[c]=k)}g[l]=B}else for(l=0;l<h;l++){B=[];for(c=
0;c<v;c++)A=c+r,B[c]=A<a[l]?k:A>u[l]?e:Math.floor((A-a[l])/n[l]*q)+k;g[l]=B}this.LUT=g;this.LUTOffset=r;this._LUTSignature=this._computeLutSignature()}},_computeLutSignature:function(){var a=this.functionArguments,c=[],l,h;c.push(a.stretchType);c.push(a.min);c.push(a.max);c.push(a.numberOfStandardDeviations);if(this._statistics)for(l=0;l<this._statistics.length;l++)for(h=0;h<this._statistics[l].length;h++)c.push(this._statistics[l][h]);c.push(a.dra?1:0);c.push(a.minPercent);c.push(a.maxPercent);if(a.gamma)for(l=
0;l<this._statistics.length;l++)c.push(a.gamma[l]);c.push(a.useGamma?1:0);return c},_filterNoLUT:function(a){if(null!==a&&null!==a.pixelBlock&&null!==a.pixelBlock.pixels){var c=this.functionArguments,l=a.pixelBlock,h=l.pixels,n=l.mask;l=l.width*l.height;var g=h.length,e=[],k=[],w=c.max,q=c.min,u=c.gamma,r=w-q;var v=this._getCutOffPoints(a);var z=v.minCutOff,B=v.maxCutOff;for(v=0;v<g;v++)e[v]=B[v]-z[v];if(c.useGamma&&null!==u&&u.length>=g)for(v=0;v<g;v++)k[v]=1<u[v]?2<u[v]?6.5+Math.pow(u[v]-2,2.5):
6.5+100*Math.pow(2-u[v],4):1;if(c.useGamma)if(void 0!==n&&null!==n)for(c=0;c<l;c++){if(n[c])for(v=0;v<g;v++){var A=h[v][c];var y=(A-z[v])/e[v];var D=1;1<u[v]&&(D-=Math.pow(1/r,y*k[v]));A<B[v]&&A>z[v]?h[v][c]=Math.floor(D*r*Math.pow(y,1/u[v]))+q:A>B[v]?h[v][c]=w:A<z[v]&&(h[v][c]=q)}}else for(c=0;c<l;c++)for(v=0;v<g;v++)A=h[v][c],y=(A-z[v])/e[v],D=1,1<u[v]&&(D-=Math.pow(1/r,y*k[v])),A<B[v]&&A>z[v]?h[v][c]=Math.floor(D*r*Math.pow(y,1/u[v]))+q:A>B[v]?h[v][c]=w:A<z[v]&&(h[v][c]=q);else if(void 0!==n&&
null!==n)for(c=0;c<l;c++){if(n[c])for(v=0;v<g;v++)A=h[v][c],A<B[v]&&A>z[v]?h[v][c]=Math.floor((A-z[v])/e[v]*r)+q:A>B[v]?h[v][c]=w:A<z[v]&&(h[v][c]=q)}else for(c=0;c<l;c++)for(v=0;v<g;v++)A=h[v][c],A<B[v]&&A>z[v]?h[v][c]=Math.floor((A-z[v])/e[v]*r)+q:A>B[v]?h[v][c]=w:A<z[v]&&(h[v][c]=q);a.pixelBlock.pixelType="U8";return a}},_computeGammaValues:function(a){var c=this._statistics.length,l,h=[];for(l=0;l<c;l++){var n=this._statistics[l][2];"U8"!==a&&(n=255*(n-this._statistics[l][0])/(this._statistics[l][1]-
this._statistics[l][0]));h.push(this._computeGammaValue(n))}return h},_computeGammaValue:function(a){if(0!==a&&!(255<a||0>a)){var c=0;0<a&&150!=a&&255>a&&(c=150>=a?45*Math.cos(.01047*a):17*Math.sin(.021*a));c=Math.log((a+c)/255);if(0!==c&&(a=Math.log(a/255)/c,!isNaN(a)))return Math.min(9.9,Math.max(.01,a))}},readGL:function(a){return this._stretchGL(a.raster)},_stretchGL:function(a){this._performance.start();var c=this.renderTexture,l,h=a.pixelBlock&&a.pixelBlock.pixels&&a.pixelBlock.pixels.length||
this.sourceRasterInfo.raster.bandCount,n=a.pixelBlock,g=this.gl,e=g.drawingBufferWidth,k=g.drawingBufferHeight;if(!n&&this.functionArguments.dra){var w=new Float32Array(e*k*4),q=new Uint8Array(e*k);var u=new Float32Array(e*k);var r=new Float32Array(e*k);var v=new Float32Array(e*k);g.checkFramebufferStatus(g.FRAMEBUFFER)==g.FRAMEBUFFER_COMPLETE&&g.readPixels(0,0,e,k,g.RGBA,g.FLOAT,w);for(l=0;l<e*k;l++)u[l]=w[4*l],r[l]=w[4*l+1],v[l]=w[4*l+2],q[l]=w[4*l+3];a.pixelBlock=new b({width:e,height:k,pixels:[u,
r,v],mask:q});a.pixelBlock.calculateStatistics()}!n&&this.functionArguments.dra&&this._useGPUStats?(u=new Float32Array(h),r=new Float32Array(h)):(this._updateStatistisHistograms(a),w=this._getCutOffPoints(a),u=new Float32Array(h),r=new Float32Array(h),u.set(w.minCutOff.slice(0,h)),r.set(w.maxCutOff.slice(0,h)));this._initializeProgram({fragment:f.stretch,fragmentName:"Stretch"});w=this._setupTextureData(a);q=this.bindFrameBuffer();this.renderTexture=!1;this._performance.start();if(!n&&this.functionArguments.dra&&
this._useGPUStats){this._setUniforms({u_sourceDim:[e,k],u_bandCount:h});if(1===h)var z=this._readMinMax(w,2);else{z=this._readMinMax(w,0);var B=this._readMinMax(w,1)}if(6===this.functionArguments.stretchType||3===this.functionArguments.stretchType&&this.functionArguments.dra)l=this._readHistogram(z,B,a),u=l.minCutOff||u,r=l.minCutOff||r}v=this.functionArguments.max-this.functionArguments.min;a=new Float32Array(h);for(l=0;l<h;l++)a[l]=v/(r[l]-u[l]);this._useGPUStats&&this._initializeProgram({fragment:f.stretch,
fragmentName:"Stretch"});g.blendFunc(g.SRC_ALPHA,g.ZERO);v=new Float32Array(3);var A=new Float32Array(3);for(l=0;3>l;l++)v[l]=this.functionArguments.min,A[l]=this.functionArguments.max;l=this.functionArguments.useGamma;var y=this.functionArguments.gamma,D=this._gammaCorrection;Array.isArray(y)&&y.length>=h||(l=!1);this._setUniforms({u_sourceDim:[e,k],u_bandCount:h,u_minOutput:v,u_maxOutput:A,u_minCutOff:u,u_maxCutOff:r,u_factor:a,u_state:100,u_useGamma:l,u_gamma:y,u_scaled:!c,u_gammaCorrection:D,
u_minMaxTexture:!n&&this.functionArguments.dra&&this._useGPUStats?!0:!1});this.renderTexture=c;g.viewport(0,0,e,k);this._bindTexture(w.texture,"u_image");!n&&this.functionArguments.dra&&this._useGPUStats&&(c=g.getUniformLocation(this.rasterProgram,"u_image1"),g.uniform1i(c,1),g.activeTexture(g.TEXTURE1),g.bindTexture(g.TEXTURE_2D,z.texture),1<h&&(h=g.getUniformLocation(this.rasterProgram,"u_image2"),g.uniform1i(h,2),g.activeTexture(g.TEXTURE2),g.bindTexture(g.TEXTURE_2D,B.texture)));this._drawGL();
return{extent:w.extent,texture:q.texture}},_readMinMax:function(a,c){var l=this.gl,h=a.width||l.drawingBufferWidth,n=a.height||l.drawingBufferHeight;this._setUniforms({u_state:c});this.renderTexture=!1;var g=a.texture;for(l.activeTexture(l.TEXTURE0);1<h||1<n;){var e=this._createTexture();var k=Math.max(Math.ceil(h/2),1);var w=Math.max(Math.ceil(n/2),1);l.getExtension("OES_texture_float");l.texImage2D(l.TEXTURE_2D,0,l.RGBA,k,w,0,l.RGBA,l.FLOAT,null);var q=l.createFramebuffer();l.bindFramebuffer(l.FRAMEBUFFER,
q);l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,e,0);l.viewport(0,0,k,w);l.bindTexture(l.TEXTURE_2D,g);this._setUniforms({u_sourceDim:[h,n]});h=k;n=w;this._drawGL(!0);g=e}q=new Float32Array(h*n*4);l.checkFramebufferStatus(l.FRAMEBUFFER)==l.FRAMEBUFFER_COMPLETE&&l.readPixels(0,0,h,n,l.RGBA,l.FLOAT,q);return{texture:e,minmax:q}},_readHistogram:function(a,c,l){if(a)try{var h=this.gl,n=h.drawingBufferWidth,g=h.drawingBufferHeight,e,k,w;if(a.texture instanceof WebGLTexture){var q=
!0;var u=[1,0,0,1];if(c){var r=a.minmax;var v=c.minmax}else r=[a.minmax[0]],v=[a.minmax[1]]}else for(v=c,r=a,u=new Float32Array(v.length),e=0;e<v.length;e++)u[e]=256/(v[e]-r[e]);var z=new Float32Array(n*g);for(w=0;w<z.length;w++)z[w]=w;if(!this.histogramProgram){var B=m.getShader(h,m.histogram),A=f.getShader(h,f.constant);this.histogramProgram=this._loadProgram(B,A)}h.blendFunc(h.ONE,h.ONE);h.enable(h.BLEND);h.useProgram(this.histogramProgram);var y=h.getAttribLocation(this.histogramProgram,"a_pixelIndex"),
D=h.createBuffer();h.bindBuffer(h.ARRAY_BUFFER,D);h.bufferData(h.ARRAY_BUFFER,z,h.STATIC_DRAW);h.enableVertexAttribArray(y);h.vertexAttribPointer(y,1,h.FLOAT,!1,0,0);var G=this._setupHistTexture(l),E=this._createTexture();h.getExtension("OES_texture_float");h.texImage2D(h.TEXTURE_2D,0,h.RGBA,257,1,0,h.RGBA,h.FLOAT,null);var F=h.createFramebuffer();h.bindFramebuffer(h.FRAMEBUFFER,F);h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,E,0);h.viewport(0,0,257,1);var I=h.getUniformLocation(this.histogramProgram,
"u_image");h.uniform1i(I,0);h.activeTexture(h.TEXTURE0);h.bindTexture(h.TEXTURE_2D,G);var M=h.getUniformLocation(this.histogramProgram,"u_sourceDim");h.uniform2f(M,n,g);var P=h.getUniformLocation(this.histogramProgram,"u_bandCount");h.uniform1i(P,3);var W=h.getUniformLocation(this.histogramProgram,"u_halfPixel");h.uniform2f(W,.5/n,.5/g);var H=h.getUniformLocation(this.histogramProgram,"u_minMaxTexture");if(q){h.uniform1i(H,1);var O=h.getUniformLocation(this.histogramProgram,"u_image1");h.uniform1i(O,
1);h.activeTexture(h.TEXTURE1);h.bindTexture(h.TEXTURE_2D,a.texture);if(c){var K=h.getUniformLocation(this.histogramProgram,"u_image2");h.uniform1i(K,2);h.activeTexture(h.TEXTURE2);h.bindTexture(h.TEXTURE_2D,c.texture)}}else{var R=h.getUniformLocation(this.histogramProgram,"u_mins");h.uniform4f(R,r[0],r[0],r[0],r[0]);h.uniform1i(H,0)}var da=h.getUniformLocation(this.histogramProgram,"u_color"),U=h.getUniformLocation(this.histogramProgram,"u_factors"),Z=h.getUniformLocation(this.histogramProgram,"u_size");
h.uniform1f(Z,256);a=[];c=[];h.uniform4fv(da,[1,0,0,1]);h.uniform4fv(U,[u[0],0,0,1]);h.drawArrays(h.POINTS,0,z.length);var L=this.sourceRasterInfo.raster.bandCount;1<L&&(h.uniform4fv(da,[0,1,0,1]),h.uniform4fv(U,[0,u[0],0,1]),h.drawArrays(h.POINTS,0,z.length),h.uniform4fv(da,[0,0,1,1]),h.uniform4fv(U,[0,0,u[0],1]),h.drawArrays(h.POINTS,0,z.length));if(h.checkFramebufferStatus(h.FRAMEBUFFER)==h.FRAMEBUFFER_COMPLETE){var T=new Float32Array(1028);h.readPixels(0,0,257,1,h.RGBA,h.FLOAT,T);h=0;var Y=-.5===
r[0]&&1===(v[0]-r[0])/256?.5:0;for(e=0;e<L;e++){var ca=new Float32Array(257);var Q=new Float32Array(257);for(w=h=0;256>w;w++)h+=T[4*w+e],ca[w]=h,Q[w]=T[4*w+e];Q[256]=T[1024+e];ca[256]=h+T[1024+e];var X=this.functionArguments.minPercent*h/100;if(v){for(k=0;256>k;k++)if(ca[k]>X){a[e]=r[0]+(v[0]-r[0])/256*(k+Y);break}X=(1-this.functionArguments.maxPercent/100)*h;for(k=254;0<=k;k--)if(ca[k]<X){c[e]=r[0]+(v[0]-r[0])/256*(k+2-Y);break}}}}return{histogram:T,minCutOff:a,maxCutOff:c}}catch(ha){}},_setupHistTexture:function(a){if(a instanceof
WebGLTexture)return a;var c=this.originalHistTexture=this._createTexture(),l=this.gl;a=a.pixelBlock;var h=a.width,n=a.height;l.getExtension("OES_texture_float");this.rgbaFloatData=a.getAsRGBAFloat();l.texImage2D(l.TEXTURE_2D,0,l.RGBA,h,n,0,l.RGBA,l.FLOAT,this.rgbaFloatData);return c}})})},"esri/layers/rasterLib/function/RemapFunction":function(){define("dojo/_base/declare dojo/_base/lang ../../../renderers/colorRampGenerator ./RasterFunctionX ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),
function(t,p,x,b,m,f,d){return t([b,f],{declaredClass:"esri.layers.rasterLib.function.RemapFunction",functionName:"Remap",pixelType:"U8",renderTexture:!1,supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({inputRanges:null,outputValues:null,outputColors:null,colorBreaks:null,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input is not available.");var c=!(!this.functionArguments.outputColors&&!this.functionArguments.colorBreaks);
this.rasterInfo=p.mixin(a.raster,{bandCount:c?3:1,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType=c?"Processed":"Thematic";return!0},read2D:function(a){return this._remap(a.raster)},readGL:function(a){return this._remapGL(a.raster)},_remap:function(a){this._performance.start();var c=d.remapColor(a.pixelBlock,this.functionArguments.colorBreaks);this._addPerformanceMetric(this._performance.elapsed());
return{extent:a.extent,pixelBlock:c}},_remapGL:function(a){this._performance.start();this._initializeProgram({fragment:m.remap,fragmentName:"Remap"});var c=new Uint8Array(64),l=this.functionArguments.colorBreaks;l.forEach(function(e,k){c[4*k]=e.mappedColor[0];c[4*k+1]=e.mappedColor[1];c[4*k+2]=e.mappedColor[2];c[4*k+3]=1>=e.mappedColor[3]?255*e.mappedColor[3]:e.mappedColor[3]});var h=l[l.length-1],n=h.mappedColor;c[60]=n[0];c[61]=n[1];c[62]=n[2];c[63]=1>=n[3]?255*n[3]:n[3];var g=new Float32Array(16);
l.forEach(function(e,k){g[k]=e.value});g[15]=h.value;this._clrTexture||(this._clrTexture=this._setupColormapTexture(c));l=this._clrTexture;h=this.bindFrameBuffer();a=this._setupTextureData(a);this._setUniforms({u_indexedColormapOffset:0,u_indexedColormapMaxIndex:c.length/4-1,u_breaks:g});this._bindTexture(l,"u_image1");this._bindTexture(a.texture,"u_image");this._drawGL();return{extent:a.extent,texture:h.texture}},_setupColormapTexture:function(a){var c=this._createTexture(),l=a.length/4,h=new Float32Array(a.length),
n=this.renderTexture?255:1,g,e=this.gl;for(g=0;g<a.length;g++)h[g]=a[g]/n;e.getExtension("OES_texture_float");e.texImage2D(e.TEXTURE_2D,0,e.RGBA,l,1,0,e.RGBA,e.FLOAT,h);return c}})})},"esri/layers/rasterLib/function/IdentityFunction":function(){define(["dojo/_base/declare","dojo/_base/lang","./pixelShaders","./RasterFunctionX","./RasterFunctionWebGLMixin"],function(t,p,x,b,m){return t([b,m],{declaredClass:"esri.layers.rasterLib.function.IdentityFunction",functionName:"Identity",supportWebGL:!0,support2D:!0,
constructor:function(f){this.functionArguments={raster:null}},bind:function(f){f=this.getSourceRasterInfo(f);if(!f.raster)return Error("The raster input to identity function is invalid.");this.rasterInfo=p.mixin(f.raster,{});return!0},read2D:function(f){return f.raster},readGL:function(f){this._initializeProgram({fragment:x.identity,fragmentName:"identity"});f=this._setupTextureData(f.raster);var d=this.bindFrameBuffer();this._bindTexture(f.texture,"u_image");this._drawGL();return{extent:f.extent,
texture:d.texture}}})})},"esri/layers/rasterLib/function/ResampleFunction":function(){define(["dojo/_base/declare","dojo/_base/lang","./pixelShaders","./RasterFunctionX","./RasterFunctionWebGLMixin"],function(t,p,x,b,m){return t([b,m],{declaredClass:"esri.layers.rasterLib.function.ResampleFunction",renderTexture:!0,resamplingOrigin:null,resamplingRatio:null,zFactor:1,functionName:"Resample",supportWebGL:!0,support2D:!1,constructor:function(f){this.functionArguments=this.mixinIgnoreCase({resamplingType:0},
f)},bind:function(f){f=this.getSourceRasterInfo(f);if(!f.raster)return Error("The raster input to convolution function is invalid.");this.rasterInfo=p.mixin(f.raster,{bandCount:f.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,f.raster.pixelType),statistics:f.raster.statistics,histograms:f.raster.histograms});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};return!0},readGL:function(f){this._performance.start();this._initializeProgram({fragment:x.resample,fragmentName:"Resample"});
var d=this._setupTextureData(f.raster),a=this.bindFrameBuffer(),c=this.gl,l=c.drawingBufferWidth;c=c.drawingBufferHeight;var h=f.raster;void 0!==h.pixelBlock?(d=d||this._setupTextureData(h),f=h.pixelBlock.width,h=h.pixelBlock.height):(d=d||h,f=l,h=c);this._setUniforms({u_resamplingRatio:this.resamplingRatio||[f/l,h/c],u_anchor:this.resamplingOrigin||[0,1],u_resamplingType:this.functionArguments.resamplingType,u_resolution:[1/l,1/c]});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());
return{extent:d.extent,texture:a.texture}}})})},"esri/layers/rasterLib/renderer/rasterRendererHelper":function(){define("dojo/_base/declare dojo/_base/lang ../../PixelBlock ./RasterColormapRenderer ./RasterUniqueValueRenderer ./RasterRGBRenderer ./RasterStretchColorRampRenderer ./RasterClassBreaksRenderer ./RasterShadedReliefRenderer".split(" "),function(t,p,x,b,m,f,d,a,c){var l=function(){function h(g){n[g.prototype.rendererName]=g}var n={};h(b);h(f);h(d);h(m);h(a);h(c);return n}();return{wellKnownRenderers:l,
isSupported:function(h){if(!h)return!1;var n=!0;l[h.rendererName]||(n=!1);return n},create:function(h){if(!h)return null;if(h.rendererName){var n=h.rendererName;h=h.rendererArguments}else n="uniqueValue rasterStretch rasterShadedRelief rgb rasterColormap classBreaks".split(" ").indexOf(h.type),n="UniqueValue Stretch ShadedRelief RGB Colormap ClassBreaks".split(" ")[n],"rasterStretch"===h.type&&h.bandIndex&&1<h.bandIndex.length&&(n="RGB");return(n=l[n])?new n(h):null},createDefaultRenderer:function(h){if(h&&
h.raster){var n=h.raster.rasterInfo,g=h.raster.dataType;if(n){var e=h.raster.rasterFunction,k=["Stretch","Colormap","ContrastAndBrightness"];if(e&&"U8"===n.pixelType&&-1<k.indexOf(e.functionName))e.renderTexture=!0;else if("Processed"!==g||!(h.useWebGL&&e&&e.renderTexture||!h.useWebGL&&"U8"===n.pixelType)){e&&(n=e.rasterInfo);e=n.bandCount;var w=n.colormap,q=n.vat;k=n.histograms;k&&0===k.length&&(k=null);var u=n.statistics&&n.statistics.map(function(z){return[z.min,z.max,z.mean,z.stddev]});if(1===
e&&w&&0<w.length)var r=this._getDefaultColormapRenderer(q,w);else if(1===e&&q&&q.features&&0<q.features.length)r=new m({});else{w=0;q=!1;g||!h.raster||!h.raster.tileInfo||void 0!==h.raster.tileInfo.tileType&&"Map"!==h.raster.tileInfo.tileType?"U8"===n.pixelType&&"Processed"===g?(w=5,u=u||[[0,255,0,0],[0,255,0,0],[0,255,0,0]],q=!1):"U8"===n.pixelType||"Elevation"===g?(w=5,q=u?!1:!0):"Scientific"===g||"StdTime"===g?(w=5,q=u?!1:!0,r=this._getDefaultScientificColorRamp()):k&&0<k.length?(w=6,q=!1):u?(w=
5,q=!1):(w=6,q=!0):(u=[[0,255,0,0],[0,255,0,0],[0,255,0,0]],w=5,q=!1);u||(w=5,q=!0);var v;3<=e&&!(h.bandIds||h.raster&&h.raster.imageServiceParams&&h.raster.imageServiceParams.bandIds)&&(v=this.getDefaultBandCombination(n));v&&(u=v.map(function(z){return u[z]}));h={stretchType:w,min:0,max:255,dra:q,minPercent:.25,maxPercent:.25,useGamma:!1,computeGamma:!1,statistics:u,histograms:k,numberOfStandardDeviations:2.5,bandIndex:v};1===e||v&&1===v.length?(r&&(h.colorRamp=r,h.invert=!1),r=new d(h)):r=new f(h)}return r}}}},
getDefaultBandCombination:function(h){var n=h.bandCount;if(1===n)return null;if(2===n)return[0];var g=(h=h.keyProperties)&&h.ChangeAnalysisParameters&&h.ChangeAnalysisParameters.AnalysisType;if(g&&("ccdc"===g.toLowerCase()||"landtrendr"===g.toLowerCase()))return[0];h=h&&h.BandProperties;var e;if(h&&h.length===n){var k=this.getWellKnownBandIndexes(h);h=k.red;g=k.green;var w=k.blue;k=k.nir;null!=h&&null!=g&&null!=w?e=[h,g,w]:null!=k&&null!=h&&null!=g&&(e=[k,h,g])}!e&&3<=n&&(e=[0,1,2]);return e},getWellKnownBandIndexes:function(h){for(var n=
{},g=0;g<h.length;g++){var e=h[g],k=e.BandName&&e.BandName.toLowerCase();"red"===k?n.red=g:"green"===k?n.green=g:"blue"===k?n.blue=g:"nearinfrared"===k||"nearinfrared_1"===k||"nir"===k?n.nir=g:e.WavelengthMax&&e.WavelengthMin&&(k=e.WavelengthMin,e=e.WavelengthMax,null==n.blue&&410<=k&&480>=k&&480<=e&&540>=e?n.blue=g:null==n.green&&490<=k&&560>=k&&560<=e&&610>=e?n.green=g:null==n.red&&595<=k&&670>=k&&660<=e&&730>=e?n.red=g:null==n.nir&&700<=k&&860>=k&&800<=e&&950>=e&&(n.nir=g))}return n},_getDefaultColormapRenderer:function(h,
n){if(n||n.length){var g=[],e=this._ratContainsColormap(h);if(e)var k=this._getRATValueClassNameMap(h);n.forEach(function(w){var q=k?k[w[0]]:w[0];g.push({color:[w[1],w[2],w[3]],value:w[0],label:e?null!=q?q:"":w[0]})});return new b({colormapInfos:g})}},_ratContainsColormap:function(h){if(!h||!h.fields)return!1;var n,g,e;return h.fields.some(function(k){k&&k.name&&(k=k.name.toLowerCase(),"red"===k&&(n=!0),"green"===k&&(g=!0),"blue"===k&&(e=!0));return n&&g&&e})},_getRATValueClassNameMap:function(h){if(!h||
!h.fields)return null;var n={},g,e;h.fields.forEach(function(k){if("classname"===k.name.toLowerCase()||"class_name"===k.name.toLowerCase())g=k.name;"value"===k.name.toLowerCase()&&(e=k.name)});h.features.forEach(function(k){k=k.attributes;n[k[e]]=g?k[g]:k[e]});return n},_getDefaultScientificColorRamp:function(){return{type:"multipart",colorRamps:[{fromColor:[255,0,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,0,255]}].map(function(h){return{fromColor:h.toColor,
toColor:h.fromColor}}).reverse()}}}})},"esri/layers/rasterLib/renderer/RasterColormapRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","./RasterRenderer","../function/ColormapFunction"],function(t,p,x,b){return t([x],{declaredClass:"esri.layers.rasterLib.renderer.RasterColormapRenderer",rendererName:"Colormap",renderTexture:!0,constructor:function(m){m&&m.colormapInfos&&(m.colormap=m.colormapInfos.map(function(f){return[f.value].concat(f.color)}));this._function=new b(m);this._function.outputPixelType=
"U8";this._function.renderTexture=!0},draw2D:function(m){this._updateColormapParameters();m=this._clonePixelData(m);return m=this._function._colorize(m)},drawGL:function(m){this._updateColormapParameters();this._function._colorizeGL(m)},toJson:function(){var m=this._function.toJson().rasterFunctionArguments;return{rendererName:this.rendererName,rendererArguments:m}},toCommonRendererJson:function(){return{type:"rasterColormap",colormapInfos:this.colormapInfos||this.colormap.map(function(m){return{value:m[0],
color:m.slice(1),label:m[0]}})}},_updateColormapParameters:function(){var m=this._function.functionArguments;m.colormap=this.colormap;m.colormapName=this.colormapName;m.colorRamp=this.colorRamp;m.colorRampName=this.colorRampName}})})},"esri/layers/rasterLib/renderer/RasterRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","../../../geometry/Extent","../../PixelBlock"],function(t,p,x,b){return t(null,{declaredClass:"esri.layers.rasterLib.renderer.RasterRenderer",raster:null,constructor:function(m){m=
m||{};this.raster=m.raster||m.Raster||this.raster;this.draw=p.hitch(this,this.draw);this.bind=p.hitch(this,this.bind);m=p.clone(m);Object.keys(m).forEach(function(f){null==m[f]&&delete m[f]});p.mixin(this,m)},bind:function(m){if(!m)throw"failed to bind without options";var f=m;m.layer&&(m=m.layer,f={id:m.id,rawRasterInfo:m.raster.rasterInfo,glSetting:m._glSetting,xformSetting:m.tileManager&&m.tileManager.xformSetting,useWebGL:m.useWebGL,resampling:m.tileMode&&m.tileManager&&m.tileManager.xformSetting.requireProjection&&
!m._hasTilingEffects&&"Thematic"!==m.raster.dataType?1:0,tileMode:m.tileMode});this._rawRasterInfo=f.rawRasterInfo;this.useWebGL=f.useWebGL;this._function&&this._function.setProcessingContext(p.mixin({useProcessedData:!0},f));this._processingContext=f},hasTilingEffects:function(){},draw:function(m){return this.useWebGL?this.drawGL(m):this.draw2D(m)},toJson:function(){},_clonePixelData:function(m){if(null==m)return m;var f={};m.extent&&(f.extent=new x(m.extent.xmin,m.extent.ymin,m.extent.xmax,m.extent.ymax,
m.extent.spatialReference));m=m.processedPixelBlock||m.pixelBlock;if(null==m)return f;f.pixelBlock=m.clone?m.clone():b.prototype.clone(m);return f}})})},"esri/layers/rasterLib/renderer/RasterUniqueValueRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","./RasterRenderer","../function/ColormapFunction","../../../renderers/colorRampGenerator"],function(t,p,x,b,m){return t([x],{declaredClass:"esri.layers.rasterLib.renderer.RasterUniqueValueRenderer",rendererName:"UniqueValue",field:"",
alias:"",uniqueValueInfos:null,constructor:function(f){f&&f.colormap&&(this.colormap=f.colormap,this._function=new b(f),this._function.outputPixelType="U8",this._function.renderTexture=!0)},bind:function(f){this.inherited(arguments);if(!this._function){var d=(this.raster&&this.raster.rasterInfo||this._rawRasterInfo).vat;if(!d)throw"uv renderer requires data source to have raster attribute table";var a=this.attributeField||this.field1||this.field,c=this.infos||this.uniqueValueInfos;this.defaultColor=
this.defaultColor||this.defaultSymbol&&this.defaultSymbol.color;var l=d.fields.filter(function(r){return"value"===r.name.toLowerCase()})[0];if(l)var h=l.name;a||((a=d.fields.filter(function(r){return-1<["classname","category"].indexOf(r.name.toLowerCase())})[0])||(a=d.fields.filter(function(r){return"esriFieldTypeString"===r.type})[0]),this.alias=(this.field=a=a&&a.name||h)&&a.alias||h);var n=[],g;if(!c){c=[];var e=d.fields.filter(function(r){return"alpha"===r.name.toLowerCase()})[0];var k=d.fields.filter(function(r){return"red"===
r.name.toLowerCase()})[0];var w=d.fields.filter(function(r){return"green"===r.name.toLowerCase()})[0];var q=d.fields.filter(function(r){return"blue"===r.name.toLowerCase()})[0];for(l=0;l<d.features.length;l++){var u=d.features[l].attributes;(g=c.some(function(r){r.value===u[a]}))||(e&&k&&w&&q?c.push({value:u[a],alias:u[a],color:[u[k.name],u[w.name],u[q.name],u[e.name]]}):k&&w&&q?c.push({value:u[a],alias:u[a],color:[u[k.name],u[w.name],u[q.name]]}):c.push({value:u[a],alias:u[a]}))}if(!(k&&w&&q))for(g=
m.createRandomColorRamp({size:c.length}),l=0;l<c.length;l++)c[l].color=g[l];this.uniqueValueInfos=c}if(c)c.forEach(function(r){n=n.concat(d.features.filter(function(v){return r.value==v.attributes[a]}).map(function(v){return[v.attributes[h]].concat(r.color||r.symbol&&r.symbol.color)}))}),this.defaultColor&&d.features.filter(function(r){n.some(function(v){return v[0]===r.attributes[h]})||n.push([r.attributes[h]].concat(this.defaultColor))});else throw"missing uniqueValueInfos property";this._function=
new b({colormap:n});this.colormap=n;this._function.outputPixelType="U8";this._function.renderTexture=!0;this._function.setProcessingContext(this._processingContext)}},draw2D:function(f){f=this._clonePixelData(f);return f=this._function._colorize(f)},drawGL:function(f){this._function._colorizeGL(f)},toJson:function(f){var d={field:this.field,uniqueValueInfos:this.uniqueValueInfos,defaultColor:this.defaultColor};f&&(d.colormap=this.colormap);return{rendererName:this.rendererName,rendererArguments:d}},
toCommonRendererJson:function(){var f=this.attributeField||this.field1||this.field,d=(this.infos||this.uniqueValueInfos).map(function(a){return{value:a.value,label:a.alias+"",symbol:{color:3===a.color.length?a.color.concat([255]):a.color,type:"esriSFS",style:"esriSFSSolid"}}});return{type:"uniqueValue",field1:f,uniqueValueInfos:d}}})})},"esri/layers/rasterLib/renderer/RasterRGBRenderer":function(){define("dojo/_base/declare dojo/_base/lang ./RasterRenderer ../function/StretchFunction ../function/ContrastBrightnessFunction ../function/rasterUtils".split(" "),
function(t,p,x,b,m,f){return t([x],{declaredClass:"esri.layers.rasterLib.renderer.RasterRGBRenderer",rendererName:"RGB",bandIndex:null,stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,maxPercent:.5,useGamma:!1,gamma:null,computeGamma:!1,sigmoidStrengthLevel:1,constructor:function(d){this.stretchType="number"===typeof this.stretchType?this.stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ").indexOf(this.stretchType);
d=p.mixin({},d,{stretchType:this.stretchType});this._stretchFunction=new b(d);this._stretchFunction.outputPixelType="U8";this._stretchFunction.renderTexture=!1;this.bandIndex=d.bandIndex||d.BandIndex;this._function=new m(d);this._function.functionArguments.raster=this._stretchFunction;this._function.renderTexture=!0},hasTilingEffects:function(){return this._stretchFunction.hasTilingEffects()},draw2D:function(d){this._updateStretchParameters();d=this._clonePixelData(d);if("U8"===d.pixelBlock.pixelType&&
!this.contrastOffset&&!this.brightnessOffset)return d;this._stretchFunction._stretch(d);var a=d.pixelBlock,c=this.bandIndex,l=Math.max.apply(null,c);a&&a.pixels.length>l&&c&&(a.pixels=c.map(function(h){return a.pixels[h]}),a.statistics&&(a.statistics=c.map(function(h){return a.statistics[h]})));if(this.contrastOffset||this.brightnessOffset)d.pixelBlock=f.contrastBrightnessStretch(d.pixelBlock,{contrastOffset:this.contrastOffset,brightnessOffset:this.brightnessOffset});return d},drawGL:function(d){this._updateStretchParameters();
d.pixelBlock&&(d=this._clonePixelData(d));var a=d.pixelBlock,c=this.bandIndex,l=Math.max.apply(null,c),h=this.statistics&&0<this.statistics.length?this.statistics:this._stretchFunction&&this._stretchFunction.srcStatistics,n=this.histograms&&0<this.histograms.length?this.histograms:this._stretchFunction&&this._stretchFunction.srcHistograms,g,e;a&&a.pixels.length>l&&c&&(a.pixels=c.map(function(k){return a.pixels[k]}),a.statistics&&(a.statistics=c.map(function(k){return a.statistics[k]})),h&&0<h.length&&
h.length!==c.length&&(g=c.map(function(k){return h[k]})),n&&0<n.length&&n.length!==c.length&&(e=c.map(function(k){return n[k]})));this._stretchFunction.functionArguments.statistics=g||h;this._stretchFunction.functionArguments.histograms=e||n;this.contrastOffset||this.brightnessOffset?(this._stretchFunction.renderTexture=!1,this._function.renderTexture=!0,d=this._stretchFunction._stretchGL(d),this._function._cbGL(d)):(this._stretchFunction.renderTexture=!0,this._stretchFunction._stretchGL(d))},toJson:function(){var d=
this._stretchFunction.toJson().rasterFunctionArguments;d.bandIndex=this.bandIndex;d.contrastOffset=this.contrastOffset;d.brightnessOffset=this.brightnessOffset;return{rendererName:this.rendererName,rendererArguments:d}},toCommonRendererJson:function(){return{type:"rasterStretch",stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ")[this.stretchType]||"minMax",min:this.min,max:this.max,numberOfStandardDeviations:this.numberOfStandardDeviations,statistics:p.clone(this.statistics),
dra:this.dra,minPercent:this.minPercent,maxPercent:this.maxPercent,useGamma:this.useGamma,gamma:p.clone(this.gamma),computeGamma:this.computeGamma,sigmoidStrengthLevel:this.sigmoidStrengthLevel}},_updateStretchParameters:function(){var d=this._stretchFunction.functionArguments;d.stretchType=this.stretchType;d.min=this.min;d.max=this.max;d.numberOfStandardDeviations=this.numberOfStandardDeviations;d.statistics=this.statistics;d.histograms=this.histograms;d.dra=this.dra;d.minPercent=this.minPercent;
d.maxPercent=this.maxPercent;d.useGamma=this.useGamma;d.gamma=this.gamma;d.computeGamma=this.computeGamma;this._stretchFunction.interpolation=this.interpolation}})})},"esri/layers/rasterLib/renderer/RasterStretchColorRampRenderer":function(){define("dojo/_base/declare dojo/_base/lang ./RasterRenderer ../function/ResampleFunction ../function/StretchFunction ../function/ContrastBrightnessFunction ../function/ColormapFunction ../function/rasterUtils".split(" "),function(t,p,x,b,m,f,d,a){return t([x],
{declaredClass:"esri.layers.rasterLib.renderer.RasterStretchColorRampRenderer",rendererName:"Stretch",bandIndex:[0],colorRamp:null,invert:!1,stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,maxPercent:.5,useGamma:!1,gamma:null,computeGamma:!1,sigmoidStrengthLevel:1,constructor:function(c){this.stretchType="number"===typeof this.stretchType?this.stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ").indexOf(this.stretchType);
c=p.mixin({},c,{stretchType:this.stretchType});Object.keys(c).forEach(function(l){null==c[l]&&delete c[l]});this._function=new f(c);this._stretchFunction=new m(c);this._stretchFunction.outputPixelType="U8";this._stretchFunction.renderTexture=!1;this._clrFunction=new d(c);this._clrFunction.functionArguments.raster=this._stretchFunction;this._clrFunction.renderTexture=!1;this._function.functionArguments.raster=this._clrFunction},hasTilingEffects:function(){return this._stretchFunction.hasTilingEffects()},
draw2D:function(c){this._updateStretchParameters();c=this._clonePixelData(c);if("U8"===c.pixelBlock.pixelType&&!(this.contrastOffset||this.brightnessOffset||this.colorRamp))return c;this._stretchFunction._stretch(c);var l=c.pixelBlock,h=this.bandIndex?this.bandIndex[0]:0;l&&1<l.pixels.length&&l.pixels.length>h&&(l.pixels=[l.pixels[h]],l.statistics&&(l.statistics=[l.statistics[h]]));this.colorRamp&&(c=this._clrFunction._colorize(c));if(this.contrastOffset||this.brightnessOffset)c.pixelBlock=a.contrastBrightnessStretch(c.pixelBlock,
{contrastOffset:this.contrastOffset,brightnessOffset:this.brightnessOffset});return c},drawGL:function(c){this._updateStretchParameters();c.pixelBlock&&(c=this._clonePixelData(c));var l=c.pixelBlock,h=this.bandIndex?this.bandIndex[0]||0:0,n=this.statistics&&0<this.statistics.length?this.statistics:this._stretchFunction&&this._stretchFunction.srcStatistics,g=this.histograms&&0<this.histograms.length?this.histograms:this._stretchFunction&&this._stretchFunction.srcHistograms,e,k;l&&1<l.pixels.length&&
l.pixels.length>h&&(l.pixels=[l.pixels[h]],l.statistics&&(l.statistics=[l.statistics[h]]),n&&n.length>h&&(e=[n[h]]),g&&g.length>h&&(k=[g[h]]));this._stretchFunction.functionArguments.statistics=e||n;this._stretchFunction.functionArguments.histograms=k||g;l=!!this.colorRamp;this.contrastOffset||this.brightnessOffset?(this._stretchFunction.renderTexture=!1,this._clrFunction.renderTexture=!1,this._function.renderTexture=!0,c=this._stretchFunction._stretchGL(c),l&&(c=this._clrFunction._colorizeGL(c)),
this._function._cbGL(c)):l?(this._stretchFunction.renderTexture=!1,this._clrFunction.renderTexture=!0,c=this._stretchFunction._stretchGL(c),this._clrFunction._colorizeGL(c)):(this._stretchFunction.renderTexture=!0,this._stretchFunction._stretchGL(c))},toJson:function(){var c=this._stretchFunction.toJson().rasterFunctionArguments;c.colorRamp=this.colorRamp||"";this.invert&&(c.invert=!0);c.contrastOffset=this.contrastOffset;c.brightnessOffset=this.brightnessOffset;return{rendererName:this.rendererName,
rendererArguments:c}},toCommonRendererJson:function(){return{type:"rasterStretch",stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ")[this.stretchType]||"minMax",colorRamp:this.colorRamp&&this.colorRamp.toJson?this.colorRamp.toJson():this.colorRamp,min:this.min,max:this.max,numberOfStandardDeviations:this.numberOfStandardDeviations,statistics:p.clone(this.statistics),dra:this.dra,minPercent:this.minPercent,maxPercent:this.maxPercent,useGamma:this.useGamma,
gamma:p.clone(this.gamma),computeGamma:this.computeGamma,sigmoidStrengthLevel:this.sigmoidStrengthLevel}},_updateStretchParameters:function(){var c=this._stretchFunction.functionArguments;c.stretchType=this.stretchType;c.min=this.min;c.max=this.max;c.numberOfStandardDeviations=this.numberOfStandardDeviations;c.statistics=this.statistics;c.histograms=this.histograms;c.dra=this.dra;c.minPercent=this.minPercent;c.maxPercent=this.maxPercent;c.useGamma=this.useGamma;c.gamma=this.gamma;c.computeGamma=this.computeGamma;
this._stretchFunction.interpolation=this.interpolation}})})},"esri/layers/rasterLib/renderer/RasterClassBreaksRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","./RasterRenderer","../function/ColormapFunction","../function/RemapFunction"],function(t,p,x,b,m){return t([x],{declaredClass:"esri.layers.rasterLib.renderer.RasterClassBreaksRenderer",rendererName:"ClassBreaks",renderTexture:!0,constructor:function(f){f=f||{};this._function=new m(f);this._function.outputPixelType="U8";var d=
f.classBreakInfos;f=f.minValue;null!=f&&d&&(this._function.functionArguments.colorBreaks=this._getSortedColorBreaks(f,d))},bind:function(f){this.inherited(arguments);this.isColormapFunction=!1;var d=this.raster&&this.raster.rasterInfo||this._rawRasterInfo,a=d&&d.vat;if(a&&"u8"===d.pixelType.toLowerCase()&&this.classBreakInfos){var c=this.field;if(d=a.fields.filter(function(k){return"value"===k.name.toLowerCase()})[0])var l=d.name;var h=a.features.sort(function(k,w){return parseFloat(k.attributes[c])-
parseFloat(w.attributes[c])})[0].attributes[c];this.isColormapFunction=!0;var n=[],g=this.field,e=this.classBreakInfos;e.forEach(function(k,w){a.features.forEach(function(q){var u=e[w-1]&&e[w-1].classMaxValue||h;q.attributes[g]<=k.classMaxValue&&(q.attributes[g]>u||q.attributes[g]===h)&&(u=k.symbol.color,n.some(function(r){return r[0]===q.attributes[l]})||n.push([q.attributes[l]].concat(u)))})});this._function=new b({colormap:n});this.colormap=n;this._function.outputPixelType="U8";this._function.renderTexture=
!0}this._function&&this._function.setProcessingContext(p.mixin({useProcessedData:!0},this._processingContext))},draw2D:function(f){if(this.isColormapFunction)return this._updateColormapParameters(),f=this._clonePixelData(f),f=this._function._colorize(f);this._updateRemapParameters();return this._function._remap(f)},drawGL:function(f){this.isColormapFunction?(this._updateColormapParameters(),this._function._colorizeGL(f)):(this._function.renderTexture=!0,this._updateRemapParameters(),this._function._remapGL(f))},
toJson:function(){var f=this._function.toJson().rasterFunctionArguments;return{rendererName:this.rendererName,rendererArguments:f}},toCommonRendererJson:function(){var f,d=this.classBreakInfos,a=this.colorBreaks;if(null==d&&a)for(d=[],f=0;f<a.length-1;f++)d.push({classMaxValue:a[f+1].value,symbol:{color:a[f].mappedColor,type:"esriSFS",style:"esriSFSSolid"},label:a[f].value+" - "+a[f+1].value});return{type:"classBreaks",field:"Value",minValue:null!=this.minValue?this.minValue:a[0].value,classBreakInfos:d}},
_updateRemapParameters:function(){var f=this.classBreakInfos,d=this.minValue;null!=d&&f&&(this._function.functionArguments.colorBreaks=this._getSortedColorBreaks(d,f))},_getSortedColorBreaks:function(f,d){var a=d.map(function(h){return{maxValue:h.classMaxValue,color:h.symbol.color}}).sort(function(h,n){return h.maxValue-n.maxValue}),c,l=[{value:f,mappedColor:a[0].color}];for(c=0;c<a.length;c++)l.push({value:a[c].maxValue,mappedColor:c===a.length-1?a[c].color:a[c+1].color});return l},_updateColormapParameters:function(){this._function.functionArguments.colormap=
this.colormap;this._function.interpolation=this.interpolation}})})},"esri/layers/rasterLib/renderer/RasterShadedReliefRenderer":function(){define("dojo/_base/declare dojo/_base/lang ./RasterRenderer ../function/HillshadeFunction ../function/ContrastBrightnessFunction ../function/ColormapFunction ../function/rasterUtils".split(" "),function(t,p,x,b,m,f,d){return t([x],{declaredClass:"esri.layers.rasterLib.renderer.RasterShadedReliefRenderer",rendererName:"ShadedRelief",hillshadeType:null,azimuth:315,
altitude:45,zFactor:1,slopeType:null,psPower:.664,psFactor:.024,raster:null,constructor:function(a){this.hillshadeType="number"===typeof this.hillshadeType?this.hillshadeType:["traditional","multi-directional"].indexOf(this.hillshadeType);a&&a.scalingType&&(this.slopeType="adjusted"===a.scalingType?3:1);a&&a.pixelSizePower&&(this.psPower=a.pixelSizePower);a&&a.pixelSizeFactor&&(this.psFactor=a.pixelSizeFactor);a=p.mixin({},a,{hillshadeType:this.hillshadeType,psPower:this.psPower,psFactor:this.psFactor,
slopeType:this.slopeType});Object.keys(a).forEach(function(c){null==a[c]&&delete a[c]});this._function=new m(a);this._hillshadeFunction=new b(a);this._hillshadeFunction.outputPixelType="U8";this._hillshadeFunction.renderTexture=!1;this._function.functionArguments.raster=this._hillshadeFunction},hasTilingEffects:function(){return this._hillshadeFunction.hasTilingEffects()},draw2D:function(a){this._updateHillshadeParameters();a=this._clonePixelData(a);a=this._hillshadeFunction.read2D({raster:a});if(this.contrastOffset||
this.brightnessOffset)a.pixelBlock=d.contrastBrightnessStretch(a.pixelBlock,{contrastOffset:this.contrastOffset,brightnessOffset:this.brightnessOffset});return a},drawGL:function(a){this._updateHillshadeParameters();this.contrastOffset||this.brightnessOffset?(this._hillshadeFunction.renderTexture=!1,this._function.renderTexture=!0,a=this._hillshadeFunction.readGL({raster:a}),this._function._cbGL(a)):(this._hillshadeFunction.renderTexture=!0,this._hillshadeFunction.readGL({raster:a}))},toJson:function(){var a=
this._hillshadeFunction.toJson().rasterFunctionArguments;a.colorRamp=this.colorRamp||"";this.invert&&(a.invert=!0);a.contrastOffset=this.contrastOffset;a.brightnessOffset=this.brightnessOffset;return{rendererName:this.rendererName,rendererArguments:a}},toCommonRendererJson:function(){return{type:"rasterShadedRelief",hillshadeType:["traditional","multi-directional"][this.hillshadeType]||"traditional",azimuth:this.azimuth,altitude:this.altitude,zFactor:this.zFactor,scalingType:3===this.slopeType?"adjusted":
"none",pixelSizePower:this.psPower,pixelSizeFactor:this.psFactor,colorRamp:this.colorRamp&&this.colorRamp.toJson?this.colorRamp.toJson():this.colorRamp}},_updateHillshadeParameters:function(){var a=this._hillshadeFunction.functionArguments;a.hillshadeType=this.hillshadeType;a.azimuth=this.azimuth;a.altitude=this.altitude;a.zFactor=this.zFactor;a.slopeType=this.slopeType;a.psPower=this.psPower;a.psFactor=this.psFactor}})})},"esri/layers/rasterLib/raster/rasterProjectionHelper":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/sniff ../../../kernel ../../../WKIDUnitConversion ../../../geometry/Extent ../../../geometry/projection ../../../geometry/webMercatorUtils ../../../SpatialReference ../../../geometry/Point".split(" "),
function(t,p,x,b,m,f,d,a,c,l,h){t={requirePE:function(g,e){return!(g.equals(e)||g._canProject(e))},load:function(){var g=new x;if(!this._loadPromise)if(a.isSupported())this._loadPromise=a.load();else{var e=new x;e.reject("projection engine is not supported on this version of the browser, please try with a modern browser");this._loadPromise=e.promise}this._loadPromise.isFulfilled()?this._loadPromise.isResolved()?g.resolve():this._loadPromise.isRejected()&&g.resolve():(this._pendingdfds=this._pendingdfds||
[],this._pendingdfds.push(g),this._loadPromise.then(p.hitch(this,function(){this._pendingdfds.forEach(function(k){k.isFulfilled()||k.resolve()})}),p.hitch(this,function(){this._pendingdfds.forEach(function(k){k.isFulfilled()||k.reject()})})));return g.promise},computeError:function(g,e){return[Math.abs((g[0]+g[4]+g[4*e.rows]+g[4*e.rows+4])/4-g[2*e.rows+2]),Math.abs((g[1]+g[5]+g[4*e.rows+1]+g[4*e.rows+5])/4-g[2*e.rows+3])]},getDefaultDatumTransformationForDataset:function(g,e,k){if(!(e&&g.spatialReference&&
this.requirePE(g.spatialReference,e)&&a.isLoaded()))return null;g=new d(g.toJson());e=new l(e.toJson());return k?a.getTransformation(e,g.spatialReference,g):a.getTransformation(g.spatialReference,e,g)},project:function(g,e,k){if(!e||g.spatialReference.equals(e))return g;var w=a.isLoaded()?a:c;"esri.geometry.Extent"===g.declaredClass?g=new d(g.toJson()):"esri.geometry.Point"===g.declaredClass&&(g=new h(g.toJson()));e=new l(e.toJson());(g=w.project(g,e))&&"esri.geometry.Extent"===g.declaredClass?(g=
new d(g.toJson()),k&&(1E-5>Math.abs(g.xmin+180)&&1E-5>Math.abs(g.xmax-180)?(g.xmin=0,g.xmax=360):(0>g.xmin&&(g.xmin+=360,g.xmax+=360),0>g.xmax&&(g.xmax+=360)))):g&&"esri.geometry.Point"===g.declaredClass&&(g=new h(g.toJson()),k&&0>g.x&&(g.x+=360));return g},projectResolution:function(g,e,k){var w=k.xmin+(k.xmax-k.xmin)/2;k=k.ymin+(k.ymax-k.ymin)/2;g=new d(w,k,w+g.x,k+g.y,g.spatialReference);g=this.project(g,e);return new h(g.xmax-g.xmin,g.ymax-g.ymin,e)},getProjectionOffsetGrid:function(g,e,k,w,q,
u,r){null==r&&(r=[32,32]);var v=g.xmin,z=g.ymin,B=g.xmax,A=g.ymax,y=g.spatialReference,D=e.spatialReference,G=a.isLoaded()?a:c,E=q?-q:null,F=r[0]*k.x,I=r[1]*k.y;B={cols:Math.ceil((B-v)/F)+1,rows:Math.ceil((A-z)/I)+1};g=[];for(A=0;A<B.cols;A++){var M=P;var P=[];for(k=0;k<B.rows;k++){var W=new h({x:v+F*A,y:z+I*k,spatialReference:y});W=G.project(W,D,u);if(!W)return null;w&&0>W.x&&(W.x+=360);P.push(W);0<A&&null!=E&&W.x<M[k].x&&(W.x+=q-E,W.x<M[k].x&&(W.x+=q-E));g.push((W.x-e.xmin)/(e.xmax-e.xmin));g.push((W.y-
e.ymin)/(e.ymax-e.ymin))}}e=this.computeError(g,B);w=new Float32Array((B.cols-1)*(B.rows-1)*12);q=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]);u=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(A=0;A<B.cols-1;A++)for(k=0;k<B.rows-1;k++){F=A*B.rows*2+2*k;v=g[F];z=g[F+1];P=g[F+2];y=g[F+3];F+=2*B.rows;D=g[F];G=g[F+1];E=g[F+2];I=g[F+3];M=0;W=12*(k*(B.cols-1)+A);for(F=0;3>F;F++)w[W++]=q[M++]*v+q[M++]*P+q[M++]*E;for(F=M=0;3>F;F++)w[W++]=q[M++]*z+q[M++]*y+q[M++]*I;for(F=M=0;3>F;F++)w[W++]=u[M++]*v+u[M++]*D+u[M++]*
E;for(F=M=0;3>F;F++)w[W++]=u[M++]*z+u[M++]*G+u[M++]*I}return{offsets:g,error:e,coefficients:w,spacing:r,size:[B.cols-1,B.rows-1]}},getHalfWorldWidth:function(g){var e=g&&g.wkid;if(null!=e)return g.isWebMercator()&&(e=3857),null==f[e]?180:n[e]}};p.setObject("layers.rasterLib.raster.rasterProjectionHelper",t,m);var n={3395:2.0037508342789244E7,3410:1.7334193943686873E7,3857:2.0037508342788905E7,3975:1.7367530445161372E7,4087:2.0037508342789244E7,4088:2.0015108787169147E7,6933:1.7367530445161372E7,32662:2.0037508342789244E7,
53001:2.001508679602057E7,53002:1.000754339801029E7,53003:2.001508679602057E7,53004:2.001508679602057E7,53016:1.4152803599503474E7,53017:1.7333573624304302E7,53034:2.001508679602057E7,53079:2.0015114352186374E7,53080:2.0015114352186374E7,54001:2.0037508342789244E7,54002:1.0018754171394624E7,54003:2.0037508342789244E7,54004:2.0037508342789244E7,54016:1.4168658027268292E7,54017:1.736753044516137E7,54034:2.0037508342789244E7,54079:2.0037508342789244E7,54080:2.0037508342789244E7,54100:2.0037508342789244E7,
54101:2.0037508342789244E7};return t})},"esri/geometry/projection":function(){define("require exports dojo/Deferred ./pe ../SpatialReference ./GeographicTransformation".split(" "),function(t,p,x,b,m,f){function d(n,g,e,k,w){void 0===k&&(k=null);void 0===w&&(w=!1);if(null===k){var q=f.cacheKey(g,e);void 0!==h[q]?k=h[q]:(k=a(g,e,null),null===k&&(k=new f),h[q]=k)}return c._project(n,g,e instanceof m||!1===w?e:new m(e),k,w)}function a(n,g,e){void 0===e&&(e=null);n=c._getTransformation(n,g,e);return null!==
n?f.fromGE(n):null}Object.defineProperty(p,"__esModule",{value:!0});var c=null;p.isLoaded=function(){return!!c&&b.isLoaded()};p.isSupported=function(){return b.isSupported()};var l=null;p.load=function(){if(l)return l.promise;l=new x;var n=b.load();t(["./geometryEngine"],function(g){c=g;n.then(function(){c._enableProjection(b);l.resolve()},function(e){l.reject(e)})});return l.promise};p.project=function(n,g,e){void 0===e&&(e=null);return n instanceof Array?0===n.length?[]:d(n,n[0].spatialReference,
g,e):d([n],n.spatialReference,g,e)[0]};var h={};p.projectMany=d;p.getTransformation=a;p.getTransformations=function(n,g,e){void 0===e&&(e=null);n=c._getTransformationBySuitability(n,g,e);if(null!==n){g=[];for(e=0;e<n.length;e++)g.push(f.fromGE(n[e]));return g}return[]}})},"esri/geometry/pe":function(){define(["require","exports","../core/tsSupport/extendsHelper","dojo/Deferred","../core/sniff"],function(t,p,x,b,m){function f(q){function u(B,A,y){B[A]=y(B[A])}p._pe=q;n.init();g.init();e.init();k.init();
w.init();p.PeGCSExtent=function(B){function A(){return null!==B&&B.apply(this,arguments)||this}x(A,B);A.prototype.destroy=function(){p._pe.destroy(this)};return A}(p._pe.PeGCSExtent);for(var r=0,v=[p._pe.PeDatum,p._pe.PeGeogcs,p._pe.PeGeogtran,p._pe.PeObject,p._pe.PeParameter,p._pe.PePrimem,p._pe.PeProjcs,p._pe.PeSpheroid,p._pe.PeUnit];r<v.length;r++)q=v[r],u(q.prototype,"getName",function(B){return function(){return B.call(this,Array(n.PE_NAME_MAX))}});r=0;for(v=[p._pe.PeGeogtran,p._pe.PeProjcs];r<
v.length;r++)q=v[r],u(q.prototype,"getParameters",function(B){return function(){for(var A=Array(n.PE_PARM_MAX),y=B.call(this),D=0;D<A.length;D++){var G=p._pe.getValue(y,"*");A[D]=G?p._pe.wrapPointer(G,p._pe.PeParameter):null;y+=Int32Array.BYTES_PER_ELEMENT}return A}});u(p._pe.PeHorizon.prototype,"getCoord",function(B){return function(){var A=this.getSize();if(!A)return null;var y=[],D=B.call(this);l(y,A,D);return y}});u(p._pe.PeGTlistExtendedEntry.prototype,"getEntries",function(B){var A=p._pe._pe_getPeGTlistExtendedGTsSize();
return function(){var y=null,D=B.call(this);if(!p._pe.compare(D,p._pe.NULL)){y=[D];var G=this.getSteps();if(1<G){D=p._pe.getPointer(D);for(var E=1;E<G;E++)y.push(p._pe.wrapPointer(D+A*E,p._pe.PeGTlistExtendedGTs))}}return y}});var z=p._pe._pe_getPeHorizonSize();q=function(B){return function(){var A=this._cache;A||(this._cache=A=new Map);if(A.has(B))return A.get(B);var y=null,D=B.call(this);if(!p._pe.compare(D,p._pe.NULL)){y=[D];var G=D.getNump();if(1<G){D=p._pe.getPointer(D);for(var E=1;E<G;E++)y.push(p._pe.wrapPointer(D+
z*E,p._pe.PeHorizon))}}A.set(B,y);return y}};u(p._pe.PeProjcs.prototype,"horizonGcsGenerate",q);u(p._pe.PeProjcs.prototype,"horizonPcsGenerate",q);p._pe.PeObject.prototype.toString=function(B){void 0===B&&(B=n.PE_STR_OPTS_NONE);p._pe.ensureCache.prepare();var A=p._pe.getPointer(this),y=p._pe.ensureInt8(Array(n.PE_BUFFER_MAX));return p._pe.UTF8ToString(p._pe._pe_object_to_string_ext(A,B,y))}}function d(q){if(q){var u=p._pe.getClass(q);u&&(u=p._pe.getCache(u))&&(q=p._pe.getPointer(q))&&delete u[q]}}
function a(q,u){for(var r=[],v=Array(u),z=0;z<q;z++)r.push(p._pe.ensureInt8(v));return r}function c(q){if(Array.isArray(q[0])){var u=[];q.forEach(function(r){u.push(r[0],r[1])})}else u=q;return u}function l(q,u,r,v){void 0===v&&(v=!1);if(v)for(v=0;v<2*u;v++)q[v]=p._pe.getValue(r+v*Float64Array.BYTES_PER_ELEMENT,"double");else{var z=0===q.length;for(v=0;v<u;v++)z&&(q[v]=Array(2)),q[v][0]=p._pe.getValue(r,"double"),q[v][1]=p._pe.getValue(r+Float64Array.BYTES_PER_ELEMENT,"double"),r+=2*Float64Array.BYTES_PER_ELEMENT}}
Object.defineProperty(p,"__esModule",{value:!0});var h;p._pe=null;p.isLoaded=function(){return!!p._pe};p.isSupported=function(){return!!m("esri-wasm")};p.load=function(){if(h)return h.promise;h=new b;t(["./support/pe-wasm"],function(q){q({locateFile:function(u){return t.toUrl("./support/"+u)},onAbort:function(u){h.reject(Error(u))}}).then(function(u){f(u);h.resolve()})});return h.promise};(function(q){function u(z,B,A){p._pe.ensureCache.prepare();var y=c(A),D=A===y;y=p._pe.ensureFloat64(y);(z=p._pe._pe_geog_to_proj(p._pe.getPointer(z),
B,y))&&l(A,B,y,D);return z}function r(z,B,A){return v(z,B,A,0)}function v(z,B,A,y){p._pe.ensureCache.prepare();var D=c(A),G=A===D;D=p._pe.ensureFloat64(D);(z=p._pe._pe_proj_to_geog_center(p._pe.getPointer(z),B,D,y))&&l(A,B,D,G);return z}q.geogToProj=u;q.projGeog=function(z,B,A,y){switch(y){case n.PE_TRANSFORM_P_TO_G:return r(z,B,A);case n.PE_TRANSFORM_G_TO_P:return u(z,B,A)}return 0};q.projToGeog=r;q.projToGeogCenter=v})(p.PeCSTransformations||(p.PeCSTransformations={}));var n;(function(q){q.init=
function(){q.PE_BUFFER_MAX=p._pe.PeDefs.prototype.PE_BUFFER_MAX;q.PE_NAME_MAX=p._pe.PeDefs.prototype.PE_NAME_MAX;q.PE_MGRS_MAX=p._pe.PeDefs.prototype.PE_MGRS_MAX;q.PE_USNG_MAX=p._pe.PeDefs.prototype.PE_USNG_MAX;q.PE_DD_MAX=p._pe.PeDefs.prototype.PE_DD_MAX;q.PE_DDM_MAX=p._pe.PeDefs.prototype.PE_DDM_MAX;q.PE_DMS_MAX=p._pe.PeDefs.prototype.PE_DMS_MAX;q.PE_UTM_MAX=p._pe.PeDefs.prototype.PE_UTM_MAX;q.PE_PARM_MAX=p._pe.PeDefs.prototype.PE_PARM_MAX;q.PE_TYPE_NONE=p._pe.PeDefs.prototype.PE_TYPE_NONE;q.PE_TYPE_GEOGCS=
p._pe.PeDefs.prototype.PE_TYPE_GEOGCS;q.PE_TYPE_PROJCS=p._pe.PeDefs.prototype.PE_TYPE_PROJCS;q.PE_TYPE_GEOGTRAN=p._pe.PeDefs.prototype.PE_TYPE_GEOGTRAN;q.PE_TYPE_COORDSYS=p._pe.PeDefs.prototype.PE_TYPE_COORDSYS;q.PE_TYPE_UNIT=p._pe.PeDefs.prototype.PE_TYPE_UNIT;q.PE_STR_OPTS_NONE=p._pe.PeDefs.prototype.PE_STR_OPTS_NONE;q.PE_STR_AUTH_NONE=p._pe.PeDefs.prototype.PE_STR_AUTH_NONE;q.PE_STR_AUTH_TOP=p._pe.PeDefs.prototype.PE_STR_AUTH_TOP;q.PE_STR_NAME_CANON=p._pe.PeDefs.prototype.PE_STR_NAME_CANON;q.PE_PARM_X0=
p._pe.PeDefs.prototype.PE_PARM_X0;q.PE_PARM_ND=p._pe.PeDefs.prototype.PE_PARM_ND;q.PE_TRANSFORM_1_TO_2=p._pe.PeDefs.prototype.PE_TRANSFORM_1_TO_2;q.PE_TRANSFORM_2_TO_1=p._pe.PeDefs.prototype.PE_TRANSFORM_2_TO_1;q.PE_TRANSFORM_P_TO_G=p._pe.PeDefs.prototype.PE_TRANSFORM_P_TO_G;q.PE_TRANSFORM_G_TO_P=p._pe.PeDefs.prototype.PE_TRANSFORM_G_TO_P;q.PE_HORIZON_RECT=p._pe.PeDefs.prototype.PE_HORIZON_RECT;q.PE_HORIZON_POLY=p._pe.PeDefs.prototype.PE_HORIZON_POLY;q.PE_HORIZON_LINE=p._pe.PeDefs.prototype.PE_HORIZON_LINE;
q.PE_HORIZON_DELTA=p._pe.PeDefs.prototype.PE_HORIZON_DELTA}})(n=p.PeDefs||(p.PeDefs={}));(function(q){function u(B,A){var y=null,D=v[B];D||(D={},v[B]=D);if(D.hasOwnProperty(String(A)))y=D[A];else{var G=p._pe.PeFactory.prototype.factoryByType(B,A);p._pe.compare(G,p._pe.NULL)||(y=G,D[A]=y)}return y=r(y)}function r(B){if(B){var A=B.getType();switch(A){case n.PE_TYPE_GEOGCS:B=p._pe.castObject(B,p._pe.PeGeogcs);break;case n.PE_TYPE_PROJCS:B=p._pe.castObject(B,p._pe.PeProjcs);break;case n.PE_TYPE_GEOGTRAN:B=
p._pe.castObject(B,p._pe.PeGeogtran);break;default:A&n.PE_TYPE_UNIT&&(B=p._pe.castObject(B,p._pe.PeUnit))}}return B}var v={},z={};q.initialize=function(){p._pe.PeFactory.prototype.initialize(null)};q.coordsys=function(B){return u(n.PE_TYPE_COORDSYS,B)};q.factoryByType=u;q.fromString=function(B,A){var y=null,D=z[B];D||(D={},z[B]=D);if(D.hasOwnProperty(A))y=D[A];else{var G=p._pe.PeFactory.prototype.fromString(B,A);p._pe.compare(G,p._pe.NULL)||(y=G,D[A]=y)}return y=r(y)};q.geogcs=function(B){return u(n.PE_TYPE_GEOGCS,
B)};q.geogtran=function(B){return u(n.PE_TYPE_GEOGTRAN,B)};q.getCode=function(B){return p._pe.PeFactory.prototype.getCode(B)};q.projcs=function(B){return u(n.PE_TYPE_PROJCS,B)};q.unit=function(B){return u(n.PE_TYPE_UNIT,B)}})(p.PeFactory||(p.PeFactory={}));p.PeGCSExtent=null;var g;(function(q){var u;q.init=function(){q.PE_GTLIST_OPTS_COMMON=p._pe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON;u=p._pe._pe_getPeGTlistExtendedEntrySize()};q.getGTlist=function(r,v,z,B,A,y){var D=null,G=new p._pe.PeInteger(y);
try{var E=p._pe.PeGTlistExtended.prototype.getGTlist(r,v,z,B,A,G);if(y=G.val)if(D=[E],1<y){var F=p._pe.getPointer(E);for(r=1;r<y;r++)D.push(p._pe.wrapPointer(F+u*r,p._pe.PeGTlistExtendedEntry))}}finally{p._pe.destroy(G)}return D}})(g=p.PeGTlistExtended||(p.PeGTlistExtended={}));(function(q){q.destroy=function(u){if(u&&u.length){for(var r=0;r<u.length;r++){var v=u[r];d(v);v.getEntries().forEach(function(z){d(z);z=z.getGeogtran();d(z);z.getParameters().forEach(d);[z.getGeogcs1(),z.getGeogcs2()].forEach(function(B){d(B);
var A=B.getDatum();d(A);d(A.getSpheroid());d(B.getPrimem());d(B.getUnit())})})}p._pe.PeGTlistExtendedEntry.prototype.Delete(u[0])}}})(p.PeGTlistExtendedEntry||(p.PeGTlistExtendedEntry={}));(function(q){q.geogToGeog=function(u,r,v,z,B){p._pe.ensureCache.prepare();var A=c(v),y=v===A;A=p._pe.ensureFloat64(A);var D=0;z&&(D=p._pe.ensureFloat64(z));(u=p._pe._pe_geog_to_geog(p._pe.getPointer(u),r,A,D,B))&&l(v,r,A,y);return u}})(p.PeGTTransformations||(p.PeGTTransformations={}));(function(q){function u(v,
z,B,A,y,D){p._pe.ensureCache.prepare();switch(v){case "dd":var G=p._pe._pe_geog_to_dd;var E=n.PE_DD_MAX;break;case "ddm":G=p._pe._pe_geog_to_ddm;E=n.PE_DDM_MAX;break;case "dms":G=p._pe._pe_geog_to_dms,E=n.PE_DMS_MAX}v=0;z&&(v=p._pe.getPointer(z));z=c(A);z=p._pe.ensureFloat64(z);E=a(B,E);A=p._pe.ensureInt32(E);if(y=G(v,B,z,y,A))for(G=0;G<B;G++)D[G]=p._pe.UTF8ToString(E[G]);return y}function r(v,z,B,A,y){p._pe.ensureCache.prepare();switch(v){case "dd":var D=p._pe._pe_dd_to_geog;break;case "ddm":D=p._pe._pe_ddm_to_geog;
break;case "dms":D=p._pe._pe_dms_to_geog}v=0;z&&(v=p._pe.getPointer(z));z=A.map(function(G){return p._pe.ensureString(G)});A=p._pe.ensureInt32(z);z=p._pe.ensureFloat64(Array(2*B));(D=D(v,B,A,z))&&l(y,B,z);return D}q.geog_to_dms=function(v,z,B,A,y){return u("dms",v,z,B,A,y)};q.dms_to_geog=function(v,z,B,A){return r("dms",v,z,B,A)};q.geog_to_ddm=function(v,z,B,A,y){return u("ddm",v,z,B,A,y)};q.ddm_to_geog=function(v,z,B,A){return r("ddm",v,z,B,A)};q.geog_to_dd=function(v,z,B,A,y){return u("dd",v,z,
B,A,y)};q.dd_to_geog=function(v,z,B,A){return r("dd",v,z,B,A)}})(p.PeNotationDms||(p.PeNotationDms={}));var e;(function(q){q.init=function(){q.PE_MGRS_STYLE_NEW=p._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW;q.PE_MGRS_STYLE_OLD=p._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD;q.PE_MGRS_STYLE_AUTO=p._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO;q.PE_MGRS_180_ZONE_1_PLUS=p._pe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS;q.PE_MGRS_ADD_SPACES=p._pe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES};
q.geog_to_mgrs_extended=function(u,r,v,z,B,A,y){p._pe.ensureCache.prepare();var D=0;u&&(D=p._pe.getPointer(u));u=c(v);v=p._pe.ensureFloat64(u);u=a(r,n.PE_MGRS_MAX);var G=p._pe.ensureInt32(u);if(z=p._pe._pe_geog_to_mgrs_extended(D,r,v,z,B,A,G))for(B=0;B<r;B++)y[B]=p._pe.UTF8ToString(u[B]);return z};q.mgrs_to_geog_extended=function(u,r,v,z,B){p._pe.ensureCache.prepare();var A=0;u&&(A=p._pe.getPointer(u));u=v.map(function(y){return p._pe.ensureString(y)});v=p._pe.ensureInt32(u);u=p._pe.ensureFloat64(Array(2*
r));(z=p._pe._pe_mgrs_to_geog_extended(A,r,v,z,u))&&l(B,r,u);return z}})(e=p.PeNotationMgrs||(p.PeNotationMgrs={}));(function(q){q.geog_to_usng=function(u,r,v,z,B,A,y){p._pe.ensureCache.prepare();var D=0;u&&(D=p._pe.getPointer(u));u=c(v);v=p._pe.ensureFloat64(u);u=a(r,n.PE_MGRS_MAX);var G=p._pe.ensureInt32(u);if(z=p._pe._pe_geog_to_usng(D,r,v,z,B,A,G))for(B=0;B<r;B++)y[B]=p._pe.UTF8ToString(u[B]);return z};q.usng_to_geog=function(u,r,v,z){p._pe.ensureCache.prepare();var B=0;u&&(B=p._pe.getPointer(u));
u=v.map(function(A){return p._pe.ensureString(A)});v=p._pe.ensureInt32(u);u=p._pe.ensureFloat64(Array(2*r));(B=p._pe._pe_usng_to_geog(B,r,v,u))&&l(z,r,u);return B}})(p.PeNotationUsng||(p.PeNotationUsng={}));var k;(function(q){q.init=function(){q.PE_UTM_OPTS_NONE=p._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE;q.PE_UTM_OPTS_ADD_SPACES=p._pe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES;q.PE_UTM_OPTS_NS=p._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NS};q.geog_to_utm=function(u,r,v,z,B){p._pe.ensureCache.prepare();
var A=0;u&&(A=p._pe.getPointer(u));u=c(v);v=p._pe.ensureFloat64(u);u=a(r,n.PE_UTM_MAX);var y=p._pe.ensureInt32(u);if(z=p._pe._pe_geog_to_utm(A,r,v,z,y))for(A=0;A<r;A++)B[A]=p._pe.UTF8ToString(u[A]);return z};q.utm_to_geog=function(u,r,v,z,B){p._pe.ensureCache.prepare();var A=0;u&&(A=p._pe.getPointer(u));u=v.map(function(y){return p._pe.ensureString(y)});v=p._pe.ensureInt32(u);u=p._pe.ensureFloat64(Array(2*r));(z=p._pe._pe_utm_to_geog(A,r,v,z,u))&&l(B,r,u);return z}})(k=p.PeNotationUtm||(p.PeNotationUtm=
{}));var w;(function(q){var u=new Map;q.init=function(){q.PE_PCSINFO_OPTION_NONE=p._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE;q.PE_PCSINFO_OPTION_DOMAIN=p._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN;q.PE_POLE_OUTSIDE_BOUNDARY=p._pe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY;q.PE_POLE_POINT=p._pe.PePCSInfo.prototype.PE_POLE_POINT};q.generate=function(r,v){void 0===v&&(v=q.PE_PCSINFO_OPTION_DOMAIN);var z;if(u.has(r)){var B=u.get(r);B[v]&&(z=B[v])}z||(z=p._pe.PePCSInfo.prototype.generate(r,
v),B||(B=[],u.set(r,B)),B[v]=z);return z}})(w=p.PePCSInfo||(p.PePCSInfo={}));(function(q){q.version_string=function(){return p._pe.PeVersion.prototype.version_string()}})(p.PeVersion||(p.PeVersion={}));p._init=f})},"esri/core/tsSupport/extendsHelper":function(){define([],function(){return function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,x){p.__proto__=x}||function(p,x){for(var b in x)x.hasOwnProperty(b)&&(p[b]=x[b])};return function(p,x){function b(){this.constructor=
p}t(p,x);p.prototype=null===x?Object.create(x):(b.prototype=x.prototype,new b)}}()})},"esri/geometry/GeographicTransformation":function(){define(["require","exports","./GeographicTransformationStep"],function(t,p,x){return function(){function b(m){this.steps=[];this._cached_projection={};this._chain="";this._gtlistentry=null;if(m&&m.steps){var f=0;for(m=m.steps;f<m.length;f++){var d=m[f];d instanceof x?this.steps.push(d):this.steps.push(new x({wkid:d.wkid,wkt:d.wkt,isInverse:d.isInverse}))}}}b.cacheKey=
function(m,f){return[void 0!==m.wkid&&null!==m.wkid?m.wkid.toString():"-1",void 0!==m.wkt&&null!==m.wkt?m.wkt.toString():"",void 0!==f.wkid&&null!==f.wkid?f.wkid.toString():"-1",void 0!==f.wkt&&null!==f.wkt?f.wkt.toString():""].join()};b.fromGE=function(m){var f=new b,d="",a=0;for(m=m.steps;a<m.length;a++){var c=x.fromGE(m[a]);f.steps.push(c);d+=c.uid.toString()+","}f._cached_projection={};f._gtlistentry=null;f._chain=d;return f};b.prototype.getInverse=function(){var m=new b;m.steps=[];for(var f=
this.steps.length-1;0<=f;f--)m.steps.push(this.steps[f].getInverse());return m};b.prototype.getGTListEntry=function(){for(var m="",f=0,d=this.steps;f<d.length;f++)m+=d[f].uid.toString()+",";m!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=m);return this._gtlistentry};b.prototype.assignCachedGe=function(m,f,d){this._cached_projection[b.cacheKey(m,f)]=d};b.prototype.getCachedGeTransformation=function(m,f){for(var d="",a=0,c=this.steps;a<c.length;a++)d+=c[a].uid.toString()+
",";d!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=d);d=this._cached_projection[b.cacheKey(m,f)];return void 0===d?null:d};return b}()})},"esri/geometry/GeographicTransformationStep":function(){define(["require","exports"],function(t,p){var x=0;return function(){function b(m){void 0===m&&(m=null);this.uid=x++;m?(this._wkt=void 0!==m.wkt?m.wkt:null,this._wkid=void 0!==m.wkid?m.wkid:-1,this._isInverse=void 0!==m.isInverse?!0===m.isInverse:!1):(this._wkt=null,this._wkid=
-1,this._isInverse=!1)}b.fromGE=function(m){var f=new b;f._wkt=m.wkt;f._wkid=m.wkid;f._isInverse=m.isInverse;return f};Object.defineProperty(b.prototype,"wkt",{get:function(){return this._wkt},set:function(m){this._wkt=m;this.uid=x++},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"wkid",{get:function(){return this._wkid},set:function(m){this._wkid=m;this.uid=x++},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isInverse",{get:function(){return this._isInverse},
set:function(m){this._isInverse=m;this.uid=x++},enumerable:!0,configurable:!0});b.prototype.getInverse=function(){var m=new b;m._wkt=this.wkt;m._wkid=this._wkid;m._isInverse=!this.isInverse;return m};return b}()})},"esri/layers/rasterLib/raster/TileServiceRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff dojo/DeferredList dojo/when ../../../kernel ../../../Evented ../../../request ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../deferredUtils ../../../urlUtils ../../PixelBlock ../../rasterFormats/rasterCodec ../tile/RasterTileInfo ./RasterInfo ./BasicRaster".split(" "),
function(t,p,x,b,m,f,d,a,c,l,h,n,g,e,k,w,q,u,r,v,z,B,A){t=p([A],{declaredClass:"esri.layers.rasterLib.raster.TileServiceRaster",constructor:function(y){},open:function(){var y=new b,D=this.serviceInfo||this._getServiceInfo(null),G=x.hitch(this,function(F){this.serviceInfo=F;this.version=F.currentVersion;this.rasterInfo=this._parseRasterInfo(F);this.loaded=!0;this._getRasterIdentifier();y.resolve(this)}),E=x.hitch(this,function(F){this.loaded=!0;this._getRasterIdentifier();y.reject(F)});l(D,G,E);return y.promise},
read:function(y){var D=this.url+"/tile/"+y.level+"/"+y.row+"/"+y.col,G={width:this.tileInfo.cols,height:this.tileInfo.rows,planes:null,pixelType:null,format:null,decodeFunc:null,isPoint:"elevation"===this.tileType.toLowerCase()?!0:!1};return this._requestPixels({url:D+(this.disableClientCaching?"?_ts\x3d "+(new Date).getTime():""),payload:{},decodeParams:G,tileOptions:y})},identify:function(y,D){null==D&&(D=this.tileInfo.lods[this.tileInfo.lods.length-1].level);var G=(y.x-this.tileInfo.origin.x)/
this.tileInfo.lods[D].resolution/this.tileInfo.cols,E=(this.tileInfo.origin.y-y.y)/this.tileInfo.lods[D].resolution/this.tileInfo.rows,F=Math.floor(G),I=Math.floor(E),M=Math.floor((G-F)*this.tileInfo.cols);M=Math.min(M,this.tileInfo.cols-1);var P=Math.floor((E-I)*this.tileInfo.rows);P=Math.min(P,this.tileInfo.rows-1);var W=new b;this.read({level:D,row:I,col:F}).then(function(H){var O=P*H.width+M;H&&H.pixels&&0<H.pixels.length?(H=H.mask?H.mask[O]?H.pixels.map(function(K){return K[O]}):null:H.pixels.map(function(K){return K[O]}),
W.resolve(H)):W.reject("no valid data")},function(H){W.reject(H)});return W.promise},setFetchParameters:function(y,D){},_getRasterIdentifier:function(){this._rasterId||(this._rasterId=this.url.replace("http:","").replace("https:",""));return this._rasterId},_getServiceInfo:function(){var y=this.url,D=new b(q._dfdCanceller);D._pendingDfd=g({url:y,content:{f:"json"},handleAs:"json",callbackParamName:"callback"});D._pendingDfd.then(function(G){D.callback(G)},function(G){D.errback(G)});return D},_parseRasterInfo:function(y){var D=
new B;D.extent=new e(y.fullExtent);D.spatialReference=new w(y.spatialReference);this.tileType=y.cacheType||"Map";switch(this.tileType){case "Map":D.bandCount=3;D.pixelType="U8";this.dataType="Processed";break;case "Elevation":D.bandCount=1;D.pixelType=y.pixelType||"F32";this.dataType="Elevation";break;case "Raster":D.bandCount=null,D.pixelType=null,this.dataType=y.serviceDataType&&y.serviceDataType.replace("esriImageServiceDataType","")||"Generic"}var G=y.tileInfo;D.width=Math.floor((y.fullExtent.xmax-
y.fullExtent.xmin)/G.lods[G.lods.length-1].resolution+.5);D.height=Math.floor((y.fullExtent.ymax-y.fullExtent.ymin)/G.lods[G.lods.length-1].resolution+.5);D.cellSize=new k({x:G.lods[G.lods.length-1].resolution,y:G.lods[G.lods.length-1].resolution,spatialReference:y.spatialReference});this.tileInfo=new z(G);this.tileInfo.tileType=this.tileType;return D}});x.setObject("layers.rasterLib.raster.TileServiceRaster",t,h);return t})},"esri/layers/rasterLib/raster/TileRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff dojo/DeferredList dojo/when ../../../kernel ../../../Evented ../../../request ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../deferredUtils ../../../urlUtils ../../PixelBlock ../../rasterFormats/rasterCodec ../tile/RasterTileInfo ./RasterInfo ./BasicRaster".split(" "),
function(t,p,x,b,m,f,d,a,c,l,h,n,g,e,k,w,q,u,r,v,z,B,A){t=p([A],{declaredClass:"esri.layers.rasterLib.raster.TileRaster",sourceType:"TileCache",_RECORD_SIZE:8,constructor:function(y){this._cloudBlobStorage=y&&y._cloudBlobStorage},open:function(){var y=new b,D=this.datasetInfo||this._getDatasetInfo(null),G=x.hitch(this,function(F){this.datasetInfo=F;this.rasterInfo=F=this._parseRasterInfo(F);this.tileType="Cache/LERC"===F.format?"Elevation":"Cache/MIXED"===F.format||"Cache/JPEG"===F.format||"Cache/PNG"===
F.format?"Map":"Raster";this.tileInfo=F.tileInfo;this.dataType=["Generic","Elevation","Processed"][["Raster","Elevation","Map"].indexOf(this.tileType)];this._HEADER_SIZE=F.packetSize*F.packetSize*this._RECORD_SIZE+64;this.loaded=!0;this._cloudBlobStorage=this._cloudBlobStorage||-1<this.url.toLowerCase().indexOf("s3.amazonaws.com")||-1<this.url.toLowerCase().indexOf("windows.net")||-1<this.url.toLowerCase().indexOf("googleapis.com");this._getRasterIdentifier();y.resolve(this)}),E=x.hitch(this,function(F){this.loaded=
!0;this._getRasterIdentifier();y.reject(F)});l(D,G,E);return y.promise},read:function(y){var D=new b,G=y.level,E=y.row,F=y.col,I=this._buildCacheFilePath(this.url,G,E,F),M=this._getIndexRecordFromBundle(G,E,F);g({url:I,content:{},headers:{Range:"bytes\x3d0-"+(this._HEADER_SIZE-1).toString()},handleAs:"arraybuffer"}).then(x.hitch(this,function(P,W){if(!D.isCanceled()){var H=new Uint8Array(P);H=this._getTileEndAndContentType(H,M);var O={width:this.tileInfo.cols,height:this.tileInfo.rows,planes:null,
pixelType:null,format:null,decodeFunc:null,isPoint:"elevation"===this.tileType.toLowerCase()?!0:!1};this._requestPixels({url:I+(this.disableClientCaching?"?_ts\x3d "+(new Date).getTime():""),payload:{},headers:{Range:"bytes\x3d"+H.position.toString()+"-"+(H.position+H.recordSize).toString()},decodeParams:O,tileOptions:y}).then(function(K){D.isCanceled()||D.resolve(K)},function(K){D.isCanceled()||D.reject(K)})}}));return D.promise},identify:function(){return null},setFetchParameters:function(y,D){},
toJson:function(){return{url:this.url,tileInfo:this.tileInfo.toJson(),rasterInfo:this.rasterInfo.toJson(),datasetInfo:this.datasetInfo,sourceType:this.sourceType,tileType:this.tileType,_rasterId:this._rasterId}},_getDatasetInfo:function(){return g({url:this.url+"/conf.json",handleAs:"json",content:{}})},_parseRasterInfo:function(y){var D=new B;switch(y.pixelType){case 1:var G="U1";break;case 1:G="U2";break;case 2:G="U4";break;case 3:G="U8";break;case 4:G="S8";break;case 5:G="U16";break;case 6:G="S16";
break;case 7:G="U32";break;case 8:G="S32";break;case 9:G="F32";break;default:G="F32"}var E,F=[],I=y.LODInfos;for(E=0;E<I.levels.length;E++)F.push({level:I.levels[E],resolution:I.resolutions[E],scale:96/.0254*I.resolutions[E]});E=new w(y.extent.spatialReference||y.geodataXform.spatialReference);F=new z({rows:y.blockHeight,cols:y.blockWidth,dpi:96,format:y.format,compressionQuality:0,origin:y.origin,spatialReference:E,lods:F});D.pixelType=G;D.bandCount=y.bandCount;D.spatialReference=E;D.extent=new e({xmin:y.extent.xmin,
ymin:y.extent.ymin,xmax:y.extent.xmax,ymax:y.extent.ymax,spatialReference:E});D.cellSize=new k({x:y.pixelSizeX,y:y.pixelSizeY,spatialReference:E});D.width=Math.floor((D.extent.xmax-D.extent.xmin)/D.cellSize.x+.5);D.height=Math.floor((D.extent.ymax-D.extent.ymin)/D.cellSize.y+.5);D.statistics=y.statistics.map(function(M){Object.keys(M).forEach(function(P){isNaN(M[P])&&(M[P]=null)});return M});D.histograms=y.histograms;D.geodataXform=y.geodataXform;D.packetSize=y.packetSize;D.format=y.format;D.compressionQuality=
y.compressionQuality;D.tileInfo=F;return D},_getRasterIdentifier:function(){this._rasterId||(this._rasterId=this.url.replace("http:","").replace("https:",""));return this._rasterId},_buildCacheFilePath:function(y,D,G,E){var F=this.rasterInfo.packetSize;E=Math.floor(E/F)*F;G="R"+this._toHexString4(Math.floor(G/F)*F)+"C"+this._toHexString4(E);F="L";F=10<=D?F+D.toString():F+("0"+D.toString());return this._cloudBlobStorage?y+"/_alllayers/"+F+"/"+G+".bundle":y+"/"+F+"_"+G+"/bundle"},_getIndexRecordFromBundle:function(y,
D,G){y=this.rasterInfo.packetSize;D=D%y*y+G%y;if(0>D)throw"Invalid level / row / col";return D*this._RECORD_SIZE+64},_getTileEndAndContentType:function(y,D){var G=y.subarray(D,D+8),E=0,F;for(F=0;5>F;F++)E|=(G[F]&255)<<8*F;var I=E&0xffffffffff;E=0;for(F=5;8>F;F++)E|=(G[F]&255)<<8*(F-5);return{position:I,recordSize:E&0xffffffffff}},_toHexString4:function(y){y=y.toString(16);if(4!=y.length)for(var D=4-y.length;0<D--;)y="0"+y;return y}});x.setObject("layers.rasterLib.raster.TileRaster",t,h);return t})},
"esri/layers/rasterLib/raster/FunctionRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff ../DeferredList2 dojo/when ../../../kernel ../../../Evented ../../../request ../../../deferredUtils ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../deferredUtils ../../../urlUtils ../../rasterFormats/rasterCodec ./RasterInfo ./BasicRaster ../../rasterLib/function/rasterFunctionHelper".split(" "),
function(t,p,x,b,m,f,d,a,c,l,h,n,g,e,k,w,q,u,r,v,z,B,A){t=p([B],{declaredClass:"esri.layers.rasterLib.raster.FunctionRaster",rasterFunction:null,sourceType:"Function",constructor:function(y){y&&y.rasterFx&&this._init(y.rasterFx,y.rasterFxArgs)},open:function(){var y=this.getMemberRasters().map(function(G){return G.open()});this.identifiers=this.getMemberRasters().map(function(G){return G._rasterId});var D=new b;(new c(y,null,null,!0)).then(function(G){G.some(function(E){return!E[0]})?D.reject(G):
(this.rasterFunction.bind(),this.rasterInfo=this.rasterFunction.rasterInfo,this.dataType=this.rasterInfo.keyProperties&&this.rasterInfo.keyProperties.DataType||"Generic",this.tileInfo=G[0][1].tileInfo,D.resolve(this))}.bind(this));return D.promise},getProjectedFullExtent:function(y){var D=new b;this.getMemberRasters()[0].getProjectedFullExtent(y).then(x.hitch(this,function(G){this.projectedFullExtent=G;D.resolve(G)}));return D.promise},setProcessingContext:function(y){var D=y;y.layer&&(y=y.layer,
D={id:y.id,rawRasterInfo:y.raster.rasterInfo,glSetting:y._glSetting,xformSetting:y.tileManager&&y.tileManager.xformSetting,useWebGL:y.useWebGL,resampling:y.tileMode&&y.tileManager&&y.tileManager.xformSetting.requireProjection&&!y._hasTilingEffects&&"Thematic"!==y.raster.dataType?1:0,tileMode:y.tileMode});this.rasterFunction.setProcessingContext(D);this._layerOptions=D},alterDefinition:function(y){if(y=y||this.rasterFunction)1===this.memberRasters.length&&!y._bindComplete&&(this.rasterFunction=A.create(y,
{raster:this.memberRasters[0]}))&&(this.rasterFunction.bind(),this.rasterInfo=this.rasterFunction.rasterInfo,this.dataType=this.rasterInfo.keyProperties&&this.rasterInfo.keyProperties.DataType||"Generic",this.rasterFunction.setProcessingContext(this._layerOptions)),this._rasterHandler&&this._rasterHandler._connected&&this.rasterFunction&&this._rasterHandler.setRasterFunction({layerId:this._layerOptions.id,data:this.rasterFunction.toJson(!0)})},setFetchParameters:function(y,D){var G=this.getMemberRasters();
G&&1===G.length&&G[0].setFetchParameters(y,D)},getMemberRasters:function(){this.memberRasters||(this.memberRasters=[],this._getMemberRasters(this.rasterFunction.functionArguments,this.memberRasters));return this.memberRasters},read:function(y){var D=new b(e._dfdCanceller);if(y.src){var G=this.rasterFunction.read(y);D.resolve(G);return D.promise}var E=this.getMemberRasters().map(function(P){return P.read(y)});E=new c(E);var F,I,M=this.identifiers;D._pendingDfd=E;E.then(x.hitch(this,function(P){if(F=
P.some(function(W){return W[0]}))I={},P.forEach(function(W,H){I[M[H]]=W[0]?W[1]:null});G=I?this.rasterFunction.read({extent:y.extent,src:I}):null;G.srcData=I;D.resolve(G)}));return D},_init:function(y,D){if(this.rasterFunction=A.create(y,D))this.rasterFunction._bindComplete=!0;else throw"Cannot initialize a function raster without a raster function";},_getMemberRasters:function(y,D){var G=Object.keys(y),E,F,I;for(E=0;E<G.length;E++)if(I=y[G[E]]){var M=I instanceof Array?I:[I];for(F=0;F<M.length;F++)(I=
M[F])&&("function"===typeof I||"object"===typeof I)&&I.read&&(I.functionArguments?this._getMemberRasters(I.functionArguments,D):I.sourceType&&"Function"!==I.sourceType&&(I._identifier=I._getRasterIdentifier(),D.some(function(P){return P._identifier===I._identifier})||D.push(I)))}return D}});x.setObject("layers.rasterLib.raster.FunctionRaster",t,h);return t})},"esri/layers/rasterLib/DeferredList2":function(){define(["dojo/DeferredList"],function(t){return function(p,x,b,m,f){this.list=p;x=new t(p,
x,b,m,f);var d=x.resolve.bind(x),a=x.cancel.bind(x);x.cancel=function(){p&&p.forEach(function(c){c.cancel&&c.cancel()});a.apply(this,arguments)}.bind(x);x.resolve=function(){this.isFulfilled()||d.apply(this,arguments)}.bind(x);return x}})},"esri/layers/rasterLib/tile/RasterTileManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/when ../DeferredList2 ../../../geometry/Extent ../../../SpatialReference ../../../geometry/Point ../../PixelBlock ./RasterTileInfo ../raster/rasterProjectionHelper".split(" "),
function(t,p,x,b,m,f,d,a,c,l,h){var n=function(g,e){var k;for(k=0;k<g.length;k++)if(e(g[k]))return k;return-1};return t(null,{declaredClass:"esri.layers.rasterLib.tile.RasterTileManager",count:null,fullBoundary:null,tileBoundary:null,tiles:null,resolution:null,virtual:!0,prefetchBufferSize:0,_progressiveGlobal:!1,_MAX_TILES:128,_defaultMatrixResolution:20,constructor:function(g){this.tiles=[];this.xformSetting={};this.mapSpatialReference=g&&g.mapSR;this.layer=g&&g.layer;this.identifiers=this.layer.raster.rasterFunction?
this.layer.raster.getMemberRasters().map(function(e){return e._rasterId}):[this.layer.raster._rasterId];(g=g&&g.tileInfo)&&this.setTileInfo(g)},setTileInfo:function(g){this.tileInfo=g;this.virtual=g.virtual;this.mapResolution=null;this.tiles.length=0;this.xformSetting.requireProjection=!this.virtual&&!this.mapSpatialReference.equals(this.tileInfo.spatialReference);this.xformSetting.requirePE=h.requirePE(this.mapSpatialReference,this.tileInfo.spatialReference);this.xformSetting.meshSize=this.xformSetting.requireProjection?
[this._defaultMatrixResolution,this._defaultMatrixResolution]:[1,1];this.halfWorldWidth=h.getHalfWorldWidth(g.spatialReference)},updateResolution:function(g,e){if(!(this.mapResolution&&g&&this._resolutionEqual(this.mapResolution.x,g.x)&&this._resolutionEqual(this.mapResolution.y,g.y))){this.resetTiles();var k=this.xformSetting.requireProjection;this.mapResolution=this.resolution=g;k&&(this.resolution=h.projectResolution(g,this.tileInfo.spatialReference,this.layer.projectedFullExtent||e));this._resolution=
this.resolution;k=this.resolution;if(!this.tileInfo.virtual){var w=.75*Math.min(k.x,k.y)+.25*Math.max(k.x,k.y);if(w>=this.tileInfo.lods[0].resolution){var q=this.tileInfo.lods[0];this.ooe=!0}else{if(w<=this.tileInfo.lods[this.tileInfo.lods.length-1].resolution)q=this.tileInfo.lods[this.tileInfo.lods.length-1];else for(k=0;k<this.tileInfo.lods.length-1;k++){q=this.tileInfo.lods[k];var u=this.tileInfo.lods[k+1];if(q.resolution>=w&&u.resolution<=w){q.resolution-w>w-u.resolution&&(q=u);break}}this.ooe=
!1}this.level=q&&q.level;k=this.resolution=new a({x:q.resolution,y:q.resolution,spatialReference:this.tileInfo.spatialReference})}w=this.layer.raster.rasterInfo.extent;q=this.tileInfo.origin;u=this.tileInfo.cols;var r=this.tileInfo.rows;this.fullBoundary={rowStart:Math.floor((q.y-w.ymax)/k.y/r),rowEnd:Math.floor((q.y-w.ymin-k.y)/k.y/r),colStart:Math.floor((w.xmin-q.x)/k.x/u),colEnd:Math.floor((w.xmax-q.x-k.x)/k.x/u)};if(w=this.halfWorldWidth){r=Math.ceil(w/k.x/(u/2));var v=this.tileInfo.applyGCS360Transform?
360:w,z=Math.round(u-(v-q.x)/k.x%u);z===u&&(z=0);this.fullBoundary.colRange=r;this.fullBoundary.paddingRight=z;this.fullBoundary.paddingLeft=Math.round((r*u*k.x+q.x-v-(this.tileInfo.applyGCS360Transform?0:q.x+w))/k.x)}this.hasNewData=!0}},getXformGrid:function(){var g=this.mapExtent,e=this.layer._hasTilingEffects?this.extent:this.fullExtent,k=this.layer.getCurrentResolution(),w=JSON.stringify(g.toJson())+JSON.stringify(e.toJson());this._datumTransformationInitialized||(this._datumTransformationInitialized=
!0,this._datumTransformation=h.getDefaultDatumTransformationForDataset(this.layer.raster.rasterInfo.extent,g.spatialReference,!0));this._cachedExtentString&&this._cachedExtentString===w||(this._cachedExtentString=w,this._xformGrid=g=h.getProjectionOffsetGrid(g,e,k,this.tileInfo.applyGCS360Transform,this.halfWorldWidth,this._datumTransformation));g=this._xformGrid;this.xformSetting.meshSize=g&&g.size;return g},getWrapTimes:function(g){var e=h.getHalfWorldWidth(g.spatialReference);if(!e)return 0;var k=
2*e;e=this.tileInfo.applyGCS360Transform?0:-e;return Math.floor((g.xmax-e)/k)-Math.floor((g.xmin-e)/k)},normalizeCoordinate:function(g,e){if(!e)return 0;var k=2*e;if(0<g){for(;g>e;)g-=k;return g}for(;g<-e;)g+=k;return g},resetTiles:function(){this.tiles.forEach(p.hitch(this,function(g){g.fetch&&!g.fetch.isCanceled()&&g.fetch.cancel();g.update&&!g.update.isCanceled()&&g.update.cancel()}));this.tiles.length=0},updateExtent:function(g,e){this.mapExtent=this.extent=g;var k=this.xformSetting.requireProjection;
if(k){this.extent=h.project(g,this.tileInfo.spatialReference,this.tileInfo.applyGCS360Transform);if(!this.extent)return;this.extent.spatialReference=new d(this.extent.spatialReference.toJson())}else if(g.spatialReference.isWebMercator()||4326===g.spatialReference.wkid){var w=4326===g.spatialReference.wkid?180:this.halfWorldWidth,q=g.xmin;if(q<-w||q>w){for(var u=g.xmax,r=2*w;q<-w;)q+=r,u+=r;for(;q>w;)q-=r,u-=r;this.mapExtent=this.extent=g=new f(q,g.ymin,u,g.ymax,g.spatialReference)}}this.updateResolution(e,
g);w=this.extent;q=this.tileInfo;u=q.cols;r=q.rows;e=this.resolution;var v=w,z=k?this.layer.raster.rasterInfo.extent:this.layer.raster.projectedFullExtent;this.ooe&&(v=this._getIntersect(w,z));var B=Math.floor((v.xmin-q.origin.x)/e.x/u)-this.prefetchBufferSize,A=Math.floor((v.xmax-q.origin.x)/e.x/u)+this.prefetchBufferSize,y=null,D=this.getWrapTimes(g),G=this.fullBoundary&&this.fullBoundary.colRange;D&&this.halfWorldWidth&&(A===B&&(y=B),A+=D*G);if(k=this.halfWorldWidth&&this.tiles.length&&(D!==this.wrapTimes||
y!==this._circlularColId))this._wrapSwitchCount=this._wrapSwitchCount?this._wrapSwitchCount+1:1;this.wrapTimes=D;this._circlularColId=y;var E=Math.floor((q.origin.y-v.ymax)/e.y/r)-this.prefetchBufferSize;y=Math.floor((q.origin.y-v.ymin)/e.y/r)+this.prefetchBufferSize;this.tileBoundary={rowStart:E,rowEnd:y,colStart:B,colEnd:A};var F,I;((v=(y-E+1)*(A-B+1)>this._MAX_TILES||!this.virtual&&this._resolution.x>8*this.tileInfo.lods[0].resolution)||2<D||k)&&this.resetTiles();if(!(v||2<D)){v=this.tiles;k=!1;
for(F=v.length-1;0<=F;F--){var M=v[F].row;var P=v[F].wrapCol;if(M<E||M>y||P<B||P>A)v[F].fetch&&!v[F].fetch.isCanceled()&&v[F].fetch.cancel(),v[F].update&&!v[F].update.isCanceled()&&v[F].update.cancel(),v.splice(F,1),k=!0}for(F=E;F<=y;F++)for(I=B;I<=A;I++){E=new f(q.origin.x+e.x*u*I,q.origin.y-e.y*r*(F+1),q.origin.x+e.x*u*(I+1),q.origin.y-e.y*r*F,w.spatialReference);var W=D&&G?0<=I?I%G:G- -I%G:I;M=n(v,function(H){return H.row===F&&H.col===W&&H.wrapCol===I});P=z.xmax>=E.xmax?u:Math.round((z.xmax-E.xmin)/
e.x);-1===M&&(v.push({row:F,col:W,wrapCol:I,cellsizeX:e.x,cellsizeY:e.y,width:u,height:r,actualWidth:P,extent:E,normalizedExtent:this._wrapExtent(E,W),pixelBlock:null,virtual:this.virtual,level:this.level,tileType:this.tileInfo.tileType||"Raster"}),k=!0)}k&&this._sortTiles();q=this.tileInfo.rows*(this.tileBoundary.rowEnd-this.tileBoundary.rowStart+1);this.width=this.tileInfo.cols*(this.tileBoundary.colEnd-this.tileBoundary.colStart+1);this.height=q;this.count=v.length;q=Math.min.apply(null,v.map(function(H){return H.extent.xmin}));
u=Math.max.apply(null,v.map(function(H){return H.extent.xmax}));r=Math.min.apply(null,v.map(function(H){return H.extent.ymin}));z=Math.max.apply(null,v.map(function(H){return H.extent.ymax}));q=this.fullExtent=new f(q,r,u,z,w.spatialReference);if(this.layer.roaming||this.layer.useWebGL)this.layer._hasTilingEffects?(this.xformSetting.offset=[0,0],this.xformSetting.scale=[1,1]):(k&&(this._tilesChanged=!0),this.xformSetting.offset=[(w.xmin-q.xmin)/(q.xmax-q.xmin),-(q.ymin-w.ymin)/(q.ymax-q.ymin)],this.xformSetting.scale=
[(w.xmax-w.xmin)/(q.xmax-q.xmin),(w.ymax-w.ymin)/(q.ymax-q.ymin)])}},fetchTiles:function(g){(this._tilesChanged||g)&&this._fetchTiles(g)},_fetchTiles:function(g){this._fetchCounter=0;var e=this.extent;this.fetchAllCompleted=g?new x:null;(this._tilesChanged||g&&this.layer._hasTilingEffects)&&this.tiles.forEach(p.hitch(this,function(w){w.updateCompleted=!1}));var k={};!this.layer.roaming&&this.layer._hasTilingEffects&&g?(this.identifiers.forEach(function(w,q){k[w]={extent:this.extent,pixelBlock:new c({width:this.layer._map.width,
height:this.layer._map.height,pixels:[],pixelType:"",mask:null,statistics:[]})}}.bind(this)),this.originalPixelData={extent:this.extent,src:k,isEmpty:!0}):this._tilesChanged&&(this.identifiers.forEach(function(w,q){k[w]={extent:this.fullExtent,pixelBlock:new c({width:128,height:128,pixels:[],pixelType:"",mask:null,statistics:[]})}}.bind(this)),this.originalPixelData={extent:this.fullExtent,src:k,isEmpty:!0});this.tiles.forEach(p.hitch(this,function(w){if(w.fetch)w.update||(w.update=this.updateTile(w));
else{if(this._isTileOutSide(w,e)){w.updateCompleted=!0;return}this._requestTile(w)}this.layer.roaming&&this.layer.useWebGL?this._fillPixelData(w):w.src&&g&&(this.layer._hasTilingEffects||this.layer.useWebGL)&&(this._fillPixelData(w),this.layer._hasTilingEffects&&(w.updateCompleted=!0),w.processedPixelBlock=null,w.renderedPixelBlock=null)}));0===this._fetchCounter&&(this._fetched=!0);this._tilesChanged=!1;g&&this._updateFetchStatus()},updateTile:function(g,e){var k=new x;if(!g.src&&!g.fetch)return k.resolve(g),
k.promise;b(g.src||g._fetched||g.fetch,p.hitch(this,function(){var w=this.layer.tileMode&&this.layer._rasterHandler&&!(this.layer._hasTilingEffects||this.layer.useWebGL),q=this.layer._drawTile,u=this._validateRawPixelBlocks(g);this.layer._hasTilingEffects&&!this.layer.useWebGL&&(q=q&&(this._progressiveGlobal||e));if((e||!e&&u)&&(w||q||this.layer.roaming)){if(this.xformSetting.requireProjection&&this.layer.useWebGL&&(this.xformSetting.gridConfig=this.getXformGrid(),null==this.xformSetting.gridConfig))return k.cancel(),
k.promise;this._processTile(g,e).then(p.hitch(this,function(r){k.isCanceled()||this._renderTile(r,e).then(p.hitch(this,function(v){this.hasNewData=!1;k.isCanceled()||k.resolve(v)}))}))}else e||u||(g.updateCompleted=!0),this.layer.useWebGL||this.layer._hasTilingEffects?k.resolve(this.originalPixelData):k.resolve()}));return k.promise},setLayer:function(g){this.layer=g},fillupTiles:function(){this.tiles.forEach(p.hitch(this,function(g){g.update&&g.updateCompleted&&!g.filled&&(g.updateCompleted=!1,this._fillPixelData(g),
g.updateCompleted=!0)}))},_validateRawPixelBlocks:function(g){return g&&g.src&&!this.identifiers.some(function(e){return!(g.src[e].pixelBlock&&0!==g.src[e].pixelBlock.validPixelCount&&g.src[e].pixelBlock.pixels&&0<g.src[e].pixelBlock.pixels.length)})},_wrapExtent:function(g,e){if(g){if(this.tileInfo.applyGCS360Transform){var k=this.normalizeCoordinate(g.xmin,180);0>k&&(k+=360);return new f({xmin:k,ymin:g.ymin,xmax:g.xmax-g.xmin+k,ymax:g.ymax,spatialReference:g.spatialReference})}if(this.halfWorldWidth){k=
null!=e?new f({xmin:this.tileInfo.origin.x+this.tileInfo.cols*e*this.resolution.x,ymin:g.ymin,xmax:this.tileInfo.origin.x+this.tileInfo.cols*(e+1)*this.resolution.x,ymax:g.ymax,spatialReference:g.spatialReference}):new f({xmin:g.xmin,ymin:g.ymin,xmax:g.xmax,ymax:g.ymax,spatialReference:g.spatialReference});var w=this.normalizeCoordinate(k.xmin,this.halfWorldWidth),q=w-k.xmin;.01<Math.abs(q)&&(k.xmin=w,k.xmax+=q)}return k||g}},_getIntersect:function(g,e){return new f(Math.max(g.xmin,e.xmin),Math.max(g.ymin,
e.ymin),Math.min(g.xmax,e.xmax),Math.min(g.ymax,e.ymax),g.spatialReference)},_isTileOutSide:function(g,e){var k=!1;if(g.virtual){var w=g.normalizedExtent;if(e=e||(this.xformSetting.requireProjection?this.layer.raster.rasterInfo.extent:this.layer.raster.projectedFullExtent)){k=w.xmin-this.prefetchBufferSize*this.tileInfo.cols*this.resolution.x;var q=w.ymin-this.prefetchBufferSize*this.tileInfo.rows*this.resolution.y;var u=w.xmax+this.prefetchBufferSize*this.tileInfo.cols*this.resolution.x;w=w.ymax+
this.prefetchBufferSize*this.tileInfo.rows*this.resolution.y;k=u<=e.xmin||k>=e.xmax||w<=e.ymin||q>=e.ymax}else k=!1}else k=0>g.level||g.row<this.fullBoundary.rowStart||g.row>this.fullBoundary.rowEnd||g.col<this.fullBoundary.colStart||g.col>this.fullBoundary.colEnd;return k},_resolutionEqual:function(g,e){return g===e||g&&e&&Math.abs(g-e)<Math.abs(e/1E4)?!0:!1},_requestTile:function(g){var e=this.identifiers,k;if(this._isTileOutSide(g)){var w=new x;g.updateCompleted=!0;w.resolve(null);w=w.promise}else w=
this.layer.raster.rasterFunction?new m(this.layer.raster.getMemberRasters().map(function(q){return q.read(g)})):new m([this.layer.raster.read(g)]);g.fetch=w;this._fetchCounter++;b(g.src||g._fetched||w,p.hitch(this,function(q){if(k=q&&q.some(function(r){return r[0]})){var u={};q.forEach(function(r,v){u[e[v]]=r[0]&&r[1]?{extent:r[1].extent,pixelBlock:r[1].pixelBlock,width:r[1].width,height:r[1].height}:null});g.src=u}else g.src=null;this._fetchCounter--;0===this._fetchCounter&&(this._fetched=!0);g._fetched=
!0;this._updateFetchStatus()}),p.hitch(this,function(){this._fetchCounter--;0===this._fetchCounter&&(this._fetched=!0);g._fetched=!0;this._updateFetchStatus()}));g.update=this.updateTile(g)},_updateFetchStatus:function(){this.layer._drawTile&&this.fetchAllCompleted&&!this.fetchAllCompleted.isResolved()&&!this.tiles.some(function(g){return!g._fetched})&&(this.tiles.forEach(p.hitch(this,function(g){this._fillPixelData(g)})),this.fetchAllCompleted.resolve())},_fillPixelData:function(g,e){if(g&&!g.updateCompleted)if(Math.abs(g.cellsizeX-
this.resolution.x)>g.cellsizeX/10)g.updateCompleted=!0;else if(!1===this._validateRawPixelBlocks(g))g.updateCompleted=!0;else{var k=g.extent;if(this.layer.roaming||this.layer.useWebGL&&!this.layer._hasTilingEffects){var w=this.fullExtent;var q=this.tileInfo.cols*(this.tileBoundary.colEnd-this.tileBoundary.colStart+1);var u=this.tileInfo.rows*(this.tileBoundary.rowEnd-this.tileBoundary.rowStart+1);e?this.originalPixelData.renderedPixelBlock||(this.originalPixelData.renderedPixelBlock=new c({width:q,
height:u,pixels:[],pixelType:"",mask:null,statistics:[]})):this.identifiers.forEach(p.hitch(this,function(v){this.originalPixelData.src[v].pixelBlock.width=q;this.originalPixelData.src[v].pixelBlock.height=u}))}else w=this.extent,q=this.layer._map.width,u=this.layer._map.height,e?this.originalPixelData.renderedPixelBlock||(this.originalPixelData.renderedPixelBlock=new c({width:q,height:u,pixels:[],pixelType:"",mask:null,statistics:[]})):this.identifiers.forEach(p.hitch(this,function(v){this.originalPixelData.src[v].pixelBlock.width=
q;this.originalPixelData.src[v].pixelBlock.height=u}));if(w.xmax<=k.xmin||w.xmin>=k.xmax||w.ymax<=k.ymin||w.ymin>=k.ymax)return null;var r=this.originalPixelData.isEmpty=!1;this.identifiers.forEach(p.hitch(this,function(v){g.src&&(this._fillPixelBlock(g.src[v],this.originalPixelData.src[v],{extent:w,width:q,height:u,normalizedExtent:g.normalizedExtent},!1),r=!0)}));g.filled=r;this.hasNewData=!0}},_fillPixelBlock:function(g,e,k,w){var q=g.extent,u=k.extent;w=k.width;var r=k.height;if(g.pixelBlock&&
g.pixelBlock.pixels&&g.pixelBlock.pixels[0]){var v=(q.xmax-q.xmin)/g.width,z=Math.max(q.xmin,u.xmin),B=Math.min(q.ymax,u.ymax),A=Math.round((z-q.xmin)/v),y=g.width-Math.round(Math.abs(q.xmax-Math.min(q.xmax,u.xmax))/v),D=Math.round(Math.abs(q.ymax-B)/v),G=g.height-Math.round((Math.max(q.ymin,u.ymin)-q.ymin)/v),E=this.halfWorldWidth;z=Math.round((z-u.xmin)/v);k=k.normalizedExtent;if(!(this.wrapTimes&&E&&q.xmin<-E)){if(this.wrapTimes&&E){if(this.tileInfo.applyGCS360Transform)360<q.xmin&&(z-=this.fullBoundary.paddingLeft);
else if(q.xmin>E){z-=this.fullBoundary.paddingLeft;var F=this.normalizeCoordinate(q.xmin,E);var I=this.normalizeCoordinate(q.xmax,E)}else F=q.xmin,I=q.xmax;this.tileInfo.applyGCS360Transform?k&&360>k.xmin&&360<k.xmax&&(y-=this.fullBoundary.paddingRight):k&&k.xmin<E&&k.xmax>E?y-=this.fullBoundary.paddingRight:F<E&&I>E&&(y-=this.fullBoundary.paddingRight)}F=Math.round(Math.abs(u.ymax-B)/v);I=g.pixelBlock.pixels.length;e=e.pixelBlock;k=g.width;q=e.mask||new Uint8Array(w*r);var M=g.pixelBlock,P=M.mask,
W=0;for(v=0;v<I;v++){B=M.pixels[v];E=e.pixels[v]||new B.constructor(w*r);for(g=D;g<G;g++)for(W=(F+g-D)*w+z,u=A;u<y;u++)E[W+u-A]=B[g*k+u];e.pixels[v]=E}if(P)for(g=D;g<G;g++)for(W=(F+g-D)*w+z,u=A;u<y;u++)q[W+u-A]=P[g*k+u];else for(g=D;g<G;g++)for(W=(F+g-D)*w+z,u=A;u<y;u++)q[W+u-A]=1;e.pixelType=e.pixelType||M.pixelType;e.mask=q;if(!(e.statistics&&0<e.statistics.length))for(e.statistics=[],g=0;g<M.statistics.length;g++)e.statistics[g]={minValue:M.statistics[g].minValue,maxValue:M.statistics[g].maxValue};
else if(M.statistics&&e.statistics)for(g=0;g<e.statistics.length;g++)e.statistics[g].minValue=Math.min(M.statistics[g].minValue,e.statistics[g].minValue),e.statistics[g].maxValue=Math.max(M.statistics[g].maxValue,e.statistics[g].maxValue)}}},_processTile:function(g,e){var k=new x,w=this.layer._hasTilingEffects,q=this.layer.useWebGL,u=w||q,r=this.layer.raster.rasterFunction&&g&&(w||q||!g.processedPixelBlock);if(e)var v=g;else this._fillPixelData(g),v=u?this.originalPixelData:g;this.xformSetting.hasNewTexture=
this.hasNewData;var z;r?(this.identifiers.forEach(function(B){if(0===v.src[B].pixelBlock.pixels.length||0===v.src[B].pixelBlock.pixels[0].length)z=!0}),z?k.resolve({extent:v.extent,processedPixelBlock:v.src[this.identifiers[0]],pixelBlock:v.src[this.identifiers[0]]}):q?(this.processedPixelData=this.layer.raster.rasterFunction.read(v),k.resolve(this.processedPixelData)):this.layer._rasterHandler?this.layer._rasterHandler.process({extent:v.extent,src:v.src}).then(function(B){w?(this.processedPixelData=
B,k.resolve(this.processedPixelData)):(g.processedPixelBlock=B.pixelBlock,k.resolve(g))}):(q=this.layer.raster.rasterFunction.read(g),g.processedPixelBlock=q.pixelBlock,k.resolve(g))):u?k.resolve(v.src[this.identifiers[0]]):(g.pixelBlock=v.src[this.identifiers[0]]&&v.src[this.identifiers[0]].pixelBlock,k.resolve(g));return k.promise},_renderTile:function(g){var e=new x,k=this.layer._hasTilingEffects,w=this.layer.useWebGL,q=Math.abs((g.extent.xmax-g.extent.xmin)/g.width-this.layer.getCurrentResolution().x)>
this.resolution.x/10;q=this.layer.useWebGL&&(q||this._isTileOutSide(g,this.layer._map.extent));this.xformSetting.hasNewTexture=this.hasNewData;this.layer._rasterRenderer&&g&&(g.texture||g.src||g.pixelBlock||g.processedPixelBlock)?(this.layer._rasterRenderer.interpolation=this.layer.interpolation,w&&!q?(this.layer.raster.rasterFunction&&this.layer.raster.rasterFunction.renderTexture||this.layer._rasterRenderer.draw(g),e.resolve(g)):this.layer._rasterHandler?this.layer._rasterHandler.render({extent:g.extent,
pixelBlock:g.processedPixelBlock||g.pixelBlock}).then(function(u){k?(u.renderedPixelBlock=u.pixelBlock,e.resolve(u)):(g.renderedPixelBlock=u.pixelBlock,e.resolve(g))}.bind(this)):(g.renderedPixelBlock=this.layer._rasterRenderer.draw(g).pixelBlock,e.resolve(g))):(g.renderedPixelBlock=g.processedPixelBlock||g.pixelBlock,e.resolve(g));return e.promise},_sortTiles:function(){this.tiles.sort(function(g,e){return g.row<e.row||g.row==e.row&&g.col<e.col?-1:1})}})})},"esri/virtualearth/VETiledLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/_base/array dojo/_base/config dojo/has dojo/string dojo/_base/Deferred ../kernel ../urlUtils ../SpatialReference ../layers/TileInfo ../layers/TiledMapServiceLayer ../geometry/Extent ../request".split(" "),
function(t,p,x,b,m,f,d,a,c,l,h,n,g,e,k){t=t(g,{declaredClass:"esri.virtualearth.VETiledLayer",constructor:function(w){try{if(w=p.mixin({bingMapsKey:null,culture:"en-US"},w||{}),this.url=l.getProtocolForWebResource()+"//dev.virtualearth.net/REST/v1",this._url=l.urlToObject(this.url),this.spatialReference=new h({wkid:102100}),this.tileInfo=new n({rows:256,cols:256,dpi:96,origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:{wkid:102100},lods:[{level:1,resolution:78271.5169639999,scale:2.95828763795777E8},
{level:2,resolution:39135.7584820001,scale:1.47914381897889E8},{level:3,resolution:19567.8792409999,scale:7.3957190948944E7},{level:4,resolution:9783.93962049996,scale:3.6978595474472E7},{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},{level:10,resolution:152.874056570411,
scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:.597164283559817,scale:2256.994353},{level:19,resolution:.298582141647617,
scale:1128.497176},{level:20,resolution:.1492910708238085,scale:564.248588}]}),this.initialExtent=this.fullExtent=new e(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new h({wkid:102100})),p.mixin(this,w),this.hasAttributionData=this.showAttribution,this._initLayer=p.hitch(this,this._initLayer),this._errorHandler=p.hitch(this,this._errorHandler),this._getTileInfo=p.hitch(this,this._getTileInfo),this.bingMapsKey)this._getTileInfo();else throw Error("BingMapsKey must be provided.");
}catch(q){throw this.onError(q),q;}},_unsetMap:function(w,q){this.inherited("_unsetMap",arguments)},_getTileInfo:function(){if(this.mapStyle){var w=this._url.path+"/Imagery/Metadata/"+this.mapStyle,q=window.location.protocol;if(this.bingMapsKey){var u=this.resourceInfo;!this.loaded&&u?this._initLayer(u):k({url:w,content:p.mixin({},{uriScheme:"https:"===q?"https":"http",key:this.bingMapsKey,ss:!0,c:this.culture,include:this.hasAttributionData?"imageryProviders":null}),callbackParamName:"jsonp",load:this._initLayer,
error:this._errorHandler})}}},_initLayer:function(w,q){if(200!==w.statusCode){var u=Error();u.code=w.statusCode;u.message=w.statusDescription;u.details=w.errorDetails;u.authenticationResultCode=w.authenticationResultCode;this.onError(u)}else try{this.resourceInfo=x.toJson(w);u=w.resourceSets[0].resources[0];var r=u.imageUrl.replace("{","${");this.tileServers=b.map(u.imageUrlSubdomains,function(z){var B=l.getProtocolForWebResource();return d.substitute(r,{subdomain:z}).replace("http:",B)});this._tsLength=
this.tileServers.length;if(this.loaded)this.refresh(),this.onMapStyleChange();else{this.copyright=this.copyright||"\x26copy; 2017 Microsoft Corporation and its data suppliers";this.loaded=!0;this.onLoad(this);var v=this.loadCallback;v&&(delete this.loadCallback,v(this))}}catch(z){this.onError(z)}},getAttributionData:function(){var w=new a,q=x.fromJson(this.resourceInfo),u;this.hasAttributionData&&q&&(u=p.getObject("resourceSets.0.resources.0.imageryProviders",!1,q));u?w.callback({contributors:u}):
(q=Error("Layer does not have attribution data"),q.log=m.isDebug,w.errback(q));return w},getTileUrl:function(w,q,u){return d.substitute(this.tileServers[q%this._tsLength].replace(/\{/g,"${"),{quadkey:this._getQuadKey(w,q,u),culture:this.culture,token:this.bingMapsKey})},_getQuadKey:function(w,q,u){var r="",v;for(v=w;0<v;v--){w="0";var z=1<<v-1;0!=(u&z)&&w++;0!=(q&z)&&(w++,w++);r+=w}return r},setMapStyle:function(w){this.mapStyle=w;this._getTileInfo()},setCulture:function(w){this.culture=w;this._getTileInfo()},
setBingMapsKey:function(w){this.bingMapsKey=w},onMapStyleChange:function(){}});p.mixin(t,{MAP_STYLE_AERIAL:"aerial",MAP_STYLE_AERIAL_WITH_LABELS:"aerialWithLabelsOnDemand",MAP_STYLE_ROAD:"roadOnDemand"});p.setObject("virtualearth.VETiledLayer",t,c);return t})},"esri/dijit/Attribution":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-attr dojo/dom-construct dojo/dom-style dojo/dom-class dojo/dom-geometry ../kernel ../lang ../SpatialReference ../geometry/webMercatorUtils ../geometry/Extent".split(" "),
function(t,p,x,b,m,f,d,a,c,l,h,n,g,e,k,w,q,u){t=t(null,{declaredClass:"esri.dijit.Attribution",itemDelimiter:" | ",listClass:"esriAttributionList",itemClass:"esriAttributionItem",lastItemClass:"esriAttributionLastItem",delimiterClass:"esriAttributionDelim",constructor:function(r,v){try{p.mixin(this,r);this._attributions={};this._pendingDfds={};this._activeLayers=[];this._sharedLayers=[];this._layerHandles={};var z=this.domNode=a.byId(v),B=this.map,A="\x3cspan class\x3d'"+this.listClass+"'\x3e\x3c/span\x3e";
z&&(c.set(z,"innerHTML",A),this.listNode=m.query(".esriAttributionList",z)[0],this.itemNodes={});this._eventConnections=[b.connect(B,"onLayerAdd",this,this._onLayerAdd),b.connect(B,"onLayerRemove",this,this._onLayerRemove),b.connect(B,"onLayerSuspend",this,this._onLayerSuspend),b.connect(B,"onLayerResume",this,this._onLayerResume),b.connect(B,"onResize",this,this._adjustFocus),b.connect(B,"onExtentChange",this,this._onExtentChange)];if(B.loaded){var y=B.layerIds.concat(B.graphicsLayerIds),D,G=y.length;
for(D=0;D<G;D++){var E=B.getLayer(y[D]);E.loaded&&this._onLayerAdd(E)}}}catch(F){}},startup:function(){},destroy:function(){x.forEach(this._eventConnections,b.disconnect);l.destroy(this.listNode);var r=this._layerHandles,v;for(v in r)r[v]&&r[v].remove();this.map=this.domNode=this._eventConnections=this.listNode=this._attributions=this._pendingDfds=this.itemNodes=this._activeLayers=this._lastItem=this._sharedLayers=this._layerHandles=null},_onLayerAdd:function(r){try{var v=this._attributions,z=r.id;
if(!k.isDefined(v[z])&&r.showAttribution){if(r.hasAttributionData){var B=r.getAttributionData();this._pendingDfds[z]=1;v[z]=B;B.addBoth(p.partial(this._onAttributionLoad,this,r))}else v[z]=r.copyright||r.copyrightText||"",v[z]?(r.suspended||this._activeLayers.push(z),this._createNode(z)):this._onLayerRemove(r);-1<r.declaredClass.toLowerCase().indexOf("vetiledlayer")&&(this._layerHandles[z]=r.on("map-style-change",p.hitch(this,function(){this._onLayerRemove(r);this._onLayerAdd(r)})))}}catch(A){}},
_onAttributionLoad:function(r,v,z){var B=r._attributions,A=r._pendingDfds,y=v.id;if(A&&A[y]){delete A[y];if(!z||z instanceof Error)z="";B[y]=z?r._createIndexByLevel(z,-1!==v.declaredClass.toLowerCase().indexOf("vetiledlayer")):v.copyright||v.copyrightText||"";B[y]?(v.suspended||r._activeLayers.push(y),r._createNode(y)):r._onLayerRemove(v)}},_onLayerRemove:function(r){try{var v=r.id,z=this.itemNodes,B=-1;this._onLayerSuspend(r);this._layerHandles[v]&&this._layerHandles[v].remove();delete this._attributions[v];
delete this._pendingDfds[v];delete this._layerHandles[v];var A=this._getGroupIndex(v);-1!==A&&(B=x.indexOf(this._sharedLayers[A],v),-1!==B&&(this._sharedLayers[A].splice(B,1),1>=this._sharedLayers[A].length&&this._sharedLayers.splice(A,1)));z[v]&&-1===B&&l.destroy(z[v]);delete z[v];this._updateLastItem()}catch(y){}},_onLayerSuspend:function(r){try{var v=r.id;if(this._attributions[v]){var z=x.indexOf(this._activeLayers,v),B=this.itemNodes[v];-1!==z&&this._activeLayers.splice(z,1);B&&this._toggleItem(B,
!1,this._getGroupIndex(v))}}catch(A){}},_adjustFocus:function(){var r=this.domNode.scrollWidth>this.domNode.clientWidth,v=n.contains(this.domNode,"esriAttributionOpen");c.set(this.domNode,"tabIndex",r||v?"0":"")},_onLayerResume:function(r){try{var v=r.id,z=this._attributions[v],B=this.itemNodes[v];if(z&&(-1===x.indexOf(this._activeLayers,v)&&this._activeLayers.push(v),B)){var A=p.isString(z)?z:this._getContributorsList(z,this.map.extent,this.map.getLevel());p.isString(z)||c.set(B,"innerHTML",A?A+
this._getDelimiter():"");A&&this._toggleItem(B,!0,this._getGroupIndex(v))}}catch(y){}},_onExtentChange:function(r,v,z,B){try{var A=this._activeLayers,y=this._attributions,D=this.itemNodes,G,E,F=A.length||0;for(E=0;E<F;E++){var I=A[E];var M=y[I];if((G=D[I])&&!p.isString(M)){var P=this._getContributorsList(M,r,B?B.level:-1);c.set(G,"innerHTML",P?P+this._getDelimiter():"");this._toggleItem(G,!!P,-1)}}}catch(W){}this._adjustCursorStyle()},_createNode:function(r){if(this.domNode){var v=this._checkShareInfo(r),
z=v&&v.sharedWith;z=z&&this.itemNodes[z];var B=this.map,A=this._attributions[r];A=p.isString(A)?A:this._getContributorsList(A,B.extent,B.getLevel());B=!!A&&!B.getLayer(r).suspended;z?(this.itemNodes[r]=z,this._toggleItem(z,B,v.index)):(r=this.itemNodes[r]=l.create("span",{"class":this.itemClass,innerHTML:A?A+this._getDelimiter():"",style:{display:B?"inline":"none"}},this.listNode),B&&this._setLastItem(r));this._adjustCursorStyle()}},_checkShareInfo:function(r){var v=this._attributions,z,B=-1,A=v[r];
if(A&&p.isString(A)){for(z in v){var y=v[z];if(z!==r&&y&&p.isString(y)&&y.length===A.length&&y.toLowerCase()===A.toLowerCase()){var D=z;break}}v=this._sharedLayers;y=v.length;if(D){for(z=0;z<y;z++)if(A=v[z],-1!==x.indexOf(A,D)){B=z;A.push(r);break}-1===B&&(B=v.push([D,r])-1)}}return-1<B?{index:B,sharedWith:D}:null},_getGroupIndex:function(r){var v=this._sharedLayers,z,B=v.length,A=-1;for(z=0;z<B;z++)if(-1!==x.indexOf(v[z],r)){A=z;break}return A},_getDelimiter:function(){var r=this.itemDelimiter;return r?
"\x3cspan class\x3d'"+this.delimiterClass+"'\x3e"+r+"\x3c/span\x3e":""},_toggleItem:function(r,v,z){if(-1<z&&!v){z=this._sharedLayers[z];var B,A=z.length,y=this._activeLayers;for(B=0;B<A;B++)if(-1!==x.indexOf(y,z[B]))return}h.set(r,"display",v?"inline":"none");this._updateLastItem()},_updateLastItem:function(){var r=this.listNode.childNodes;var v=r.length;if(v)for(--v;0<=v;v--){var z=r[v];if("none"!==h.get(z,"display")){this._setLastItem(z);break}}this._adjustCursorStyle()},_setLastItem:function(r){var v=
this.itemClass,z=this.lastItemClass;this._lastItem&&n.replace(this._lastItem,v,z);r&&(n.replace(r,z,v),this._lastItem=r)},_createIndexByLevel:function(r,v){var z=r.contributors,B,A,y=z?z.length:0,D,G=new w(4326),E={};for(A=0;A<y;A++){var F=z[A];var I=(B=F.coverageAreas)?B.length:0;for(D=0;D<I;D++){var M=B[D];var P=M.bbox;P={extent:q.geographicToWebMercator(new u(P[1],P[0],P[3],P[2],G)),attribution:F.attribution||"",zoomMin:M.zoomMin-(v&&M.zoomMin?1:0),zoomMax:M.zoomMax-(v&&M.zoomMax?1:0),score:k.isDefined(M.score)?
M.score:100,objectId:A};for(M=P.zoomMin;M<=P.zoomMax;M++)E[M]=E[M]||[],E[M].push(P)}}return E},_getContributorsList:function(r,v,z){var B="";if(v&&k.isDefined(z)&&-1<z){r=r[z];z=v.getCenter().normalize();var A=r?r.length:0,y=[],D={};for(B=0;B<A;B++)v=r[B],!D[v.objectId]&&v.extent.contains(z)&&(D[v.objectId]=1,y.push(v));y.sort(function(G,E){return E.score-G.score||G.objectId-E.objectId});A=y.length;for(B=0;B<A;B++)y[B]=y[B].attribution;B=y.join(", ")}return B},_adjustCursorStyle:function(){var r=
g.position(this.listNode.parentNode,!0).h;n.contains(this.listNode.parentNode,"esriAttributionOpen")?(n.remove(this.listNode.parentNode,"esriAttributionOpen"),r>g.position(this.listNode.parentNode,!0).h?(h.set(this.listNode.parentNode,"cursor","pointer"),n.add(this.listNode.parentNode,"esriAttributionOpen")):h.set(this.listNode.parentNode,"cursor","default")):(n.add(this.listNode.parentNode,"esriAttributionOpen"),r<g.position(this.listNode.parentNode,!0).h?h.set(this.listNode.parentNode,"cursor",
"pointer"):h.set(this.listNode.parentNode,"cursor","default"),n.remove(this.listNode.parentNode,"esriAttributionOpen"));this._adjustFocus()}});p.setObject("dijit.Attribution",t,e);return t})},"esri/dijit/TimeSlider":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/kernel dojo/has dojo/dom-class dojo/dom-construct dojo/dom-style dojo/dom-geometry dijit/_Widget dijit/_Templated dijit/form/HorizontalSlider dijit/form/HorizontalRule dijit/form/HorizontalRuleLabels dojox/timing/_base dojox/form/RangeSlider dojo/text!dojox/form/resources/HorizontalRangeSlider.html ../kernel ../lang ../TimeExtent ./_EventedWidget dojo/text!./templates/TimeSlider.html dojo/i18n!../nls/jsapi".split(" "),
function(t,p,x,b,m,f,d,a,c,l,h,n,g,e,k,w,q,u,r,v,z,B,A){m=t([z,l,h],{declaredClass:"esri.dijit.TimeSlider",widgetsInTemplate:!0,templateString:B,intermediateChanges:!1,_slideDuration:1E3,_defaultCount:10,_eventMap:{"time-extent-change":!0,play:!0,pause:!0,next:!0,previous:!0},constructor:function(y,D){p.mixin(this,A.widgets.timeSlider);this._iconClass="tsButton tsPlayButton";this.loop=this.playing=!1;this.thumbCount=1;this.thumbMovingRate=1E3;this._createTimeInstants=!1;this._options=p.mixin({excludeDataAtTrailingThumb:!1,
excludeDataAtLeadingThumb:!1},y.options||{})},postCreate:function(){this.inherited(arguments)},startup:function(){this.inherited(arguments);this._timer=new k.Timer;this._timer.setInterval(this.thumbMovingRate);this._timer.onTick=p.hitch(this,"_bumpSlider",1);this._createSlider()},destroy:function(){this._timer.stop();this.timeStops=this._timer=null;this._slider.destroy();this._slider=null;this._hTicks&&(this._hTicks.destroyRecursive(),this._hTicks=null);this._hLabels&&(this._hLabels.destroyRecursive(),
this._hLabels=null);this.inherited(arguments)},onTimeExtentChange:function(){},onPlay:function(){},onPause:function(){},onNext:function(){},onPrevious:function(){},_onHorizontalChange:function(){var y=this._sliderToTimeExtent();this.onTimeExtentChange(y)},_onPlay:function(){this.playing=!this.playing;this._updateUI();this.playing?(this._timer.start(),this.onPlay(this._sliderToTimeExtent())):(this._timer.stop(),this.onPause(this._sliderToTimeExtent()));var y=this._getSliderValue();this._offset=p.isArray(y)?
y[1]-y[0]:0},_onNext:function(){this.playing||(this._bumpSlider(1),this.onNext(this._sliderToTimeExtent()))},_onPrev:function(){this.playing||(this._bumpSlider(-1),this.onPrevious(this._sliderToTimeExtent()))},createTimeStopsByCount:function(y,D){y&&y.startTime&&y.endTime&&(D=D||this._defaultCount,this.createTimeStopsByTimeInterval(y,Math.ceil((y.endTime-y.startTime)/(D-1)),"esriTimeUnitsMilliseconds"))},createTimeStopsByTimeInterval:function(y,D,G,E){if(y&&y.startTime&&y.endTime){this.fullTimeExtent=
new v(y.startTime,y.endTime);E&&!0===E.resetStartTime&&this._resetStartTime(this.fullTimeExtent,G);this._timeIntervalUnits=G;E=this.fullTimeExtent.startTime;for(var F=[];E<=y.endTime;)F.push(E),E=y._getOffsettedDate(E,D,G);0<F.length&&F[F.length-1]<y.endTime&&F.push(E);this.setTimeStops(F)}},getCurrentTimeExtent:function(){return this._sliderToTimeExtent()},setTimeStops:function(y){this.timeStops=y||[];this._numTicks=this._numStops=this.timeStops.length;!1===r.isDefined(this.fullTimeExtent)&&(this.fullTimeExtent=
new v(y[0],y[y.length-1]))},setLoop:function(y){this.loop=y},setThumbCount:function(y){this.thumbCount=y;this.singleThumbAsTimeInstant(this._createTimeInstants);this._slider&&this._createSlider()},setThumbIndexes:function(y){this.thumbIndexes=p.clone(y)||[0,1];this._initializeThumbs()},setThumbMovingRate:function(y){this.thumbMovingRate=y;this._timer&&this._timer.setInterval(this.thumbMovingRate)},setLabels:function(y){this.labels=y;this._slider&&this._createSlider()},setTickCount:function(y){this._numTicks=
y;this._slider&&this._createSlider()},singleThumbAsTimeInstant:function(y){this._createTimeInstants=y&&1===this.thumbCount},next:function(){this._onNext()},pause:function(){this.playing=!1;this._updateUI();this._timer.stop()},play:function(){!0!==this.playing&&(this.playing=!1,this._onPlay())},previous:function(){this._onPrev()},_setIntermediateChangesAttr:function(y){this.intermediateChanges=!!y;this._slider&&this._slider.set("intermediateChanges",!!y)},_updateUI:function(){f.remove(this.playPauseBtn.iconNode,
this._iconClass);this._iconClass=this.playing?"tsButton tsPauseButton":"tsButton tsPlayButton";f.add(this.playPauseBtn.iconNode,this._iconClass);this.previousBtn.set("disabled",this.playing);this.nextBtn.set("disabled",this.playing)},_createSlider:function(){this._slider&&(this._slider.destroy(),this._slider=null);for(var y=this.domNode;y.parentNode&&!y.dir;)y=y.parentNode;y={onChange:p.hitch(this,"_onHorizontalChange"),showButtons:!1,discreteValues:this._numStops,slideDuration:this._slideDuration,
"class":"ts",dir:"ltr",intermediateChanges:this.intermediateChanges};this._ts=d.create("div",{},b.query(".tsTmp",this.domNode)[0],"first");this._timeSliderTicks=d.create("div",{},this._ts,"first");this._timeSliderLabels=d.create("div",{},this._ts);2===this.thumbCount?this._createRangeSlider(y):this._createSingleSlider(y);this.thumbIndexes=this.thumbIndexes||[0,1];this._createHorizRule();this._createLabels();!0===this._createTimeInstants&&b.query(".dijitSliderProgressBarH, .dijitSliderLeftBumper, .dijitSliderRightBumper",
this._ts).forEach(function(D){a.set(D,{background:"none"})});this._initializeThumbs();x.disconnect(this._onChangeConnect);this._onChangeConnect=x.connect(this._slider,"onChange",p.hitch(this,"_updateThumbIndexes"))},_createRangeSlider:function(y){this._isRangeSlider=!0;this._slider=new (t([n,w],{templateString:q}))(y,this._ts)},_createSingleSlider:function(y){this._isRangeSlider=!1;this._slider=new n(y,this._ts)},_createHorizRule:function(){this._hTicks&&(this._hTicks.destroyRecursive(),this._hTicks=
null);2>this._numTicks||(this._hTicks=new g({container:"topDecoration",ruleStyle:"","class":"tsTicks",count:this._numTicks},this._timeSliderTicks))},_createLabels:function(){this._hLabels&&(this._hLabels.destroyRecursive(),this._hLabels=null);this.labels&&0<this.labels.length&&(this._hLabels=new e({labels:this.labels,labelStyle:"","class":"tsLabels"},this._timeSliderLabels))},_initializeThumbs:function(){if(this._slider){this._offset=this._toSliderValue(this.thumbIndexes[1])||0;var y=this._toSliderValue(this.thumbIndexes[0]);
y=y>this._slider.maximum||y<this._slider.minimum?this._slider.minimum:y;if(!0===this._isRangeSlider){var D=this._toSliderValue(this.thumbIndexes[1]);D=D>this._slider.maximum||D<this._slider.minimum?this._slider.maximum:D;this._setSliderValue([y,D<y?y:D])}else this._setSliderValue(y);this._onHorizontalChange()}},_bumpSlider:function(y){var D=this._getSliderValue(),G=D,E=G,F=y;p.isArray(D)&&(E=D[0],G=D[1],F=[{change:y,useMaxValue:!0},{change:y,useMaxValue:!1}]);1E-10>Math.abs(E-this._slider.minimum)&&
0>y||1E-10>Math.abs(G-this._slider.maximum)&&0<y?this._timer.isRunning&&(this.loop?(this._timer.stop(),this._setSliderValue(this._getSliderMinValue()),y=this._sliderToTimeExtent(),this.onTimeExtentChange(y),this._timer.start(),this.playing=!0):this.pause()):this._slider._bumpValue(F)},_updateThumbIndexes:function(){var y=this._getSliderValue();p.isArray(y)?(this.thumbIndexes[0]=this._toSliderIndex(y[0]),this.thumbIndexes[1]=this._toSliderIndex(y[1])):this.thumbIndexes[0]=this._toSliderIndex(y)},_sliderToTimeExtent:function(){if(this.timeStops&&
0!==this.timeStops.length){var y=new v,D=this._getSliderValue();if(p.isArray(D)){if(D[0]>D[1]){var G=D[0];var E=D[1]}else E=D[0],G=D[1];y.startTime=new Date(this.timeStops[this._toSliderIndex(E)]);y.endTime=new Date(this.timeStops[this._toSliderIndex(G)]);this._adjustTimeExtent(y)}else y.startTime=!0===this._createTimeInstants?new Date(this.timeStops[this._toSliderIndex(D)]):new Date(this.fullTimeExtent.startTime),y.endTime=!0===this._createTimeInstants?y.startTime:new Date(this.timeStops[this._toSliderIndex(D)]);
return y}},_adjustTimeExtent:function(y){if((!1!==this._options.excludeDataAtTrailingThumb||!1!==this._options.excludeDataAtLeadingThumb)&&y.startTime.getTime()!==y.endTime.getTime()){if(this._options.excludeDataAtTrailingThumb){var D=y.startTime;D.setUTCSeconds(D.getUTCSeconds()+1)}this._options.excludeDataAtLeadingThumb&&(y=y.endTime,y.setUTCSeconds(y.getUTCSeconds()-1))}},_resetStartTime:function(y,D){switch(D){case "esriTimeUnitsSeconds":y.startTime.setUTCMilliseconds(0);break;case "esriTimeUnitsMinutes":y.startTime.setUTCSeconds(0,
0,0);break;case "esriTimeUnitsHours":y.startTime.setUTCMinutes(0,0,0);break;case "esriTimeUnitsDays":y.startTime.setUTCHours(0,0,0,0);break;case "esriTimeUnitsWeeks":y.startTime.setUTCDate(y.startTime.getUTCDate()-y.startTime.getUTCDay());break;case "esriTimeUnitsMonths":y.startTime.setUTCDate(1);y.startTime.setUTCHours(0,0,0,0);break;case "esriTimeUnitsDecades":y.startTime.setUTCFullYear(y.startTime.getUTCFullYear()-y.startTime.getUTCFullYear()%10);break;case "esriTimeUnitsCenturies":y.startTime.setUTCFullYear(y.startTime.getUTCFullYear()-
y.startTime.getUTCFullYear()%100)}},_getSliderMinValue:function(){return this._isRangeSlider?[this._slider.minimum,this._slider.minimum+this._offset]:this._slider.minimum},_toSliderIndex:function(y){y=Math.floor((y-this._slider.minimum)*this._numStops/(this._slider.maximum-this._slider.minimum));0>y&&(y=0);y>=this._numStops&&(y=this._numStops-1);return y},_toSliderValue:function(y){return y*(this._slider.maximum-this._slider.minimum)/(this._numStops-1)+this._slider.minimum},_getSliderValue:function(){return this._slider.get("value")},
_setSliderValue:function(y){this._slider._setValueAttr(y,!1,!1)}});p.setObject("dijit.TimeSlider",m,u);return m})},"esri/dijit/MultidimensionalSlider":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/on dojo/json dijit/form/VerticalSlider dojox/form/VerticalRangeSlider dijit/form/VerticalRule dijit/form/VerticalRuleLabels dijit/form/HorizontalSlider dojox/form/HorizontalRangeSlider dijit/form/HorizontalRule dijit/form/HorizontalRuleLabels dijit/_Widget dijit/_Templated dojox/timing/_base dojo/_base/array dojo/Deferred dojo/DeferredList ../layers/MosaicRule ../layers/DimensionalDefinition ../kernel ../lang ./_EventedWidget dojo/text!./templates/MultidimensionalSlider_vertical.html dojo/text!./templates/MultidimensionalSlider_horizontal.html dojo/i18n!../nls/jsapi dojo/dom-class dojo/dom-style dojo/dom-geometry dojo/touch dojo/query dojo/dom-construct dojo/_base/sniff".split(" "),
function(t,p,x,b,m,f,d,a,c,l,h,n,g,e,k,w,q,u,r,v,z,B,A,y,D,G,E,F,I,M,P,W,H){var O={LAYOUT_VERTICAL:"vertical",LAYOUT_HORIZONTAL:"horizontal"};e=t([y,e,k],{declaredClass:"esri.dijit.MultidimensionalSlider",widgetsInTemplate:!0,templateString:D,nLabels:10,_thumbCount:1,useRanges:void 0,loop:!0,useLayersDimSlices:!0,prefetch:!0,prefetchedValues:{},showPlayButton:!0,prefetchFactor:2,_hasUnitConflict:!1,_update:!0,useDefaults:!1,playDirectionAscending:!0,unitSymbols:{meter:"m",pascal:"Pa"},_eventMap:{"dimension-value-change":!0,
play:!0,pause:!0,next:!0,previous:!0,change:!0,"dimension-array-create":!0},onChange:function(){},onPlay:function(){},onPause:function(){},onDimensionValueChange:function(){},_onPlay:function(){this.playing=!this.playing;this._updateUI();this.playing?(this._timer.start(),this.onPlay()):(this._timer.stop(),this.onPause())},constructor:function(K,R){t.safeMixin(this,K);this.playing=!1;this._iconClass="mdsButton mdsPlayButton";this.map&&this._getImageLayers();this.layout===O.LAYOUT_HORIZONTAL&&(this.templateString=
G);this.thumbMovingRate=this.thumbMovingRate||3E3;this._i18n=E;this.prefetchImgNodes={}},postCreate:function(){this.inherited(arguments)},startup:function(){this.inherited(arguments);var K=this;this._getAllLayersMDInfo().then(function(){K._sortDimensionValues();K.dimensionValues=K.dimensionValues&&K.dimensionValues.length&&!K.useLayersDimSlices?K.dimensionValues:K._mapSortedDimensionValues;K.getUnit();K._setupSlider()});this._timer=new w.Timer;this._timer.setInterval(this.thumbMovingRate);this._timer.onTick=
p.hitch(this,function(){this.playDirectionAscending?this._bumpSlider(1):this._bumpSlider(-1)});this.layout===O.LAYOUT_VERTICAL&&(this.computeSliderStyle(),this.on("resize",p.hitch(this,"computeSliderStyle")));this._setupHandles()},_insertPassiveLabels:function(){var K=W(".dijitSliderMoveable.dijitSliderMoveableV",this.domNode);this._passiveLbl1=H.create("div");F.add(this._passiveLbl1,"esriMdSliderPassiveLbl");H.place(this._passiveLbl1,K[0]);2===this._thumbCount&&(this._passiveLbl2=H.create("div"),
F.add(this._passiveLbl2,"esriMdSliderPassiveLbl"),H.place(this._passiveLbl2,K[1]))},_setupHandles:function(){this._eventHandles=[];this._eventHandles.push(b(this.domNode,"mouseover",p.hitch(this,"activateSlider")));this._eventHandles.push(b(this.domNode,"mouseleave",p.hitch(this,"deactivateSlider")));this._eventHandles.push(b(this.domNode,P.press,p.hitch(this,"activateSlider")));this._eventHandles.push(b(this.domNode,P.release,p.hitch(this,"deactivateSlider")));this._eventHandles.push(b(this.prevBtn.domNode,
P.press,p.hitch(this,"activateSlider")));this._eventHandles.push(b(this.playPauseBtn.domNode,P.press,p.hitch(this,"activateSlider")));this._eventHandles.push(b(this.nextBtn.domNode,P.press,p.hitch(this,"activateSlider")));var K=W(".dijitSliderImageHandle.dijitSliderImageHandleV",this.domNode);q.forEach(K,function(R){this._eventHandles.push(b(R,P.press,p.hitch(this,"activateSlider")));this._eventHandles.push(b(R,P.release,p.hitch(this,"deactivateSlider")))},this)},_removeHandles:function(){q.forEach(this._eventHandles,
function(K){K&&K.remove()})},activateSlider:function(){9>x("ie")&&I.set(this.domNode,"background","#fff");this.sliderActive=!0;this.deactivateTimer&&clearTimeout(this.deactivateTimer);F.remove(this.domNode,"esriMdSliderPassive");F.add(this.domNode,"esriMdSliderActive");I.set(this._passiveLbl1,"display","none");this._passiveLbl2&&I.set(this._passiveLbl2,"display","none")},deactivateSlider:function(){if(!(10>x("ie"))){var K=this;this.deactivateTimer=setTimeout(function(){K.sliderActive=!1;K.updatePassiveLabels();
F.remove(K.domNode,"esriMdSliderActive");F.add(K.domNode,"esriMdSliderPassive");K._showPassiveLabels()},2500)}},updatePassiveLabels:function(){this._slider&&A.isDefined(this._slider.value)&&(this._passiveLbl1.innerHTML=this.value.length?this.value[0]:this.value,this._slider.value.length&&(this._passiveLbl2.innerHTML=this.value[1]),this.sliderActive||this._showPassiveLabels())},_showPassiveLabels:function(){A.isDefined(this.value)&&(I.set(this._passiveLbl1,"display","inline-block"),this.value.length?
I.set(this._passiveLbl2,"display","inline-block"):this._passiveLbl2&&I.set(this._passiveLbl2,"display","none"))},increment:function(){var K=1;!this.playDirectionAscending&&this.playing&&(K=-1);this._bumpSlider(K)},decrement:function(){var K=-1;!this.playDirectionAscending&&this.playing&&(K=1);this._bumpSlider(K)},_setDimensionAttr:function(K){this._slider&&(K.dimension&&(this.dimension=K.dimension),this.dimensionValues=K.dimensionValues&&K.dimensionValues.length?K.dimensionValues:[],this.update())},
update:function(){var K=this;this._mapSortedDimensionValues=[];this._getImageLayers();this.value=this.dimensionValues[this._slider.value];this._getAllLayersMDInfo().then(function(){K._sortDimensionValues();K.getUnit();K.dimensionValues&&K.dimensionValues.length&&!K.useLayersDimSlices||(K.dimensionValues=K._mapSortedDimensionValues);K._setupSlider()})},pause:function(){this.playing=!1;this._updateUI();this._timer.stop()},play:function(K){!0!==this.playing&&(this.playing=!1,this._onPlay())},_setupSlider:function(){this._destroySlider();
this.dimensionValues&&this.dimensionValues.length&&(this.sliderNode=document.createElement("div"),this._getDimensionAlias(),this._layers&&this._layers.length&&1===this._layers.length&&this._readMosaicRule(),this._createRule(),this._createLabels(),this._createSlider(),this._insertPassiveLabels(),this._slider.onChange(this._slider.value))},_createLabels:function(){this.layout===O.LAYOUT_HORIZONTAL?this._createHorizontalLabels():this._createVerticalLabels()},_createRule:function(){this.layout===O.LAYOUT_HORIZONTAL?
this._createHorizontalRule():this._createVerticalRule()},_createVerticalLabels:function(){this.labelsNode=document.createElement("div");this.sliderNode.appendChild(this.labelsNode);this._sliderLabels=new c({labels:this._filterLabels(),labelStyle:"font-size: 83%; padding-left: 5px;"},this.labelsNode)},_createVerticalRule:function(){this.rulesNode=document.createElement("div");this.sliderNode.appendChild(this.rulesNode);100>=this.dimensionValues.length&&(this._sliderRules=new a({count:this.dimensionValues.length,
style:"width:5px;"},this.rulesNode),this._sliderRules.startup())},_createHorizontalLabels:function(){this.labelsNode=document.createElement("div");this.sliderNode.appendChild(this.labelsNode);this._sliderLabels=new g({labels:this._filterLabels(),labelStyle:"font-size: 83%"},this.labelsNode)},_createHorizontalRule:function(){this.rulesNode=document.createElement("div");this.sliderNode.appendChild(this.rulesNode);100>=this.dimensionValues.length&&(this._sliderRules=new n({count:this.dimensionValues.length,
style:"height:5px;"},this.rulesNode),this._sliderRules.startup())},_createHorizontalSingleSlider:function(K){K=K?K:this.playDirectionAscending?0:this.dimensionValues.length-1;this._slider=new l({name:"horizontal",minimum:0,maximum:this.dimensionValues.length-1,intermediateChanges:!1,discreteValues:this.dimensionValues.length,style:"width: 100%;",increment:p.hitch(this,"increment"),decrement:p.hitch(this,"decrement"),value:K||0,onChange:p.hitch(this,this._onSingleSliderChange),showButtons:!1},this.sliderNode);
this._slider.startup()},_createHorizontalRangeSlider:function(K){K=K?K:this.playDirectionAscending?[0,1]:[this.dimensionValues.length-2,this.dimensionValues.length-1];this._slider=new h({name:"horizontal",minimum:0,maximum:this.dimensionValues.length-1,intermediateChanges:!1,discreteValues:this.dimensionValues.length,style:"width:100%;",increment:p.hitch(this,"increment"),decrement:p.hitch(this,"decrement"),value:K||[0,1],onChange:p.hitch(this,this._onRangeSliderChange),showButtons:!1},this.sliderNode);
this._slider.startup();b(this._slider.incrementButton,"click",this._slider.increment);b(this._slider.decrementButton,"click",this._slider.decrement);this._slider._typematicCallback=function(){}},_createVerticalSingleSlider:function(K){K=A.isDefined(K)?K:this.playDirectionAscending?0:this.dimensionValues.length-1;this._slider=new f({name:"vertical",minimum:0,maximum:this.dimensionValues.length-1,intermediateChanges:!1,discreteValues:this.dimensionValues.length,style:this.computeSliderStyle(),increment:p.hitch(this,
"increment"),decrement:p.hitch(this,"decrement"),value:K||0,onChange:p.hitch(this,this._onSingleSliderChange),showButtons:!1},this.sliderNode);this._slider.startup()},_createVerticalRangeSlider:function(K){K=K?K:this.playDirectionAscending?[0,1]:[this.dimensionValues.length-2,this.dimensionValues.length-1];this._slider=new d({name:"vertical",minimum:0,maximum:this.dimensionValues.length-1,intermediateChanges:!1,discreteValues:this.dimensionValues.length,style:this.computeSliderStyle(),increment:p.hitch(this,
"increment"),decrement:p.hitch(this,"decrement"),value:K||[0,1],onChange:p.hitch(this,this._onRangeSliderChange),showButtons:!1},this.sliderNode);this._slider.startup();this._slider._typematicCallback=function(){}},_onSingleSliderChange:function(K){var R=this.dimensionValues[K];this.setDimensionInfoText(R);q.forEach(this._layers,function(da){this._updateMosaicRule(da,R);this.prefetch&&this.playing&&"esri.layers.RasterXLayer"!==da.declaredClass&&this._prefetchData(K,da)},this);this._oldValue=K;this.value=
R;this.updatePassiveLabels();this.onChange(R)},_onRangeSliderChange:function(K){if(this._update){this._snap&&(K=this._snapToNearestRange(K));var R=[this.dimensionValues[K[1]],this.dimensionValues[K[0]]];R.sort(this._sortCompareFunction);this.value=R;this.setDimensionInfoText(R);this.updatePassiveLabels();q.forEach(this._layers,function(da){this._updateMosaicRule(da,R);this.prefetch&&this.playing&&this._prefetchData(K,da)},this);this._update=!0;this._oldValue=p.clone(K);this.onChange(R)}},destroy:function(){this.inherited(arguments);
this._timer.stop();this._destroySlider();this._removeHandles()},_destroySlider:function(){if(this._slider)try{this._slider.destroy()}catch(K){this._slider.domNode&&H.destroy(this._slider.domNode)}finally{this._slider=null}},_createSlider:function(){this.mdSliderCell.appendChild(this.sliderNode);if(this.value&&this.value.length&&0<=q.indexOf(this.dimensionValues,this.value[0])&&0<=q.indexOf(this.dimensionValues,this.value[1]))var K=[q.indexOf(this.dimensionValues,this.value[0]),q.indexOf(this.dimensionValues,
this.value[1])];else if(A.isDefined(this.value)){var R=q.indexOf(this.dimensionValues,this.value);0<=R&&(K=R)}A.isDefined(K)||(K=this._getDefaultSliderValue());this.useDefaults&&A.isDefined(K)&&(K===this.dimensionValues.length-1||K.length&&0<=q.indexOf(K,this.dimensionValues.length-1))&&(this.playDirectionAscending=!1);2===this._thumbCount?this.layout===O.LAYOUT_HORIZONTAL?this._createHorizontalRangeSlider(K):this._createVerticalRangeSlider(K):this.layout===O.LAYOUT_HORIZONTAL?this._createHorizontalSingleSlider(K):
this._createVerticalSingleSlider(K)},_getDefaultSliderValue:function(){if(this.dimensionValues&&this.dimensionValues.length){var K=Infinity,R=1,da;if(this.dimension&&"stdz"===this.dimension.toLowerCase())for(da=0;da<this.dimensionValues.length;da++){var U=this.dimensionValues[da];var Z=Math.abs(U-0);if(Z<K){K=Z;var L=U}if(0===Z)break}else L=this.dimensionValues[0];L=q.indexOf(this.dimensionValues,L);L=0>L?0:L;2===this._thumbCount&&(L===this.dimensionValues.length-1&&(R=-1),L=[L,L+R]);return L}},_getMultidimensionalInfo:function(K){function R(){K.getMultidimensionalInfo().then(function(U){K.multidimensionalInfo=
U;da.resolve(K)},function(U){da.reject(U)})}var da=new u;if(K.multidimensionalInfo)da.resolve(K);else if(K.loaded)R();else K.on("load",function(){R()});return da},_getAllLayersMDInfo:function(){var K=[];q.forEach(this._layers,function(R){K.push(this._getMultidimensionalInfo(R))},this);return new r(K)},_getImageLayers:function(){var K=this.map.layerIds.concat(this.map.graphicsLayerIds),R;this._layers=[];q.forEach(K,function(da){R=this.map.getLayer(da);"esri.layers.ArcGISImageServiceLayer"!==R.declaredClass&&
"esri.layers.ArcGISImageServiceVectorLayer"!==R.declaredClass&&"esri.layers.RasterLayer"!==R.declaredClass&&"esri.layers.WCSLayer"!==R.declaredClass&&"esri.layers.RasterXLayer"!==R.declaredClass||this._layers.push(R)},this);return this._layers},_sortCompareFunction:function(K,R){return A.isDefined(K)&&A.isDefined(R)?K-R:!1},_getDimensionObjects:function(){function K(U){if(U&&U.values&&U.hasRanges){var Z=[];q.forEach(U.values,function(L){L.length?Z=R(Z,L):Z.push.apply(R(Z.sort(this._sortCompareFunction),
[L]))},this);Z=Z.sort(da._sortCompareFunction);U.decodedValues=Z}return U}var R=this._merge,da=this;this._allRangeValues=!0;this._thumbCount=1;this._snap=!1;this._dimensionObjects=[];this._layers=this._filterLayers();q.forEach(this._layers,function(U){U.multidimensionalInfo&&q.some(U.multidimensionalInfo.variables,function(Z){q.some(Z.dimensions,function(L){L.name!==this.dimension||L.hasRanges||(this._allRangeValues=!1)},this)},this)},this);this.useRanges?(this._thumbCount=2,this._snap=!1):this._allRangeValues&&
this.useLayersDimSlices?(this._thumbCount=2,this._snap=!0):this._snap=!1;q.forEach(this._layers,function(U){U.multidimensionalInfo&&q.some(U.multidimensionalInfo.variables,function(Z){q.some(Z.dimensions,function(L){L.name===this.dimension&&(this._allRangeValues&&L.hasRanges||this.useRanges?this._dimensionObjects.push(K(p.clone(L))):this._dimensionObjects.push(p.clone(L)))},this)},this)},this)},_merge:function(K,R){for(var da=[],U=0,Z=0;U<K.length&&Z<R.length;)K[U]<R[Z]?da.push(K[U++]):K[U]>R[Z]?
da.push(R[Z++]):(da.push(R[Z++]),U++);da=da.concat(K.slice(U)).concat(R.slice(Z));return da=q.filter(da,function(L,T,Y){return Y.indexOf(L)===T})},_mergeRangeArrays:function(K,R){for(var da=[],U=0,Z=0;U<K.length&&Z<R.length;)K[U][0]<R[Z][0]||K[U][0]===R[Z][0]&&K[U][1]<R[Z][1]?da.push(K[U++]):K[U][0]>R[Z][0]||K[U][0]===R[Z][0]&&K[U][1]>R[Z][1]?da.push(R[Z++]):(da.push(R[Z++]),U++);da=da.concat(K.slice(U)).concat(R.slice(Z));return da=q.filter(da,function(L,T,Y){return Y.indexOf(L)===T},this)},_sortDimensionValues:function(){var K=
0,R=this._merge,da=this._mergeRangeArrays;this._getDimensionObjects();1<=this._dimensionObjects.length&&(this._mapSortedDimensionValues=this._dimensionObjects[0].decodedValues||this._dimensionObjects[0].values,this._allRangeValues&&(this._dimensionRangeValues=this._dimensionObjects[0].values));if(1<this._dimensionObjects.length)for(K=1;K<this._dimensionObjects.length;K++)this._mapSortedDimensionValues=R(this._mapSortedDimensionValues,this._dimensionObjects[K].decodedValues||this._dimensionObjects[K].values),
this._allRangeValues&&(this._dimensionRangeValues=da(this._dimensionRangeValues,this._dimensionObjects[K].values))},_createDimensionalDefinition:function(K,R){var da=[K];return new z({variableName:R,dimensionName:this.dimension,values:da,isSlice:1===da.length})},_updateMosaicRule:function(K,R){var da=!1,U=K.mosaicRule||K.defaultMosaicRule||new v({multidimensionalDefinition:[]}),Z="esri.layers.WCSLayer"===K.declaredClass,L="esri.layers.RasterXLayer"===K.declaredClass,T=(Z?K.multidimensionalDefinition:
U.multidimensionalDefinition)||[];R.length&&R.sort(this._sortCompareFunction);q.forEach(T,function(Q){Q.dimensionName===this.dimension&&(Q.values=[R],Q.isSlice=!this.useRanges,da=!0)},this);if(!da){var Y="",ca=q.filter(K.multidimensionalInfo.variables,function(Q){return q.some(T,function(X){return X.variableName&&X.variableName.toLowerCase()===Q.name.toLowerCase()},this)},this);0===ca.length&&(ca=K.multidimensionalInfo.variables);q.some(ca,function(Q){if(q.some(Q.dimensions,function(X){if(X.name===
this.dimension){if(Z||L)Y=Q.name;return!0}},this))return!0},this)&&(T.push(this._createDimensionalDefinition(R,Y)),da=!0)}da&&(Z&&K.setMultidimensionalDefinition(T),L?K.setMultiDimensionalDefinition(U):(U.multidimensionalDefinition=T,K.setMosaicRule(U)))},_prefetchData:function(K,R){if(R&&(R.mosaicRule||R.multidimensionalDefinition)){var da,U,Z=!1,L,T=this,Y;this.prefetchedValues[R.id]||(this.prefetchedValues[R.id]=[]);this.prefetchImgNodes[R.id]=[];var ca=p.clone(R._params);var Q=(U=p.clone(R.mosaicRule))&&
U.multidimensionalDefinition||p.clone(R.multidimensionalDefinition);for(da=1;da<=this.prefetchFactor;da++)Z=!1,q.forEach(Q,function(X){X.dimensionName===this.dimension&&(this.playDirectionAscending?K.length?(this.snap?(L=this._getNextRangeIndex(K)||K,X.values=[this.dimensionValues[L[0]],this.dimensionValues[L[1]]]):X.values=[this.dimensionValues[(K[0]+da)%this.dimensionValues.length],this.dimensionValues[(K[1]+da)%this.dimensionValues.length]],X.values.sort(this._sortCompareFunction)):X.values=[this.dimensionValues[(K+
da)%this.dimensionValues.length]]:K.length?(this.snap?(L=this._getNextRangeIndex(K,-1)||K,X.values=[this.dimensionValues[L[0]],this.dimensionValues[L[1]]]):X.values=[this.dimensionValues[(this.dimensionValues.length+K[0]-da)%this.dimensionValues.length],this.dimensionValues[(this.dimensionValues.length+K[1]-da)%this.dimensionValues.length]],X.values.sort(this._sortCompareFunction)):X.values=[this.dimensionValues[(this.dimensionValues.length+K-da)%this.dimensionValues.length]],q.some(this.prefetchedValues[R.id],
function(ha){if(m.stringify(ha)===m.stringify(X.values))return!0})||(Z=!0,this.prefetchedValues[R.id].push(X.values)))},this),Z&&"esri.layers.WCSLayer"!==R.declaredClass&&(ca.mosaicRule=m.stringify(U.toJson()),R.getImageUrl(this.map.extent,this.map.width,this.map.height,function(X){Y=new Image;T.prefetchImgNodes[R.id].push(Y);Y.src=X},ca))}},setDimensionInfoText:function(K){if(A.isDefined(K)){var R=this.unitSymbol||this.unit;if("number"!==typeof K){K=p.clone(K.sort(this._sortCompareFunction));if(0!==
K[0]%1||0!==K[1]%1)K[0]=parseFloat(K[0].toFixed(2)),K[1]=parseFloat(K[1].toFixed(2));K="["+K[0]+", "+K[1]+"]"}else 0!==K%1&&(K=K.toFixed(2));this.dimensionInfo.innerHTML=this.unitSymbol?"\x3clabel style\x3d'font-weight:700;'\x3e"+this.dimensionAlias+" ("+R+")\x3c/label\x3e":"\x3clabel style\x3d'font-weight:700;'\x3e"+this.dimensionAlias+"\x3c/label\x3e";this.dimensionInfo.innerHTML=this.layout===O.LAYOUT_HORIZONTAL?this.dimensionInfo.innerHTML+(": "+K):this.dimensionInfo.innerHTML+("\x3cbr/\x3e "+
K)}},setLabels:function(K){},_filterLabels:function(){if(this.nLabels&&this.dimensionValues&&this.dimensionValues.length){var K=Math.ceil(this.dimensionValues.length/this.nLabels);return q.map(this.dimensionValues,function(R,da){return 0===da%K||da===this.dimensionValues.length-1?(0!==R%1&&(R=parseFloat(R.toFixed(2))),R):""},this)}},_filterLayers:function(){return q.filter(this._layers,function(K){if(K.multidimensionalInfo&&K.visible&&K.useMapDimensionValue&&q.some(K.multidimensionalInfo.variables,
function(R){if(q.some(R.dimensions,function(da){if(da.name===this.dimension)return!0},this))return!0},this))return!0},this)},_updateUI:function(){F.remove(this.playPauseBtn.iconNode,this._iconClass);this._iconClass=this.playing?"mdsButton mdsPauseButton":"mdsButton mdsPlayButton";F.add(this.playPauseBtn.iconNode,this._iconClass)},_bumpSlider:function(K){var R=this._slider.value;if(0<=K)!this._snap&&(0>R||R>=this.dimensionValues.length-1||R[0]>=this.dimensionValues.length-1||R[1]>=this.dimensionValues.length-
1)?this._timer.isRunning&&(this.loop?(this._timer.stop(),this.prefetchedValues={},this.prefetchImgNodes={},2===this._thumbCount?this._snap?this._slider.set("value",this._getNextRangeIndex(R)):this._slider.set("value",[0,Math.abs(R[0]-R[1])]):this._slider.set("value",0),this._timer.start(),this.playing=!0):this.pause()):2===this._thumbCount&&!this._snap&&R[0]<this.dimensionValues.length-1&&R[1]<this.dimensionValues.length-1?this._slider.set("value",[R[0]+1,R[1]+1]):1===this._thumbCount&&R<this.dimensionValues.length-
1?this._slider.set("value",R+1):this._snap&&this._slider.set("value",this._getNextRangeIndex(R));else if(0>=R||0>=R[0]||0>=R[1])this._timer.isRunning&&(this.loop?(this._timer.stop(),this.prefetchedValues={},2===this._thumbCount?this._snap?this._slider.set("value",this._getNextRangeIndex(R,-1)):this._slider.set("value",[this.dimensionValues.length-1,this.dimensionValues.length-1-Math.abs(R[0]-R[1])]):this._slider.set("value",this.dimensionValues.length-1),this._timer.start(),this.playing=!0):this.pause());
else if(0<=R||0<=R[1])2===this._thumbCount&&0<R[1]&&0<R[0]?this._snap?this._slider.set("value",this._getNextRangeIndex(R,-1)):this._slider.set("value",[R[0]-1,R[1]-1]):1===this._thumbCount&&0<R&&this._slider.set("value",R-1)},setThumbMovingRate:function(K){this.thumbMovingRate=K;this._timer&&this._timer.setInterval(this.thumbMovingRate)},getFullDimensionRange:function(K){K=K||this.dimension;var R,da;q.forEach(this._layers,function(U){U.multidimensionalInfo&&U.multidimensionalInfo.variables&&q.forEach(U.multidimensionalInfo.variables,
function(Z){q.forEach(Z.dimensions,function(L){if(L.name===K&&L.extent&&L.extent.length&&1<L.extent.length){if(!A.isDefined(R)||L.extent[0]<R)R=L.extent[0];if(!A.isDefined(da)||L.extent[1]>da)da=L.extent[1]}},this)},this)},this);return[R,da]},setThumbCount:function(K){this._thumbCount=2==K?2:1;this.value=this.dimensionValues[this._slider.value];this._setupSlider()},clearDimensionalDefinition:function(K){var R=[];if(K&&K.mosaicRule&&K.mosaicRule.multidimensionalDefinition){var da=K.mosaicRule;var U=
da.multidimensionalDefinition;q.forEach(U,function(Z){Z.dimensionName!==this.dimension&&R.push(Z)},this);da.multidimensionalDefinition=R;K.setMosaicRule(da)}},getUnit:function(){var K=null,R=!1;this.unit=null;q.forEach(this._layers,function(da){da.multidimensionalInfo&&q.forEach(da.multidimensionalInfo.variables,function(U){q.forEach(U.dimensions,function(Z){Z.name===this.dimension&&Z.unit&&(null!=K||R?A.isDefined(Z.unit)&&Z.unit.replace("esri","").toLowerCase()!==K.toLowerCase()&&(K=null,R=!0):K=
Z.unit.replace("esri",""))},this)},this)},this);K&&(K=K.replace("esri",""));this.unit=K;this.unitSymbol=this.getUnitSymbol();this._hasUnitConflict=R;return K},_getDimensionAlias:function(){this.dimensionAlias=this.dimension;q.some(this._layers,function(K){if(K.fields&&K.fields.length&&q.some(K.fields,function(R){if(R.name&&R.name===this.dimension&&R.alias)return this.dimensionAlias=R.alias,!0},this))return!0},this)},_readMosaicRule:function(){var K;q.forEach(this._layers,function(R){(R=R.mosaicRule&&
R.mosaicRule.multidimensionalDefinition||R.multidimensionalDefinition)&&q.forEach(R,function(da){da&&da.dimensionName===this.dimension&&da.values&&(K=da.values.length&&da.values[0]&&da.values[0].length?da.values[0]:da.values)},this)},this);this.useRanges=A.isDefined(this.useRanges)?this.useRanges:K&&1!==K.length?!0:!1;K&&(this.useRanges?(this._thumbCount=2,this.value=1===K.length?[K[0],this.dimensionValues[this.dimensionValues.length-1]]:K):1<K.length&&this._snap?(this._thumbCount=2,this.value=K):
(this._thumbCount=1,this.useRanges=!1,this.value=K[0]))},hasUnitConflict:function(){this.getUnit();return this._hasUnitConflict},resizeSlider:function(K,R){I.set(this.domNode,{height:K+"px",width:R+"px"});I.set(this.mdSliderTable,{height:K+"px",width:R+"px"});this.computeSliderStyle()},computeSliderStyle:function(){var K=M.getContentBox(this.domNode).h-M.getContentBox(this.dimensionInfo).h-(M.getContentBox(this.playPauseBtnRow).h+20);10>=x("ie")&&(K-=53);var R="height: "+K+"px;";this._slider&&this._slider.domNode&&
I.set(this._slider.domNode,"height",K+"px");return R},getUnitSymbol:function(){if(!A.isDefined(this.unit))return null;var K=this.unit.toLowerCase();if("meters"===K||"meter"===K)return this.unitSymbols.meter;if("pascal"===K||"pascals"===K)return this.unitSymbols.pascal},_snapToNearestRange:function(K){if(K&&K.length&&this._snap){var R,da,U,Z=this;var L=[this.dimensionValues[K[1]],this.dimensionValues[K[0]]];L.sort(this._sortCompareFunction);if(q.some(this._dimensionObjects,function(X){if(q.some(X.values,
function(ha){if(ha&&ha.length&&ha[0]===L[0]&&ha[1]===L[1])return!0}))return!0},this))return K;if(q.some(this._dimensionObjects,function(X){if(q.some(X.values,function(ha){if(ha&&ha.length&&ha[0]===L[0])return R=p.clone(ha.sort(this._sortCompareFunction)),!0},this))return!0},this)){q.some(this.dimensionValues,function(X,ha){X===R[0]&&(da=ha);X===R[1]&&(U=ha)});var T=Math.abs(K[0]-da);var Y=[da,U]}if(q.some(this._dimensionObjects,function(X){if(q.some(X.values,function(ha){if(ha&&ha.length&&ha[1]===
L[1])return R=p.clone(ha.sort(this._sortCompareFunction)),!0},this))return!0},this)){q.some(this.dimensionValues,function(X,ha){X===R[1]&&(U=ha);X===R[0]&&(da=ha)});var ca=Math.abs(K[1]-U);var Q=[da,U]}K=T&&ca?this._oldValue&&this._oldValue.length&&this._arraysEqual(this._oldValue,Y)?Q:this._oldValue&&this._oldValue.length&&this._arraysEqual(this._oldValue,Q)?Y:T<=ca?Y:Q:Y||Q||K;this._update=!1;setTimeout(function(){Z._slider.set("value",K)},100);return K}},_arraysEqual:function(K,R){var da;if(!A.isDefined(K)||
!A.isDefined(R))return!1;if(K===R)return!0;if(K.length!==R.length)return!1;K.sort(this._sortCompareFunction);R.sort(this._sortCompareFunction);for(da=0;da<K.length;++da)if(K[da]!==R[da])return!1;return!0},_getNextRangeIndex:function(K,R){if(!this._dimensionRangeValues||!this._dimensionRangeValues.length)return null;var da,U,Z;R=A.isDefined(R)?R:1;q.some(this._dimensionRangeValues,function(T,Y){if(this._arraysEqual(T,[this.dimensionValues[K[0]],this.dimensionValues[K[1]]]))return da=Y,!0},this);var L=
this._dimensionRangeValues[0<R?(da+1)%this._dimensionRangeValues.length:(this._dimensionRangeValues.length+da-1)%this._dimensionRangeValues.length];q.some(this.dimensionValues,function(T,Y){T===L[0]&&(U=Y);T===L[1]&&(Z=Y);if(U&&Z)return!0},this);return[U,Z]}});p.mixin(e,O);p.setObject("dijit.MultidimensionalSlider",e,B);return e})},"esri/dijit/BasemapGallery":function(){define("require dojo/_base/declare dojo/_base/array dojo/_base/connect dojo/_base/lang dojo/_base/kernel dojo/_base/sniff dojo/has dojo/query dojo/Deferred dojo/DeferredList dojo/dom dojo/dom-construct dojo/dom-class dijit/_Widget dijit/_Templated ../kernel ../lang ../urlUtils ../request ../geometry/Extent ../SpatialReference ../virtualearth/VETiledLayer ../layers/OpenStreetMapLayer ../layers/ArcGISTiledMapServiceLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/WebTiledLayer ../layers/VectorTileLayer ../layers/TileInfo ../layers/ArcGISImageServiceLayer ../layers/ImageServiceParameters ../layers/ImageParameters ../layers/RasterFunction ../layers/RasterXLayer ./Basemap ./_EventedWidget dojo/text!./templates/BasemapGallery.html".split(" "),
function(t,p,x,b,m,f,d,a,c,l,h,n,g,e,k,w,q,u,r,v,z,B,A,y,D,G,E,F,I,M,P,W,H,O,K,R,da){p=p([R,k,w],{declaredClass:"esri.dijit.BasemapGallery",widgetsInTemplate:!0,templateString:da,loaded:!1,basemaps:[],bingMapsKey:null,flowContainer:null,_hasUI:!1,_supportsVTL:null,_selectedBasemap:null,_selectBasemapInProgress:!1,_eventMap:{load:!0,"selection-change":!0,add:["basemap"],remove:["basemap"],error:["message"]},constructor:function(U,Z){U=U||{};this.map=U.map;this._hasUI=Z?!0:!1;this.bingMapsKey=U.bingMapsKey&&
0<U.bingMapsKey.length?U.bingMapsKey:null;this.showArcGISBasemaps=!1!==U.showArcGISBasemaps;this.basemaps=U.basemaps||[];this.basemapIds=U.basemapIds;this.referenceIds=U.referenceIds;this.basemapsGroup=U.basemapsGroup;this.arcgisUrl=q.dijit._arcgisUrl;U.portalUrl&&(this.arcgisUrl=U.portalUrl+"/sharing/rest");0>this.arcgisUrl.indexOf("://")?this.arcgisUrl=r.getProtocolForWebResource()+"//"+this.arcgisUrl:"https:"===window.location.protocol&&(this.arcgisUrl=this.arcgisUrl.replace("http:","https:"));
this.init()},init:function(){this.inherited(arguments);this._checkVTLSupport().then(m.hitch(this,function(U){this._supportsVTL=U}));x.forEach(this.basemaps,function(U){U.id&&0!==U.id.length||(U.id=this._getUniqueId());x.forEach(U.layers,function(Z){Z.opacity=0<=Z.opacity?Z.opacity:1;Z.visibility=!0},this)},this);this.basemapIds&&0<this.basemapIds.length&&x.forEach(this.basemapIds,function(U){this.map.getLayer(U)._basemapGalleryLayerType="basemap"},this);this.referenceIds&&0<this.referenceIds.length&&
x.forEach(this.referenceIds,function(U){U=this.map.getLayer(U);U._basemapGalleryLayerType="reference";U.attr("data-reference",!0)},this);this.basemapsGroup&&(this.basemapsGroup.owner&&this.basemapsGroup.title||this.basemapsGroup.id)?this._findCustomBasemapsGroup(m.hitch(this,"_handleArcGISBasemapsResponse")):this.showArcGISBasemaps?this._findArcGISBasemapsGroup(m.hitch(this,"_handleArcGISBasemapsResponse")):this._finishStartup()},startup:function(){this.loaded?this._refreshUI():b.connect(this,"onLoad",
m.hitch(this,function(){this._refreshUI()}))},select:function(U){this._select(U)},getSelected:function(){return this._selectedBasemap},get:function(U){var Z;for(Z=0;Z<this.basemaps.length;Z++)if(this.basemaps[Z].id===U)return this.basemaps[Z];return null},add:function(U){return U&&!U.id?(U.id=this._getUniqueId(),this.basemaps.push(U),this._refreshUI(),this.onAdd(U),!0):U&&this._isUniqueId(U.id)?(this.basemaps.push(U),this._refreshUI(),this.onAdd(U),!0):!1},remove:function(U){var Z;for(Z=0;Z<this.basemaps.length;Z++){var L=
this.basemaps[Z];if(L.id===U)return this._selectedBasemap&&this._selectedBasemap.id===L.id&&(this._selectedBasemap=null),this.basemaps.splice(Z,1),this._refreshUI(),this.onRemove(L),L}return null},onLoad:function(){},onSelectionChange:function(){},onAdd:function(U){},onRemove:function(U){},onError:function(U){},_defaultBasemapGalleryGroupQuery:'title:"ArcGIS Online Basemaps" AND owner:esri',_basemapGalleryGroupQuery:null,_finishStartup:function(){this.loaded=!0;this.onLoad();0===this.map.layerIds.length&&
0<this.basemaps.length&&!this._selectBasemapInProgress&&this._select(this.basemaps[0].id)},_findCustomBasemapsGroup:function(U){this.basemapsGroup&&this.basemapsGroup.id?this._findArcGISBasemaps(this.basemapsGroup.id,U):(this._basemapGalleryGroupQuery='title:"'+this.basemapsGroup.title+'" AND owner:'+this.basemapsGroup.owner,this._findArcGISBasemapsGroup(U))},_findArcGISBasemapsGroup:function(U){if(this._basemapGalleryGroupQuery)this._findArcGISBasemapsGroupContent(U);else{var Z=this.arcgisUrl+"/portals/self",
L={f:"json"};L.culture=f.locale;v({url:Z,content:L,callbackParamName:"callback",load:m.hitch(this,function(T,Y){T&&T.useVectorBasemaps&&T.vectorBasemapGalleryGroupQuery?this._checkVTLSupport().then(m.hitch(this,function(ca){this._basemapGalleryGroupQuery=ca?T.vectorBasemapGalleryGroupQuery:T&&T.basemapGalleryGroupQuery?T.basemapGalleryGroupQuery:this._defaultBasemapGalleryGroupQuery;this._findArcGISBasemapsGroupContent(U)})):(this._basemapGalleryGroupQuery=T&&T.basemapGalleryGroupQuery?T.basemapGalleryGroupQuery:
this._defaultBasemapGalleryGroupQuery,this._findArcGISBasemapsGroupContent(U))}),error:m.hitch(this,function(T,Y){this._basemapGalleryGroupQuery=this._defaultBasemapGalleryGroupQuery})})}},_findArcGISBasemapsGroupContent:function(U){var Z=m.hitch(this,"_findArcGISBasemaps"),L=this.arcgisUrl+"/community/groups",T={};T.q=this._basemapGalleryGroupQuery;T.f="json";v({url:L,content:T,callbackParamName:"callback",load:m.hitch(this,function(Y,ca){if(0<Y.results.length)Z(Y.results[0].id,U,Y.results[0].sortField,
Y.results[0].sortOrder);else this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")}),error:m.hitch(this,function(Y){this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")})})},_findArcGISBasemaps:function(U,Z,L,T){var Y=m.hitch(this,function(ca,Q,X,ha){var ja=this.arcgisUrl+"/search",aa={};aa.q="group:"+ca+' AND type:"web map" NOT type:"web mapping application"';aa.sortField=X;aa.sortOrder="asc"===ha?"desc":"asc";aa.num=100;aa.f="json";v({url:ja,content:aa,
callbackParamName:"callback",load:m.hitch(this,function(la,oa){if(0<la.results.length)Q(la.results);else this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")}),error:m.hitch(this,function(la,oa){this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")})})});L&&T?Y(U,Z,L,T):v({url:this.arcgisUrl+"/community/groups/"+U,content:{f:"json"},callbackParamName:"callback",load:m.hitch(this,function(ca,Q){ca.sortField?Y(U,Z,ca.sortField,ca.sortOrder):Y(U,Z,"name",
"desc")}),error:m.hitch(this,function(ca,Q){Y(U,Z,"name","desc")})})},_handleArcGISBasemapsResponse:function(U){0<U.length&&(x.forEach(U,function(Z,L){if(this.bingMapsKey||!this.bingMapsKey&&Z.title&&-1===Z.title.indexOf("Bing Maps")){var T={};T.id=this._getUniqueId();T.title=Z.title;T.thumbnailUrl="";if(Z.thumbnail&&Z.thumbnail.length&&(T.thumbnailUrl=this.arcgisUrl+"/content/items/"+Z.id+"/info/"+Z.thumbnail,q.id)){var Y=q.id.findCredential(r.urlToObject(this.arcgisUrl).path);Y&&(T.thumbnailUrl+=
"?token\x3d"+Y.token)}T.itemId=Z.id;T=new K(T,this);this.basemaps.splice(0,0,T)}},this),this._finishStartup())},_refreshUI:function(){this._hasUI&&(g.empty(this.flowContainer),x.forEach(this.basemaps,function(U,Z){U.id||(U.id="basemap_"+Z);this.flowContainer.appendChild(this._buildNodeLayout(U))},this),g.create("br",{style:{clear:"both"}},this.flowContainer),this._markSelected(this._selectedBasemap))},_buildNodeLayout:function(U){var Z=g.create("div",{id:"galleryNode_"+U.id,"class":"esriBasemapGalleryNode"}),
L=g.create("a",{href:"javascript:void(0);"},Z);b.connect(L,"onclick",m.hitch(this,"_onNodeClick",U));var T=U.title||"";U.thumbnailUrl?g.create("img",{"class":"esriBasemapGalleryThumbnail",src:U.thumbnailUrl,title:T,alt:T},L):g.create("img",{"class":"esriBasemapGalleryThumbnail",src:t.toUrl("./images/transparent.gif"),title:T,alt:T},L);U=g.create("div",{"class":"esriBasemapGalleryLabelContainer"},Z);g.create("span",{innerHTML:T,alt:T,title:T},U);return Z},_onNodeClick:function(U,Z){Z.preventDefault();
this._markSelected(U);this.select(U.id)},_markSelected:function(U){U&&(x.forEach(f.query(".esriBasemapGallerySelectedNode",this.domNode),function(Z){e.remove(Z,"esriBasemapGallerySelectedNode")}),(U=n.byId("galleryNode_"+U.id))&&e.add(U,"esriBasemapGallerySelectedNode"))},_select:function(U){this._selectBasemapInProgress=!0;var Z=this.get(U);Z?(Z.layers?this._getServiceInfos(Z):(U=Z.getLayers(this.arcgisUrl),m.isArray(U)?this._getServiceInfos(Z):U.addCallback(m.hitch(this,function(L){this._getServiceInfos(Z)}))),
this._markSelected(Z)):this._selectBasemapInProgress=!1},_getServiceInfos:function(U){"https:"===location.protocol&&x.forEach(U.layers,function(L){if(this._isAgolService(L.url)||this._isHostedService(L.url))L.url=L.url.replace("http:","https:")},this);this._selectedBasemap=U;var Z=[];x.forEach(U.layers,function(L){L.url&&0<L.url.length&&!L.isReference&&!L.type&&(L.deferredsPos=Z.length,Z.push(this._getServiceInfo(L.url)))},this);0<Z.length?(new h(Z)).addCallback(m.hitch(this,function(L){var T=null;
x.forEach(U.layers,function(Y){if(0===Y.deferredsPos||Y.deferredsPos){Y.serviceInfoResponse=L[Y.deferredsPos][1];var ca=Y.serviceInfoResponse.fullExtent;ca||(ca=Y.serviceInfoResponse.extent);T=T?T.union(new z(ca)):new z(ca)}},this);this.map.extent&&5>this._getIntersectionPercent(T,this.map.extent)&&this.map.setExtent(T,!0);this._switchBasemapLayers(U);this._updateReferenceLayer(U)})):(this._switchBasemapLayers(U),this._updateReferenceLayer(U))},_checkVTLSupport:function(){var U=new l;d("ie")?U.resolve(!1):
U.resolve(F.supported());return U},_switchBasemapLayers:function(U){var Z=U.layers,L=!1,T,Y,ca;x.forEach(Z,function(X){"VectorTileLayer"===X.type&&(L=!0)});if(L&&!0!==this._supportsVTL)this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because layer type is not supported by your current browser version.");else if(0<this.map.layerIds.length&&0===this.map.getNumLevels()&&("OpenStreetMap"===Z[0].type||Z[0].type&&-1<Z[0].type.indexOf("BingMaps")||"WebTiledLayer"===Z[0].type||"VectorTileLayer"===
Z[0].type))this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");else{x.forEach(Z,function(X){if(!X.isReference&&X.type&&-1<X.type.indexOf("BingMaps")&&!this.bingMapsKey)this.onError("esri.dijit.BasemapGallery: Invalid Bing Maps key.")},this);var Q=0;x.forEach(Z,function(X,ha){if(!X.isReference){if("OpenStreetMap"===X.type){if(0<this.map.layerIds.length&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");
return}var ja=new y({id:"layer_osm",opacity:X.opacity})}else if(X.type&&-1<X.type.indexOf("BingMaps")){if(0<this.map.layerIds.length&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}ja=A.MAP_STYLE_AERIAL_WITH_LABELS;"BingMapsAerial"===X.type?ja=A.MAP_STYLE_AERIAL:"BingMapsRoad"===X.type&&(ja=A.MAP_STYLE_ROAD);ja=new A({id:"layer_bing",bingMapsKey:this.bingMapsKey,
mapStyle:ja,opacity:X.opacity})}else if("WebTiledLayer"===X.type){if(0<this.map.layerIds.length&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}ja=X.initialExtent||X.fullExtent;ja=new E(X.templateUrl||X.url,{visible:X.visibility,opacity:X.opacity,copyright:X.copyright,fullExtent:X.fullExtent&&new z(X.fullExtent),initialExtent:ja&&new z(ja),subDomains:X.subDomains,
tileInfo:X.tileInfo?new I(X.tileInfo):null,tileServers:X.tileServers})}else if("VectorTileLayer"===X.type){ja=new F(X.styleUrl,{visible:X.visibility,opacity:X.opacity});0===ha&&1<Z.length&&this._removeBasemapLayers();var aa=this;b.connect(ja,"onLoad",m.hitch(this,function(la,oa,wa){var za=aa._sameSpatialReference(wa.spatialReference,aa.map.spatialReference);if(aa.map.spatialReference&&!za)aa.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different spatial reference.");
else{if(0<aa.map.getNumLevels()){if(za=aa._sameTilingScheme(wa.tileInfo,aa.map.__tileInfo),!za){aa.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different tiling scheme.");return}}else if(aa.map.loaded){aa.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a vector tile layer and cannot be loaded as a dynamic layer.");return}0===oa&&1===Z.length&&aa._removeBasemapLayers();wa._basemapGalleryLayerType="basemap";aa.map.addLayer(wa,
la)}},Q,ha))}else if(X.serviceInfoResponse&&X.serviceInfoResponse.mapName){T=new B(X.serviceInfoResponse.spatialReference);Y=this._sameSpatialReference(T,this.map.spatialReference);if(this.map.spatialReference&&!Y){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different spatial reference.");return}if(!0===X.serviceInfoResponse.singleFusedMapCache&&0<this.map.getNumLevels()){if(ca=this._sameTilingScheme(X.serviceInfoResponse.tileInfo,this.map.__tileInfo),
!ca){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different tiling scheme.");return}}else if(!0===X.serviceInfoResponse.singleFusedMapCache&&-1<X.serviceInfoResponse.capabilities.toLowerCase().indexOf("tilesonly")&&this.map.loaded&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}ja=(0===this.map.layerIds.length||0<this.map.getNumLevels())&&
!0===X.serviceInfoResponse.singleFusedMapCache?this._loadAsCached(X):this._loadAsDynamic(X)}else if(X.serviceInfoResponse&&X.serviceInfoResponse.pixelSizeX){T=new B(X.serviceInfoResponse.spatialReference);Y=this._sameSpatialReference(T,this.map.spatialReference);if(this.map.spatialReference&&!Y){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different spatial reference.");return}if(!0===X.serviceInfoResponse.singleFusedMapCache&&0<this.map.getNumLevels()&&
(ca=this._sameTilingScheme(X.serviceInfoResponse.tileInfo,this.map.__tileInfo),!ca)){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different tiling scheme.");return}X.serviceInfoResponse.singleFusedMapCache&&"ArcGISImageServiceLayer"!==X.type?ja="Raster"===X.serviceInfoResponse.cacheType?new O(X.url,{serviceInfo:X.serviceInfoResponse,opacity:X.opacity,visible:X.visibility,bandIds:X.bandIds&&0<X.bandIds.length?X.bandIds:null}):new D(X.url,{resourceInfo:X.serviceInfoResponse,
opacity:X.opacity,visible:X.visibility}):X.serviceInfoResponse.pixelSizeX?(ja=new P,ja.bandIds=X.bandIds,X.renderingRule?ja.renderingRule=new H(X.renderingRule):!X.bandIds&&X.serviceInfoResponse.bandCount&&3<parseInt(X.serviceInfoResponse.bandCount,10)&&(ja.bandIds=[0,1,2]),ja=new M(X.url,{resourceInfo:X.serviceInfoResponse,opacity:X.opacity,visible:X.visibility,imageServiceParameters:ja})):(ja=new W,ja.format="png24",X.serviceInfoResponse.supportedImageFormatTypes&&-1<X.serviceInfoResponse.supportedImageFormatTypes.indexOf("PNG32")&&
(ja.format="png32"),ja=new G(X.url,{resourceInfo:X.serviceInfoResponse,opacity:X.opacity,visible:X.visibility,imageParameters:ja}))}"VectorTileLayer"===X.type?Q++:ja&&(0===ha&&this._removeBasemapLayers(),ja._basemapGalleryLayerType="basemap",this.map.addLayer(ja,Q),Q++)}},this);this._selectBasemapInProgress=!1;this.onSelectionChange()}},_removeBasemapLayers:function(){var U=this.map.layerIds,Z=[];x.forEach(U,function(L){L=this.map.getLayer(L);"basemap"===L._basemapGalleryLayerType&&Z.push(L)},this);
0===Z.length&&0<U.length&&Z.push(this.map.getLayer(U[0]));0<Z.length&&x.forEach(Z,function(L){this.map.removeLayer(L)},this)},_updateReferenceLayer:function(U){var Z;this._removeReferenceLayer();for(Z=0;Z<U.layers.length;Z++)!0===U.layers[Z].isReference&&this._addReferenceLayer(U.layers[Z])},_removeReferenceLayer:function(){var U;for(U=this.map.layerIds.length-1;0<=U;U--){var Z=this.map.getLayer(this.map.layerIds[U]);"reference"===Z._basemapGalleryLayerType&&this.map.removeLayer(Z)}},_addReferenceLayer:function(U){"VectorTileLayer"===
U.type?this._handleReferenceServiceInfoResponse(U):this._getServiceInfo(U.url,m.hitch(this,"_handleReferenceServiceInfoResponse",U))},_handleReferenceServiceInfoResponse:function(U,Z,L){U.serviceInfoResponse=Z;if("VectorTileLayer"===U.type)var T=new F(U.styleUrl,{visible:U.visibility,opacity:U.opacity});else Z&&Z.mapName?T=!0===Z.singleFusedMapCache?this._loadAsCached(U):this._loadAsDynamic(U):Z&&Z.pixelSizeX&&(U.serviceInfoResponse.singleFusedMapCache?T=new D(U.url,{resourceInfo:U.serviceInfoResponse,
opacity:U.opacity,visible:U.visibility}):U.serviceInfoResponse.pixelSizeX?(L=new P,L.bandIds=U.bandIds,U.renderingRule?L.renderingRule=new H(U.renderingRule):!U.bandIds&&Z.bandCount&&3<parseInt(Z.bandCount,10)&&(L.bandIds=[0,1,2]),T=new M(U.url,{resourceInfo:Z,opacity:U.opacity,visible:U.visibility,imageServiceParameters:L})):(Z=new W,Z.format="png24",U.serviceInfoResponse.supportedImageFormatTypes&&-1<U.serviceInfoResponse.supportedImageFormatTypes.indexOf("PNG32")&&(Z.format="png32"),Z.transparent=
!0,T=new G(U.url,{resourceInfo:U.serviceInfoResponse,opacity:U.opacity,visible:U.visibility,imageParameters:Z})));T&&(T._basemapGalleryLayerType="reference",T.attr("data-reference",!0),this.map.addLayer(T))},_getServiceInfo:function(U,Z){return v({url:U,content:{f:"json"},callbackParamName:"callback",load:function(L,T){Z&&Z(L,T)},error:m.hitch(this,function(L,T){this.onError("esri.dijit.BasemapGallery: service not accessible.")})})},_loadAsCached:function(U){var Z=[];U.displayLevels||(Z=x.map(U.serviceInfoResponse.tileInfo.lods,
function(T){return T.level}));var L=null;U.exclusionAreas&&U.exclusionAreas.length&&(L=[],x.forEach(U.exclusionAreas,function(T){L.push({minZoom:T.minZoom,maxZoom:T.maxZoom,minScale:T.minScale,maxScale:T.maxScale,geometry:new z(T.geometry)})}));return new D(U.url,{resourceInfo:U.serviceInfoResponse,opacity:U.opacity,visible:U.visibility,exclusionAreas:L,displayLevels:U.displayLevels||Z})},_loadAsDynamic:function(U){var Z=new G(U.url,{resourceInfo:U.serviceInfoResponse,opacity:U.opacity,visible:U.visibility});
U.visibleLayers&&Z.setVisibleLayers(U.visibleLayers);return Z},_getIntersectionPercent:function(U,Z){var L=Z.intersects(U);if(L){L=L.getWidth()*L.getHeight();var T=Z.getWidth()*Z.getHeight();return L/T*100}return 0},_getIds:function(){var U=[];x.forEach(this.basemaps,function(Z){U.push(Z.id)},this);return U},_getUniqueId:function(){for(var U=","+this._getIds().toString()+",",Z=0;;)if(-1<U.indexOf(",basemap_"+Z+","))Z++;else return"basemap_"+Z},_isUniqueId:function(U){return-1===(","+this._getIds().toString()+
",").indexOf(","+U+",")?!0:!1},_isAgolService:function(U){return U?-1!==U.indexOf("/services.arcgisonline.com/")||-1!==U.indexOf("/server.arcgisonline.com/"):!1},_isHostedService:function(U){return U?-1!==U.indexOf(".arcgis.com/"):!1},_sameSpatialReference:function(U,Z){return U&&Z&&U.wkt==Z.wkt&&(U.wkid===Z.wkid||u.isDefined(U.latestWkid)&&U.latestWkid===Z.wkid||u.isDefined(Z.latestWkid)&&U.wkid===Z.latestWkid||u.isDefined(U.latestWkid)&&U.latestWkid===Z.latestWkid)||U&&Z&&U.isWebMercator()&&Z.isWebMercator()?
!0:!1},_sameTilingScheme:function(U,Z){var L=this.map;L=L.width>L.height?L.width:L.height;var T=!1,Y=!1,ca,Q;for(ca=0;ca<U.lods.length;ca++){var X=U.lods[ca].scale;U.dpi!==Z.dpi&&(X=U.lods[ca].scale/U.dpi);for(Q=0;Q<Z.lods.length;Q++){var ha=Z.lods[Q].scale;U.dpi!==Z.dpi&&(ha=Z.lods[Q].scale/Z.dpi);if(Math.abs(ha-X)/ha<1/L)if(T){Y=!0;break}else T=!0;if(ha<X)break}if(Y)break}return Y||T&&(1===U.lods.length||1===Z.lods.length)?!0:!1}});m.setObject("dijit.BasemapGallery",p,q);return p})},"esri/layers/WebTiledLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/url dojo/sniff dojo/string ../config ../kernel ../request ../urlUtils ../SpatialReference ../geometry/Extent ./TiledMapServiceLayer ./TileInfo".split(" "),
function(t,p,x,b,m,f,d,a,c,l,h,n,g,e){function k(w,q){var u=[];if(w&&q&&(q.customLayerParameters||q.customParameters)){var r=p.clone(q.customParameters||{});p.mixin(r,q.customLayerParameters||{});var v=l.urlToObject(w);for(var z in v.query)r.hasOwnProperty(z)||u.push(z+"\x3d"+v.query[z]);w=v.path+(u.length?"?"+u.join("\x26"):"")}return w}t=t(g,{declaredClass:"esri.layers.WebTiledLayer",constructor:function(w,q){q||(q={});this.urlTemplate=w=k(w,q.wmtsInfo);var u=new n(-2.0037508342787E7,-2.003750834278E7,
2.003750834278E7,2.0037508342787E7,new h({wkid:102100})),r=new n(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new h({wkid:102100}));this.initialExtent=q.initialExtent||u;this.fullExtent=q.fullExtent||r;this.tileInfo=q.tileInfo?q.tileInfo:new e({dpi:96,rows:256,cols:256,origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:{wkid:102100},lods:[{level:0,resolution:156543.033928,scale:5.91657527591555E8},{level:1,resolution:78271.5169639999,scale:2.95828763795777E8},
{level:2,resolution:39135.7584820001,scale:1.47914381897889E8},{level:3,resolution:19567.8792409999,scale:7.3957190948944E7},{level:4,resolution:9783.93962049996,scale:3.6978595474472E7},{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},{level:10,resolution:152.874056570411,
scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:.597164283559817,scale:2256.994353},{level:19,resolution:.298582141647617,
scale:1128.497176},{level:20,resolution:.14929107082380833,scale:564.248588},{level:21,resolution:.07464553541190416,scale:282.124294},{level:22,resolution:.03732276770595208,scale:141.062147},{level:23,resolution:.01866138385297604,scale:70.5310735}]});this.spatialReference=new h(this.tileInfo.spatialReference.toJson());this.copyright=q.copyright||"";var v=new b(w);u=v.scheme+"://"+v.authority+"/";this.urlPath=w.substring(u.length);this.tileServers=q.tileServers||[];-1===v.authority.indexOf("{subDomain}")&&
this.tileServers.push(u);if(q.subDomains&&0<q.subDomains.length&&1<v.authority.split(".").length){this.subDomains=q.subDomains;var z;x.forEach(q.subDomains,function(D){-1<v.authority.indexOf("${subDomain}")?z=v.scheme+"://"+f.substitute(v.authority,{subDomain:D})+"/":-1<v.authority.indexOf("{subDomain}")&&(z=v.scheme+"://"+v.authority.replace(/\{subDomain\}/gi,D)+"/");this.tileServers.push(z)},this)}this.tileServers=x.map(this.tileServers,function(D){"/"!==D.charAt(D.length-1)&&(D+="/");return D});
this._levelToLevelValue=[];var B=0;x.forEach(this.tileInfo.lods,function(D,G){this._levelToLevelValue[D.level]=D.levelValue||D.level;0===G&&(B=this._levelToLevelValue[D.level])},this);this._wmtsInfo=q.wmtsInfo;var A=p.hitch(this,function(){this.loaded=!0;this.onLoad(this)});if(m("chrome")){u=this.getTileUrl(B,0,0);r=d.defaults.io;var y="with-credentials"===r.useCors?l.canUseXhr(u,!0):-1;(r=-1<y?r.corsEnabledServers[y]:null)&&r.withCredentials?c({url:u,handleAs:"arraybuffer"}).addBoth(function(){A()}):
A()}else A()},getTileUrl:function(w,q,u){w=this._levelToLevelValue[w];var r=this.tileServers[q%this.tileServers.length]+f.substitute(this.urlPath,{level:w,z:w,col:u,x:u,row:q,y:q});r=r.replace(/\{level\}/gi,w).replace(/\{row\}/gi,q).replace(/\{col\}/gi,u).replace(/\{z\}/gi,w).replace(/\{x\}/gi,u).replace(/\{y\}/gi,q);r=this._appendCustomLayerParameters(r);r=this.addTimestampToURL(r);return l.addProxy(r)},_appendCustomLayerParameters:function(w){var q;if(this._wmtsInfo&&(this._wmtsInfo.customLayerParameters||
this._wmtsInfo.customParameters)){var u=p.clone(this._wmtsInfo.customParameters||{});p.mixin(u,this._wmtsInfo.customLayerParameters||{});for(q in u)w+=(-1===w.indexOf("?")?"?":"\x26")+q+"\x3d"+encodeURIComponent(u[q])}return w}});p.setObject("layers.WebTiledLayer",t,a);return t})},"esri/dijit/Basemap":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/has ../kernel ../request ./BasemapLayer".split(" "),function(t,p,x,b,m,f,d){t=t(null,{declaredClass:"esri.dijit.Basemap",id:null,
title:"",thumbnailUrl:null,layers:null,itemId:null,basemapGallery:null,constructor:function(a,c){a=a||{};this.id=a.id;this.itemId=a.itemId;this.layers=a.layers;this.title=a.title||"";this.thumbnailUrl=a.thumbnailUrl;this.basemapGallery=c},getLayers:function(a){if(this.layers)return this.layers;if(this.itemId)return a=f({url:(a||m.dijit._arcgisUrl)+"/content/items/"+this.itemId+"/data",content:{f:"json"},callbackParamName:"callback",error:x.hitch(this,function(c,l){if(this.basemapGallery)this.basemapGallery.onError("esri.dijit.Basemap: could not access basemap item.")})}),
a.addCallback(x.hitch(this,function(c,l){if(c.baseMap)return this.layers=[],p.forEach(c.baseMap.baseMapLayers,function(h){this.layers.push(new d(h))},this),this.layers;if(this.basemapGallery)this.basemapGallery.onError("esri.dijit.Basemap: could not access basemap item.");return[]})),a}});x.setObject("dijit.Basemap",t,m);return t})},"esri/dijit/BasemapLayer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(t,p,x,b){t=t(null,{declaredClass:"esri.dijit.BasemapLayer",
constructor:function(m){m=m||{};this.url=m.url;this.type=m.type;this.isReference=!0===m.isReference?!0:!1;this.opacity=m.opacity;this.visibleLayers=m.visibleLayers;this.displayLevels=m.displayLevels;this.exclusionAreas=m.exclusionAreas;this.bandIds=m.bandIds;this.renderingRule=m.renderingRule;this.templateUrl=m.templateUrl;this.copyright=m.copyright;this.subDomains=m.subDomains;this.fullExtent=m.fullExtent;this.initialExtent=m.initialExtent;this.tileInfo=m.tileInfo;this.tileServers=m.tileServers;
this.styleUrl=m.styleUrl}});p.setObject("dijit.BasemapLayer",t,b);return t})},"esri/dijit/HomeButton":function(){define("dojo/Evented dojo/_base/declare dojo/_base/lang dojo/has ../kernel dijit/_WidgetBase dijit/a11yclick dijit/_TemplatedMixin dojo/on dojo/Deferred dojo/text!./templates/HomeButton.html dojo/i18n!../nls/jsapi dojo/dom-class dojo/dom-style".split(" "),function(t,p,x,b,m,f,d,a,c,l,h,n,g,e){t=p("esri.dijit.HomeButton",[f,a,t],{templateString:h,options:{theme:"HomeButton",map:null,extent:null,
fit:!1,visible:!0},constructor:function(k,w){var q=x.mixin({},this.options,k);this.domNode=w;this._i18n=n;this.set("map",q.map);this.set("theme",q.theme);this.set("visible",q.visible);this.set("extent",q.extent);this.set("fit",q.fit);this.watch("theme",this._updateThemeWatch);this.watch("visible",this._visible);this._css={container:"homeContainer",home:"home",loading:"loading"}},postCreate:function(){this.inherited(arguments);this.own(c(this._homeNode,d,x.hitch(this,this.home)))},startup:function(){this.inherited(arguments);
this.map||this.destroy();if(this.map.loaded)this._init();else c.once(this.map,"load",x.hitch(this,function(){this._init()}))},destroy:function(){this.inherited(arguments)},home:function(){var k=new l,w=this.get("extent");this._showLoading();var q={extent:w};w?this.map.extent!==w?this.map.setExtent(w,this.get("fit")).then(x.hitch(this,function(){this._hideLoading();this.emit("home",q);k.resolve(q)}),x.hitch(this,function(u){u||(u=Error("HomeButton::Error setting map extent"));q.error=u;this.emit("home",
q);k.reject(u)})):(this._hideLoading(),this.emit("home",q),k.resolve(q)):(this._hideLoading(),w=Error("HomeButton::home extent is undefined"),q.error=w,this.emit("home",q),k.reject(w));return k.promise},show:function(){this.set("visible",!0)},hide:function(){this.set("visible",!1)},_init:function(){this._visible();this.get("extent")||this.set("extent",this.map.extent);this.set("loaded",!0);this.emit("load",{})},_showLoading:function(){g.add(this._homeNode,this._css.loading)},_hideLoading:function(){g.remove(this._homeNode,
this._css.loading)},_updateThemeWatch:function(k,w,q){g.remove(this.domNode,w);g.add(this.domNode,q)},_visible:function(){this.get("visible")?e.set(this.domNode,"display","block"):e.set(this.domNode,"display","none")}});x.setObject("dijit.HomeButton",t,m);return t})},"esri/dijit/LocateButton":function(){define("require dojo/Evented dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../config dijit/_WidgetBase dijit/a11yclick dijit/_TemplatedMixin dojo/on dojo/Deferred dojo/text!./templates/LocateButton.html dojo/i18n!../nls/jsapi dojo/dom-class dojo/dom-style dojo/dom-attr ../geometry/webMercatorUtils ../geometry/Point ../SpatialReference ../graphic ../symbols/PictureMarkerSymbol ../tasks/ProjectParameters".split(" "),
function(t,p,x,b,m,f,d,a,c,l,h,n,g,e,k,w,q,u,r,v,z,B,A){t=x("esri.dijit.LocateButton",[a,l,p],{templateString:g,options:{theme:"LocateButton",map:null,visible:!0,highlightLocation:!0,symbol:new B(t.toUrl("./images/sdk_gps_location.png"),28,28),infoTemplate:null,scale:null,useTracking:!1,clearOnTrackingStop:!1,setScale:!0,centerAt:!0,timeout:15E3,graphicsLayer:null,geolocationOptions:{maximumAge:0,timeout:15E3,enableHighAccuracy:!0}},constructor:function(y,D){var G=b.mixin({},this.options,y);this.domNode=
D;this._i18n=e;var E=navigator.geolocation,F=window.hasOwnProperty("isSecureContext");(F&&window.isSecureContext||!F&&"https:"===window.location.protocol)&&E||(G.visible=!1);this.set("map",G.map);this.set("theme",G.theme);this.set("visible",G.visible);this.set("scale",G.scale);this.set("highlightLocation",G.highlightLocation);this.set("symbol",G.symbol);this.set("infoTemplate",G.infoTemplate);this.set("geolocationOptions",G.geolocationOptions);this.set("useTracking",G.useTracking);this.set("setScale",
G.setScale);this.set("centerAt",G.centerAt);this.set("timeout",G.timeout);this.set("graphicsLayer",G.graphicsLayer);this.set("clearOnTrackingStop",G.clearOnTrackingStop);this.watch("theme",this._updateThemeWatch);this.watch("visible",this._visible);this.watch("tracking",this._locate);this.watch("useTracking",b.hitch(this,function(){this.get("tracking")&&!this.get("useTracking")&&this._stopTracking();this._setTitle()}));this._css={container:"locateContainer",locate:"zoomLocateButton",loading:"loading",
tracking:"tracking"}},postCreate:function(){this.inherited(arguments);this.own(h(this._locateNode,c,b.hitch(this,this.locate)))},startup:function(){this.inherited(arguments);this.get("map")||this.set("visible",!1);if(this.get("map").loaded)this._init();else h.once(this.get("map"),"load",b.hitch(this,function(){this._init()}))},destroy:function(){this.clear();this._graphicsEvent&&this._graphicsEvent.remove();this._removeWatchPosition();this.inherited(arguments)},clear:function(){var y=this.get("highlightGraphic"),
D=this.get("graphicsLayer");y&&(D?D.remove(y):this.get("map").graphics.remove(y),this.set("highlightGraphic",null))},locate:function(){this.get("useTracking")&&this.set("tracking",!this.get("tracking"));return this._locate()},show:function(){this.set("visible",!0)},hide:function(){this.set("visible",!1)},_setTitle:function(){this.get("useTracking")?this.get("tracking")?q.set(this._locateNode,"title",this._i18n.widgets.locateButton.locate.stopTracking):q.set(this._locateNode,"title",this._i18n.widgets.locateButton.locate.tracking):
q.set(this._locateNode,"title",this._i18n.widgets.locateButton.locate.title)},_removeWatchPosition:function(){this.get("watchId")&&(navigator.geolocation.clearWatch(this.get("watchId")),this.set("watchId",null));this._removePrivateVars()},_stopTracking:function(){k.remove(this._locateNode,this._css.tracking);this._removeWatchPosition();this.get("clearOnTrackingStop")&&this.clear();this._hideLoading()},_positionToObject:function(y){return y?{coords:b.mixin({},y.coords),timestamp:y.timestamp}:{}},_startTracking:function(){k.add(this._locateNode,
this._css.tracking);this._removeWatchPosition();var y=navigator.geolocation.watchPosition(b.hitch(this,function(D){D=this._positionToObject(D);this._setPosition(D).then(b.hitch(this,function(G){this._locateEvent(G)}),b.hitch(this,function(G){G||(G=Error("LocateButton::Error setting the position."));this._locateError(G)}))}),b.hitch(this,function(D){this.set("tracking",!1);D||(D=Error("LocateButton::Could not get tracking position."));this._locateError(D)}),this.get("geolocationOptions"));this.set("watchId",
y)},_removePrivateVars:function(){this._scale=this._position=this._graphic=null},_getCurrentPosition:function(){var y=new n;this._removePrivateVars();var D=setTimeout(b.hitch(this,function(){clearTimeout(D);y.reject(Error("LocateButton::time expired for getting location."))}),this.get("timeout"));navigator.geolocation.getCurrentPosition(b.hitch(this,function(G){G=this._positionToObject(G);clearTimeout(D);this._setPosition(G).then(b.hitch(this,function(E){y.resolve(E)}),b.hitch(this,function(E){E||
(E=Error("LocateButton::Error setting map position."));y.reject(E)}))}),b.hitch(this,function(G){G||(G=Error("LocateButton::Could not get current position."));y.reject(G)}),this.get("geolocationOptions"));return y.promise},_locate:function(){var y=new n;this._showLoading();if(navigator.geolocation)this.get("useTracking")?this.get("tracking")?(this._startTracking(),y.resolve({tracking:!0})):(this._stopTracking(),y.resolve({tracking:!1})):this._getCurrentPosition().then(b.hitch(this,function(G){this._locateEvent(G);
y.resolve(G)}),b.hitch(this,function(G){G||(G=Error("LocateButton::Could not get current position."));this._locateError(G);y.reject(G)}));else{var D=Error("LocateButton::geolocation unsupported");this._locateError(D);y.reject(D)}this._setTitle();return y.promise},_projectPoint:function(y){var D=new n,G=this.get("map").spatialReference,E=G.wkid;G.isWebMercator()?(y=u.geographicToWebMercator(y),D.resolve(y)):d.defaults.geometryService&&4326!==E?(E=new A,E.geometries=[y],E.outSR=G,d.defaults.geometryService.project(E).then(b.hitch(this,
function(F){F&&F.length?D.resolve(F[0]):D.reject(Error("LocateButton::Point was not projected."))}),function(F){F||(F=Error("LocateButton::please specify a geometry service on esri/config to project."));D.reject(F)})):D.resolve(y);return D.promise},_getScale:function(y){var D=this.get("scale");return y&&y.coords?D||y.coords.accuracy||5E4:D||5E4},_createPoint:function(y){var D;y&&y.coords&&(D=new r([y.coords.longitude,y.coords.latitude],new v({wkid:4326})));return D},_setPosition:function(y){var D=
new n,G,E;this._removePrivateVars();if((this._position=y)&&y.coords){if(G=this._createPoint(y))this._graphic=E=this._createGraphic(G,y);var F=this._getScale(y);this._scale=F;G?this._projectPoint(G).then(b.hitch(this,function(I){this._graphic=E=this._createGraphic(I,y);var M={graphic:E,scale:F,position:y};this.get("setScale")&&this.get("map").setScale(F);this.get("centerAt")?this.get("map").centerAt(I).then(b.hitch(this,function(){D.resolve(M)}),b.hitch(this,function(P){P||(P=Error("LocateButton::Could not center map."));
D.reject(P)})):D.resolve(M)}),b.hitch(this,function(I){I||(I=Error("LocateButton::Error projecting point."));D.reject(I)})):(G=Error("LocateButton::Invalid point"),D.reject(G))}else G=Error("LocateButton::Invalid position"),D.reject(G);return D.promise},_createGraphic:function(y,D){if(y){var G={position:D};G=new z(y,this.get("symbol"),G,this.get("infoTemplate"))}return G},_locateEvent:function(y){if(y.graphic){var D=this.get("highlightGraphic"),G=this.get("graphicsLayer");D?(D.setGeometry(y.graphic.geometry),
D.setAttributes(y.graphic.attributes),D.setInfoTemplate(y.graphic.infoTemplate),D.setSymbol(y.graphic.symbol)):(D=y.graphic,this.get("highlightLocation")&&(G?G.add(D):this.get("map").graphics.add(D)));this.set("highlightGraphic",D)}this._hideLoading();this.emit("locate",y)},_locateError:function(y){y={graphic:this._graphic,scale:this._scale,position:this._position,error:y};this._hideLoading();this.emit("locate",y)},_showLoading:function(){this.get("useTracking")||k.add(this._locateNode,this._css.loading)},
_hideLoading:function(){this.get("useTracking")||k.remove(this._locateNode,this._css.loading)},_init:function(){this._visible();this._setTitle();this.get("tracking")&&this.get("useTracking")&&this._locate();this.set("loaded",!0);this.emit("load",{})},_updateThemeWatch:function(y,D,G){k.remove(this.domNode,D);k.add(this.domNode,G)},_visible:function(){this.get("visible")?w.set(this.domNode,"display","block"):w.set(this.domNode,"display","none")}});b.setObject("dijit.LocateButton",t,f);return t})},
"esri/layers/graphics":function(){define(["./GraphicsLayer","../graphic","../renderer"],function(){return{}})},"esri/renderer":function(){define("./renderers/Renderer ./renderers/SimpleRenderer ./renderers/UniqueValueRenderer ./renderers/ClassBreaksRenderer ./renderers/TemporalRenderer ./renderers/SymbolAger ./renderers/TimeClassBreaksAger ./renderers/TimeRampAger ./renderers/StretchRenderer ./renderers/jsonUtils".split(" "),function(t,p,x,b,m,f,d,a,c,l){return{Renderer:t,SimpleRenderer:p,UniqueValueRenderer:x,
ClassBreaksRenderer:b,TemporalRenderer:m,SymbolAger:f,TimeClassBreaksAger:d,TimeRampAger:a,StretchRenderer:c,jsonUtils:l}})},"esri/layers/agstiled":function(){define(["./agscommon","./ArcGISTiledMapServiceLayer"],function(){return{}})},"esri/layers/agsdynamic":function(){define(["./agscommon","./ArcGISDynamicMapServiceLayer","../_time"],function(){return{}})},"esri/_time":function(){define(["./TimeExtent"],function(){return{}})},"esri/layers/agsimageservice":function(){define("./agscommon ./ArcGISImageServiceLayer ./ImageServiceParameters ./MosaicRule ./RasterFunction ../utils".split(" "),
function(){return{}})},"esri/layers/KMLLayer":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/sniff dojo/io-query dojo/dom-construct dojo/dom-style ../kernel ../config ../lang ../request ../urlUtils ../SpatialReference ../geometry/webMercatorUtils ../dijit/PopupTemplate ./layer ./KMLFolder ./KMLGroundOverlay ./MapImageLayer ./FeatureLayer".split(" "),function(t,p,x,b,m,f,d,a,c,l,h,n,g,e,k,w,q,u,r,v,z,B,A){var y=
p([r],{declaredClass:"esri.layers.KMLLayer",serviceUrl:k.getProtocolForWebResource()+"//utility.arcgis.com/sharing/kml",constructor:function(D,G){this._url=k.urlToObject(this.url=D);this._outSR=G&&G.outSR||new w({wkid:4326});this._options=b.mixin({},G);n.defaults.kmlService&&(this.serviceUrl=n.defaults.kmlService);var E=this.linkInfo=G&&G.linkInfo;E&&(this.visible=!!E.visibility,this._waitingForMap=!!E.viewFormat);(!E||E&&E.visibility&&!this._waitingForMap)&&this._parseKml();this.refresh=b.hitch(this,
this.refresh);this.registerConnectEvents("esri.layers.KMLLayer",!0)},getFeature:function(D){if(D){var G=D.type,E=D.id,F;switch(G){case "esriGeometryPoint":case "esriGeometryPolyline":case "esriGeometryPolygon":(D=this["_"+G])&&(F=b.getObject("_mode._featureMap."+E,!1,D));break;case "GroundOverlay":if(D=this._groundLyr){var I=D.getImages();G=I.length;for(D=0;D<G;D++)if(I[D].id===E){F=I[D];break}}break;case "NetworkLink":m.some(this._links,function(M){return M.linkInfo&&M.linkInfo.id===E?(F=M,!0):!1});
break;case "Folder":for(G=(I=this.folders)?I.length:0,D=0;D<G;D++)if(I[D].id===E){F=I[D];break}}return F}},getLayers:function(){var D=[];this._groundLyr&&D.push(this._groundLyr);this._fLayers&&(D=D.concat(this._fLayers));this._links&&m.forEach(this._links,function(G){G.declaredClass&&D.push(G)});return D},setFolderVisibility:function(D,G){D&&(this._fireUpdateStart(),(D.visible=G)&&(G=this._areLocalAncestorsVisible(D)),this._setState(D,G),this._fireUpdateEnd())},_eventMap:{"network-link-error":["error"]},
onRefresh:function(){},onOpacityChange:function(){},onNetworkLinkError:function(){},_parseKml:function(D){var G=this;this._fireUpdateStart();this._io=e({url:this.serviceUrl,content:{url:this._url.path+this._getQueryParameters(D),model:"simple",folders:"",refresh:this.loaded?!0:void 0,outSR:f.toJson(this._outSR.toJson())},callbackParamName:"callback",load:function(E){G._io=null;G._initLayer(E)},error:function(E){G._io=null;E=b.mixin(Error(),E);E.message="Unable to load KML: "+(E.message||"");G._fireUpdateEnd(E);
G._errorHandler(E)}})},_initLayer:function(D){if(this.loaded){var G=[];m.forEach(this.folders,function(H){H.visible&&G.push(H.id)});this._options.minScale=this.minScale;this._options.maxScale=this.maxScale;this._options.opacity=this.opacity;this._removeInternalLayers()}this.name=D.name;this.description=D.description;this.snippet=D.snippet;this.visibility=D.visibility;this.featureInfos=D.featureInfos;var E,F=this.folders=D.folders,I=[];if(F){var M=F.length;for(E=0;E<M;E++){var P=F[E]=new v(F[E]);-1===
P.parentFolderId&&I.push(P)}}F=this._links=D.networkLinks;M=F?F.length:0;for(E=0;E<M;E++)if(!F[E].viewRefreshMode||-1===F[E].viewRefreshMode.toLowerCase().indexOf("onregion")){var W=b.mixin({},this._options);W.linkInfo=F[E];W.id&&(W.id=W.id+"_"+E);P=F[E]=new y(F[E].href,W);P._parentLayer=this;P._parentFolderId=this._getLinkParentId(P.linkInfo.id);P._linkErrorHandle=P.on("error,network-link-error",b.hitch(P,function(H){this._parentLayer.onNetworkLinkError(H.error)}))}if((F=D.groundOverlays)&&0<F.length)for(W=
b.mixin({},this._options),W.id&&(W.id+="_mapImage"),P=this._groundLyr=new B(W),M=F.length,E=0;E<M;E++)P.addImage(new z(F[E]));(D=b.getObject("featureCollection.layers",!1,D))&&0<D.length&&(this._fLayers=[],m.forEach(D,function(H,O){var K=b.getObject("featureSet.features",!1,H);K&&0<K.length&&(W=b.mixin({outFields:["*"],infoTemplate:H.popupInfo?new u(H.popupInfo):null,editable:!1},this._options),W.id&&(W.id=W.id+"_"+O),W.webgl=!1,H.layerDefinition.capabilities="Query,Data",K=new A(H,W),K.geometryType&&
(this["_"+K.geometryType]=K),this._fLayers.push(K))},this),0===this._fLayers.length&&delete this._fLayers);if(!this.loaded)for(M=I.length,E=0;E<M;E++)P=I[E],this._setState(P,P.visible);this._fireUpdateEnd();this.loaded?(this._addInternalLayers(),m.forEach(this.folders,function(H){-1<m.indexOf(G,H.id)?this.setFolderVisibility(H,!0):this.setFolderVisibility(H,!1)},this),this.onRefresh()):(this.loaded=!0,this.onLoad(this))},_addInternalLayers:function(){var D=this._map;this._fireUpdateStart();this._links&&
m.forEach(this._links,function(I){I.declaredClass&&(D.addLayer(I),I._waitingForMap&&(I._waitingForMap=null,I.visible?I._parseKml(D):I._wMap=D))});var G=D.spatialReference,E=this._outSR;if(!G.equals(E))if(G.isWebMercator()&&4326===E.wkid)var F=q.geographicToWebMercator;else if(E.isWebMercator()&&4326===G.wkid)F=q.webMercatorToGeographic;else return;this._groundLyr&&(F&&m.forEach(this._groundLyr.getImages(),function(I){I.extent=F(I.extent)}),D.addLayer(this._groundLyr));(G=this._fLayers)&&0<G.length&&
m.forEach(G,function(I){if(F){var M=I.graphics,P,W,H=M?M.length:0;for(P=0;P<H;P++)(W=M[P].geometry)&&M[P].setGeometry(F(W))}D.addLayer(I)});this.onVisibilityChange(this.visible)},_removeInternalLayers:function(){var D=this._map;this._links&&m.forEach(this._links,function(G){G.declaredClass&&G._io&&G._io.cancel();G._linkErrorHandle&&(G._linkErrorHandle.remove(),G._linkErrorHandle=null)});D&&m.forEach(this.getLayers(),D.removeLayer,D)},_setState:function(D,G){var E=D.featureInfos,F,I,M=E?E.length:0,
P=G?"show":"hide",W=G?"_resume":"_suspend";for(I=0;I<M;I++){var H=E[I];if(F=this.getFeature(H))if("Folder"===H.type)this._setState(F,G&&F.visible);else if("NetworkLink"===H.type)this._setInternalVisibility(F,G);else if(F[W])F[W]();else F[P]()}},_areLocalAncestorsVisible:function(D){var G=D.parentFolderId;for(D=D.visible;D&&-1!==G;)G=this.getFeature({type:"Folder",id:G}),D=D&&G.visible,G=G.parentFolderId;return D},_setInternalVisibility:function(D,G){var E=D._parentLayer,F=D._parentFolderId;for(G=
G&&D.visible;G&&E;)G=G&&E.visible,-1<F&&(G=G&&E._areLocalAncestorsVisible(E.getFeature({type:"Folder",id:F}))),F=E._parentFolderId,E=E._parentLayer;this._setIntState(D,G)},_setIntState:function(D,G){D&&m.forEach(D.getLayers(),function(E){E.linkInfo?D._setIntState(E,G&&E.visible&&D._areLocalAncestorsVisible(D.getFeature({type:"Folder",id:E._parentFolderId}))):E.setVisibility(G)})},_getLinkParentId:function(D){var G=-1;this.folders&&m.some(this.folders,function(E){return E.networkLinkIds&&-1!==m.indexOf(E.networkLinkIds,
D)?(G=E.id,!0):!1});return G},_checkAutoRefresh:function(){var D=this.linkInfo;if(D)if(this.visible){if(this.loaded&&this._map){var G=D.refreshMode,E=D.refreshInterval,F=D.viewRefreshMode;D=D.viewRefreshTime;G&&-1!==G.toLowerCase().indexOf("oninterval")&&0<E&&(this._stopAutoRefresh(),this._timeoutHandle=setTimeout(this.refresh,1E3*E));F&&-1!==F.toLowerCase().indexOf("onstop")&&0<D&&!this._extChgHandle&&(this._extChgHandle=x.connect(this._map,"onExtentChange",this,this._extentChanged))}}else this._stopAutoRefresh(),
x.disconnect(this._extChgHandle),delete this._extChgHandle},_stopAutoRefresh:function(){clearTimeout(this._timeoutHandle);this._timeoutHandle=null},_getQueryParameters:function(D){D=D||this._map;var G={},E=this.linkInfo,F=D&&D.extent;if(this._url.query){b.mixin(G,this._url.query);var I=!!this._url.query.token}h.id&&!I&&(I=h.id.findCredential(this._url.path))&&(G.token=I.token);if(E){I=E.viewFormat;var M=E.httpQuery;E=E.viewBoundScale;if(F&&I){var P=F,W=F,H=F.spatialReference;H&&(H.isWebMercator()?
P=q.webMercatorToGeographic(F):4326===H.wkid&&(W=q.geographicToWebMercator(F)));F=P.getCenter();W=Math.max(W.getWidth(),W.getHeight());E&&(P=P.expand(E));I=I.replace(/\[bboxWest\]/ig,P.xmin).replace(/\[bboxEast\]/ig,P.xmax).replace(/\[bboxSouth\]/ig,P.ymin).replace(/\[bboxNorth\]/ig,P.ymax).replace(/\[lookatLon\]/ig,F.x).replace(/\[lookatLat\]/ig,F.y).replace(/\[lookatRange\]/ig,W).replace(/\[lookatTilt\]/ig,0).replace(/\[lookatHeading\]/ig,0).replace(/\[lookatTerrainLon\]/ig,F.x).replace(/\[lookatTerrainLat\]/ig,
F.y).replace(/\[lookatTerrainAlt\]/ig,0).replace(/\[cameraLon\]/ig,F.x).replace(/\[cameraLat\]/ig,F.y).replace(/\[cameraAlt\]/ig,W).replace(/\[horizFov\]/ig,60).replace(/\[vertFov\]/ig,60).replace(/\[horizPixels\]/ig,D.width).replace(/\[vertPixels\]/ig,D.height).replace(/\[terrainEnabled\]/ig,0);b.mixin(G,a.queryToObject(I))}M&&(M=M.replace(/\[clientVersion\]/ig,h.version).replace(/\[kmlVersion\]/ig,2.2).replace(/\[clientName\]/ig,"ArcGIS API for JavaScript").replace(/\[language\]/ig,t.locale),b.mixin(G,
a.queryToObject(M)))}D=[];for(var O in G)g.isDefined(G[O])&&D.push(O+"\x3d"+G[O]);return(D=D.join("\x26"))?"?"+D:""},setScaleRange:function(D,G){this.inherited(arguments);m.forEach(this.getLayers(),function(E){E.setScaleRange(D,G)})},setOpacity:function(D){this.opacity!=D&&(m.forEach(this.getLayers(),function(G){G.setOpacity(D)}),this.opacity=D,this.onOpacityChange(D))},_setMap:function(D,G){this.inherited(arguments);this._map=D;var E=this._div=c.create("div",null,G);l.set(E,"position","absolute");
this._addInternalLayers();this.evaluateSuspension();return E},_unsetMap:function(D,G){this._io&&this._io.cancel();this._stopAutoRefresh();x.disconnect(this._extChgHandle);delete this._extChgHandle;this._removeInternalLayers();var E=this._div;E&&(G.removeChild(E),c.destroy(E));this._wMap=this._div=null;this.inherited(arguments)},onVisibilityChange:function(D){this.loaded?(this._fireUpdateStart(),this._setInternalVisibility(this,D),this._checkAutoRefresh(),this._fireUpdateEnd()):this.linkInfo&&D&&(this._waitingForMap||
this._parseKml(this._wMap))},refresh:function(){this.loaded&&this._map&&!this._io&&this.visible&&this._parseKml()},getFeatureCollection:function(D){var G,E=[];(D=this.getFeature({type:"Folder",id:D}))&&(G=m.map(D.featureInfos,function(F){if("esriGeometryPoint"===F.type||"esriGeometryPolyline"===F.type||"esriGeometryPolygon"===F.type)return F.id},this))&&0<G.length&&m.forEach(this._fLayers,function(F){var I;var M=F.toJson();M.featureSet.features&&0<M.featureSet.features.length&&(I=m.filter(M.featureSet.features,
function(P){if(-1!==m.indexOf(G,P.attributes[F.objectIdField]))return P},this));I&&0<I.length&&(M.featureSet.features=I,E.push(M))},this);return E},getFeatureCount:function(D){D=this.getFeature({type:"Folder",id:D});var G={points:0,polylines:0,polygons:0};D&&m.forEach(D.featureInfos,function(E){"esriGeometryPoint"===E.type&&(G.points+=1);"esriGeometryPolyline"===E.type&&(G.polylines+=1);"esriGeometryPolygon"===E.type&&(G.polygons+=1)});return G},_extentChanged:function(){this._stopAutoRefresh();this._timeoutHandle=
setTimeout(this.refresh,1E3*this.linkInfo.viewRefreshTime)}});b.setObject("layers.KMLLayer",y,h);return y})},"esri/layers/KMLFolder":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(t,p,x,b,m){t=t(null,{declaredClass:"esri.layers.KMLFolder",constructor:function(f){p.mixin(this,f);m.isDefined(this.visibility)&&(this.visible=!!this.visibility)}});p.setObject("layers.KMLFolder",t,b);return t})},"esri/layers/KMLGroundOverlay":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ./MapImage".split(" "),
function(t,p,x,b,m,f){t=t([f],{declaredClass:"esri.layers.KMLGroundOverlay",constructor:function(d){m.isDefined(this.visibility)&&(this.visible=!!this.visibility)}});p.setObject("layers.KMLGroundOverlay",t,b);return t})},"esri/layers/osm":function(){define(["./OpenStreetMapLayer"],function(){return{}})},"esri/SnappingManager":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/Color dojo/_base/Deferred dojo/has dojo/keys ./kernel ./graphic ./geometry/ScreenPoint ./geometry/Extent ./symbols/SimpleMarkerSymbol ./symbols/SimpleLineSymbol ./tasks/query".split(" "),
function(t,p,x,b,m,f,d,a,c,l,h,n,g,e,k){t=t(null,{declaredClass:"esri.SnappingManager",constructor:function(w){w=w||{};this.map=w.map;this.tolerance=w.tolerance||15;this.layerInfos=[];if(w.layerInfos)this.layerInfos=w.layerInfos;else{var q;for(q=0;q<this.map.graphicsLayerIds.length;q++){var u=this.map.getLayer(this.map.graphicsLayerIds[q]);this.layerInfos.push({layer:u})}if(this.map.loaded)this.layerInfos.push({layer:this.map.graphics});else var r=p.connect(this.map,"onLoad",this,function(v){p.disconnect(r);
r=null;this.layerInfos.push({layer:this.map.graphics});this.setLayerInfos(this.layerInfos)})}this.snapPointSymbol=w.snapPointSymbol?w.snapPointSymbol:new g(g.STYLE_CROSS,15,new e(e.STYLE_SOLID,new m([0,255,255]),1),new m([0,255,0,0]));this.alwaysSnap=w.alwaysSnap?w.alwaysSnap:!1;this.snapKey=w.snapKey?w.snapKey:d("mac")?a.META:a.CTRL;this._SelectionLyrQuery=new k;this._SelectionLyrQuery.spatialRelationship=k.SPATIAL_REL_INTERSECTS;this._snappingGraphic=new l;this.setLayerInfos(this.layerInfos);this._currentGraphicOption=
{snapToPoint:!0,snapToVertex:!0,snapToLastVertex:!0,snapToEdge:!0};this._snappingCallback=x.hitch(this,this._snappingCallback)},getSnappingPoint:function(w){var q=this.layers,u=this.tolerance,r=this.map,v=this.layerOptions,z=r.toMap(w.offset(-u,u));u=r.toMap(w.offset(u,-u));z=new n(z.x,z.y,u.x,u.y,r.spatialReference);var B=new k;B.geometry=z;B.spatialRelationship=k.SPATIAL_REL_INTERSECTS;var A=[],y=[],D=this._extractPointsAndLines,G=new f,E=0,F;u=z.xmin;var I=z.xmax;b.forEach(q,function(O,K){O.visible&&
O.loaded&&"esri.layers.FeatureLayer"===O.declaredClass&&O.mode!==O.constructor.MODE_SELECTION&&E++});r.spatialReference._isWrappable()&&(u=n.prototype._normalizeX(z.xmin,r.spatialReference._getInfo()).x,I=n.prototype._normalizeX(z.xmax,r.spatialReference._getInfo()).x);var M=new n(u,z.ymin,I,z.ymax,r.spatialReference);b.forEach(q,function(O,K){if("esri.layers.GraphicsLayer"===O.declaredClass&&O.visible){var R=[];b.forEach(O.graphics,function(U){U&&U.visible&&M.intersects(U.geometry)&&R.push(U)});
var da=D(R,v[K]);A=A.concat(da[0]);y=y.concat(da[1])}});var P=x.hitch(this,function(O){E--;O instanceof Error||(O=D(O.features,v[F]),A=A.concat(O[0]),y=y.concat(O[1]));E||(H=this._getSnappingPoint(A,y,w),G.callback(H))}),W=!1;b.forEach(q,function(O,K){O.visible&&O.loaded&&(F=K,"esri.layers.FeatureLayer"===O.declaredClass&&O.mode!==O.constructor.MODE_SELECTION&&(W=!0,O.queryFeatures(B,P,P)))});if(!W){var H=this._getSnappingPoint(A,y,w);G.callback(H)}return G},setLayerInfos:function(w){this.layers=
[];this.layerOptions=[];var q;for(q=0;q<w.length;q++)this.layers.push(w[q].layer),this.layerOptions.push({snapToPoint:!0,snapToVertex:!0,snapToEdge:!0}),!1===w[q].snapToPoint&&(this.layerOptions[q].snapToPoint=w[q].snapToPoint),!1===w[q].snapToVertex&&(this.layerOptions[q].snapToVertex=w[q].snapToVertex),!1===w[q].snapToEdge&&(this.layerOptions[q].snapToEdge=w[q].snapToEdge);this._featurePtsFromSelectionLayer=[];this._featureLinesFromSelectionLayer=[];this._selectionLayers=[];this._selectionLayerOptions=
[];b.forEach(this.layers,function(u,r){"esri.layers.FeatureLayer"===u.declaredClass&&u.mode===u.constructor.MODE_SELECTION&&(this._selectionLayers.push(u),this._selectionLayerOptions.push(this.layerOptions[r]))},this);this.layerInfos=w},destroy:function(){p.disconnect(this._onExtentChangeConnect);this._killOffSnapping();this._featurePtsFromSelectionLayer=this._featureLinesFromSelectionLayer=this._currentFeaturePts=this._currentFeatureLines=this.layers=this.map=null},_startSelectionLayerQuery:function(){p.disconnect(this._onExtentChangeConnect);
this._mapExtentChangeHandler(this._selectionLayers,this._selectionLayerOptions,this.map.extent);this._onExtentChangeConnect=p.connect(this.map,"onExtentChange",x.hitch(this,"_mapExtentChangeHandler",this._selectionLayers,this._selectionLayerOptions))},_stopSelectionLayerQuery:function(){p.disconnect(this._onExtentChangeConnect)},_mapExtentChangeHandler:function(w,q,u){this._featurePtsFromSelectionLayer=[];this._featureLinesFromSelectionLayer=[];var r;this._SelectionLyrQuery.geometry=u;var v=x.hitch(this,
function(z){z instanceof Error||(z=this._extractPointsAndLines(z.features,q[r]),this._featurePtsFromSelectionLayer=this._featurePtsFromSelectionLayer.concat(z[0]),this._featureLinesFromSelectionLayer=this._featureLinesFromSelectionLayer.concat(z[1]))});b.forEach(w,function(z,B){z.visible&&z.loaded&&(r=B,z.queryFeatures(this._SelectionLyrQuery,v,v))},this)},_extractPointsAndLines:function(w,q){var u=q&&!1===q.snapToLastVertex?!1:!0,r=[],v=[],z,B;b.forEach(w,function(A,y){if((!A._graphicsLayer||A.visible)&&
A.geometry&&A._isSnapTarget)if("point"===A.geometry.type&&q.snapToPoint)r.push(A.geometry);else if("polyline"===A.geometry.type)for(z=0;z<A.geometry.paths.length;z++){v.push("lineStart");var D=A.geometry.paths[z].length;for(B=0;B<D;B++)if(u||B!==D-1){var G=A.geometry.getPoint(z,B);q.snapToVertex&&r.push(G);q.snapToEdge&&v.push(G)}v.push("lineEnd")}else if("polygon"===A.geometry.type)for(z=0;z<A.geometry.rings.length;z++){v.push("lineStart");D=A.geometry.rings[z].length;for(B=0;B<D;B++)if(u||B!==D-
1)G=A.geometry.getPoint(z,B),q.snapToVertex&&r.push(G),q.snapToEdge&&v.push(G);v.push("lineEnd")}});return[r,v]},_getSnappingPoint:function(w,q,u){var r,v=this.tolerance,z=this.map,B=this.map._getFrameWidth();w=w.concat(this._featurePtsFromSelectionLayer);q=q.concat(this._featureLinesFromSelectionLayer);if(this._currentGraphic){var A=this._extractPointsAndLines([this._currentGraphic],this._currentGraphicOption);w=w.concat(A[0]);q=q.concat(A[1])}var y,D;b.forEach(w,function(Z,L){var T=z.toScreen(Z,
!0);if(-1!==B&&(T.x%=B,0>T.x&&(T.x+=B),z.width>B))for(var Y=(z.width-B)/2;T.x<Y;)T.x+=B;r=Math.sqrt((T.x-u.x)*(T.x-u.x)+(T.y-u.y)*(T.y-u.y));r<=v&&(v=r,y=T.x,D=T.y)});if(y){q=new h(y,D);var G=q=z.toMap(q)}else{v=this.tolerance;for(w=0;w<q.length;w++)if("lineStart"===q[w])for(A=w+1;A<q.length;A++){if("lineEnd"!==q[A+1]&&"lineStart"!==q[A+1]&&"lineEnd"!==q[A]&&"lineStart"!==q[A]){var E=z.toScreen(q[A],!0),F=z.toScreen(q[A+1],!0),I=E.x>=F.x?E:F,M=E.x>=F.x?F:E;-1!==B&&(I.x%=B,0>I.x&&(I.x+=B),M.x%=B,0>
M.x&&(M.x+=B),M.x>I.x&&(M.x-=B));E=I.x;I=I.y;F=M.x;M=M.y;var P;if(E===F){var W=E;var H=u.y;var O=P=E;var K=I<=M?I:M;var R=I<=M?M:I}else I===M?(W=u.x,H=I,O=E<=F?E:F,P=E<=F?F:E,K=R=I):(H=(M-I)/(F-E),O=(I*F-E*M)/(F-E),W=(O-(u.y*M-u.y*I-u.x*E+u.x*F)/(M-I))/((E-F)/(M-I)-H),H=H*W+O,O=E<=F?E:F,P=E<=F?F:E,K=I<=M?I:M,R=I<=M?M:I);if(W>=O&&W<=P&&H>=K&&H<=R){if(E=Math.sqrt((u.x-W)*(u.x-W)+(u.y-H)*(u.y-H)),E<=v){v=E;var da=W;var U=H}}else W=Math.sqrt((E-u.x)*(E-u.x)+(I-u.y)*(I-u.y)),H=Math.sqrt((F-u.x)*(F-u.x)+
(M-u.y)*(M-u.y)),W<=H?(O=W,W=E,H=I):(O=H,W=F,H=M),O<=v&&(v=O,da=W,U=H)}if("lineEnd"===q[A]){w=A;break}}da&&(q=new h(da,U),G=q=z.toMap(q))}return G},_setGraphic:function(w,q){this._currentGraphic=w;this._currentGraphicOption.snapToLastVertex=q&&!1===q.snapToLastVertex?!1:!0},_addSnappingPointGraphic:function(){var w=this.map;this._snappingGraphic.setSymbol(this.snapPointSymbol);w.graphics.add(this._snappingGraphic)},_setUpSnapping:function(){var w=this.map;this._onSnapKeyDown_connect=p.connect(w,"onKeyDown",
this,"_onSnapKeyDownHandler");this._onSnapKeyUp_connect=p.connect(w,"onKeyUp",this,"_onSnapKeyUpHandler");this._onSnappingMouseMove_connect=p.connect(w,"onMouseMove",this,"_onSnappingMouseMoveHandler");this._onSnappingMouseDrag_connect=p.connect(w,"onMouseDrag",this,"_onSnappingMouseMoveHandler");this.alwaysSnap&&this._activateSnapping()},_killOffSnapping:function(){p.disconnect(this._onSnapKeyDown_connect);p.disconnect(this._onSnapKeyUp_connect);p.disconnect(this._onSnappingMouseMove_connect);p.disconnect(this._onSnappingMouseDrag_connect);
this._deactivateSnapping()},_onSnapKeyDownHandler:function(w){w.keyCode===this.snapKey&&(p.disconnect(this._onSnapKeyDown_connect),this.alwaysSnap?this._deactivateSnapping():this._activateSnapping())},_activateSnapping:function(){this._snappingActive=!0;this._addSnappingPointGraphic();this._currentLocation&&this._onSnappingMouseMoveHandler(this._currentLocation)},_onSnapKeyUpHandler:function(w){w.keyCode===this.snapKey&&(this._onSnapKeyDown_connect=p.connect(this.map,"onKeyDown",this,"_onSnapKeyDownHandler"),
this.alwaysSnap?this._activateSnapping():this._deactivateSnapping())},_deactivateSnapping:function(){this._snappingActive=!1;this._snappingPoint=null;this.map.graphics.remove(this._snappingGraphic);this._snappingGraphic.setGeometry(null)},_onSnappingMouseMoveHandler:function(w){this._currentLocation=w;this._snappingPoint=null;this._snappingActive&&(this._snappingGraphic.hide(),this.getSnappingPoint(w.screenPoint).addCallback(this._snappingCallback))},_snappingCallback:function(w){if(this._snappingPoint=
w)this._snappingGraphic.show(),this._snappingGraphic.setGeometry(w)}});return c.SnappingManager=t})},"esri/tasks/geometry":function(){define("./GeometryService ./TrimExtendParameters ./BufferParameters ./AreasAndLengthsParameters ./LengthsParameters ./RelationParameters ./DensifyParameters ./GeneralizeParameters ./OffsetParameters ./DistanceParameters ./ProjectParameters".split(" "),function(){return{}})},"esri/tasks/TrimExtendParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel".split(" "),
function(t,p,x,b,m,f){t=t(null,{declaredClass:"esri.tasks.TrimExtendParameters",polylines:null,trimExtendTo:null,extendHow:null,toJson:function(){var d=x.map(this.polylines,function(c){return c.toJson()}),a={};a.polylines=b.toJson(d);a.trimExtendTo=b.toJson(this.trimExtendTo.toJson());a.sr=b.toJson(this.polylines[0].spatialReference.toJson());a.extendHow=this.extendHow||0;return a}});p.mixin(t,{DEFAULT_CURVE_EXTENSION:0,RELOCATE_ENDS:1,KEEP_END_ATTRIBUTES:2,NO_END_ATTRIBUTES:4,NO_EXTEND_AT_FROM:8,
NO_EXTEND_AT_TO:16});p.setObject("tasks.TrimExtendParameters",t,f);return t})},"esri/tasks/BufferParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/Polygon ../geometry/jsonUtils".split(" "),function(t,p,x,b,m,f,d,a){t=t(null,{declaredClass:"esri.tasks.BufferParameters",geometries:null,outSpatialReference:null,bufferSpatialReference:null,distances:null,unit:null,unionResults:!1,geodesic:!1,toJson:function(){var c={unit:this.unit,
unionResults:this.unionResults,geodesic:this.geodesic},l=this.distances,h=this.outSpatialReference,n=this.bufferSpatialReference,g=x.map(this.geometries,function(w){w="extent"===w.type?d.fromExtent(w):w;return w.toJson()},this),e=this.geometries;if(e&&0<e.length){var k="extent"===e[0].type?"esriGeometryPolygon":a.getJsonType(e[0]);c.geometries=b.toJson({geometryType:k,geometries:g});c.inSR=e[0].spatialReference.wkid?e[0].spatialReference.wkid:b.toJson(e[0].spatialReference.toJson())}l&&(c.distances=
l.join(","));h&&(c.outSR=h.wkid?h.wkid:b.toJson(h.toJson()));n&&(c.bufferSR=n.wkid?n.wkid:b.toJson(n.toJson()));return c}});p.setObject("tasks.BufferParameters",t,f);return t})},"esri/tasks/RelationParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),function(t,p,x,b,m,f,d){t=t(null,{declaredClass:"esri.tasks.RelationParameters",geometries1:null,geometries2:null,relation:null,relationParam:null,toJson:function(){var a=
x.map(this.geometries1,function(n){return n.toJson()}),c=x.map(this.geometries2,function(n){return n.toJson()}),l={},h=this.geometries1;h&&0<h.length&&(l.geometries1=b.toJson({geometryType:d.getJsonType(h[0]),geometries:a}),a=this.geometries1[0].spatialReference,l.sr=a.wkid?a.wkid:b.toJson(a.toJson()));(a=this.geometries2)&&0<a.length&&(l.geometries2=b.toJson({geometryType:d.getJsonType(a[0]),geometries:c}));this.relation&&(l.relation=this.relation);this.relationParam&&(l.relationParam=this.relationParam);
return l}});p.mixin(t,{SPATIAL_REL_CROSS:"esriGeometryRelationCross",SPATIAL_REL_DISJOINT:"esriGeometryRelationDisjoint",SPATIAL_REL_IN:"esriGeometryRelationIn",SPATIAL_REL_INTERIORINTERSECTION:"esriGeometryRelationInteriorIntersection",SPATIAL_REL_INTERSECTION:"esriGeometryRelationIntersection",SPATIAL_REL_COINCIDENCE:"esriGeometryRelationLineCoincidence",SPATIAL_REL_LINETOUCH:"esriGeometryRelationLineTouch",SPATIAL_REL_OVERLAP:"esriGeometryRelationOverlap",SPATIAL_REL_POINTTOUCH:"esriGeometryRelationPointTouch",
SPATIAL_REL_TOUCH:"esriGeometryRelationTouch",SPATIAL_REL_WITHIN:"esriGeometryRelationWithin",SPATIAL_REL_RELATION:"esriGeometryRelationRelation"});p.setObject("tasks.RelationParameters",t,f);return t})},"esri/tasks/DensifyParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),function(t,p,x,b,m,f,d){t=t(null,{declaredClass:"esri.tasks.DensifyParameters",geometries:null,geodesic:null,lengthUnit:null,maxSegmentLength:null,
toJson:function(){var a=x.map(this.geometries,function(l){return l.toJson()}),c={};this.geometries&&0<this.geometries.length&&(c.geometries=b.toJson({geometryType:d.getJsonType(this.geometries[0]),geometries:a}),c.sr=b.toJson(this.geometries[0].spatialReference.toJson()));this.geodesic&&(c.geodesic=this.geodesic);this.lengthUnit&&(c.lengthUnit=this.lengthUnit);this.maxSegmentLength&&(c.maxSegmentLength=this.maxSegmentLength);return c}});p.setObject("tasks.DensifyParameters",t,f);return t})},"esri/tasks/GeneralizeParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),
function(t,p,x,b,m,f,d){t=t(null,{declaredClass:"esri.tasks.GeneralizeParameters",geometries:null,deviationUnit:null,maxDeviation:null,toJson:function(){var a=x.map(this.geometries,function(l){return l.toJson()}),c={};this.geometries&&0<this.geometries.length&&(c.geometries=b.toJson({geometryType:d.getJsonType(this.geometries[0]),geometries:a}),c.sr=b.toJson(this.geometries[0].spatialReference.toJson()));this.deviationUnit&&(c.deviationUnit=this.deviationUnit);this.maxDeviation&&(c.maxDeviation=this.maxDeviation);
return c}});p.setObject("tasks.GeneralizeParameters",t,f);return t})},"esri/tasks/OffsetParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),function(t,p,x,b,m,f,d){t=t(null,{declaredClass:"esri.tasks.OffsetParameters",geometries:null,bevelRatio:null,offsetDistance:null,offsetHow:null,offsetUnit:null,toJson:function(){var a=x.map(this.geometries,function(l){return l.toJson()}),c={};this.geometries&&
0<this.geometries.length&&(c.geometries=b.toJson({geometryType:d.getJsonType(this.geometries[0]),geometries:a}),c.sr=b.toJson(this.geometries[0].spatialReference.toJson()));this.bevelRatio&&(c.bevelRatio=this.bevelRatio);this.offsetDistance&&(c.offsetDistance=this.offsetDistance);this.offsetHow&&(c.offsetHow=this.offsetHow);this.offsetUnit&&(c.offsetUnit=this.offsetUnit);return c}});p.mixin(t,{OFFSET_BEVELLED:"esriGeometryOffsetBevelled",OFFSET_MITERED:"esriGeometryOffsetMitered",OFFSET_ROUNDED:"esriGeometryOffsetRounded"});
p.setObject("tasks.OffsetParameters",t,f);return t})},"esri/tasks/DistanceParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),function(t,p,x,b,m,f){t=t(null,{declaredClass:"esri.tasks.DistanceParameters",geometry1:null,geometry2:null,distanceUnit:null,geodesic:null,toJson:function(){var d={},a=this.geometry1;a&&(d.geometry1=x.toJson({geometryType:f.getJsonType(a),geometry:a}));if(a=this.geometry2)d.geometry2=x.toJson({geometryType:f.getJsonType(a),
geometry:a});d.sr=x.toJson(this.geometry1.spatialReference.toJson());this.distanceUnit&&(d.distanceUnit=this.distanceUnit);this.geodesic&&(d.geodesic=this.geodesic);return d}});p.setObject("tasks.DistanceParameters",t,m);return t})},"esri/tasks/identify":function(){define(["./IdentifyTask","./IdentifyParameters","./IdentifyResult"],function(){return{}})},"esri/tasks/IdentifyTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../request ../geometry/normalizeUtils ./Task ./IdentifyResult".split(" "),
function(t,p,x,b,m,f,d,a,c){t=t(a,{declaredClass:"esri.tasks.IdentifyTask",_eventMap:{complete:["results"]},constructor:function(l,h){this._url.path+="/identify";this._handler=p.hitch(this,this._handler);this.gdbVersion=h&&h.gdbVersion;this.registerConnectEvents()},__msigns:[{n:"execute",c:3,a:[{i:0,p:["geometry"]}],e:2}],_handler:function(l,h,n,g,e){try{var k=[];x.forEach(l.results,function(w,q){k[q]=new c(w)});this._successHandler([k],"onComplete",n,e)}catch(w){this._errorHandler(w,g,e)}},execute:function(l,
h,n,g){var e=g.assembly;l=this._encode(p.mixin({},this._url.query,{f:"json"},l.toJson(e&&e[0])));var k=this._handler,w=this._errorHandler;this.gdbVersion&&(l.gdbVersion=this.gdbVersion);return f({url:this._url.path,content:l,callbackParamName:"callback",load:function(q,u){k(q,u,h,n,g.dfd)},error:function(q){w(q,n,g.dfd)}})},onComplete:function(){}});d._createWrappers(t);p.setObject("tasks.IdentifyTask",t,m);return t})},"esri/tasks/IdentifyResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../graphic ../geometry/jsonUtils".split(" "),
function(t,p,x,b,m,f){t=t(null,{declaredClass:"esri.tasks.IdentifyResult",constructor:function(d){p.mixin(this,d);this.feature=new m(d.geometry?f.fromJson(d.geometry):null,null,d.attributes);delete this.geometry;delete this.attributes}});p.setObject("tasks.IdentifyResult",t,b);return t})},"esri/tasks/IdentifyParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../layerUtils ../geometry/jsonUtils ../geometry/scaleUtils".split(" "),function(t,
p,x,b,m,f,d,a,c){var l=t(null,{declaredClass:"esri.tasks.IdentifyParameters",constructor:function(){this.layerOption=l.LAYER_OPTION_TOP},geometry:null,spatialReference:null,layerIds:null,tolerance:null,returnGeometry:!1,returnFieldName:!1,returnUnformattedValues:!1,mapExtent:null,width:400,height:400,dpi:96,layerDefinitions:null,timeExtent:null,layerTimeOptions:null,dynamicLayerInfos:null,toJson:function(h){var n=h&&h.geometry||this.geometry,g=this.mapExtent,e=this.spatialReference,k=this.layerIds;
h={tolerance:this.tolerance,returnGeometry:this.returnGeometry,returnFieldName:this.returnFieldName,returnUnformattedValues:this.returnUnformattedValues,imageDisplay:this.width+","+this.height+","+this.dpi,maxAllowableOffset:this.maxAllowableOffset,geometryPrecision:this.geometryPrecision};if(n){var w=n.toJson();delete w.spatialReference;h.geometry=b.toJson(w);h.geometryType=a.getJsonType(n)}e?h.sr=e.wkid||b.toJson(e.toJson()):n&&n.spatialReference?h.sr=n.spatialReference.wkid||b.toJson(n.spatialReference.toJson()):
g&&g.spatialReference&&(h.sr=g.spatialReference.wkid||b.toJson(g.spatialReference.toJson()));g&&(h.mapExtent=g.xmin+","+g.ymin+","+g.xmax+","+g.ymax);h.layers=this.layerOption;k&&(h.layers+=":"+k.join(","));h.layerDefs=d._serializeLayerDefinitions(this.layerDefinitions,!0);n=this.timeExtent;h.time=n?n.toJson().join(","):null;h.layerTimeOptions=d._serializeTimeOptions(this.layerTimeOptions);if(this.dynamicLayerInfos&&0<this.dynamicLayerInfos.length){g=c.getScale({extent:g,width:this.width,spatialReference:g.spatialReference});
var q=d._getLayersForScale(g,this.dynamicLayerInfos),u=[];x.forEach(this.dynamicLayerInfos,function(r){if(!r.subLayerIds){var v=r.id;if((!this.layerIds||this.layerIds&&-1!==x.indexOf(this.layerIds,v))&&-1!==x.indexOf(q,v)){var z={id:v};z.source=r.source&&r.source.toJson();var B;this.layerDefinitions&&this.layerDefinitions[v]&&(B=this.layerDefinitions[v]);B&&(z.definitionExpression=B);var A;this.layerTimeOptions&&this.layerTimeOptions[v]&&(A=this.layerTimeOptions[v]);A&&(z.layerTimeOptions=A.toJson());
u.push(z)}}},this);g=b.toJson(u);"[]"===g&&(g="[{}]");h.dynamicLayers=g}return h}});p.mixin(l,{LAYER_OPTION_TOP:"top",LAYER_OPTION_VISIBLE:"visible",LAYER_OPTION_ALL:"all"});p.setObject("tasks.IdentifyParameters",l,f);return l})},"esri/virtualearth/VEGeocoder":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/has ../kernel ../urlUtils ../tasks/Task ./VEGeocodeResult ../deferredUtils ../request".split(" "),function(t,p,x,b,m,f,d,a,c,l,h){t=t(a,{declaredClass:"esri.virtualearth.VEGeocoder",
constructor:function(n){try{if(n=p.mixin({bingMapsKey:null},n||{}),this.url=d.getProtocolForWebResource()+"//serverapi.arcgisonline.com/veadaptor/production/services/geocode/geocode",this._url=d.urlToObject(this.url),this._queue=[],this.bingMapsKey=n.bingMapsKey,this.culture=n.culture||"en-US",this._errorHandler=p.hitch(this,this._errorHandler),this._addressToLocationsHandler=p.hitch(this,this._addressToLocationsHandler),!this.bingMapsKey)throw Error("BingMapsKey must be provided.");}catch(g){throw this.onError(g),
g;}},addressToLocations:function(n,g,e){if(this.bingMapsKey){var k=p.mixin({},this._url.query,{query:n,token:this.bingMapsKey,culture:this.culture}),w=this._addressToLocationsHandler,q=this._errorHandler,u=new b(l._dfdCanceller);u._pendingDfd=h({url:this._url.path,content:k,callbackParamName:"callback",load:function(r,v){w(r,v,g,e,u)},error:function(r){q(r,e,u)}});return u}this._queue.push(arguments)},_addressToLocationsHandler:function(n,g,e,k,w){try{x.forEach(n,function(q,u){n[u]=new c(q)}),this._successHandler([n],
"onAddressToLocationsComplete",e,w)}catch(q){this._errorHandler(q,k,w)}},onAddressToLocationsComplete:function(){},setBingMapsKey:function(n){this.bingMapsKey=n},setCulture:function(n){this.culture=n}});p.setObject("virtualearth.VEGeocoder",t,f);return t})},"esri/virtualearth/VEGeocodeResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../geometry/Point ../geometry/Extent ./VEAddress".split(" "),function(t,p,x,b,m,f,d){t=t(null,{declaredClass:"esri.virtualearth.VEGeocodeResult",
constructor:function(a){p.mixin(this,{address:null,bestView:null,calculationMethod:null,confidence:null,displayName:null,entityType:null,location:null,matchCodes:null},a);this.address&&(this.address=new d(this.address));this.bestView&&(this.bestView=new f(this.bestView));this.locationArray&&(this.calculationMethod=this.locationArray[0].calculationMethod,this.location=new m(this.locationArray[0]))}});p.setObject("virtualearth.VEGeocodeResult",t,b);return t})},"esri/virtualearth/VEAddress":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","../kernel"],function(t,p,x,b){t=t(null,{declaredClass:"esri.virtualearth.VEAddress",constructor:function(m){p.mixin(this,{addressLine:null,adminDistrict:null,countryRegion:null,district:null,formattedAddress:null,locality:null,postalCode:null,postalTown:null},m)}});p.setObject("virtualearth.VEAddress",t,b);return t})},"esri/dijit/Geocoder":function(){define("require dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/_base/event dojo/dom-attr dojo/dom-class dojo/dom-style dojo/dom-construct dojo/keys dojo/on dojo/query dojo/i18n!../nls/jsapi dojo/text!./templates/Geocoder.html dojo/uacss dojo/_base/kernel dijit/a11yclick dijit/_TemplatedMixin dijit/focus dijit/_FocusMixin ../kernel ../urlUtils ../SpatialReference ../graphic ../symbols/PictureMarkerSymbol ./_EventedWidget ../geometry/Point ../geometry/Extent ../tasks/locator ../tasks/query ../tasks/QueryTask ../geometry/scaleUtils".split(" "),
function(t,p,x,b,m,f,d,a,c,l,h,n,g,e,k,w,q,u,r,v,z,B,A,y,D,G,E,F,I,M,P,W){p=p("esri.dijit.Geocoder",[G,u,v],{templateString:e,reHostedFS:/https?:\/\/services.*\.arcgis\.com/i,_eventMap:{select:["result"],"find-results":["results"],"auto-complete":["results"],"geocoder-select":["geocoder"],clear:!0,"enter-key-select":!0,load:!0},constructor:function(H,O){w.deprecated("esri.dijit.Geocoder","Use esri.dijit.Search instead","4.0");this._css={GeocoderContainerClass:"esriGeocoderContainer",GeocoderClass:"esriGeocoder",
GeocoderMultipleClass:"esriGeocoderMultiple",GeocoderIconClass:"esriGeocoderIcon",GeocoderActiveClass:"esriGeocoderActive",GeocoderResultsOpenClass:"esriGeocoderResultsOpen",GeocoderMenuOpenClass:"esriGeocoderMenuOpen",loadingClass:"esriGeocoderLoading",resultsContainerClass:"esriGeocoderResults",resultsItemClass:"esriGeocoderResult",resultsItemEvenClass:"esriGeocoderResultEven",resultsItemOddClass:"esriGeocoderResultOdd",resultsItemFirstClass:"esriGeocoderResultFirst",resultsItemLastClass:"esriGeocoderResultLast",
resultsPartialMatchClass:"esriGeocoderResultPartial",searchButtonClass:"esriGeocoderSearch",clearButtonClass:"esriGeocoderReset",hasValueClass:"esriGeocoderHasValue",geocoderMenuClass:"esriGeocoderMenu",geocoderMenuHeaderClass:"esriGeocoderMenuHeader",geocoderMenuCloseClass:"esriGeocoderMenuClose",activeMenuClass:"esriGeocoderMenuActive",geocoderMenuArrowClass:"esriGeocoderMenuArrow",geocoderSelectedClass:"esriGeocoderSelected",geocoderSelectedCheckClass:"esriGeocoderSelectedCheck",GeocoderClearClass:"esriGeocoderClearFloat"};
this.options={autoComplete:!1,arcgisGeocoder:!0,value:"",theme:"simpleGeocoder",activeGeocoderIndex:0,maxLocations:6,minCharacters:3,searchDelay:300,geocoderMenu:!0,autoNavigate:!0,showResults:!0,map:null,activeGeocoder:null,geocoders:null,zoomScale:1E4,highlightLocation:!1,symbol:new D(t.toUrl("./images/sdk_gps_location.png"),28,28),graphicsLayer:null};var K=x.mixin({},this.options,H);this.set("autoComplete",K.autoComplete);this.set("arcgisGeocoder",K.arcgisGeocoder);this.set("value",K.value);this.set("theme",
K.theme);this.set("activeGeocoderIndex",K.activeGeocoderIndex);this.set("maxLocations",K.maxLocations);this.set("minCharacters",K.minCharacters);this.set("searchDelay",K.searchDelay);this.set("geocoderMenu",K.geocoderMenu);this.set("autoNavigate",K.autoNavigate);this.set("showResults",K.showResults);this.set("map",K.map);this.set("activeGeocoder",K.activeGeocoder);this.set("geocoders",K.geocoders);this.set("zoomScale",K.zoomScale);this.set("highlightLocation",K.highlightLocation);this.set("symbol",
K.symbol);this.set("graphicsLayer",K.graphicsLayer);this.set("results",[]);this._i18n=g;this._deferreds=[];this._defaultSR=new A(4326);this.watch("value",this._updateValue);this.watch("theme",this._updateTheme);this.watch("activeGeocoder",this._setActiveGeocoder);this.watch("activeGeocoderIndex",this._setActiveGeocoderIndex);this.watch("geocoders",this._updateGeocoder);this.watch("arcgisGeocoder",this._updateGeocoder);this.watch("geocoderMenu",this._updateGeocoder);this.watch("map",this._setupEvents);
this.domNode=O},startup:function(){this.inherited(arguments);if(this._geocoders.length)if(this.domNode)if(this.get("map"))if(this.get("map").loaded)this._init();else h.once(this.get("map"),"load",x.hitch(this,function(){this._init()}));else this._init();else this.destroy();else this.destroy()},postCreate:function(){this.inherited(arguments);this.own(h(this.submitNode,q,x.hitch(this,this._findThenSelect)));this.own(h(this.geocoderMenuArrowNode,q,x.hitch(this,this._toggleGeolocatorMenu)));this.own(h(this.inputNode,
q,x.hitch(this,this._inputClick)));this.own(h(this.clearNode,q,x.hitch(this,this.clear)));this.own(h(this.geocoderMenuCloseNode,q,x.hitch(this,this._hideGeolocatorMenu)));this._updateGeocoder();this._setupEvents();this.get("value")&&this._checkStatus();this._hideMenus()},destroy:function(){this._removeEvents();c.empty(this.domNode);this.inherited(arguments)},clear:function(){this.onClear();var H=this.get("highlightGraphic"),O=this.get("graphicsLayer");H&&(O?O.remove(H):this.get("map").graphics.remove(H),
this.set("highlightGraphic",null));f.set(this.inputNode,"value","");this.set("value","");this.set("results",[]);d.remove(this.containerNode,this._css.hasValueClass);f.set(this.clearNode,"title","");this._hideMenus();this._hideLoading()},show:function(){a.set(this.domNode,"display","block")},hide:function(){a.set(this.domNode,"display","none")},find:function(H){var O=new b;if(H)if("string"===typeof H)this._findQuery(H).then(function(R){O.resolve(R)});else if("object"===typeof H&&H.hasOwnProperty("geometry")){switch(H.geometry.type){case "extent":var K=
H.geometry.getCenter();break;case "multipoint":K=H.geometry.getExtent().getCenter();break;case "point":K=H.geometry;break;case "polygon":K=H.geometry.getExtent().getCenter();break;case "polyline":K=H.geometry.getExtent().getCenter()}K&&this._reverseGeocodePoint(K,H.geometry).then(function(R){R.results[0]&&(H.hasOwnProperty("attributes")&&R.results[0].feature.setAttributes(x.mixin(R.results[0].feature.attributes,H.attributes)),H.hasOwnProperty("infoTemplate")&&R.results[0].feature.setInfoTemplate(H.infoTemplate),
H.hasOwnProperty("symbol")&&R.results[0].feature.setSymbol(H.symbol));O.resolve(R)},function(R){O.reject(R)})}else"object"===typeof H&&"point"===H.type?this._reverseGeocodePoint(H).then(function(R){O.resolve(R)},function(R){O.reject(R)}):H instanceof Array&&2===H.length?(K=new E(H,new A({wkid:4326})),this._reverseGeocodePoint(K).then(function(R){O.resolve(R)},function(R){O.reject(R)})):O.reject("Geocoder:: Invalid find type");else this._findQuery(this.get("value")).then(function(R){O.resolve(R)});
return O.promise},focus:function(){r.focus(this.inputNode);var H=this.get("map");H&&H.disableKeyboardNavigation()},blur:function(){r.curNode&&r.curNode.blur();this.inputNode.blur();this._hideMenus();var H=this.get("map");H&&H.enableKeyboardNavigation()},select:function(H){this.onSelect(H);this._hideMenus();this._hideLoading();this.get("autoNavigate")&&H&&H.hasOwnProperty("extent")&&this.get("map")&&this.get("map").setExtent(H.extent);if(H.feature){var O=this.get("highlightGraphic"),K=this.get("graphicsLayer"),
R=this.get("symbol")||H.feature.symbol;O?(O.setGeometry(H.feature.geometry),O.setAttributes(H.feature.attributes),O.setInfoTemplate(H.feature.infoTemplate),O.setSymbol(R)):(O=H.feature,this.get("highlightLocation")&&(O.setSymbol(R),K?K.add(O):this.get("map").graphics.add(O)));this.set("highlightGraphic",O)}},onSelect:function(){},onFindResults:function(){},onAutoComplete:function(){},onGeocoderSelect:function(){},onClear:function(){},onEnterKeySelect:function(){},onLoad:function(){},_onFocus:function(){this.focus();
this.inherited(arguments)},_onBlur:function(){this.blur();this.inherited(arguments)},_autoComplete:function(){var H=this.get("activeGeocoder"),O=this.reHostedFS.test(H.url);("query"!==H.type||O)&&this._query({delay:this.get("searchDelay"),autoComplete:!0,search:this.get("value")}).then(x.hitch(this,function(K){this.onAutoComplete(K);this.get("showResults")&&this._showResults(K)}))},_init:function(){this.set("loaded",!0);this.onLoad()},_containsNonLatinCharacter:function(H){for(var O=0;O<H.length;O++)if(255<
H.charCodeAt(O))return!0;return!1},_findQuery:function(H){var O=new b;this._query({delay:0,search:H}).then(x.hitch(this,function(K){this.onFindResults(K);O.resolve(K)}),x.hitch(this,function(K){this.onFindResults(K);O.reject(K)}));return O.promise},_reverseGeocodePoint:function(H,O){var K=new b;if(H&&this.get("activeGeocoder")){var R=O||H,da=this.get("activeGeocoder").distance||1500;this._task.outSpatialReference=this._defaultSR;this.get("map")&&(this._task.outSpatialReference=this.get("map").spatialReference);
this._task.locationToAddress(H,da,x.hitch(this,function(U){U={results:[this._hydrateResult(U)],geometry:R};this.onFindResults(U);K.resolve(U)}),x.hitch(this,function(U){K.reject(U)}))}else K.reject("Geocoder:: no point or active geocoder defined");return K.promise},_setEsriGeocoder:function(){this.get("arcgisGeocoder")?("object"===typeof this.get("arcgisGeocoder")?this._arcgisGeocoder=this.get("arcgisGeocoder"):this._arcgisGeocoder={},this._arcgisGeocoder.hasOwnProperty("suggest")||(this._arcgisGeocoder.suggest=
!0),this._arcgisGeocoder.hasOwnProperty("singleLineFieldName")||(this._arcgisGeocoder.singleLineFieldName="SingleLine"),this._arcgisGeocoder.url||(this._arcgisGeocoder.url=B.getProtocolForWebResource()+"//geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer"),this._arcgisGeocoder.name||(this._arcgisGeocoder.name=g.widgets.Geocoder.esriGeocoderName),this._arcgisGeocoder.hasOwnProperty("localSearchOptions")||(this._arcgisGeocoder.localSearchOptions={minScale:3E5,distance:5E4}),this.set("arcgisGeocoder",
this._arcgisGeocoder)):this.set("arcgisGeocoder",!1)},_setActiveGeocoder:function(){this.set("activeGeocoder",this._geocoders[this.get("activeGeocoderIndex")]);this._task="query"===this.activeGeocoder.type?new P(this.get("activeGeocoder").url):new I(this.get("activeGeocoder").url);this._updatePlaceholder()},_setGeocoderList:function(){var H=[];this.get("arcgisGeocoder")&&(H=H.concat([this._arcgisGeocoder]));this.get("geocoders")&&this.get("geocoders").length&&(H=H.concat(this.get("geocoders")));this._geocoders=
H},_updateGeocoder:function(){this.set("activeGeocoderIndex",0);this._setEsriGeocoder();this._setGeocoderList();this._setActiveGeocoder();this._insertGeocoderMenuItems()},_updatePlaceholder:function(){this._placeholder="";this.get("activeGeocoder")&&this.get("activeGeocoder").placeholder&&(this._placeholder=this.get("activeGeocoder").placeholder);f.set(this.inputNode,"placeholder",this._placeholder);f.set(this.submitNode,"title",this._placeholder)},_updateValue:function(H,O,K){this._ignoreUpdateValue||
(f.set(this.inputNode,"value",K),this._checkStatus())},_updateTheme:function(H,O,K){d.remove(this.domNode,O);d.add(this.domNode,K)},_setActiveGeocoderIndex:function(H,O,K){this.set("activeGeocoderIndex",K);this._setActiveGeocoder();this._hideMenus();this._insertGeocoderMenuItems();H={attr:this.get("activeGeocoder"),oldVal:O,newVal:K};this.onGeocoderSelect(H)},_clearQueryTimeout:function(){this._queryTimer&&clearTimeout(this._queryTimer)},_query:function(H){H||(H={delay:0});H.search||(H.search=this.get("value"));
var O=new b;this._deferreds.push(O);H.delay?(this._clearQueryTimeout(),this._queryTimer=setTimeout(x.hitch(this,function(){this._performTask(O,H)}),H.delay)):this._performTask(O,H);return O.promise},_performTask:function(H,O){if(O.search){this._hideGeolocatorMenu();this._showLoading();var K="";this.get("activeGeocoder").prefix&&(K+=this.get("activeGeocoder").prefix);K+=O.search;this.get("activeGeocoder").suffix&&(K+=this.get("activeGeocoder").suffix);var R=this.get("activeGeocoder").outFields;R&&
(R instanceof Array||(R=[R]));var da=this.get("maxLocations")||6,U=this.get("activeGeocoder").searchExtent,Z=this._defaultSR;this.get("map")&&(Z=this.get("map").spatialReference);if("query"===this.get("activeGeocoder").type){var L=new M;L.outSpatialReference=Z;L.returnGeometry=!0;L.num=da;U&&(L.geometry=U);da=this.get("activeGeocoder").exactMatch;U=this.get("activeGeocoder").field;Z="";this.reHostedFS.test(this.get("activeGeocoder").url)&&this._containsNonLatinCharacter(K)&&(Z="N");L.where=da?U+" \x3d "+
Z+"'"+K+"'":"UPPER("+U+") LIKE "+Z+"'%"+K.toUpperCase()+"%'";R&&(L.outFields=R);this._task.execute(L,x.hitch(this,function(T){this._receivedResults(T.features,H,O)}),x.hitch(this,function(T){this._receivedResults([],H,O)}))}else L={},this.get("activeGeocoder").categories&&(L.categories=this.get("activeGeocoder").categories),this._task.outSpatialReference=Z,this.get("map")&&this.get("activeGeocoder").localSearchOptions&&this.get("activeGeocoder").localSearchOptions.hasOwnProperty("distance")&&this.get("activeGeocoder").localSearchOptions.hasOwnProperty("minScale")&&
(Z=this.get("map").getScale(),!this.get("activeGeocoder").localSearchOptions.minScale||Z&&Z<=parseFloat(this.get("activeGeocoder").localSearchOptions.minScale))&&(L.location=this.get("map").extent.getCenter(),L.distance=this.get("activeGeocoder").localSearchOptions.distance),this.get("activeGeocoder").suggest&&O.autoComplete?(L.text=K,U&&(L.searchExtent=U),this._task.suggestLocations(L).then(x.hitch(this,function(T){this._receivedResults(T,H,O)}),x.hitch(this,function(T){this._receivedResults(T,H,
O)}))):(L.address={},L.maxLocations=da,U&&(L.searchExtent=U),this.get("activeGeocoder").sourceCountry&&(L.countryCode=this.get("activeGeocoder").sourceCountry),O.magicKey&&(L.magicKey=O.magicKey),this.get("activeGeocoder").singleLineFieldName?L.address[this.get("activeGeocoder").singleLineFieldName]=K:L.address["Single Line Input"]=K,R&&(L.outFields=R),this._task.addressToLocations(L,x.hitch(this,function(T){this._receivedResults(T,H,O)}),x.hitch(this,function(T){this._receivedResults(T,H,O)})))}else this._hideLoading(),
H.reject("Geocoder:: no search to perform")},_showResults:function(){this._hideGeolocatorMenu();var H="";if(this.get("results")&&this.get("results").length&&this.resultsNode){var O=this.get("value"),K=new RegExp("("+O+")","gi");H+='\x3cul role\x3d"presentation"\x3e';for(O=0;O<this.get("results").length&&5>O;++O){var R=this.get("results")[O].text||this.get("results")[O].name,da=this._css.resultsItemClass+" ";da=0===O%2?da+this._css.resultsItemOddClass:da+this._css.resultsItemEvenClass;0===O?da+=" "+
this._css.resultsItemFirstClass:O===this.get("results").length-1&&(da+=" "+this._css.resultsItemLastClass);H+='\x3cli title\x3d"'+R+'" data-text\x3d"'+R+'" data-item\x3d"true" data-index\x3d"'+O+'" role\x3d"menuitem" tabindex\x3d"0" class\x3d"'+da+'"\x3e'+R.replace(K,'\x3cstrong class\x3d"'+this._css.resultsPartialMatchClass+'"\x3e$1\x3c/strong\x3e')+"\x3c/li\x3e"}H+="\x3c/ul\x3e";this.resultsNode&&(this.resultsNode.innerHTML=H);this._autoCompleteEvent();this._showResultsMenu()}else this.resultsNode&&
(this.resultsNode.innerHTML=H),this._hideResultsMenu()},_receivedResults:function(H,O){this._hideLoading();var K=this._hydrateResults(H);this.set("results",K);K={results:K,value:this.get("value")};O.resolve(K)},_showLoading:function(){d.add(this.containerNode,this._css.loadingClass)},_hideLoading:function(){d.remove(this.containerNode,this._css.loadingClass)},_showGeolocatorMenu:function(){d.add(this.containerNode,this._css.activeMenuClass);d.add(this.domNode,this._css.GeocoderMenuOpenClass);a.set(this.geocoderMenuNode,
"display","block");f.set(this.geocoderMenuInsertNode,"aria-hidden","false");f.set(this.geocoderMenuArrowNode,"aria-expanded","true")},_hideGeolocatorMenu:function(){d.remove(this.containerNode,this._css.activeMenuClass);d.remove(this.domNode,this._css.GeocoderMenuOpenClass);a.set(this.geocoderMenuNode,"display","none");f.set(this.geocoderMenuInsertNode,"aria-hidden","true");f.set(this.geocoderMenuArrowNode,"aria-expanded","false")},_toggleGeolocatorMenu:function(){this._hideResultsMenu();"block"===
a.get(this.geocoderMenuNode,"display")?this._hideGeolocatorMenu():this._showGeolocatorMenu()},_showResultsMenu:function(){d.add(this.containerNode,this._css.GeocoderActiveClass);d.add(this.domNode,this._css.GeocoderResultsOpenClass);a.set(this.resultsNode,"display","block");f.set(this.resultsNode,"aria-hidden","false")},_hideResultsMenu:function(){a.set(this.resultsNode,"display","none");d.remove(this.containerNode,this._css.GeocoderActiveClass);d.remove(this.domNode,this._css.GeocoderResultsOpenClass);
f.set(this.resultsNode,"aria-hidden","true")},_hideMenus:function(){this._hideGeolocatorMenu();this._hideResultsMenu()},_insertGeocoderMenuItems:function(){if(this.get("geocoderMenu")&&this._geocoders&&1<this._geocoders.length){var H="",O;var K='\x3cul role\x3d"presentation"\x3e';for(O=0;O<this._geocoders.length;O++){H=this._css.resultsItemClass+" ";H=0===O%2?H+this._css.resultsItemOddClass:H+this._css.resultsItemEvenClass;O===this.get("activeGeocoderIndex")&&(H+=" "+this._css.geocoderSelectedClass);
0===O?H+=" "+this._css.resultsItemFirstClass:O===this._geocoders.length-1&&(H+=" "+this._css.resultsItemLastClass);var R=this._geocoders[O].name||g.widgets.Geocoder.main.untitledGeocoder;K+='\x3cli data-index\x3d"'+O+'" data-item\x3d"true" role\x3d"menuitem" tabindex\x3d"0" class\x3d"'+H+'"\x3e';K+='\x3cdiv class\x3d"'+this._css.geocoderSelectedCheckClass+'"\x3e\x3c/div\x3e';K+=R;K+='\x3cdiv class\x3d"'+this._css.GeocoderClearClass+'"\x3e\x3c/div\x3e';K+="\x3c/li\x3e"}this.geocoderMenuInsertNode.innerHTML=
K+"\x3c/ul\x3e";this._geocoderMenuEvent();a.set(this.geocoderMenuNode,"display","none");a.set(this.geocoderMenuArrowNode,"display","block");d.add(this.containerNode,this._css.GeocoderMultipleClass)}else this.geocoderMenuInsertNode.innerHTML="",a.set(this.geocoderMenuNode,"display","none"),a.set(this.geocoderMenuArrowNode,"display","none"),d.remove(this.containerNode,this._css.GeocoderMultipleClass)},_checkStatus:function(){this.get("value")?(d.add(this.containerNode,this._css.hasValueClass),f.set(this.clearNode,
"title",g.widgets.Geocoder.main.clearButtonTitle)):this.clear()},_autoCompleteEvent:function(){var H=n('[data-item\x3d"true"]',this.resultsNode);this._acEvent&&this._acEvent.remove();this._acEvent=h(H,"click, keydown",x.hitch(this,function(O){this._clearQueryTimeout();var K=parseInt(f.get(O.currentTarget,"data-index"),10),R=f.get(O.currentTarget,"data-text");"click"===O.type||"keydown"===O.type&&O.keyCode===l.ENTER?(f.set(this.inputNode,"value",R),this.set("value",R),this.get("results")&&this.get("results")[K]&&
(O=this.get("results")[K],O.name?this.select(O):this._query({delay:0,search:O.text,magicKey:O.magicKey||null}).then(x.hitch(this,function(da){this.select(da.results[0])})))):"keydown"!==O.type||O.keyCode!==l.BACKSPACE&&O.keyCode!==l.DELETE?"keydown"===O.type&&O.keyCode===l.UP_ARROW?(m.stop(O),O=K-1,0>O?this.inputNode.focus():H[O].focus()):"keydown"===O.type&&O.keyCode===l.DOWN_ARROW?(m.stop(O),O=K+1,O>=H.length?this.inputNode.focus():H[O].focus()):O.keyCode===l.ESCAPE&&this._hideMenus():(m.stop(O),
this.inputNode.focus(),O=this.inputNode.value.slice(0,-1),f.set(this.inputNode,"value",O),this.set("value",O))}))},_geocoderMenuEvent:function(){var H=n('[data-item\x3d"true"]',this.geocoderMenuInsertNode);this._gmEvent&&this._gmEvent.remove();this._gmEvent=h(H,"click, keydown",x.hitch(this,function(O){var K=parseInt(f.get(O.currentTarget,"data-index"),10);"click"===O.type||"keydown"===O.type&&O.keyCode===l.ENTER?(this._setActiveGeocoderIndex(null,null,K),this._hideGeolocatorMenu()):"keydown"===O.type&&
O.keyCode===l.UP_ARROW?(m.stop(O),O=K-1,0>O?this.geocoderMenuArrowNode.focus():H[O].focus()):"keydown"===O.type&&O.keyCode===l.DOWN_ARROW?(m.stop(O),O=K+1,O>=H.length?this.geocoderMenuArrowNode.focus():H[O].focus()):O.keyCode===l.ESCAPE&&this._hideGeolocatorMenu()}))},_removeEvents:function(){var H;if(this._events&&this._events.length)for(H=0;H<this._events.length;H++)this._events[H].remove();this._acEvent&&this._acEvent.remove();this._gmEvent&&this._gmEvent.remove();this._events=[]},_setupEvents:function(){this._removeEvents();
var H=h(document,"click",x.hitch(this,function(O){this._hideResultsMenu(O)}));this._events.push(H);H=h(this.inputNode,"keyup",x.hitch(this,function(O){this._inputKeyUp(O)}));this._events.push(H);H=h(this.inputNode,"keydown",x.hitch(this,function(O){this._inputKeyDown(O)}));this._events.push(H);H=h(this.geocoderMenuArrowNode,"keydown",this._geocoderMenuButtonKeyDown());this._events.push(H);this.get("map")&&(H=h(this.get("map"),"mouse-down",x.hitch(this,function(){this.blur()})),this._events.push(H));
this._geocoderMenuEvent();this._autoCompleteEvent()},_findThenSelect:function(){this.find().then(x.hitch(this,function(H){H.results&&H.results.length&&(this.select(H.results[0]),this.onEnterKeySelect())}))},_inputKeyUp:function(H){if(H){this._clearQueryTimeout();var O=this.inputNode.value;this._ignoreUpdateValue=!0;this.set("value",O);this._ignoreUpdateValue=!1;var K=0;O&&(K=O.length);if(H.ctrlKey||H.metaKey||H.altKey||H.keyCode===l.copyKey||H.keyCode===l.ALT||H.keyCode===l.CTRL||H.keyCode===l.META||
H.keyCode===l.SHIFT||H.keyCode===l.UP_ARROW||H.keyCode===l.DOWN_ARROW||H.keyCode===l.LEFT_ARROW||H.keyCode===l.RIGHT_ARROW)return H;H&&H.keyCode===l.ENTER?(this._cancelDeferreds(),this._findThenSelect()):H&&H.keyCode===l.ESCAPE?(this._cancelDeferreds(),this._hideMenus()):H&&H.keyCode===l.TAB?(this._cancelDeferreds(),this._hideMenus()):this.get("autoComplete")&&K>=this.get("minCharacters")?this._autoComplete():this._hideMenus();this._checkStatus()}},_cancelDeferreds:function(){if(this._deferreds.length){for(var H=
0;H<this._deferreds.length;H++)this._deferreds[H].cancel("Geocoder:: stop query");this._deferreds=[]}},_inputKeyDown:function(H){var O=n('[data-item\x3d"true"]',this.resultsNode);H&&H.keyCode===l.TAB?(this._cancelDeferreds(),this._hideMenus()):H&&H.keyCode===l.UP_ARROW?(m.stop(H),(H=O.length)&&O[H-1].focus()):H&&H.keyCode===l.DOWN_ARROW&&(m.stop(H),O[0]&&O[0].focus())},_geocoderMenuButtonKeyDown:function(H){var O=n('[data-item\x3d"true"]',this.geocoderMenuInsertNode);H&&H.keyCode===l.UP_ARROW?(m.stop(H),
this._showGeolocatorMenu(),(H=O.length)&&O[H-1].focus()):H&&H.keyCode===l.DOWN_ARROW&&(m.stop(H),this._showGeolocatorMenu(),O[0]&&O[0].focus())},_inputClick:function(){this._hideGeolocatorMenu()},_hydrateResult:function(H){var O={},K=this._defaultSR,R;this.get("map")&&(K=this.get("map").spatialReference);if(H.hasOwnProperty("text")&&H.hasOwnProperty("magicKey"))return H;if(H.hasOwnProperty("feature"))O.feature=new y(H.feature),(R=O.feature.geometry)&&R.setSpatialReference(K);else if(H.hasOwnProperty("geometry")){var da=
H.symbol||null;R=H.attributes||{};O.feature=new y(H.geometry,da,R,H.infoTemplate||null);(R=O.feature.geometry)&&R.setSpatialReference(K)}else H.hasOwnProperty("location")?(da=new E(H.location.x,H.location.y,K),R={},H.hasOwnProperty("attributes")&&(R=H.attributes),H.hasOwnProperty("score")&&(R.score=H.score),O.feature=new y(da,null,R,null)):O.feature=null;if(H.hasOwnProperty("extent"))O.extent=new F(H.extent),O.extent.setSpatialReference(new A(K));else if(O.feature&&O.feature.geometry)switch(O.feature.geometry.type){case "extent":O.extent=
O.feature.geometry;break;case "multipoint":O.extent=O.feature.geometry.getExtent();break;case "polygon":O.extent=O.feature.geometry.getExtent();break;case "polyline":O.extent=O.feature.geometry.getExtent();break;case "point":this.get("map")?this.get("map").getScale()>this.get("zoomScale")?O.extent=W.getExtentForScale(this.get("map"),this.get("zoomScale")).centerAt(O.feature.geometry):O.extent=this.get("map").extent.centerAt(O.feature.geometry):O.extent=new F({xmin:O.feature.geometry.x-.25,ymin:O.feature.geometry.y-
.25,xmax:O.feature.geometry.x+.25,ymax:O.feature.geometry.y+.25,spatialReference:{wkid:4326}})}else O.extent=null;H.hasOwnProperty("name")?O.name=H.name:"query"===this.activeGeocoder.type&&this.activeGeocoder.field&&H.hasOwnProperty("attributes")&&H.attributes.hasOwnProperty(this.activeGeocoder.field)?O.name=H.attributes[this.activeGeocoder.field]:H.hasOwnProperty("Match_addr")&&"string"===typeof H.Match_addr?O.name=H.Match_addr:H.hasOwnProperty("address")&&"object"===typeof H.address&&H.address.hasOwnProperty("Match_addr")?
O.name=H.address.Match_addr:H.hasOwnProperty("address")&&"string"===typeof H.address?O.name=H.address:H.hasOwnProperty("address")&&"object"===typeof H.address&&H.address.hasOwnProperty("Address")?O.name=H.address.Address:O.name=O.feature&&O.feature.geometry?O.feature.geometry.x+","+O.feature.geometry.y:"";return O},_hydrateResults:function(H){var O=[],K=0;if(H&&H.length)for(K;K<H.length;K++){var R=this._hydrateResult(H[K]);O.push(R)}return O}});x.setObject("dijit.Geocoder",p,z);return p})},"dojox/lang/functional":function(){define(["./functional/lambda",
"./functional/array","./functional/object"],function(t){return t})},"dojox/lang/functional/lambda":function(){define(["../..","dojo/_base/lang","dojo/_base/array"],function(t,p,x){var b=p.getObject("lang.functional",!0,t),m={},f=1<"ab".split(/a*/).length?String.prototype.split:function(c){var l=this.split.call(this,c);(c=c.exec(this))&&0==c.index&&l.unshift("");return l},d=function(c){var l=[],h=f.call(c,/\s*->\s*/m);if(1<h.length)for(;h.length;)c=h.pop(),l=h.pop().split(/\s*,\s*|\s+/m),h.length&&
h.push("(function("+l.join(", ")+"){ return ("+c+"); })");else if(c.match(/\b_\b/))l=["_"];else{h=c.match(/^\s*(?:[+*\/%&|\^\.=<>]|!=)/m);var n=c.match(/[+\-*\/%&|\^\.=<>!]\s*$/m);if(h||n)h&&(l.push("$1"),c="$1"+c),n&&(l.push("$2"),c+="$2");else{h=c.replace(/(?:\b[A-Z]|\.[a-zA-Z_$])[a-zA-Z_$\d]*|[a-zA-Z_$][a-zA-Z_$\d]*:|this|true|false|null|undefined|typeof|instanceof|in|delete|new|void|arguments|decodeURI|decodeURIComponent|encodeURI|encodeURIComponent|escape|eval|isFinite|isNaN|parseFloat|parseInt|unescape|dojo|dijit|dojox|window|document|'(?:[^'\\]|\\.)*'|"(?:[^"\\]|\\.)*"/g,
"").match(/([a-z_$][a-z_$\d]*)/gi)||[];var g={};x.forEach(h,function(e){g.hasOwnProperty(e)||(l.push(e),g[e]=1)})}}return{args:l,body:c}},a=function(c){return c.length?function(){var l=c.length-1,h=b.lambda(c[l]).apply(this,arguments);for(--l;0<=l;--l)h=b.lambda(c[l]).call(this,h);return h}:function(l){return l}};p.mixin(b,{rawLambda:function(c){return d(c)},buildLambda:function(c){c=d(c);return"function("+c.args.join(",")+"){return ("+c.body+");}"},lambda:function(c){if("function"==typeof c)return c;
if(c instanceof Array)return a(c);if(m.hasOwnProperty(c))return m[c];var l=d(c);return m[c]=new Function(l.args,"return ("+l.body+");")},clearLambdaCache:function(){m={}}});return b})},"dojox/lang/functional/array":function(){define(["dojo/_base/kernel","dojo/_base/lang","dojo/_base/array","./lambda"],function(t,p,x,b){var m={};p.mixin(b,{filter:function(f,d,a){"string"==typeof f&&(f=f.split(""));a=a||t.global;d=b.lambda(d);var c=[],l;if(p.isArray(f)){var h=0;for(l=f.length;h<l;++h){var n=f[h];d.call(a,
n,h,f)&&c.push(n)}}else if("function"==typeof f.hasNext&&"function"==typeof f.next)for(h=0;f.hasNext();)n=f.next(),d.call(a,n,h++,f)&&c.push(n);else for(h in f)h in m||(n=f[h],d.call(a,n,h,f)&&c.push(n));return c},forEach:function(f,d,a){"string"==typeof f&&(f=f.split(""));a=a||t.global;d=b.lambda(d);var c;if(p.isArray(f)){var l=0;for(c=f.length;l<c;d.call(a,f[l],l,f),++l);}else if("function"==typeof f.hasNext&&"function"==typeof f.next)for(l=0;f.hasNext();d.call(a,f.next(),l++,f));else for(l in f)l in
m||d.call(a,f[l],l,f);return a},map:function(f,d,a){"string"==typeof f&&(f=f.split(""));a=a||t.global;d=b.lambda(d);var c,l;if(p.isArray(f)){var h=Array(c=f.length);for(l=0;l<c;h[l]=d.call(a,f[l],l,f),++l);}else if("function"==typeof f.hasNext&&"function"==typeof f.next)for(h=[],l=0;f.hasNext();h.push(d.call(a,f.next(),l++,f)));else for(l in h=[],f)l in m||h.push(d.call(a,f[l],l,f));return h},every:function(f,d,a){"string"==typeof f&&(f=f.split(""));a=a||t.global;d=b.lambda(d);var c;if(p.isArray(f)){var l=
0;for(c=f.length;l<c;++l)if(!d.call(a,f[l],l,f))return!1}else if("function"==typeof f.hasNext&&"function"==typeof f.next)for(l=0;f.hasNext();){if(!d.call(a,f.next(),l++,f))return!1}else for(l in f)if(!(l in m||d.call(a,f[l],l,f)))return!1;return!0},some:function(f,d,a){"string"==typeof f&&(f=f.split(""));a=a||t.global;d=b.lambda(d);var c;if(p.isArray(f)){var l=0;for(c=f.length;l<c;++l)if(d.call(a,f[l],l,f))return!0}else if("function"==typeof f.hasNext&&"function"==typeof f.next)for(l=0;f.hasNext();){if(d.call(a,
f.next(),l++,f))return!0}else for(l in f)if(!(l in m)&&d.call(a,f[l],l,f))return!0;return!1}});return b})},"dojox/lang/functional/object":function(){define(["dojo/_base/kernel","dojo/_base/lang","./lambda"],function(t,p,x){var b={};p.mixin(x,{keys:function(m){var f=[],d;for(d in m)d in b||f.push(d);return f},values:function(m){var f=[],d;for(d in m)d in b||f.push(m[d]);return f},filterIn:function(m,f,d){d=d||t.global;f=x.lambda(f);var a={},c;for(c in m)if(!(c in b)){var l=m[c];f.call(d,l,c,m)&&(a[c]=
l)}return a},forIn:function(m,f,d){d=d||t.global;f=x.lambda(f);for(var a in m)a in b||f.call(d,m[a],a,m);return d},mapIn:function(m,f,d){d=d||t.global;f=x.lambda(f);var a={},c;for(c in m)c in b||(a[c]=f.call(d,m[c],c,m));return a}});return x})},"dojox/charting/axis2d/common":function(){define(["dojo/_base/lang","dojo/_base/window","dojo/dom-geometry","dojox/gfx","dojo/has"],function(t,p,x,b,m){var f=t.getObject("dojox.charting.axis2d.common",!0),d=function(a){a.marginLeft="0px";a.marginTop="0px";
a.marginRight="0px";a.marginBottom="0px";a.paddingLeft="0px";a.paddingTop="0px";a.paddingRight="0px";a.paddingBottom="0px";a.borderLeftWidth="0px";a.borderTopWidth="0px";a.borderRightWidth="0px";a.borderBottomWidth="0px"};return t.mixin(f,{createText:{gfx:function(a,c,l,h,n,g,e,k){return c.createText({x:l,y:h,text:g,align:n}).setFont(e).setFill(k)},html:function(a,c,l,h,n,g,e,k,w){c=p.doc.createElement("div");var q=c.style;a.getTextDir&&(c.dir=a.getTextDir(g));d(q);q.font=e;c.innerHTML=String(g).replace(/\s/g,
"\x26nbsp;");q.color=k;q.position="absolute";q.left="-10000px";p.body().appendChild(c);var u=b.normalizedLength(b.splitFontString(e).size);if(!w)if(c.getBoundingClientRect){var r=c.getBoundingClientRect();r=r.width||r.right-r.left}else r=x.getMarginBox(c).w;"rtl"==c.dir&&(l+=w?w:r);p.body().removeChild(c);q.position="relative";if(w)switch(q.width=w+"px",n){case "middle":q.textAlign="center";q.left=l-w/2+"px";break;case "end":q.textAlign="right";q.left=l-w+"px";break;default:q.left=l+"px",q.textAlign=
"left"}else switch(n){case "middle":q.left=Math.floor(l-r/2)+"px";break;case "end":q.left=Math.floor(l-r)+"px";break;default:q.left=Math.floor(l)+"px"}q.top=Math.floor(h-u)+"px";q.whiteSpace="nowrap";w=p.doc.createElement("div");q=w.style;d(q);q.width="0px";q.height="0px";w.appendChild(c);a.node.insertBefore(w,a.node.firstChild);m("dojo-bidi")&&a.htmlElementsRegistry.push([w,l,h,n,g,e,k]);return w}}})})},"esri/tasks/RouteTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../graphic ../request ../geometry/normalizeUtils ./Task ./RouteResult ./NAMessage ./NAServiceDescription".split(" "),
function(t,p,x,b,m,f,d,a,c,l,h,n){t=t([c,n],{declaredClass:"esri.tasks.RouteTask",_eventMap:{"solve-complete":["result"]},constructor:function(g){this._url.orig=this._url.path;this._url.path+="/solve";this._handler=p.hitch(this,this._handler);this.registerConnectEvents()},__msigns:[{n:"solve",c:3,a:[{i:0,p:["stops.features","barriers.features","polylineBarriers.features","polygonBarriers.features"]}],e:2}],_handler:function(g,e,k,w,q){try{var u=[],r=[],v=g.directions||[],z=g.routes?g.routes.features:
[],B=g.stops?g.stops.features:[],A=g.barriers?g.barriers.features:[],y=g.polygonBarriers?g.polygonBarriers.features:[],D=g.polylineBarriers?g.polylineBarriers.features:[],G=g.messages,E=x.forEach,F=x.indexOf,I=!0,M,P,W=g.routes&&g.routes.spatialReference||g.stops&&g.stops.spatialReference||g.barriers&&g.barriers.spatialReference||g.polygonBarriers&&g.polygonBarriers.spatialReference||g.polylineBarriers&&g.polylineBarriers.spatialReference;this._chk=g.checksum;E(v,function(K){u.push(M=K.routeName);
r[M]={directions:K}});E(z,function(K){-1===F(u,M=K.attributes.Name)&&(u.push(M),r[M]={});r[M].route=K});E(B,function(K){P=K.attributes;-1===F(u,M=P.RouteName||"esri.tasks.RouteTask.NULL_ROUTE_NAME")&&(u.push(M),r[M]={});"esri.tasks.RouteTask.NULL_ROUTE_NAME"!==M&&(I=!1);void 0===r[M].stops&&(r[M].stops=[]);r[M].stops.push(K)});0<B.length&&!0===I&&(r[u[0]].stops=r["esri.tasks.RouteTask.NULL_ROUTE_NAME"].stops,delete r["esri.tasks.RouteTask.NULL_ROUTE_NAME"],u.splice(x.indexOf(u,"esri.tasks.RouteTask.NULL_ROUTE_NAME"),
1));var H=[];E(u,function(K,R){r[K].routeName="esri.tasks.RouteTask.NULL_ROUTE_NAME"===K?null:K;r[K].spatialReference=W;H.push(new l(r[K]))});g=function(K){E(K,function(R,da){R.geometry&&(R.geometry.spatialReference=W);K[da]=new f(R)});return K};E(G,function(K,R){G[R]=new h(K)});var O={routeResults:H,barriers:g(A),polygonBarriers:g(y),polylineBarriers:g(D),messages:G};this._successHandler([O],"onSolveComplete",k,q)}catch(K){this._errorHandler(K,w,q)}},solve:function(g,e,k,w){var q=w.assembly;g=this._encode(p.mixin({},
this._url.query,{f:"json"},g.toJson(q&&q[0]),this._chk?{checksum:this._chk}:{}));var u=this._handler,r=this._errorHandler;return d({url:this._url.path,timeout:25E4,content:g,callbackParamName:"callback",load:function(v,z){u(v,z,e,k,w.dfd)},error:function(v){r(v,k,w.dfd)}})},onSolveComplete:function(){}});a._createWrappers(t);p.setObject("tasks.RouteTask",t,m);return t})},"esri/tasks/RouteResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../graphic ./DirectionsFeatureSet".split(" "),
function(t,p,x,b,m,f,d){t=t(null,{declaredClass:"esri.tasks.RouteResult",constructor:function(a){var c=a.spatialReference,l=a.route;if(a.directions){var h=[],n=[],g=[];x.forEach(a.directions.features,function(k,w){n[w]=k.compressedGeometry;h[w]=k.strings;g[w]=k.events});a.directions.strings=h;a.directions.events=g;this.directions=new d(a.directions,n)}this.routeName=a.routeName;l&&(l.geometry&&(l.geometry.spatialReference=c),this.route=new f(l));if(a.stops){var e=this.stops=[];x.forEach(a.stops,function(k,
w){k.geometry&&(k.geometry.spatialReference=c);e[k.attributes.Sequence-1]=new f(k)})}},routeName:null,directions:null,route:null,stops:null});p.setObject("tasks.RouteResult",t,m);return t})},"esri/tasks/DirectionsFeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/json ../kernel ../geometry/Extent ../geometry/Polyline ../geometry/Point ../graphic ./FeatureSet".split(" "),function(t,p,x,b,m,f,d,a,c,l,h){t=t(h,{declaredClass:"esri.tasks.DirectionsFeatureSet",
constructor:function(n,g){this.routeId=n.routeId;this.routeName=n.routeName;p.mixin(this,n.summary);this.extent=new d(this.envelope);var e=this._fromCompressedGeometry,k=this.features,w=this.extent.spatialReference,q=[];x.forEach(g,function(u,r){k[r].setGeometry(q[r]=u?e(u,w):k[r].geometry)});this.mergedGeometry=this._mergePolylinesToSinglePath(q,w);this.geometryType="esriGeometryPolyline";x.forEach(n.events,function(u,r){x.forEach(u,function(v,z){u[z]=new l(new c(v.point.x,v.point.y,w),null,{ETA:v.ETA,
strings:m.stringify(v.strings),arriveTimeUTC:v.arriveTimeUTC})});n.events[r]=u});delete this.envelope},_fromCompressedGeometry:function(n,g){var e=0,k=0,w=0,q=0,u=[],r,v=0,z=0,B=0;(r=n.match(/((\+|\-)[^\+\-\|]+|\|)/g))||(r=[]);if(0===parseInt(r[v],32)){v=2;var A=parseInt(r[v],32);v++;var y=parseInt(r[v],32);v++;if(A&1){z=x.indexOf(r,"|")+1;var D=parseInt(r[z],32);z++}if(A&2){B=x.indexOf(r,"|",z)+1;var G=parseInt(r[B],32);B++}}else y=parseInt(r[v],32),v++;for(;v<r.length&&"|"!==r[v];){A=parseInt(r[v],
32)+e;v++;e=A;var E=parseInt(r[v],32)+k;v++;k=E;A=[A/y,E/y];z&&(E=parseInt(r[z],32)+w,z++,w=E,A.push(E/D));B&&(E=parseInt(r[B],32)+q,B++,q=E,A.push(E/G));u.push(A)}e=new a({paths:[u],hasZ:0<z,hasM:0<B});e.setSpatialReference(g);return e},_mergePolylinesToSinglePath:function(n,g){var e=[],k=!1;x.forEach(n,function(u){x.forEach(u.paths,function(r){k=k||u.hasM;e=e.concat(r)})});var w=[],q=[0,0];x.forEach(e,function(u){if(u[0]!==q[0]||u[1]!==q[1])w.push(u),q=u});return new a({paths:[w],spatialReference:g,
hasM:k})}});p.setObject("tasks.DirectionsFeatureSet",t,f);return t})},"esri/tasks/NAMessage":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(t,p,x,b){t=t(null,{declaredClass:"esri.tasks.NAMessage",constructor:function(m){p.mixin(this,m)}});p.mixin(t,{TYPE_INFORMATIVE:0,TYPE_PROCESS_DEFINITION:1,TYPE_PROCESS_START:2,TYPE_PROCESS_STOP:3,TYPE_WARNING:50,TYPE_ERROR:100,TYPE_EMPTY:101,TYPE_ABORT:200});p.setObject("tasks.NAMessage",t,b);return t})},"esri/tasks/NAServiceDescription":function(){define(["dojo/_base/declare",
"dojo/json","dojo/Deferred","dojo/_base/lang","../request"],function(t,p,x,b,m){return t(null,{declaredClass:"esri.tasks._NAServiceDescription",_sd:null,getServiceDescription:function(f,d){var a=new x;if(this._sd)a.resolve(this._sd);else if(this._url&&this._url.orig){var c=this._url.orig,l=(this._url.path.match(/\/solve$/)||[]).length?"Route":(this._url.path.match(/\/solveClosestFacility$/)||[]).length?"ClosestFacility":"ServiceAreas",h,n=function(g){m({url:g+("/"===g[g.length-1]?"":"/")+"GetTravelModes/execute",
content:{f:"json",serviceName:l},callbackParamName:"callback"}).then(function(e){var k=[],w=null;if(e&&e.results&&e.results.length)for(var q=0;q<e.results.length;q++)if("supportedTravelModes"===e.results[q].paramName){if(e.results[q].value&&e.results[q].value.features)for(var u=0;u<e.results[q].value.features.length;u++)if(e.results[q].value.features[u].attributes){var r=p.parse(e.results[q].value.features[u].attributes.TravelMode);k.push(r)}}else"defaultTravelMode"===e.results[q].paramName&&(w=e.results[q].value);
h.supportedTravelModes=k;h.defaultTravelMode=w;a.resolve(h)},function(e){a.reject(e)})};m({url:c,content:{f:"json"},callbackParamName:"callback"}).then(function(g){h=g;h.supportedTravelModes||(h.supportedTravelModes=[]);for(g=0;g<h.supportedTravelModes.length;g++)h.supportedTravelModes[g].id||(h.supportedTravelModes[g].id=h.supportedTravelModes[g].itemId);d?a.resolve(h):f?n(f):10.4<=h.currentVersion?m({url:c+("/"===c[c.length-1]?"":"/")+"retrieveTravelModes",content:{f:"json"},callbackParamName:"callback"}).then(function(e){h.supportedTravelModes=
e.supportedTravelModes;h.defaultTravelMode=e.defaultTravelMode;a.resolve(h)},function(e){a.reject(e)}):m({url:c.substring(0,c.indexOf("/rest/")+6)+"info",content:{f:"json"},callbackParamName:"callback"}).then(function(e){e.owningSystemUrl?(c=e.owningSystemUrl,m({url:c+("/"===c[c.length-1]?"":"/")+"sharing/rest/portals/self",content:{f:"json"},callbackParamName:"callback"}).then(function(k){k&&k.helperServices&&k.helperServices.routingUtilities&&k.helperServices.routingUtilities.url?n(k.helperServices.routingUtilities.url):
a.resolve(h)},function(k){a.reject(k)})):a.resolve(h)},function(e){a.reject(e)})},function(g){a.reject(g)})}else a.reject("NA Task has no URL specified.");a.then(b.hitch(this,function(g){this._sd=g}),b.hitch(this,function(){this._sd=null}));return a.promise},getOwningSystemUrl:function(){var f=new x;if(this._url&&this._url.orig){var d=this._url.orig;m({url:d.substring(0,d.indexOf("/rest/")+6)+"info",content:{f:"json"},callbackParamName:"callback"}).promise.always(function(a){f.resolve(a.owningSystemUrl)})}else f.resolve(void 0);
return f.promise}})})},"esri/tasks/RouteParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../lang ../graphicsUtils ./NATypes".split(" "),function(t,p,x,b,m,f,d,a){t=t(null,{declaredClass:"esri.tasks.RouteParameters",accumulateAttributes:null,attributeParameterValues:null,barriers:null,directionsLanguage:null,directionsLengthUnits:null,directionsOutputType:null,directionsStyleName:null,directionsTimeAttribute:null,doNotLocateOnRestrictedElements:!0,
findBestSequence:null,ignoreInvalidLocations:null,impedanceAttribute:null,outputLines:"esriNAOutputLineTrueShape",outputGeometryPrecision:null,outputGeometryPrecisionUnits:null,outSpatialReference:null,overrides:null,polygonBarriers:null,polylineBarriers:null,preserveFirstStop:null,preserveLastStop:null,restrictionAttributes:null,restrictUTurns:null,returnBarriers:!1,returnDirections:!1,returnPolygonBarriers:!1,returnPolylineBarriers:!1,returnRoutes:!0,returnStops:!1,returnZ:!0,startTime:null,startTimeIsUTC:null,
timeWindowsAreUTC:null,stops:null,useHierarchy:null,useTimeWindows:null,travelMode:null,toJson:function(c){var l={returnDirections:this.returnDirections,returnRoutes:this.returnRoutes,returnZ:this.returnZ,returnStops:this.returnStops,returnBarriers:this.returnBarriers,returnPolygonBarriers:this.returnPolygonBarriers,returnPolylineBarriers:this.returnPolylineBarriers,attributeParameterValues:this.attributeParameterValues&&x.toJson(this.attributeParameterValues),outSR:this.outSpatialReference?this.outSpatialReference.wkid||
x.toJson(this.outSpatialReference.toJson()):null,outputLines:this.outputLines,overrides:this.overrides,findBestSequence:this.findBestSequence,preserveFirstStop:this.preserveFirstStop,preserveLastStop:this.preserveLastStop,useTimeWindows:this.useTimeWindows,startTime:this.startTime?this.startTime.getTime():null,startTimeIsUTC:this.startTimeIsUTC,timeWindowsAreUTC:this.timeWindowsAreUTC,accumulateAttributeNames:this.accumulateAttributes?this.accumulateAttributes.join(","):null,ignoreInvalidLocations:this.ignoreInvalidLocations,
impedanceAttributeName:this.impedanceAttribute,restrictionAttributeNames:this.restrictionAttributes?this.restrictionAttributes.join(","):null,restrictUTurns:this.restrictUTurns,useHierarchy:this.useHierarchy,directionsLanguage:this.directionsLanguage,outputGeometryPrecision:this.outputGeometryPrecision,outputGeometryPrecisionUnits:this.outputGeometryPrecisionUnits,directionsLengthUnits:a.LengthUnit[this.directionsLengthUnits],directionsTimeAttributeName:this.directionsTimeAttribute,directionsStyleName:this.directionsStyleName,
travelMode:"object"===typeof this.travelMode?x.toJson(this.travelMode):this.travelMode},h=this.stops;"esri.tasks.FeatureSet"===h.declaredClass&&0<h.features.length?l.stops=x.toJson({type:"features",features:d._encodeGraphics(h.features,c&&c["stops.features"]),doNotLocateOnRestrictedElements:this.doNotLocateOnRestrictedElements}):"esri.tasks.DataLayer"===h.declaredClass?l.stops=h:"esri.tasks.DataFile"===h.declaredClass&&(l.stops=x.toJson({type:"features",url:h.url,doNotLocateOnRestrictedElements:this.doNotLocateOnRestrictedElements}));
if(this.directionsOutputType)switch(this.directionsOutputType.toLowerCase()){case "complete":l.directionsOutputType="esriDOTComplete";break;case "complete-no-events":l.directionsOutputType="esriDOTCompleteNoEvents";break;case "instructions-only":l.directionsOutputType="esriDOTInstructionsOnly";break;case "standard":l.directionsOutputType="esriDOTStandard";break;case "summary-only":l.directionsOutputType="esriDOTSummaryOnly";break;default:l.directionsOutputType=this.directionsOutputType}h=function(n,
g){return n?"esri.tasks.FeatureSet"===n.declaredClass?0<n.features.length?x.toJson({type:"features",features:d._encodeGraphics(n.features,c&&c[g])}):null:"esri.tasks.DataLayer"===n.declaredClass?n:"esri.tasks.DataFile"===n.declaredClass?x.toJson({type:"features",url:n.url}):x.toJson(n):null};this.barriers&&(l.barriers=h(this.barriers,"barriers.features"));this.polygonBarriers&&(l.polygonBarriers=h(this.polygonBarriers,"polygonBarriers.features"));this.polylineBarriers&&(l.polylineBarriers=h(this.polylineBarriers,
"polylineBarriers.features"));return f.filter(l,function(n){if(null!==n)return!0})}});p.setObject("tasks.RouteParameters",t,m);return t})},"esri/tasks/NATypes":function(){define(["dojo/_base/lang","dojo/has","../kernel"],function(t,p,x){p={esriFeet:"esriNAUFeet",esriKilometers:"esriNAUKilometers",esriMeters:"esriNAUMeters",esriMiles:"esriNAUMiles",esriNauticalMiles:"esriNAUNauticalMiles",esriYards:"esriNAUYards"};var b={NONE:"esriNAOutputLineNone",STRAIGHT:"esriNAOutputLineStraight",TRUE_SHAPE:"esriNAOutputLineTrueShape",
TRUE_SHAPE_WITH_MEASURE:"esriNAOutputLineTrueShapeWithMeasure"},m={ALLOW_BACKTRACK:"esriNFSBAllowBacktrack",AT_DEAD_ENDS_ONLY:"esriNFSBAtDeadEndsOnly",NO_BACKTRACK:"esriNFSBNoBacktrack",AT_DEAD_ENDS_AND_INTERSECTIONS:"esriNFSBAtDeadEndsAndIntersections"},f={NONE:"esriNAOutputPolygonNone",SIMPLIFIED:"esriNAOutputPolygonSimplified",DETAILED:"esriNAOutputPolygonDetailed"},d={FROM_FACILITY:"esriNATravelDirectionFromFacility",TO_FACILITY:"esriNATravelDirectionToFacility"},a={LengthUnit:p,OutputLine:b,
UTurn:m,OutputPolygon:f,TravelDirection:d};t.setObject("tasks._NALengthUnit",p,x);t.setObject("tasks.NAOutputLine",b,x);t.setObject("tasks.NAUTurn",m,x);t.setObject("tasks.NAOutputPolygon",f,x);t.setObject("tasks.NATravelDirection",d,x);return a})},"esri/layers/wmts":function(){define(["./agscommon","./tiled","./WMTSLayer"],function(){return{}})},"esri/layers/tiled":function(){define(["./TiledMapServiceLayer","./TileInfo","./LOD","../geometry","../utils"],function(){return{}})},"esri/layers/WMTSLayer":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/sniff dojox/xml/parser ../kernel ../lang ../request ../urlUtils ../WKIDUnitConversion ../SpatialReference ../geometry/Point ../geometry/Extent ../geometry/webMercatorUtils ./TiledMapServiceLayer ./TileInfo ./WMTSLayerInfo dojo/query".split(" "),
function(t,p,x,b,m,f,d,a,c,l,h,n,g,e,k,w,q,u){p=p([w],{declaredClass:"esri.layers.WMTSLayer",copyright:null,extent:null,tileUrl:null,spatialReference:null,tileInfo:null,constructor:function(r,v){this.version="1.0.0";this.tileUrl=this._url=r;this.serviceMode="RESTful";this._parseCapabilities=x.hitch(this,this._parseCapabilities);this._getCapabilitiesError=x.hitch(this,this._getCapabilitiesError);this._formatDictionary={"image/png":".png","image/png8":".png","image/png24":".png","image/png32":".png",
"image/jpg":".jpg","image/jpeg":".jpeg","image/gif":".gif","image/bmp":".bmp","image/tiff":".tif","image/jpgpng":"","image/jpegpng":"","image/unknown":""};v||(v={});if(v.serviceMode)if("KVP"===v.serviceMode||"RESTful"===v.serviceMode)this.serviceMode=v.serviceMode;else return;this.customParameters=v.customParameters;this.customLayerParameters=v.customLayerParameters;this.layerInfo=new u;v.layerInfo&&(this.layerInfo=v.layerInfo,this._identifier=v.layerInfo.identifier,this._tileMatrixSetId=v.layerInfo.tileMatrixSet,
v.layerInfo.format&&(this.format="image/"+v.layerInfo.format),this._style=v.layerInfo.style,this.title=v.layerInfo.title,this._dimension=v.layerInfo.dimension,this._dimension2=v.layerInfo.dimension2);v.resourceInfo?(this.version=v.resourceInfo.version,v.resourceInfo.getTileUrl&&(this._url=this.tileUrl=v.resourceInfo.getTileUrl),this.copyright=v.resourceInfo.copyright,this.layerInfos=v.resourceInfo.layerInfos,this.customParameters=v.resourceInfo.customParameters||this.customParameters,this.customLayerParameters=
v.resourceInfo.customLayerParameters||this.customLayerParameters,this._parseResourceInfo(),this.loaded=!0,this.onLoad(this)):this._getCapabilities()},setActiveLayer:function(r){this.setVisibleLayer(r)},setVisibleLayer:function(r){this._setActiveLayer(r);this.refresh(!0)},setCustomParameters:function(r,v){this.customParameters=r;this.customLayerParameters=v;this.refresh(!0)},getTileUrl:function(r,v,z){r=this._levelToLevelValue[r];r=this.resourceUrls&&0<this.resourceUrls.length?this.resourceUrls[v%
this.resourceUrls.length].template.replace(/\{Style\}/gi,this._style).replace(/\{TileMatrixSet\}/gi,this._tileMatrixSetId).replace(/\{TileMatrix\}/gi,r).replace(/\{TileRow\}/gi,v).replace(/\{TileCol\}/gi,z).replace(/\{dimensionValue\}/gi,this._dimension).replace(/\{dimensionValue2\}/gi,this._dimension2):this.UrlTemplate.replace(/\{level\}/gi,r).replace(/\{row\}/gi,v).replace(/\{col\}/gi,z);r=this._appendCustomLayerParameters(r);r=this.addTimestampToURL(r);return l.addProxy(r)},getTileUrlTemplate:function(r){var v=
r.identifier,z=r.tileMatrixSet,B=r.format,A=r.style,y=r.dimension,D=r.dimension2;v?r=b.filter(this.layers,function(E){return E.identifier===v})[0]:(r=this.layers[0],v=this.layers[0].identifier);if(r){if(!B)B=r.formats[0];else if(!(-1===B.indexOf("image/")&&-1<b.indexOf(r.formats,B))&&(-1===B.indexOf("image/")&&(B="image/"+B),-1===b.indexOf(r.formats,B))){this.onError(Error("The layer doesn't support the format of "+B));return}if(!A)A=r.styles[0];else if(-1===b.indexOf(r.styles,A)){this.onError(Error("The layer doesn't support the style of "+
A));return}if(!y&&r.dimensions)y=r.dimensions[0];else if(-1===b.indexOf(r.dimensions,y)){this.onError(Error("The layer doesn't support the dimension of "+y));return}if(!D&&r.dimensions2)D=r.dimensions2[0];else if(-1===b.indexOf(r.dimensions2,D)){this.onError(Error("The layer doesn't support the dimension of "+D));return}if(z){var G=b.filter(r.tileMatrixSetInfos,function(E){return E.tileMatrixSet===z})[0];if(!G){this.onError(Error("The tileMatrixSetId "+z+" is not supported by the layer of "+v));return}}else(G=
b.filter(r.tileMatrixSetInfos,function(E){return"GoogleMapsCompatible"===E.tileMatrixSet})[0])||(G=r.tileMatrixSetInfos[0]),z=G.tileMatrixSet;return this._getTileUrlTemplate(v,z,B,A,y,D)}this.onError(Error("couldn't find the layer "+v))},_getTileUrlTemplate:function(r,v,z,B,A,y){r||(r=this._identifier);v||(v=this._tileMatrixSetId);z||(z=this.format);B||""===B||(B=this._style);if(this.resourceUrls&&0<this.resourceUrls.length){var D=this.resourceUrls[0].template;D.indexOf(".xxx")===D.length-4&&(D=D.slice(0,
D.length-4));D=D.replace(/\{Style\}/gi,B);D=D.replace(/\{TileMatrixSet\}/gi,v);D=D.replace(/\{TileMatrix\}/gi,"{level}");D=D.replace(/\{TileRow\}/gi,"{row}");D=D.replace(/\{TileCol\}/gi,"{col}");D=D.replace(/\{dimensionValue\}/gi,A);return D=D.replace(/\{dimensionValue2\}/gi,y)}"KVP"===this.serviceMode?D=this._url+"SERVICE\x3dWMTS\x26VERSION\x3d"+this.version+"\x26REQUEST\x3dGetTile\x26LAYER\x3d"+r+"\x26STYLE\x3d"+B+"\x26FORMAT\x3d"+z+"\x26TILEMATRIXSET\x3d"+v+"\x26TILEMATRIX\x3d{level}\x26TILEROW\x3d{row}\x26TILECOL\x3d{col}":
"RESTful"===this.serviceMode&&(A="",this._formatDictionary[z.toLowerCase()]&&(A=this._formatDictionary[z.toLowerCase()]),D=this._url+r+"/"+B+"/"+v+"/{level}/{row}/{col}"+A);return D},_parseResourceInfo:function(){var r=this.layerInfos,v;"KVP"===this.serviceMode&&(this._url+=-1<this._url.indexOf("?")?"":"?");for(v=0;v<r.length;v++)if(!(this._identifier&&r[v].identifier!==this._identifier||this.title&&r[v].title!==this.title||this._tileMatrixSetId&&r[v].tileMatrixSet!==this._tileMatrixSetId||this.format&&
"image/"+r[v].format!==this.format||this._style&&r[v].style!==this._style)){x.mixin(this,{description:r[v].description,tileInfo:r[v].tileInfo,spatialReference:r[v].tileInfo.spatialReference,fullExtent:r[v].fullExtent,initialExtent:r[v].initialExtent,_identifier:r[v].identifier,_tileMatrixSetId:r[v].tileMatrixSet,format:"image/"+r[v].format,_style:r[v].style});break}for(v=0;v<r.length;v++){var z=r[v].tileInfo;96!==z.dpi&&(b.forEach(z.lods,function(B){B.scale=96*B.scale/z.dpi}),z.dpi=96);b.forEach(z.lods,
function(B){B.resolution=this._getResolution(z.spatialReference.wkid,90.71428571428571*B.scale/96,r[v].tileMatrixSet)},this)}this._setActiveLayer();this.UrlTemplate=this._getTileUrlTemplate();this._levelToLevelValue=[];b.forEach(this.tileInfo.lods,function(B){this._levelToLevelValue[B.level]=B.levelValue?B.levelValue:B.level},this)},_getCapabilities:function(){var r;"KVP"===this.serviceMode?r=-1<this._url.indexOf("?")?this._url+"\x26request\x3dGetCapabilities\x26service\x3dWMTS\x26version\x3d"+this.version:
this._url+"?request\x3dGetCapabilities\x26service\x3dWMTS\x26version\x3d"+this.version:"RESTful"===this.serviceMode&&(r=this._url+"/"+this.version+"/WMTSCapabilities.xml");r=this._appendCustomParameters(r);c({url:r,handleAs:"text",load:this._parseCapabilities,error:this._getCapabilitiesError})},_parseCapabilities:function(r){r=r.replace(/ows:/gi,"");r=f.parse(r);var v=t.query("Contents",r)[0];if(v){var z=t.query("OperationsMetadata",r)[0],B=t.query("[name\x3d'GetTile']",z)[0];z=this._url;B=t.query("Get",
B);var A,y=!1;for(A=0;A<B.length;A++){var D=t.query("Constraint",B[A])[0];if(!D||this._getTagWithChildTagValue("AllowedValues","Value",this.serviceMode,D)){z=B[A].attributes[0].nodeValue;y=!0;break}else if(!D||this._getTagWithChildTagValue("AllowedValues","Value","RESTful",D))var G=B[A].attributes[0].nodeValue;else if(!D||this._getTagWithChildTagValue("AllowedValues","Value","KVP",D))var E=B[A].attributes[0].nodeValue}y||("KVP"===this.serviceMode&&G?(z=G,this.serviceMode="RESTful"):"RESTful"===this.serviceMode&&
E&&(z=E,this.serviceMode="KVP"));-1===z.indexOf("/1.0.0/")&&"RESTful"===this.serviceMode&&(z+="/");"KVP"===this.serviceMode&&(z+=-1<z.indexOf("?")?"":"?");this._url=z;this.copyright=this._getTagValues("Capabilities\x3eServiceIdentification\x3eAccessConstraints",r)[0];G=t.query("Layer",v);var F,I=[];this.layers=[];b.forEach(G,function(M){F=this._getTagValues("Identifier",M)[0];I.push(F);this.layers.push(this._getWMTSLayerInfo(F,M,v))},this);this._setActiveLayer();this.loaded=!0;this.onLoad(this)}else this.onError(Error("The WMTS capabilities XML is not valid"))},
_setActiveLayer:function(r){r||(r={});r.identifier&&(this._identifier=r.identifier);r.tileMatrixSet&&(this._tileMatrixSetId=r.tileMatrixSet);r.format&&(this.format=r.format);r.style&&(this._style=r.style);r.dimension&&(this._dimension=r.dimension);r.dimension2&&(this._dimension2=r.dimension2);if(this.layers)if(this._identifier?r=b.filter(this.layers,function(z){return z.identifier===this._identifier},this)[0]:(r=this.layers[0],this._identifier=this.layers[0].identifier),r){if(this.format){if(-1===
this.format.indexOf("image/")&&(this.format="image/"+this.format),-1===b.indexOf(r.formats,this.format)){this.onError(Error("The layer doesn't support the format of "+this.format));return}}else this.format=r.formats[0],-1===this.format.indexOf("image/")&&(this.format="image/"+this.format);if(!this._style)this._style=r.styles[0];else if(-1===b.indexOf(r.styles,this._style)){this.onError(Error("The layer doesn't support the style of "+this._style));return}if(!this._dimension&&r.dimensions)this._dimension=
r.dimensions[0];else if(-1===b.indexOf(r.dimensions,this._dimension)){this.onError(Error("The layer doesn't support the dimension of "+this._dimension));return}if(!this._dimension2&&r.dimensions2)this._dimension2=r.dimensions2[0];else if(-1===b.indexOf(r.dimensions2,this._dimension2)){this.onError(Error("The layer doesn't support the dimension of "+this._dimension2));return}if(this._tileMatrixSetId){var v=b.filter(r.tileMatrixSetInfos,function(z){return z.tileMatrixSet===this._tileMatrixSetId},this)[0];
if(!v){this.onError(Error("The tileMatrixSetId "+this._tileMatrixSetId+" is not supported by the layer of "+this._identifier));return}}else(v=b.filter(r.tileMatrixSetInfos,function(z){return"GoogleMapsCompatible"===z.tileMatrixSet})[0])||(v=r.tileMatrixSetInfos[0]),this._tileMatrixSetId=v.tileMatrixSet;this.description=r.description;this.title=r.title;this.spatialReference=v.tileInfo.spatialReference;this.tileInfo=v.tileInfo;this._levelToLevelValue=[];b.forEach(this.tileInfo.lods,function(z){this._levelToLevelValue[z.level]=
z.levelValue?z.levelValue:z.level},this);102100===this.spatialReference.wkid||102113===this.spatialReference.wkid?this.fullExtent=this.initialExtent=k.geographicToWebMercator(r.gcsExtent):4326===this.spatialReference.wkid?this.fullExtent=this.initialExtent=r.gcsExtent:(this.fullExtent=v.fullExtent,this.initialExtent=v.initialExtent);this.resourceUrls=r.resourceUrls;this.UrlTemplate=this._getTileUrlTemplate();this.layerInfo={identifier:this._identifier,tileMatrixSet:this._tileMatrixSetId,format:this.format,
style:this._style,fullExtent:this.fullExtent,initialExtent:this.initialExtent,tileInfo:this.tileInfo,title:this.title,description:this.description}}else this.onError(Error("couldn't find the layer "+this._identifier))},_getWMTSLayerInfo:function(r,v,z){var B=this._getTagValues("Abstract",v)[0],A=this._getTagValues("Title",v)[0],y=t.query("WGS84BoundingBox",v)[0],D=y?this._getTagValues("LowerCorner",y)[0].split(" "):["-180","-90"],G=y?this._getTagValues("UpperCorner",y)[0].split(" "):["180","90"];
y=parseFloat(D[0]);D=parseFloat(D[1]);var E=parseFloat(G[0]);G=parseFloat(G[1]);y=new e(y,D,E,G,new n({wkid:4326}));G=this._getTagValues("Identifier",t.query("Style",v)[0]);var F=this._getTagValues("Identifier",t.query("Dimension",v)[0]),I=this._getTagValues("Default",t.query("Dimension",v)[0])||this._getTagValues("Value",t.query("Dimension",v)[0]),M=1<t.query("Dimension",v).length?this._getTagValues("Identifier",t.query("Dimension",v)[1]):[],P=1<t.query("Dimension",v).length?this._getTagValues("Default",
t.query("Dimension",v)[1])||this._getTagValues("Value",t.query("Dimension",v)[1]):[];D=this._getTagValues("Format",v);z=this._getLayerMatrixInfos(v,z);r={identifier:r,tileMatrixSetInfos:z,formats:D,styles:G,title:A,description:B,gcsExtent:y,dimensions:I,dimensions2:P};v=t.query("ResourceURL",v);var W=[],H;b.forEach(v,function(O){H=O.getAttribute("template");if(F&&I&&F[0]&&I[0])if(-1<H.indexOf("{"+F+"}"))H=H.replace("{"+F+"}","{dimensionValue}");else{var K=H.toLowerCase().indexOf("{"+F[0].toLowerCase()+
"}");-1<K&&(H=H.substring(0,K)+"{dimensionValue}"+H.substring(K+F[0].length+2))}M&&P&&M[0]&&P[0]&&(-1<H.indexOf("{"+M+"}")?H=H.replace("{"+M+"}","{dimensionValue2}"):(K=H.toLowerCase().indexOf("{"+M[0].toLowerCase()+"}"),-1<K&&(H=H.substring(0,K)+"{dimensionValue2}"+H.substring(K+M[0].length+2))));W.push({template:H,format:O.getAttribute("format"),resourceType:O.getAttribute("resourceType")})});W&&0<W.length&&(r.resourceUrls=W);return r},_getLayerMatrixInfos:function(r,v){var z=[],B=this._getTagValues("TileMatrixSet",
r);if(B&&0!==B.length)return b.forEach(B,function(A){A=this._getLayerMatrixInfo(A,r,v);z.push(A)},this),z},_getLayerMatrixInfo:function(r,v,z){var B=[];v=this._getTagWithChildTagValue("TileMatrixSetLink","TileMatrixSet",r,v);var A=this._getTagValues("TileMatrix",v),y=this._getTagWithChildTagValue("TileMatrixSet","Identifier",r,z),D=this._getTagValues("SupportedCRS",y)[0];var G=parseInt(D.split(":").pop(),10);if(900913==G||3857==G)G=102100;if(-1<D.toLowerCase().indexOf("crs84")||-1<D.toLowerCase().indexOf("crs:84")){G=
4326;var E=!0}else if(-1<D.toLowerCase().indexOf("crs83")||-1<D.toLowerCase().indexOf("crs:83"))G=4269,E=!0;else if(-1<D.toLowerCase().indexOf("crs27")||-1<D.toLowerCase().indexOf("crs:27"))G=4267,E=!0;var F=new n({wkid:G}),I=t.query("TileMatrix",y)[0];z=parseInt(this._getTagValues("TileWidth",I)[0],10);v=parseInt(this._getTagValues("TileHeight",I)[0],10);var M=this._getTagValues("TopLeftCorner",I)[0].split(" ");var P=M[0],W=M[1];1<P.split("E").length&&(M=P.split("E"),P=M[0]*Math.pow(10,M[1]));1<
W.split("E").length&&(M=W.split("E"),W=M[0]*Math.pow(10,M[1]));P=parseFloat(P);W=parseFloat(W);var H=E&&4326===G&&90===P&&-180===W;for(M=0;M<this._flippingAxisForWkids.length;M++)if(D.split(":").pop()>=this._flippingAxisForWkids[M][0]&&D.split(":").pop()<=this._flippingAxisForWkids[M][1]||4326===G&&(!E||H)){4326===G&&90<P&&(P="90");var O=new g(W,P,F);break}M===this._flippingAxisForWkids.length&&(O=new g(P,W,F));if(0===A.length)for(A=t.query("TileMatrix",y),M=0;M<A.length;M++)E=this._getLodFromTileMatrix(A[M],
G,M,r),B.push(E);else for(M=0;M<A.length;M++)E=this._getTagWithChildTagValue("TileMatrix","Identifier",A[M],y),E=this._getLodFromTileMatrix(E,G,M,r),B.push(E);G=t.query("BoundingBox",y)[0];if(G){var K=this._getTagValues("LowerCorner",G)[0].split(" ");var R=this._getTagValues("UpperCorner",G)[0].split(" ")}K&&1<K.length&&R&&1<R.length?(I=parseFloat(K[0]),G=parseFloat(K[1]),K=parseFloat(R[0]),R=parseFloat(R[1])):(K=this._getTagValues("MatrixWidth",I)[0],G=this._getTagValues("MatrixHeight",I)[0],I=O.x,
R=O.y,K=I+K*v*B[0].resolution,G=R-G*z*B[0].resolution);R=K=new e(I,G,K,R,F);O=new q({dpi:96,spatialReference:F,format:this.format,rows:z,cols:v,origin:O,lods:B});return{tileMatrixSet:r,fullExtent:R,initialExtent:K,tileInfo:O}},_getCapabilitiesError:function(r){this.onError(r)},_getLodFromTileMatrix:function(r,v,z,B){var A=this._getTagValues("Identifier",r)[0];r=this._getTagValues("ScaleDenominator",r)[0];1<r.split("E").length?(r=r.split("E"),r=r[0]*Math.pow(10,r[1])):r=parseFloat(r);v=this._getResolution(v,
r,B);return{level:z,levelValue:A,scale:1.058267716535433*r,resolution:v}},_getResolution:function(r,v,z){r=a.isDefined(h[r])?h.values[h[r]]:"default028mm"===z?6370997*Math.PI/180:6378137*Math.PI/180;return 7*v/25E3/r},_getTag:function(r,v){var z=t.query(r,v);return z&&0<z.length?z[0]:null},_getTagValues:function(r,v){var z=[],B=r.split("\x3e"),A;var y=t.query(B[0],v)[0];if(1<B.length){for(A=1;A<B.length-1;A++)y=t.query(B[A],y)[0];B=t.query(B[B.length-1],y)}else B=t.query(B[0],v);B&&0<B.length&&b.forEach(B,
function(D){9>m("ie")?z.push(D.childNodes.length?D.childNodes[0].nodeValue:""):z.push(D.textContent)});return z},_getAttributeValues:function(r,v,z){r=t.query(r,z);var B=[];r&&0<r.length&&b.forEach(r,function(A){B.push(A.getAttribute(v))});return B},_getTagWithChildTagValue:function(r,v,z,B){B=B.childNodes;var A;for(A=0;A<B.length;A++)if(-1<B[A].nodeName.indexOf(r)){if(9>m("ie")){if(a.isDefined(t.query(v,B[A])[0]))var y=t.query(v,B[A])[0].childNodes[0].nodeValue}else a.isDefined(t.query(v,B[A])[0])&&
(y=t.query(v,B[A])[0].textContent);if(y===z||z.split(":")&&y===z.split(":")[1])return B[A]}},_appendCustomParameters:function(r){var v;if(this.customParameters)for(v in this.customParameters)r+=(-1===r.indexOf("?")?"?":"\x26")+v+"\x3d"+encodeURIComponent(this.customParameters[v]);return r},_appendCustomLayerParameters:function(r){var v;if(this.customLayerParameters||this.customParameters){var z=x.clone(this.customParameters||{});x.mixin(z,this.customLayerParameters||{});for(v in z)r+=(-1===r.indexOf("?")?
"?":"\x26")+v+"\x3d"+encodeURIComponent(z[v])}return r},_flippingAxisForWkids:[[3819,3819],[3821,3824],[3889,3889],[3906,3906],[4001,4025],[4027,4036],[4039,4047],[4052,4055],[4074,4075],[4080,4081],[4120,4176],[4178,4185],[4188,4216],[4218,4289],[4291,4304],[4306,4319],[4322,4326],[4463,4463],[4470,4470],[4475,4475],[4483,4483],[4490,4490],[4555,4558],[4600,4646],[4657,4765],[4801,4811],[4813,4821],[4823,4824],[4901,4904],[5013,5013],[5132,5132],[5228,5229],[5233,5233],[5246,5246],[5252,5252],[5264,
5264],[5324,5340],[5354,5354],[5360,5360],[5365,5365],[5370,5373],[5381,5381],[5393,5393],[5451,5451],[5464,5464],[5467,5467],[5489,5489],[5524,5524],[5527,5527],[5546,5546],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3038,3051],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3150,3151],[3300,3301],[3328,
3335],[3346,3346],[3350,3352],[3366,3366],[3389,3390],[3416,3417],[3833,3841],[3844,3850],[3854,3854],[3873,3885],[3907,3910],[4026,4026],[4037,4038],[4417,4417],[4434,4434],[4491,4554],[4839,4839],[5048,5048],[5105,5130],[5253,5259],[5269,5275],[5343,5349],[5479,5482],[5518,5519],[5520,5520],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],
[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]]});x.setObject("layers.WMTSLayer",p,d);return p})},"esri/layers/WMTSLayerInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(t,p,x,b){t=t(null,{declaredClass:"esri.layers.WMTSLayerInfo",identifier:null,tileMatrixSet:null,format:null,style:null,tileInfo:null,title:null,fullExtent:null,initialExtent:null,description:null,dimension:null,constructor:function(m){m&&(this.title=m.title,this.tileMatrixSet=
m.tileMatrixSet,this.format=m.format,this.style=m.style,this.tileInfo=m.tileInfo,this.fullExtent=m.fullExtent,this.initialExtent=m.initialExtent,this.identifier=m.identifier,this.description=m.description,this.dimension=m.dimension)}});p.setObject("layers.WMTSLayerInfo",t,b);return t})},"esri/dijit/Directions":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/kernel dojo/_base/array dojo/_base/Color dijit/a11yclick dijit/_TemplatedMixin dijit/form/Select dijit/form/ValidationTextBox dijit/form/DateTextBox dijit/form/TimeTextBox dojo/store/Memory dojo/data/ObjectStore dojo/keys dojo/has dojo/on dojo/mouse dojo/dom dojo/dom-geometry dojo/dom-style dojo/dom-class dojo/dom-attr dojo/query dojo/number dojo/i18n!../nls/jsapi dojo/text!./templates/Directions.html ./Search dojo/dom-construct dojo/promise/all dojo/Deferred dojo/dnd/Source dojo/json ../kernel ../urlUtils ../graphic ../units ../TimeExtent ../InfoTemplate ../SpatialReference ../layers/ArcGISDynamicMapServiceLayer ../layers/GraphicsLayer ../geometry/webMercatorUtils ../geometry/geodesicUtils ../arcgis/utils ../geometry/Point ../geometry/Extent ../geometry/Polyline ../geometry/mathUtils ../symbols/SimpleMarkerSymbol ../symbols/PictureMarkerSymbol ../symbols/CartographicLineSymbol ../symbols/TextSymbol ../renderers/UniqueValueRenderer ../symbols/Font ./_EventedWidget ../tasks/FeatureSet ../tasks/RouteTask ../tasks/RouteParameters ../tasks/GeometryService ../tasks/DistanceParameters ../tasks/PrintTask ../tasks/PrintParameters ../tasks/PrintTemplate ../toolbars/edit ../toolbars/draw ../config ../tasks/ProjectParameters dojo/uacss".split(" "),
function(t,p,x,b,m,f,d,a,c,l,h,n,g,e,k,w,q,u,r,v,z,B,A,y,D,G,E,F,I,M,P,W,H,O,K,R,da,U,Z,L,T,Y,ca,Q,X,ha,ja,aa,la,oa,wa,za,Fa,Ba,Ca,va,Va,Sa,Ra,Ta,Wa,La,$a,ya,Xa,bb,cb,ab){var Ua=K.getProtocolForWebResource(),db=F.createSubclass({_setSourcesAttr:function(C){C&&(C=C.map(function(J){J.locator&&null==J.locationType&&(J=x.mixin({locationType:"street"},J));return J}));this.inherited(arguments,[C])}});p=p("esri.dijit.Directions",[va,a],{templateString:E,mapClickActive:!1,barrierToolActive:!1,_eventMap:{activate:!0,
deactivate:!1,load:!0,"directions-start":!0,"directions-finish":["result"],"directions-clear":!0,"segment-select":["graphic"],"segment-highlight":["graphic"],error:["error"],"stops-update":["stops"],"route-item-created":!0,"route-item-updated":!0,"feature-collection-created":!0},_emptyStop:{name:""},constructor:function(C,J){if(!C.map)throw Error('Required "map" parameter is missing. Cannot instantiate Directions Widget.');if(!J)throw Error('Required "srcNodeRef" parameter is missing. Cannot instantiate Directions Widget.');
this._i18n=G;this._css={widgetContainerClass:"esriDirectionsContainer",searchSourceContainerClass:"esriSearchSourceContainer",stopsContainerClass:"esriStopsContainer",stopsTableContainerClass:"esriStopsTableContainer",stopsTableCoverClass:"esriStopsTableCover",reverseStopsClass:"esriStopsReverse",addStopsClass:"esriStopsAdd",stopsClass:"esriStops",stopsRemovableClass:"esriStopsRemovable",stopsButtonContainerClass:"esriStopsButtons",stopsOptionsButtonClass:"esriStopsOptionsButton",stopsAddDestinationClass:"esriStopsAddDestination",
stopsAddDestinationBtnClass:"esriStopsAddDestinationBtn",stopsGetDirectionsContainerClass:"esriStopsGetDirectionsContainer",stopsGetDirectionsClass:"esriStopsGetDirections",stopsClearDirectionsClass:"esriStopsClearDirections",stopsInnerGeocoderClass:"esriInnerGeocoder",stopsOptionsOptionsEnabledClass:"esriStopsOptionsEnabled",stopsOptionsMenuClass:"esriStopsOptionsMenu",stopsFindOptimalOrderClass:"esriFindOptimalOrderOption",stopsUseTrafficClass:"esriUseTrafficOption",stopsReturnToStartClass:"esriReturnToStartOption",
stopsOptionsCheckboxesClass:"esriOptionsCheckboxes",stopsOptionsToggleContainerClass:"esriOptionsToggleContainer",stopsOptionsUnitsContainerClass:"esriOptionsUnitsContainer",stopsOptionsUnitsMiClass:"esriOptionsUnitsMi",stopsOptionsUnitsKmClass:"esriOptionsUnitsKm",stopsOptionsImpedanceContainerClass:"esriOptionsImpedanceContainer",stopsOptionsImpedanceTimeClass:"esriOptionsImpedanceTime",stopsOptionsImpedanceDistanceClass:"esriOptionsImpedanceDistance",stopClass:"esriStop",stopOriginClass:"esriStopOrigin",
stopDestinationClass:"esriStopDestination",stopUnreachedFirstOrLastClass:"esriStopUnreachedFirstOrLast",stopUnreachedClass:"esriStopUnreached",esriStopGeocoderColumnClass:"esriStopGeocoderColumn",esriStopReverseColumnClass:"esriStopReverseColumn",stopDnDHandleClass:"esriStopDnDHandle",stopDnDHandleClassHidden:"esriStopDnDHandleHidden",stopIconColumnClass:"esriStopIconColumn",stopIconClass:"esriStopIcon",stopIconRemoveColumnClass:"esriStopIconRemoveColumn",stopIconRemoveClass:"esriStopIconRemove",
stopIconRemoveClassHidden:"esriStopIconRemoveHidden",resultsContainerClass:"esriResultsContainer",resultsLoadingClass:"esriResultsLoading",resultsPrintClass:"esriResultsPrint",resultsSaveClass:"esriResultsSave",resultsSummaryClass:"esriResultsSummary",routesContainerClass:"esriRoutesContainer",routesClass:"esriRoutes",routesErrorClass:"esriRoutesError",routesInfoClass:"esriRoutesInfo",routeClass:"esriRoute",routeTextColumnClass:"esriRouteTextColumn",routeTextClass:"esriRouteText",routeLengthClass:"esriRouteLength",
routeOriginClass:"esriDMTStopOrigin",routeDestinationClass:"esriDMTStopDestination",routeInfoClass:"esriRouteInfo",routeIconColumnClass:"esriRouteIconColumn",routeIconClass:"esriRouteIcon",infoWindowRouteClass:"esriInfoWindowRoute",routeZoomClass:"esriRouteZoom",esriPrintPageClass:"esriPrintPage",esriPrintBarClass:"esriPrintBar",esriPrintButtonClass:"esriPrintButton",esriCloseButtonClass:"esriCloseButton",esriPrintMainClass:"esriPrintMain",esriPrintHeaderClass:"esriPrintHeader",esriPrintLogoClass:"esriPrintLogo",
esriPrintMapClass:"esriPrintMap",esriPrintNameClass:"esriPrintName",esriPrintNotesClass:"esriPrintNotes",esriPrintLengthClass:"esriPrintLength",esriPrintDirectionsClass:"esriPrintDirections",esriPrintStopLabelClass:"esriPrintStopLabel",clearClass:"esriClear",dndDragBodyClass:"esriDndDragDirection",stopsButtonClass:"esriDirectionsButton",stopsButtonTabClass:"esriDirectionsTabButton",stopsButtonTabLastClass:"esriDirectionsTabLastButton",stopsPressedButtonClass:"esriDirectionsPressedButton",linkButtonClass:"esriLinkButton",
activateButtonClass:"esriActivateButton",lineBarrierButtonClass:"esriLineBarrierButton",travelModesContainerClass:"esriTravelModesContainer"};this.options={map:null,autoSolve:!0,minStops:2,maxStops:20,theme:"simpleDirections",alphabet:"1234567890",directions:null,returnToStart:!1,optimalRoute:!1,routeTaskUrl:Ua+"//route.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",printTaskUrl:Ua+"//utility.arcgisonline.com/arcgis/rest/services/Utilities/PrintingTools/GPServer/Export%20Web%20Map%20Task",
geometryTaskUrl:Ua+"//utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",routeParams:{},stops:["",""],searchOptions:{},stopsInfoTemplate:new Z(G.widgets.directions.stop,"${address}${error}"),waypointInfoTemplate:new Z(G.widgets.directions.maneuver,G.widgets.directions.waypoint),segmentInfoTemplate:new Z(G.widgets.directions.maneuver,'\x3cdiv class\x3d"${maneuverType}"\x3e\x3cdiv class\x3d"'+this._css.routeIconClass+" "+this._css.infoWindowRouteClass+'"\x3e\x3cstrong\x3e${step}.\x3c/strong\x3e ${formattedText}\x3c/div\x3e\x3c/div\x3e'),
textSymbolFont:new Ca("11px",Ca.STYLE_NORMAL,Ca.VARIANT_NORMAL,Ca.WEIGHT_NORMAL,"Arial, Helvetica, sans-serif"),textSymbolColor:new f([255,255,255]),textSymbolOffset:{x:0,y:10.875},fromSymbol:(new wa({url:t.toUrl("./images/Directions/greenPoint.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),fromSymbolDrag:(new wa({url:t.toUrl("./images/Directions/greenPointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),stopSymbol:(new wa({url:t.toUrl("./images/Directions/bluePoint.png"),
height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),stopSymbolDrag:(new wa({url:t.toUrl("./images/Directions/bluePointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),toSymbol:(new wa({url:t.toUrl("./images/Directions/redPoint.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),toSymbolDrag:(new wa({url:t.toUrl("./images/Directions/redPointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),unreachedSymbol:(new wa({url:t.toUrl("./images/Directions/grayPoint.png"),
height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),unreachedSymbolDrag:(new wa({url:t.toUrl("./images/Directions/grayPointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),waypointSymbol:new oa({color:[255,255,255,255],size:10,type:"esriSMS",style:"esriSMSCircle",outline:{color:[20,89,127,255],width:2.5,type:"esriSLS",style:"esriSLSSolid"}}),maneuverSymbol:new oa({color:[255,255,255,255],size:4,type:"esriSMS",style:"esriSMSCircle",outline:{color:[30,99,137,255],
width:1,type:"esriSLS",style:"esriSLSSolid"}}),routeSymbol:(new za).setColor(new f([20,89,127,.75])).setWidth(10).setCap(za.CAP_ROUND).setJoin(za.JOIN_ROUND),segmentSymbol:(new za).setColor(new f([255,255,255,1])).setWidth(6).setCap(za.CAP_ROUND).setJoin(za.JOIN_ROUND),barrierRenderer:new Ba({type:"uniqueValue",field1:"BarrierType",defaultSymbol:{type:"esriPMS",imageData:"PHN2ZyB3aWR0aD0iMjIyIiBoZWlnaHQ9IjIyMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGc+CjxlbGxpcHNlIGZpbGw9IiNmZjAwMDAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyMCIgY3g9IjExMiIgY3k9IjExMSIgaWQ9InN2Z181IiByeD0iMTAwIiByeT0iMTAwIi8+CjxlbGxpcHNlIGZpbGw9IiNmZjAwMDAiIHN0cm9rZT0iI2ZmZmZmZiIgc3Ryb2tlLXdpZHRoPSIyMCIgY3g9IjExMiIgY3k9IjExMSIgaWQ9InN2Z182IiByeD0iOTUiIHJ5PSI5NSIvPgo8cmVjdCBmaWxsPSIjZmYwMDAwIiBzdHJva2Utd2lkdGg9IjIwIiB4PSI2NC41IiB5PSIxMDIiIHdpZHRoPSI5NSIgaGVpZ2h0PSIxOCIgaWQ9InN2Z183IiBzdHJva2U9IiNmZmZmZmYiLz4KPC9nPgo8L3N2Zz4\x3d",
contentType:"image/svg+xml",width:18,height:18},uniqueValueInfos:[{value:"2",symbol:{type:"esriPMS",imageData:"PHN2ZyB3aWR0aD0iMjg2IiBoZWlnaHQ9IjI1NiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGc+CjxwYXRoIGZpbGw9IiNmZmYiIHN0cm9rZS13aWR0aD0iMTAiIGQ9Im04Ljc0OTk5MiwyNTEuNzQ5OTk3bDEzNC45OTk5OTgsLTI0MS45OTk5OThsMTM0Ljk5OTk5OCwyNDEuOTk5OTk4bC0yNjkuOTk5OTk1LDBsLTAuMDAwMDAxLDB6IiBpZD0ic3ZnXzEiIHN0cm9rZT0iIzAwMCIvPgo8cGF0aCBzdHJva2U9IiNmZmYiIGZpbGw9IiNmZjAwMDAiIHN0cm9rZS13aWR0aD0iMTUiIGQ9Im0yMy41MDAwMDQsMjQyLjUwMDAwNWwxMTkuOTk5OTkyLC0yMTUuOTk5OTk5bDExOS45OTk5OTIsMjE1Ljk5OTk5OWwtMjM5Ljk5OTk4MywwbC0wLjAwMDAwMSwweiIgaWQ9InN2Z18yIi8+Cjx0ZXh0IGZvbnQtd2VpZ2h0PSJib2xkIiBmaWxsPSIjZmZmZmZmIiBzdHJva2U9IiNmZjAwMDAiIHN0cm9rZS13aWR0aD0iMCIgeD0iMTA5IiB5PSIyMjIuNzUiIGlkPSJzdmdfNSIgZm9udC1zaXplPSIxODAiIGZvbnQtZmFtaWx5PSJHZW9yZ2lhLCBUaW1lcywgJ1RpbWVzIE5ldyBSb21hbicsIHNlcmlmIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHhtbDpzcGFjZT0icHJlc2VydmUiPiE8L3RleHQ+CjwvZz4KPC9zdmc+",
contentType:"image/svg+xml",width:19,height:18}}]}),polylineBarrierRenderer:new Ba({type:"uniqueValue",field1:"BarrierType",defaultSymbol:{color:[255,0,0,184],width:7.5,type:"esriSLS",style:"esriSLSSolid"},uniqueValueInfos:[{value:"1",symbol:{color:[255,85,0,184],width:7.5,type:"esriSLS",style:"esriSLSSolid"}}]}),polygonBarrierRenderer:new Ba({type:"uniqueValue",field1:"BarrierType",defaultSymbol:{color:[255,0,0,156],outline:{color:[255,0,0,153],width:2.4,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",
style:"esriSFSSolid"},uniqueValueInfos:[{value:"1",symbol:{color:[255,170,0,156],outline:{color:[255,0,0,153],width:7.5,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSSolid"}}]}),printPage:"",printTemplate:"",focusOnNewStop:!0,dragging:!0,canModifyStops:!0,canModifyWaypoints:!0,directionsLengthUnits:null,directionsLanguage:null,traffic:!1,trafficLayer:null,showPrintPage:!0,showSaveButton:!1,showSegmentPopup:!1,showSegmentHighlight:!0,showReverseStopsButton:!0,showReturnToStartOption:!0,
showOptimalRouteOption:!0,showTravelModesOption:!0,showMilesKilometersOption:!0,showClearButton:!1,showActivateButton:!0,showBarriersButton:!0,loaded:!1,routeLayer:{itemId:null,title:null,isItemOwner:!0,ownerFolder:null},startTime:"now"};this.userOptions=C;this.defaults=x.mixin({},this.options,C,{_waypointName:"DWWP",_userDefinedStopName:"UserDefinedStopName",_solveInProgress:!1,_moveInProgress:!1,_stopSequence:1E3});if(!this.defaults.minStops||2>this.defaults.minStops)this.defaults.minStops=2;if(2<
this.defaults.minStops&&this.defaults.stops&&","===this.defaults.stops.toString())for(var N=2;N<this.defaults.minStops;N++)this.defaults.stops.splice(0,0,"");this.domNode=J},postCreate:function(){this.inherited(arguments);this.own(q(this._activateButtonNode,d,x.hitch(this,function(){this.mapClickActive?this.deactivate():this.activate()})));this.own(q(this._lineBarrierButtonNode,d,x.hitch(this,function(){this.barrierToolActive?this.deactivateBarrierTool():this.activateBarrierTool()})));this.own(q(this._addDestinationNode,
d,x.hitch(this,this._addStopButton)));this.own(q(this._optionsButtonNode,d,x.hitch(this,this._toggleOptionsMenu)));this.own(q(this._saveMenuButton,d,x.hitch(this,this._toggleSaveMenu)));this.own(q(this._saveButton,d,x.hitch(this,function(){this._saveButton._enabled&&this._storeRouteUI()})));this.own(q(this._saveAsButton,d,x.hitch(this,function(){x.mixin(this.routeLayer,{itemId:null,title:null,ownerFolder:null});this._storeRouteUI()})));this.own(q(this._findOptimalOrderNode,d,x.hitch(this,this._toggleCheckbox)));
this.own(q(this._returnToStartNode,d,x.hitch(this,this._toggleCheckbox)));this.own(q(this._useTrafficNode,d,x.hitch(this,this._toggleCheckbox)));this.own(q(this._useMilesNode,d,x.hitch(this,this._toggleUnits)));this.own(q(this._useKilometersNode,d,x.hitch(this,this._toggleUnits)));this.own(q(this._getDirectionsButtonNode,d,x.hitch(this,this.getDirections)));this.own(q(this._clearDirectionsButtonNode,d,x.hitch(this,function(){this.clearDirections()})));var C=x.hitch(this,function(){clearTimeout(this._startTimeMenu._hideTimer);
this._startTimeMenu._hideTimer=setTimeout(x.hitch(this,function(){z.set(this._startTimeMenu,"display","none")}),100)});this.own(q(this._startTimeButtonNode,d,x.hitch(this,function(){this._startTimeButtonNode.disabled||"block"===z.get(this._startTimeMenu,"display")?z.set(this._startTimeMenu,"display","none"):(z.set(this._startTimeMenu,"display","block"),this["now"===this.startTime?"_startTimeMenuLeaveNow":"none"===this.startTime?"_startTimeMenuNone":"_startTimeMenuDepartAt"].focus())})));this.own(q(this._startTimeMenuLeaveNow,
"blur",C));this.own(q(this._startTimeMenuDepartAt,"blur",C));this.own(q(this._startTimeMenuNone,"blur",C));this.own(q(this._startTimeMenuLeaveNow,"mousedown",x.hitch(this,function(){this.startTime="now";this._updateStartTimeUI();this._clearDisplayBeforeSolve()})));this.own(q(this._startTimeMenuDepartAt,"mousedown",x.hitch(this,function(){this.startTime=(new Date).getTime();this._updateStartTimeUI();this._clearDisplayBeforeSolve()})));this.own(q(this._startTimeMenuNone,"mousedown",x.hitch(this,function(){this.startTime=
"none";this._updateStartTimeUI();this._clearDisplayBeforeSolve()})));this._symbolEventPaddingDirections=(new za).setColor(new f([0,255,0,0])).setWidth(20).setCap(za.CAP_ROUND);this._stopLayer=new Y({id:"directions_stopLayer_"+this.id,displayOnPan:!0});this._routeLayer=new Y({id:"directions_routeLayer_"+this.id,displayOnPan:!0});this._waypointsEventLayer=new Y({id:"directions_waypointsEventLayer_"+this.id,displayOnPan:!0});this._barriersLayer=new Y({id:"directions_barriersLayer_"+this.id,displayOnPan:!0});
this._polylineBarriersLayer=new Y({id:"directions_polylineBarriersLayer_"+this.id,displayOnPan:!0});this._polygonBarriersLayer=new Y({id:"directions_polygonBarriersLayer_"+this.id,displayOnPan:!0});this._barriersLayer.setRenderer(this.defaults.barrierRenderer);this._polylineBarriersLayer.setRenderer(this.defaults.polylineBarrierRenderer);this._polygonBarriersLayer.setRenderer(this.defaults.polygonBarrierRenderer);this.map&&(this.map.addLayer(this._routeLayer),this.map.addLayer(this._polygonBarriersLayer),
this.map.addLayer(this._polylineBarriersLayer),this.map.addLayer(this._barriersLayer),this.map.addLayer(this._stopLayer),this._externalTimeExtent=this.map.timeExtent);this._snappingManager=this.map.enableSnapping({layerInfos:[{layer:this._waypointsEventLayer,snapToVertex:!1,snapToPoint:!0,snapToEdge:!0}],tolerance:15});this._setWidgetProperties();var J=new R(null,this.waypointSymbol,{});C=x.hitch(this,function(){this._moveInProgress||this._solveInProgress||!J._isShown()||(this.editToolbar.deactivate(),
this._stopLayer.remove(J),clearTimeout(J._solveTimeout),J._solveTimeout=null,J.attributes.isWaypoint=!0,J._isStopIcon&&this.stopGraphics[J._index]&&(this._stopLayer.add(this.stopGraphics[J._index]),this._stopLayer.add(this.textGraphics[J._index])));J._showTooltip()});this._handle=x.mixin(J,{_isHandle:!0,_tooltip:I.create("div",{className:this.theme+" esriDirectionsRouteTooltip",onmouseover:C},this.map.container),_showTooltip:x.hitch(this,function(N){J._tooltip.style.display=!N||N instanceof MouseEvent?
"none":"inline";N&&(N="string"===typeof N?N:"\x3ctable class\x3d'esriRoutesTooltip'\x3e"+this._renderDirectionsItemTR(N)+"\x3c/table\x3e",J._tooltip.innerHTML!==N&&(J._tooltip.innerHTML=N))}),_isShown:x.hitch(this,function(){return-1<m.indexOf(this._stopLayer.graphics,J)}),_remove:C});this._activate(this.mapClickActive)},startup:function(){this.inherited(arguments);return this._enqueue(this._init)},destroy:function(){this.deactivate();this.map.removeLayer(this._barriersLayer);this.map.removeLayer(this._polylineBarriersLayer);
this.map.removeLayer(this._polygonBarriersLayer);this.map.removeLayer(this._routeLayer);this.map.removeLayer(this._stopLayer);this.map.removeLayer(this._waypointsEventLayer);this._disconnectEvents();I.empty(this.domNode);this.inherited(arguments)},activate:function(){return this._enqueue(function(){this.deactivateBarrierTool().then(x.hitch(this,function(){this.set("mapClickActive",!0)}))})},deactivate:function(){return this._enqueue(function(){this.deactivateBarrierTool().then(x.hitch(this,function(){this.set("mapClickActive",
!1)}))})},activateBarrierTool:function(){return this._enqueue(function(){this.set("mapClickActive",!1);this.set("barrierToolActive",!0)})},deactivateBarrierTool:function(){return this._enqueue(function(){this.set("mapClickActive",!1);this.set("barrierToolActive",!1)})},clearDirections:function(){return this._enqueue(function(){this.clearMessages();return this._clearDirections()})},reset:function(){return this._enqueue(this._reset)},modifyStopSequence:function(C,J){return this._enqueue(function(){return this._modifyStopSequence(C,
J)})},onActivate:function(){},onDeactivate:function(){},onActivateBarrierTool:function(){},onDeactivateBarrierTool:function(){},onLoad:function(){this._enableButton(this._getDirectionsButtonNode)},onDirectionsStart:function(){this._clearDisplayBeforeSolve();this.set("solving",!0);this._showLoadingSpinner(!0)},onDirectionsFinish:function(){this._showLoadingSpinner(!1);this.set("solving",!1)},onDirectionsClear:function(){},onSegmentSelect:function(){},onSegmentHighlight:function(){},onStopsUpdate:function(){},
onRouteItemCreated:function(){},onRouteItemUpdated:function(){},onFeatureCollectionCreated:function(){},onError:function(){},removeStops:function(){return this.reset()},removeStop:function(C,J,N){return this._enqueue(function(){this.clearMessages();return this._removeStop(C,J,N)})},updateStops:function(C){return this._enqueue(function(){return this._updateStops(C)})},addStops:function(C,J){return this._enqueue(function(){return this._addStops(C,J)}).then(x.hitch(this,this.zoomToFullRoute))},addStop:function(C,
J){return this._enqueue(function(){return this._addStop(C,J)},{_incrementalSolveStopRange:this._incrementalSolveStopRange})},updateStop:function(C,J,N){return this._enqueue(function(){return this._updateStop(C,J,N)},{_incrementalSolveStopRange:this._incrementalSolveStopRange})},setBarriers:function(C){this.routeParams.barriers=C;return this._getDirections().then(x.hitch(this,function(){this.zoomToFullRoute()}))},setPolylineBarriers:function(C){this.routeParams.polylineBarriers=C;return this._getDirections().then(x.hitch(this,
function(){this.zoomToFullRoute()}))},setPolygonBarriers:function(C){this.routeParams.polygonBarriers=C;return this._getDirections().then(x.hitch(this,function(){this.zoomToFullRoute()}))},clearMessages:function(){this.messages=[];this._msgNode&&(this._msgNode.innerHTML="")},getDirections:function(C){return this._enqueue(function(){return this._getDirections().then(x.hitch(this,function(){!0!==C&&this.zoomToFullRoute()}))})},selectSegment:function(C){if(!(!this.directions||!this.directions.features||
0>C||C>=this.directions.features.length))for(var J=y("[data-segment]",this._resultsNode),N=0;N<J.length;N++){var V=parseInt(A.get(J[N],"data-segment"),10);if(C===V&&J[N]!==this._focusedDirectionsItem){this._focusedDirectionsItem=J[N];this.centerAtSegmentStart(C);this.onSegmentSelect(this.directions.features[C]);J[N].focus();break}}},unhighlightSegment:function(C){var J=this._segmentGraphics;if(J&&(!this._focusedDirectionsItem||C)){for(C=0;C<J.length;C++)this._routeLayer.remove(J[C]);this._segmentGraphics=
[]}},highlightSegment:function(C,J){if(!(this._focusedDirectionsItem&&!J||C>=this.directions.features.length)){C=C||0;var N=x.hitch(this,function(ta){var ua=this.map.toMap({x:0,y:0});return this.map.toScreen(ua.offset(ta,0)).x}),V=x.hitch(this,function(ta){for(var ua=0,Da=0;Da<ta.length;Da++)for(var Ma=1;Ma<ta[Da].length;Ma++){var Ha=ta[Da][Ma-1],Ia=ta[Da][Ma];ua+=N(Math.sqrt((Ha[0]-Ia[0])*(Ha[0]-Ia[0])+(Ha[1]-Ia[1])*(Ha[1]-Ia[1])))}return ua}),S=x.hitch(this,function(ta){var ua=this.map.toMap({x:0,
y:0});return this.map.toMap({x:ta,y:0}).x-ua.x}),ba=function(ta,ua,Da){ua=Math.max(1,ua);for(var Ma=Da?ta[0].length-1:0,Ha=0,Ia,Aa,ra,sa=[[ta[0][Da?Ma:0]]];Da&&0<Ma||!Da&&Ma<ta[0].length-1;){Aa=ta[0][Da?Ma-1:Ma];ra=ta[0][Da?Ma:Ma+1];if(Ia=N(Math.sqrt((Aa[0]-ra[0])*(Aa[0]-ra[0])+(Aa[1]-ra[1])*(Aa[1]-ra[1]))))if(Ha+Ia<ua)Da?sa[0].splice(0,0,Aa):sa[0].push(ra),Ha+=Ia;else{ua=(ua-Ha)/Ia;Da?sa[0].splice(0,0,[ra[0]-(ra[0]-Aa[0])*ua,ra[1]-(ra[1]-Aa[1])*ua]):sa[0].push([Aa[0]+(ra[0]-Aa[0])*ua,Aa[1]+(ra[1]-
Aa[1])*ua]);break}Ma+=Da?-1:1}return 0<Ha+Ia?sa:ta},ea=this.get("directions").features[C],ia=new aa(ea.geometry),fa=40*Math.PI/180;x.mixin(ea.attributes,{_index:C});if(C){var ka=ba(this.get("directions").features[C-1].geometry.paths,25,!0),ma="esriDMTStop"!==ea.attributes.maneuverType?ba(ia.paths,25,!1):ka;ka=ma!==ka?[ka[0].concat(ma[0])]:ma;var na=(new aa(ma)).getExtent();if(1<ma[0].length&&15<=N(Math.max(na.getWidth(),na.getHeight()))){ba=15*Math.cos(fa/2);V=15*Math.sin(fa/2);var qa=ma[0].length-
2;fa=ma[0][qa+1];for(na=0;0<=qa&&!na;){var xa=ma[0][qa];na=N(Math.sqrt((xa[0]-fa[0])*(xa[0]-fa[0])+(xa[1]-fa[1])*(xa[1]-fa[1])));qa--}22>na&&(ma=na+(22-na)/3,qa=na+2*(22-na)/3,qa=[xa[0]+qa/na*(fa[0]-xa[0]),xa[1]+qa/na*(fa[1]-xa[1])],xa=[fa[0]-ma/na*(fa[0]-xa[0]),fa[1]-ma/na*(fa[1]-xa[1])],fa=qa,na=22);ba/=na;ma=[fa[0]-(fa[0]-xa[0])*ba,fa[1]-(fa[1]-xa[1])*ba];xa[1]!==fa[1]?(ba=(fa[0]-xa[0])/(fa[1]-xa[1]),xa=S(V/Math.sqrt(1+ba*ba)),S=ba*xa):(xa=0,S=S(V));Infinity===Math.abs(xa)||Infinity===Math.abs(S)||
isNaN(xa)||isNaN(S)||(ka[0].push(fa),ka[0].push([ma[0]-xa,ma[1]+S]),ka[0].push([ma[0]+xa,ma[1]-S]),ka[0].push(fa))}else ka=ba(ka,2*V(ma),!0);ia.paths=ka}this.unhighlightSegment(this._segmentGraphics&&this._segmentGraphics.length);S=x.clone(this.routeSymbol).setWidth(this.segmentSymbol.width).setColor(new f([parseInt(.9*this.segmentSymbol.color.r),parseInt(.9*this.segmentSymbol.color.g),parseInt(.9*this.segmentSymbol.color.b)]));this._segmentGraphics=[new R(ea.geometry,S,ea.attributes,this.get("segmentInfoTemplate")),
new R(ia,this.routeSymbol,ea.attributes,this.get("segmentInfoTemplate")),new R(ia,this.segmentSymbol,ea.attributes,this.get("segmentInfoTemplate"))];this.get("showSegmentHighlight")&&(this._routeLayer.add(this._segmentGraphics[0]),this._routeLayer.add(this._segmentGraphics[1]),this._routeLayer.add(this._segmentGraphics[2]));ea=x.hitch(this,function(ta){if(0<ta&&ta<this.directions.features.length){ta=this.directions.features[ta]._associatedFeaturesWithWaypoints;for(var ua=0;ua<ta.length;ua++)ta[ua]._associatedSnapFeature&&
ta[ua]._associatedSnapFeature.getDojoShape()&&ta[ua]._associatedSnapFeature.getDojoShape().moveToFront()}});ea(C-1);ea(C);this.onSegmentHighlight(this.directions.features[C])}},zoomToSegment:function(C){var J=new P;if(this.directions&&this.directions.features){var N=Math.max(0,Math.min(this.directions.features.length-1,C||0));this.map.setExtent(this.get("directions").features[N].geometry.getExtent(),!0).promise.always(x.hitch(this,function(){this.highlightSegment(N);J.resolve()}))}else J.reject(Error("No directions."));
return J.promise},centerAtSegmentStart:function(C){var J=new P;if(this.directions&&this.directions.features){var N=Math.max(0,Math.min(this.directions.features.length-1,C||0));var V=this.directions.features[N];this.map.centerAt(V.geometry.getPoint(0,0)).promise.always(x.hitch(this,function(){this.highlightSegment(N,!0);this._showSegmentPopup(V,N);J.resolve()}))}else J.reject(Error("No directions."));return J.promise},zoomToFullRoute:function(){var C=new P;this.directions&&this.directions.features?
(this._clearInfoWindow(),this.unhighlightSegment(),this.get("map").setExtent(this.get("directions").extent,!0).promise.always(C.resolve)):C.resolve();return C.promise},setListIcons:function(){var C,J=this._dnd.getAllNodes();for(C=0;C<J.length;C++){var N=y("."+this._css.stopIconClass,J[C])[0];N&&(N.innerHTML=this._getLetter(C));B.remove(J[C],this._css.stopOriginClass+" "+this._css.stopDestinationClass+" "+this._css.stopUnreachedClass+" "+this._css.stopUnreachedFirstOrLastClass);N=this._getStopSymbol(this.stops[C]);
N===this.fromSymbol?B.add(J[C],this._css.stopOriginClass):N===this.toSymbol?B.add(J[C],this._css.stopDestinationClass):N===this.unreachedSymbol&&B.add(J[C],this._css.stopUnreachedClass)}C=y("[data-reverse-td]",this._dndNode)[0];I.destroy(C);this.get("showReverseStopsButton")&&I.create("td",{"data-reverse-td":"true",rowspan:J.length,className:this._css.esriStopReverseColumnClass,innerHTML:'\x3cdiv role\x3d"button" class\x3d"'+this._css.reverseStopsClass+'" data-reverse-stops\x3d"true" title\x3d"'+
G.widgets.directions.reverseDirections+'"\x3e\x3c/div\x3e',onmouseover:function(V){V.stopPropagation()},onmouseout:function(V){V.stopPropagation()}},J[0])},addRouteSymbols:function(){if(this.stopGraphics.length){this._moveLayersToFront();for(var C=0;C<this.stopGraphics.length;C++)if(this.stopGraphics[C]&&(!this._handle._isShown()||this._handle._isShown()&&this._handle._index!==C)){this._stopLayer.add(this.stopGraphics[C]);var J=this.stopGraphics[C].getDojoShape();J&&J.moveToFront();this._stopLayer.add(this.textGraphics[C]);
(J=this.textGraphics[C].getDojoShape())&&J.moveToFront()}this._moveInProgress&&!this._handle.attributes.isWaypoint&&this._handle.getDojoShape()&&this._handle.getDojoShape().moveToFront()}},createRouteSymbols:function(){this._clearStopGraphics();for(var C=this.stops,J=function(ia){var fa={},ka;for(ka in ia)ia.hasOwnProperty(ka)&&0===ka.indexOf("Attr_")&&(fa[ka]=ia[ka]);return fa},N=0;N<C.length;N++){var V=C[N];if(V&&V.feature){var S=V.feature.attributes,ba=S?S.Status:void 0,ea=null;this._isStopAWaypoint(V)||
(ea=new Fa(this._getLetter(N),this.get("textSymbolFont"),this.get("textSymbolColor")),this.get("textSymbolOffset")&&ea.setOffset(this.get("textSymbolOffset").x,this.get("textSymbolOffset").y));ea=new R(V.feature.geometry,ea,{address:V.name},this.get("stopsInfoTemplate"));ea._isStopLabel=!0;ea._index=N;V=new R(V.feature.geometry,this._getStopSymbol(V),x.mixin({address:V.name,Status:void 0===ba?0:ba,CurbApproach:S&&S.CurbApproach?S.CurbApproach:null,TimeWindowStart:S&&S.TimeWindowStart?S.TimeWindowStart:
null,TimeWindowEnd:S&&S.TimeWindowEnd?S.TimeWindowEnd:null,isWaypoint:this._isStopAWaypoint(V)},J(S)),this.get(this._isStopAWaypoint(V)?"waypointInfoTemplate":"stopsInfoTemplate"));V._isStopIcon=!0;V._index=N;this.stopGraphics[N]=V;this.textGraphics[N]=ea}}this.set("stopGraphics",this.stopGraphics);this.set("textGraphics",this.textGraphics);this._showBarriers();this.addRouteSymbols();this.setListIcons()},setTravelMode:function(C){return this._enqueue(function(){this.clearMessages();this._travelModeSelector.setValue(C);
return this._setTravelMode(C)})},getSupportedTravelModeNames:function(){var C=[],J=this.serviceDescription;if(J&&J.supportedTravelModes&&J.supportedTravelModes.length){J=J.supportedTravelModes;for(var N=0;N<J.length;N++)C.push(J[N].name)}return C},setDirectionsLengthUnits:function(){var C=1===arguments.length?arguments[0]:this.get("directionsLengthUnits");return this._enqueue(function(){this.clearMessages();return this._setDirectionsLengthUnits(C)})},setDirectionsLanguage:function(){var C=1===arguments.length?
arguments[0]:this.get("directionsLanguage");return this._enqueue(function(){this.clearMessages();return this._setDirectionsLanguage(C)})},useMyCurrentLocation:function(C){this.clearMessages();return this._createLocateButton(this.geocoders[C],!0,!0)},loadRoute:function(C){return this._enqueue(x.hitch(this,function(){return this._loadRoute(C)}))},_getStopsAttr:function(){return this.returnToStart&&this._returnToStartStop?this.stops.concat(this._returnToStartStop):this.stops},_getTravelModeNameAttr:function(){return this.routeParams&&
this.routeParams.travelMode&&this.routeParams.travelMode.name},_reset:function(){var C=this.mapClickActive||this.barrierToolActive;this._clearBarriersGraphics();this._setWidgetProperties();return this._init().then(x.hitch(this,function(){this.mapClickActive=!C;this.set("mapClickActive",C);this._searchSourceSelector&&this._searchSourceSelector.setValue("all")}))},_activate:function(){var C=this.get("mapClickActive"),J=x.hitch(this,function(N){for(var V=N?[this.textGraphics,this.stopGraphics,this.displayedManeuverPointGraphics,
this.displayedRouteGraphics]:[this.displayedRouteGraphics,this.displayedManeuverPointGraphics,this.stopGraphics,this.textGraphics],S=0;S<V.length;S++)for(var ba=V[S],ea=0;ea<ba.length;ea++){var ia=ba[ea].getDojoShape();ia&&ia[N?"moveToBack":"moveToFront"].call(ia)}});this.drawToolbar&&(this.barrierToolActive=!1,this.drawToolbar.deactivate(),B.remove(this._lineBarrierButtonNode,this._css.stopsPressedButtonClass));this._addStopOnMapClickListener&&this._addStopOnMapClickListener.remove();C?(this.map.activeDirectionsWidget&&
this.map.activeDirectionsWidget!==this&&this.map.activeDirectionsWidget.deactivate(),this.map.activeDirectionsWidget=this,this._addStopOnMapClickListener=q(this.map,"click",x.hitch(this,function(N){this.canModifyStops&&!this._solveInProgress&&(this.map.infoWindow.hide(),this.addStop(new R(N.mapPoint)))})),this.map.addLayer(this._waypointsEventLayer),this._moveLayersToFront(),B.add(this._activateButtonNode,this._css.stopsPressedButtonClass),this.onActivate()):(this.map.removeLayer(this._waypointsEventLayer),
B.remove(this._activateButtonNode,this._css.stopsPressedButtonClass),this.onDeactivate());J(!C);this.emit("map-click-active",{mapClickActive:this.mapClickActive})},_activateBarrierTool:function(){this.get("barrierToolActive")?(this.map.activeDirectionsWidget&&this.map.activeDirectionsWidget!==this&&this.map.activeDirectionsWidget.deactivate(),this.map.activeDirectionsWidget=this,this.drawToolbar.activate(bb.FREEHAND_POLYLINE),B.add(this._lineBarrierButtonNode,this._css.stopsPressedButtonClass),this.onActivateBarrierTool()):
(this.drawToolbar.deactivate(),B.remove(this._lineBarrierButtonNode,this._css.stopsPressedButtonClass),this.onDeactivateBarrierTool());this.emit("barrier-tool-active",{barrierToolActive:this.barrierToolActive})},_moveLayersToFront:function(){var C=this.get("map"),J=C.graphicsLayerIds.length-1;C.reorderLayer(this._routeLayer,J);C.reorderLayer(this._polygonBarriersLayer,J);C.reorderLayer(this._polylineBarriersLayer,J);C.reorderLayer(this._barriersLayer,J);C.reorderLayer(this._waypointsEventLayer,J);
C.reorderLayer(this._stopLayer,J)},_destroyGeocoders:function(){for(;this.geocoders&&this.geocoders.length;){if(this.geocoders[0])try{this.geocoders[0].destroy()}catch(C){}this.geocoders.splice(0,1)}this.geocoders=[]},_disconnectEvents:function(){var C=this._clearDirections(!0),J;if(this._watchEvents&&this._watchEvents.length)for(J=0;J<this._watchEvents.length;J++)this._watchEvents[J].unwatch();if(this._onEvents&&this._onEvents.length)for(J=0;J<this._onEvents.length;J++)this._onEvents[J].remove();
if(this._geocoderEvents)for(J=0;J<this._geocoderEvents.length;J++)this._geocoderEvents[J].value.unwatch(),this._geocoderEvents[J].blur.remove(),this._geocoderEvents[J].select.remove(),this._geocoderEvents[J].suggest.remove();this._onEvents=[];this._watchEvents=[];this._geocoderEvents=[];this._disconnectResults();this._destroyGeocoders();this._destroyGlobalGeocoder();this._destroyDnD();return C},_getDirections:function(){var C=new P;this._removeEmptyStops();1<this._getStopCount()+this._getWaypointCount()&&
this.loaded?(this.onDirectionsStart(),this.clearMessages(),this._dnd.sync(),this._sortGeocoders(),this._getCandidates(this.stops).then(x.hitch(this,function(J){this.stops=J;this._setStops();this._configureRoute().always(x.hitch(this,function(N){C.resolve(N)}))}),x.hitch(this,function(J){this.set("directions",null);this._clearRouteGraphics();C.reject(J);this.onDirectionsFinish(J)}))):this._clearDirections(!0).always(x.hitch(this,function(){this.createRouteSymbols();C.resolve()}));return C.promise},
_clearDirections:function(){var C=new P;this._handle&&this._handle._remove();this.get("routeParams")&&this.get("routeParams").stops?this.get("routeParams").stops.features.length?(this.get("routeParams").stops.features=[],this.onDirectionsClear(),C.resolve()):arguments.length?C.resolve():this._reset().then(C.resolve,C.reject):C.resolve();this.set("directions",null);this._clearDisplayBeforeSolve();this._clearDisplayAfterSolve();this._routeLayer.clear();this._waypointsEventLayer.clear();this._stopLayer.clear();
return C.promise},_setTravelMode:function(C){var J=new P,N=this.serviceDescription,V=function(){J.resolve(C)};if(N&&N.supportedTravelModes&&N.supportedTravelModes.length){var S=N.supportedTravelModes,ba=!1;for(N=0;N<S.length;N++)if(S[N].name===C){ba=!0;!this.routeParams.travelMode||this.routeParams.travelMode&&this.routeParams.travelMode.name!==C?(this.routeParams.travelMode=S[N].impedanceAttributeName?S[N]:S[N].itemId,this._checkStartTimeUIAvailability(),this._solveAndZoom().always(V)):V();this._travelModeSelector&&
this._travelModeSelector.domNode&&(this._travelModeSelector.domNode.title=S[N].description);break}ba||J.reject(C)}else J.reject(C);return J.promise},_setDirectionsLengthUnits:function(C){this._clearDisplayBeforeSolve();var J=new P;B.remove(this._useMilesNode,this._css.stopsPressedButtonClass);B.remove(this._useKilometersNode,this._css.stopsPressedButtonClass);C===da.KILOMETERS?B.add(this._useKilometersNode,this._css.stopsPressedButtonClass):C===da.MILES&&B.add(this._useMilesNode,this._css.stopsPressedButtonClass);
C===da.KILOMETERS||C===da.METERS||C===da.MILES||C===da.FEET||C===da.YARDS||C===da.NAUTICAL_MILES?(this.directionsLengthUnits=C,J.resolve(C)):J.reject(C);return J.promise},_setDirectionsLanguage:function(C){this._clearDisplayBeforeSolve();var J=new P;C=this._setDirectionsLanguageByLocale(C);this._solveAndZoom().always(function(){J.resolve(C)},J.reject);return J.promise},_showLoadingSpinner:function(C){void 0===C&&(C=this._requestQueueTail&&!this._requestQueueTail.isFulfilled()||this._moveInProgress);
C?(B.add(this._widgetContainer,this._css.resultsLoadingClass),B.add(this._resultsNode,"esriRoutesContainerBusy")):(B.remove(this._widgetContainer,this._css.resultsLoadingClass),B.remove(this._resultsNode,"esriRoutesContainerBusy"))},_enqueue:function(C,J){var N=new P;this._requestQueueTail||(this._requestQueueTail=new P,this._requestQueueTail.resolve());this._requestQueueTail.promise.always(x.hitch(this,function(){try{x.mixin(this,{_incrementalSolveStopRange:null},J);var V=C.call(this);V&&"object"===
typeof V&&V.hasOwnProperty("isFulfilled")?V.then(x.hitch(this,function(S){N.resolve(S);this._showLoadingSpinner()}),x.hitch(this,function(S){N.reject(S);this._showLoadingSpinner()})):(N.resolve(V),this._showLoadingSpinner())}catch(S){N.reject(S),this._showLoadingSpinner()}}));this._requestQueueTail=N;this._showLoadingSpinner();return N.promise},_createDnD:function(){this._dnd=new W(this._dndNode,{skipForm:!0,withHandles:!0})},_destroyDnD:function(){I.empty(this._dndNode);this._dnd&&(this._dnd.destroy(),
this._dnd=null)},_createDepartAtControls:function(){if(this._departAtTime)this.map&&this._restoreMapTimeExtent(),this._useTrafficItemNode.title=G.widgets.directions.trafficLabelLive,B.remove(this._departAtContainer,"departAtContainerVisible"),this.startTime="now",this._updateStartTimeUI();else{var C=this,J=function(){this._keepDirections||C._clearDisplayBeforeSolve();this._keepDirections=!1},N=x.hitch(this,function(){this.map&&this.map.disableKeyboardNavigation()}),V=x.hitch(this,function(){this.map&&
this.map.enableKeyboardNavigation()});this._departAtTime=new n({required:!0,value:new Date,onChange:J,onFocus:N,onBlur:V},this._departAtTimeContainer);this._departAtDate=new h({required:!0,value:new Date,onChange:J,onFocus:N,onBlur:V,constraints:{min:new Date(864E5)}},this._departAtDateContainer)}},_setStartTime:function(C,J,N){if(isNaN(N))this.startTime="now"===N?N:"none";else{J=N instanceof Date?N:new Date(N);N=this.directions&&this.directions.features&&this.directions.features[0]&&this.directions.features[0].attributes;
var V=6E4*-J.getTimezoneOffset();J=new Date(J-V+(N&&N.arriveTimeUTC?N.ETA-N.arriveTimeUTC:V));this._departAtTime._keepDirections=!C;this._departAtDate._keepDirections=!C;this._departAtTime.setValue(J);this._departAtDate.setValue(J)}this._updateStartTimeUI()},_checkStartTimeUIAvailability:function(){var C=this._getImpedanceAttribute();C=this._isTimeUnits(C?C.units:"")||this.serviceDescription&&10.6<=this.serviceDescription.currentVersion;this._startTimeButtonNode.disabled=!C;B[C?"remove":"add"].apply(this,
[this._startTimeButtonNodeContainer,"esriLinkButtonDisabled"]);B[C?"remove":"add"].apply(this,[this._startTimeDDLArrow,"esriDirectionsDDLArrowDisabled"]);C||this.set("startTime","now")},_usingAGOL:function(C){C||(C=this.routeTaskUrl);return-1<C.search(/^(https?:)*\/\/*[^.]*\.arcgis\.com.*$/i)},_usingRouteAGOL:function(){return-1<this.get("routeTaskUrl").search(/^(https?:)*\/\/route*[^.]*\.arcgis\.com.*$/i)},_setSearchOptions:function(){var C={map:this.get("map"),autoNavigate:!1,enableInfoWindow:!1,
enableHighlight:!1,enableSourcesMenu:!1};this.searchOptions=x.mixin({maxResults:1,locationToAddressDistance:100},this.defaults.searchOptions,C)},_setDefaultUnits:function(){if(!this.get("directionsLengthUnits")){var C="EN-US"===b.locale.toUpperCase()?da.MILES:da.KILOMETERS;this.defaults.directionsLengthUnits?C=this.defaults.directionsLengthUnits:this.userOptions.routeParams&&this.userOptions.routeParams.directionsLengthUnits&&(C=this.userOptions.routeParams.directionsLengthUnits);this.set("directionsLengthUnits",
C)}this._setDirectionsLengthUnits(this.directionsLengthUnits)},_setTrafficOptions:function(){this._usingRouteAGOL()&&!this.trafficLayer&&(this.trafficLayer=new T(Ua+"//traffic.arcgis.com/arcgis/rest/services/World/Traffic/MapServer",{opacity:.4}));this.trafficLayer&&this.trafficLayer.url&&this._usingAGOL(this.trafficLayer.url)&&(this._trafficAvailabilityButton.style.display="inline-block");this.set("showTrafficOption",(this.defaults.showTrafficOption||!this.defaults.hasOwnProperty("showTrafficOption"))&&
!!this.trafficLayer);this._optionsMenu()},_updateCanModifyStops:function(C,J){this.canModifyStops||this.canModifyWaypoints||this.set("mapClickActive",!1);J||!this.canModifyStops||this.canModifyWaypoints||this.set("mapClickActive",!0);this._showAddDestination();this._showMapClickActiveButton();this._stopsTableCover.style.display=this.canModifyStops?"none":"inline"},_updateCanAddWaypoints:function(C,J){this.canModifyStops||this.canModifyWaypoints||this.set("mapClickActive",!1);J||this.canModifyStops||
!this.canModifyWaypoints||this.set("mapClickActive",!0);this._showMapClickActiveButton();this._handle._remove()},_updateStartTimeUI:function(){isNaN(this.startTime)?(this._startTimeButtonLabel.innerHTML="now"==this.startTime?this._i18n.widgets.directions.leaveNow:this._i18n.widgets.directions.noStartTime,B.remove(this._startTimeButtonNodeContainer,"departAtButton"),B.remove(this._departAtContainer,"departAtContainerVisible")):(B.add(this._startTimeButtonNodeContainer,"departAtButton"),B.add(this._departAtContainer,
"departAtContainerVisible"),this._startTimeButtonLabel.innerHTML=this._i18n.widgets.directions.departAt)},_setWidgetProperties:function(){this._disconnectEvents();this.set(this.defaults);this.routeLayer=x.clone(this.defaults.routeLayer);this._folderSelector&&(this._outputLayer.setValue(""),this._outputLayer.set("disabled",!0),this._folderSelector.set("disabled",!0));this.set("stops",[]);this._updateCanModifyStops()},_updateStops:function(C){var J=new P;C?this.get("loaded")?this._reset().then(x.hitch(this,
function(){this._addStops(C).then(J.resolve,J.reject)}),J.reject):this._addStops(C).then(J.resolve,J.reject):J.reject();return J.promise},_removeStop:function(C,J,N,V){var S=new P,ba=x.hitch(this,function(ia){this.stops.splice(ia,1);var fa=this._dnd.getAllNodes()[ia],ka=this.get("geocoders");this._geocoderEvents[fa.id]&&(this._geocoderEvents[fa.id].blur.remove(),this._geocoderEvents[fa.id].select.remove(),this._geocoderEvents[fa.id].suggest.remove(),this._geocoderEvents[fa.id].value.unwatch());ka[ia].destroy();
ka.splice(ia,1);this.set("geocoders",ka);I.destroy(fa);this._dnd.sync();this._stopsRemovable();this._optionsMenu();this._checkMaxStops();this.setListIcons();this._sortGeocoders()});if(0>C||C>=this.stops.length||void 0===C)C=this.stops.length-1;var ea=!1;for(V=this.stopGraphics[C]&&this._isStopAWaypoint(this.stops[C])||V;!ea;)ba(C),V?ea=!0:(C-=0>=C||C<this.stops.length&&this._isStopAWaypoint(this.stops[C])?0:1,ea=!this._isStopAWaypoint(this.stops[C]));for(;this.stops.length-this._getWaypointCount()<
this.minStops;)this._addStop();this._clearStopsStatusAttr();this._setStops();this.createRouteSymbols();N?(this._clearDisplayBeforeSolve(),this._clearDisplayAfterSolve(),this.createRouteSymbols(),S.resolve()):this._solveAndZoom(J).then(S.resolve,S.reject);return S.promise},_removeTrafficLayer:function(){this.trafficLayer&&this.map&&this.map.removeLayer(this.trafficLayer);this._trafficLayerAdded=!1},_addStops:function(C,J){var N=new P,V=[],S=this.autoSolve;this.autoSolve=!1;void 0===J&&(J=this._getStopCount());
for(var ba=0;ba<Math.min(C.length,this.maxStops-this._getStopCount());ba++){var ea=new P;this._addStop(C[ba],J+ba,!0).always(ea.resolve);V.push(ea)}M(V).always(x.hitch(this,function(){this.autoSolve=S;this._getDirections().always(function(){N.resolve(C)})}));return N.promise},_addStop:function(C,J,N){var V=new P;this._checkMaxStops();this.maxStopsReached?(this._showMessage(G.widgets.directions.error.maximumStops),V.reject(Error(G.widgets.directions.error.maximumStops))):(void 0===C&&void 0===J&&(J=
this.stops.length),C instanceof R&&C.attributes&&C.attributes.isWaypoint&&(!J||J===this.stops.length||2>this._getStopCount())&&!N?(this._showMessage(G.widgets.directions.error.waypointShouldBeInBetweenStops),V.reject(Error(G.widgets.directions.error.waypointShouldBeInBetweenStops))):this._getCandidate(C).then(x.hitch(this,function(S){this._isStopAWaypoint(S)&&S&&S.feature&&(S.feature.attributes=x.mixin({},S.feature.attributes,{isWaypoint:!0,CurbApproach:3}));this._insertStop(S,J);this.autoSolve&&
""!==S.name?this._getDirections().always(function(){V.resolve(S,J)}):V.resolve(S,J)}),x.hitch(this,function(S){V.reject(S)})));return V.promise},_removeEmptyStops:function(){for(var C=0,J=this.stops.length-this._getWaypointCount()-this.minStops;C<this.stops.length&&0<J;)this.stops[C]&&this.stops[C].name?C++:(this._removeStop(C,!0,!0,!0),J--,this._moveInProgress&&this._handle._index>=C&&this._handle._isStopIcon&&this._handle._index--)},_setReverseGeocode:function(C,J,N){if(C.feature.geometry&&-1<N){var V=
{address:C.name};this.stopGraphics[N]&&(x.mixin(this.stopGraphics[N].attributes,V),this.stopGraphics[N].setGeometry(J));this.textGraphics[N]&&(x.mixin(this.textGraphics[N].attributes,V),this.textGraphics[N].setGeometry(J));this.set("stopGraphics",this.stopGraphics);this.set("textGraphics",this.textGraphics);(V=this.geocoders[N])&&V.inputNode&&(V.value=C.name,V.inputNode.value=C.name);x.mixin(C.feature.attributes,this.stops[N].feature.attributes);this.stops[N]=C;this.stops[N].feature.setGeometry(J);
this._setStops();return this._enqueue(function(){return this._getDirections()})}},_insertStop:function(C,J){var N;if(void 0===J)for(N=0;N<this.geocoders.length;N++){if(!this.geocoders[N].get("value")){var V=this.geocoders[N];break}}else N=J,this.geocoders[N]&&!this.geocoders[N].get("value")&&(V=this.geocoders[N]);!V||void 0!==J&&J!==N||this._isStopAWaypoint(C)?(void 0===J&&(J=this.geocoders.length),this.stops.splice(J,0,C),this._createGeocoder(C,J)):(this.stops[N]=C,V.set("value",C.name),V._stopReference=
C);this._optionsMenu()},_createGeocoder:function(C,J){var N=this._dnd.getAllNodes(),V=!1,S=!1,ba=N.length;N[J]?(S=N[J],V=!0):V=S=!1;var ea=x.hitch(this,function(ma,na){var qa=na?this._css.stopDnDHandleClass:this._css.stopDnDHandleClassHidden,xa=na?this._css.stopDnDHandleClassHidden:this._css.stopDnDHandleClass;B.replace(ma.children[0],qa,xa);2<this.geocoders.length&&(qa=na?this._css.stopIconRemoveClass:this._css.stopIconRemoveClassHidden,xa=na?this._css.stopIconRemoveClassHidden:this._css.stopIconRemoveClass,
B.replace(ma.children[3].children[0],qa,xa))}),ia=I.create("tr",{className:this._css.stopClass,style:this._isStopAWaypoint(C)?"display:none;":"",onmouseover:function(){ea(this,!0)},onmouseout:function(){ea(this,!1)}});I.create("td",{className:this._css.stopDnDHandleClassHidden+" dojoDndHandle"},ia);N=I.create("td",{className:this._css.stopIconColumnClass},ia);I.create("div",{className:this._css.stopIconClass+" dojoDndHandle",innerHTML:this._getLetter(ba),"data-center-at":"true"},N);ba=I.create("td",
{className:this._css.esriStopGeocoderColumnClass},ia);ba=I.create("div",{},ba);N=I.create("td",{className:this._css.stopIconRemoveColumnClass},ia);I.create("div",{className:this._css.stopIconRemoveClassHidden,role:"button","data-remove":"true"},N);this._dnd.insertNodes(!1,[ia],V,S);V=x.mixin({},this.get("searchOptions"),{value:C.name,activeSourceIndex:this._globalGeocoder.activeSourceIndex});var fa=new db(V,ba),ka=x.hitch(this,function(ma,na){this._enqueue(function(){if(na!==ma&&fa._stopReference&&
fa._stopReference.name!==na){var qa=m.indexOf(this.stops,fa._stopReference);this.stops[qa]={name:na};this._handle._remove();this._removeSomeWaypoints(this._markWPsForRemovalAfterUserChangedStopSequence(qa));this._setStops();this._clearDisplayBeforeSolve();this._clearDisplayAfterSolve();this.createRouteSymbols()}})});fa._tr=ia;fa._stopReference=C;fa.startup();this.geocoders.splice(J,0,fa);this._geocoderEvents[ia.id]={blur:fa.on("blur",function(){""!==this.value&&this._stopReference&&!this._stopReference.feature&&
this.search()}),select:fa.on("select-result",x.hitch(this,function(ma){var na=!0;if(ma&&(ma.results||ma.result)){var qa=this._dnd.getAllNodes();qa=m.indexOf(qa,ia);var xa=fa.value,ta=ma.results&&ma.results.results&&ma.results.results.length?ma.results.results[0]:ma.result;ta?(ta.name=xa,this.stops[qa]=this._toPointGeometry(ta),this.geocoders[qa]._stopReference=this.stops[qa],ka("",xa)):(this.removeStop(qa),this.set("directions",null),this._showMessage(G.widgets.directions.error.unknownStop.replace("\x3cname\x3e",
ma.target.get("value"))),this._clearRouteGraphics(),na=!1);na&&this.getDirections()}})),suggest:fa.on("suggest-results",function(){if(document.activeElement===this.inputNode)for(var ma=y("LI[role\x3d'menuitem']",this.suggestionsNode),na=0;na<ma.length;na++)A.set(ma[na],"tabindex",-1);else this._hideSuggestionsMenu()}),value:fa.watch("value",function(ma,na,qa){ka(na,qa)})};this._checkMaxStops();this.setListIcons();this._stopsRemovable();this._optionsMenu();this._sortGeocoders()},_blurGeocoders:function(){if(document.activeElement)for(var C=
0;C<this.geocoders.length;C++)if(this.geocoders[C].inputNode===document.activeElement){this.geocoders[C]._hideSuggestionsMenu();this.geocoders[C].inputNode.blur();1<this._getStopCount()+this._getWaypointCount()&&this.getDirections(!0);break}},_decorateEmptyAGOLGeocoderResponse:function(C){C&&", , "===C.name&&(C.name=C.feature&&C.feature.attributes&&C.feature.attributes.Match_addr?C.feature.attributes.Match_addr+("POI"===C.feature.attributes.Addr_type&&C.feature.attributes.City&&-1===C.feature.attributes.Match_addr.indexOf(C.feature.attributes.City)?
", "+C.feature.attributes.City:""):"");return C},_toPointGeometry:function(C){var J=C.feature.geometry;J&&(J.getCentroid?C.feature.geometry=J.getCentroid():J.getExtent&&(J=J.getExtent())&&(C.feature.geometry=J.getCenter()));return C},_removeLocateButtonVisibilityEvents:function(){for(var C=0;C<this.geocoders.length;C++){var J=this.geocoders[C];J._onMouseEnter&&J._onMouseEnter.remove();J._onMouseOut&&J._onMouseOut.remove();J._onKeyPress&&J._onKeyPress.remove();J._locateButton&&(J._locateButton._onMouseEnter&&
J._locateButton._onMouseEnter.remove(),J._locateButton._onMouseOut&&J._locateButton._onMouseOut.remove())}},_setLocateButtonVisibilityEvents:function(){this._removeLocateButtonVisibilityEvents();for(var C=this,J=function(fa){fa instanceof FocusEvent?this._geocoder._lbShown_f=!0:this._geocoder._lbShown_g=!0;C._createLocateButton(this._geocoder,!0)},N=function(fa){fa instanceof FocusEvent?this._geocoder._lbShown_f=!1:this._geocoder._lbShown_g=!1;clearTimeout(this._destroyTimeout);this._destroyTimeout=
setTimeout(x.hitch(this,function(){this._geocoder._lbShown_lb||this._geocoder._lbShown_f||C._destroyLocateButton(this._locateButton)}),400)},V=function(){this._geocoder._lbShown_g=!0;clearTimeout(this._destroyTimeout);this._destroyTimeout=setTimeout(x.hitch(this,function(){""===this.value?C._createLocateButton(this._geocoder,!0):C._destroyLocateButton(this._locateButton)}),400)},S=function(){this._geocoder._lbShown_lb=!0;clearTimeout(this._geocoder._destroyTimeout)},ba=function(){this._geocoder._lbShown_lb=
!1;clearTimeout(this._geocoder._destroyTimeout);this._geocoder._destroyTimeout=setTimeout(x.hitch(this,function(){this._geocoder._lbShown_g||this._geocoder._lbShown_f||C._destroyLocateButton(this._geocoder.inputNode._locateButton)}),400)},ea=0;ea<this.geocoders.length;ea++){var ia=this.geocoders[ea];ia&&ia.inputNode&&(ia.inputNode._geocoder=ia,ia._onMouseEnter=q(ia.inputNode,u.enter,J),ia._onMouseOut=q(ia.inputNode,[u.leave,"blur"],N),ia._onKeyPress=q(ia.inputNode,"keydown",V),ia.inputNode._locateButton&&
(ia=ia.inputNode._locateButton,ia._onMouseEnter=q(ia.domNode,u.enter,S),ia._onMouseOut=q(ia.domNode,u.leave,ba)))}},_createLocateButton:function(C,J,N){var V=new P;C.inputNode._locateButton&&C.inputNode._locateButton._locating?V.resolve():t(["./LocateButton"],x.hitch(this,function(S){this._destroyLocateButton(C.inputNode._locateButton);if(C&&!this._solveInProgress){var ba=I.create("div",{},C.domNode);B.add(C.domNode,this._css.stopsInnerGeocoderClass);var ea=new S({map:this.map,highlightLocation:!1,
centerAt:!1,setScale:!1,useTracking:!1},ba);ea.startup();C.inputNode._locateButton=ea;ea.domNode._geocoder=C;this._setLocateButtonVisibilityEvents();S=x.hitch(this,function(){ea._locating=!0;C.set("value","");C.inputNode.placeholder=G.widgets.directions.retrievingMyLocation.toUpperCase()});ea._onBeforeLocate=q(ea._locateNode,d,S);ea._onLocate=q(ea,"locate",x.hitch(this,function(ia){ea._locating=!1;ia.graphic?(J&&this._destroyLocateButton(C.inputNode._locateButton),this.updateStop(new R(ia.graphic.geometry),
m.indexOf(this.geocoders,C)).then(x.hitch(this,function(){1<this.stopGraphics.length?this.getDirections().always(function(){V.resolve(ia)}):V.resolve(ia)}))):(C.set("value",""),C.inputNode.placeholder=G.widgets.directions.myLocationError.toUpperCase(),V.reject(ia.error))}));N?(S(),ea.locate().then(null,V.reject)):V.resolve()}else V.resolve()}));return V.promise},_destroyLocateButton:function(C){if(C){var J=C.domNode._geocoder;clearTimeout(J._destroyTimeout);C._locating?J._destroyTimeout=setTimeout(x.hitch(this,
function(){J._lbShown_lb||J._lbShown_f||this._destroyLocateButton(C)}),100):(C.clear(),C._onBeforeLocate.remove(),C._onLocate.remove(),C._onMouseEnter&&C._onMouseEnter.remove(),C._onMouseOut&&C._onMouseOut.remove(),C.destroy(),J.inputNode&&(J.inputNode._locateButton=null,J._setPlaceholder(J.activeSourceIndex)))}},_sortStops:function(){this.stops.length&&(this.stops.sort(x.hitch(this,function(C,J){for(var N,V,S=0;S<this.get("geocoders").length;S++)this.geocoders[S]._stopReference===C?N=S:this.geocoders[S]._stopReference===
J&&(V=S);return N>V?1:V>N?-1:0})),this._setStops())},_getCandidate:function(C){var J=new P,N=typeof C;C?"object"===N&&C.hasOwnProperty("feature")&&C.hasOwnProperty("name")?(C.feature.attributes&&void 0!==C.feature.attributes.displayName&&!this._isStopAWaypoint(C)&&(C.name=C.feature.attributes.displayName,C.feature.attributes.Name=this._userDefinedStopName),C.name=this._isStopAWaypoint(C)?this._waypointName:String(C.name),"point"!==C.feature.geometry.type&&(C.feature.geometry=new ha([C.feature.geometry.x,
C.feature.geometry.y],this.map.spatialReference)),J.resolve(C)):"object"===N&&C.hasOwnProperty("address")&&C.hasOwnProperty("location")?(C=this._globalGeocoder._hydrateResult(C),J.resolve(C)):"object"!==N||!C.hasOwnProperty("name")||null!==C.name&&""!==C.name?C instanceof R&&C.attributes&&(void 0!==C.attributes.Name||C.attributes.isWaypoint)?(N=this._addStopWrapperToGraphic(C,C.attributes.isWaypoint?this._waypointName:String(C.attributes.Name)),String(C.attributes.Name)&&(N.feature.attributes.Name=
this._userDefinedStopName),J.resolve(N)):("object"===N&&C.hasOwnProperty("name")&&(C=String(C.name)),this._reverseGeocode(C).then(J.resolve,J.reject)):J.resolve(x.clone(this._emptyStop)):J.resolve(x.clone(this._emptyStop));return J.promise},_reverseGeocode:function(C){var J=new P,N,V=C.geometry?C.geometry:C;if(this._globalGeocoder){var S=x.hitch(this,function(fa){var ka=new P,ma=500;if(this.map){var na=this.map.toScreen(V);na.x+=X._calculateClickTolerance([fa]);this.map.spatialReference.isWebMercator()?
(ma=Math.abs(this.map.toMap(na).x-V.x),ka.resolve(ma)):4326===this.map.spatialReference.wkid?(ma=Math.abs(ca.geographicToWebMercator(this.map.toMap(na)).x-ca.geographicToWebMercator(V).x),ka.resolve(ma)):this._geometryService&&(fa=new Wa,fa.distanceUnit=Ta.UNIT_METER,fa.geometry1=V,fa.geometry2=this.map.toMap(na),this._geometryService.distance(fa,function(qa){ma=qa;ka.resolve(ma)},function(){ka.resolve(ma)}))}return ka.promise}),ba=[],ea=this._globalGeocoder.sources,ia=function(){ea[N].featureLayer&&
ba.push(S(ea[N].featureLayer).then(x.hitch(ea[N],function(fa){this.searchQueryParams=x.mixin(this.searchQueryParams,{distance:fa})})))};if("all"===this._globalGeocoder.activeSourceIndex)for(N=0;N<ea.length;N++)ia();else N=this._globalGeocoder.activeSourceIndex,ia();M(ba).always(x.hitch(this,function(){this._globalGeocoder.search(V).then(x.hitch(this,function(fa){var ka=!1;if(fa){var ma=null;for(N=0;N<this._globalGeocoder.sources.length;N++)if(fa[N]&&fa[N].length){var na=fa[N];break}if(na.length&&
(ka=!0,ma=na[0],this._globalGeocoder.sources[N].featureLayer))for(fa=Number.POSITIVE_INFINITY,N=0;N<na.length;N++){na[N]=this._toPointGeometry(na[N]);var qa=Q.geodesicLengths([new aa({paths:[[ca.xyToLngLat(V.x,V.y),ca.xyToLngLat(na[N].feature.geometry.x,na[N].feature.geometry.y)]],spatialReference:{wkid:this.map.spatialReference.wkid}})],"esriMeters")[0];fa>qa&&(fa=qa,ma=na[N])}(ma=this._decorateEmptyAGOLGeocoderResponse(ma))&&""!==ma.name&&null!==ma.name&&void 0!==ma.name?(ma.name=String(ma.name),
isNaN(V.x)||isNaN(V.y)||this.map.spatialReference.wkid!==V.spatialReference.wkid?!ma.feature.geometry||isNaN(ma.feature.geometry.x)||isNaN(ma.feature.geometry.y)?(this._showMessage(G.widgets.directions.error.locator),J.reject(Error(G.widgets.directions.error.locator))):J.resolve(ma):(ma.feature.geometry=V,J.resolve(ma))):ka=!1}ka||(C instanceof ha?C=new R(C):C instanceof Array&&(C=new R(new ha(C[0],C[1]))),C instanceof R?this._decorateUngeocodedStop(C).then(J.resolve,J.reject):(this._showMessage(G.widgets.directions.error.unknownStop.replace("\x3cname\x3e",
C.toString())),J.reject(Error(G.widgets.directions.error.unknownStop.replace("\x3cname\x3e",C.toString())))))}))}))}else this._showMessage(G.widgets.directions.error.locatorUndefined),J.reject(Error(G.widgets.directions.error.locatorUndefined));return J.promise},_updateStop:function(C,J,N){var V=new P;this.stops&&this.stops[J]?C instanceof R&&C.attributes&&C.attributes.isWaypoint&&(!J||J===this.stops.length-1||2>this._getStopCount())?(this._showMessage(G.widgets.directions.error.waypointShouldBeInBetweenStops),
V.reject(Error(G.widgets.directions.error.waypointShouldBeInBetweenStops))):this._getCandidate(C).then(x.hitch(this,function(S){var ba=S.feature;ba=ba?ba.geometry:null;var ea=this.stops[J].feature;ea=ea?ea.geometry:null;ba=ba&&ea&&(ba.x!==ea.x||ba.y!==ea.y)||!ba&&ea;this.stops[J]=S;this.geocoders[J]||this._createGeocoder(S,J);ea=this.geocoders[J];ea._stopReference=S;ea._tr.style.display=this._isStopAWaypoint(S)?"none":"";ea.value=S.name;ea.inputNode&&(ea.inputNode.value=S.name);ba&&this.autoSolve&&
1<this._getStopCount()+this._getWaypointCount()||N?this._getDirections().then(V.resolve,V.reject):(this._setStops(),V.resolve(S))}),x.hitch(this,function(S){V.reject(S)})):(this._showMessage(G.widgets.directions.error.couldNotUpdateStop),V.reject(Error(G.widgets.directions.error.couldNotUpdateStop)));this._optionsMenu();return V.promise},_renderDirections:function(){var C=this.get("directions");if(this._resultsNode){var J='\x3cdiv class\x3d"'+this._css.clearClass+'"\x3e\x3c/div\x3e';J+=this._renderDirectionsSummary(C);
J+='\x3cdiv class\x3d"'+this._css.clearClass+'"\x3e\x3c/div\x3e';J+='\x3cdiv class\x3d"'+this._css.routesClass+'"\x3e';J+=this._renderDirectionsTable(C);J+="\x3c/div\x3e";this._resultsNode&&(this._resultsNode.innerHTML=J);this._disconnectResults();(C=y("[data-segment]",this._resultsNode))&&C.length&&m.forEach(C,x.hitch(this,function(N){this._resultEvents.push(q(N,u.enter,x.hitch(this,function(){if(!this._focusedDirectionsItem){var V=parseInt(A.get(N,"data-segment"),10);this.highlightSegment(V)}})));
this._resultEvents.push(q(N,"focusout",x.hitch(this,function(){this._focusedDirectionsItem=null;this.unhighlightSegment(!0)})));this._resultEvents.push(q(N,u.leave,this.unhighlightSegment));this._resultEvents.push(q(N,"click, keydown",x.hitch(this,function(V){V&&("click"===V.type||"keydown"===V.type&&V.keyCode===k.ENTER)&&(this._focusedDirectionsItem!==N?this.selectSegment(parseInt(A.get(N,"data-segment"),10)):(N.blur(),this.map.infoWindow.hide(),this._focusedDirectionsItem=null,this.unhighlightSegment(!0)))})))}))}},
_renderDirectionsSummary:function(C){var J="",N=x.hitch(this,function(){for(var ea={},ia=this._getDirectionsTimeAttribute()||{},fa=this._getTimeNeutralAttribute()||{},ka=0,ma=0,na=this.get("stops"),qa=na.length-1;0<=qa;qa--)if(null!==na[qa].feature.attributes.ArriveCurbApproach){ea=na[qa].feature.attributes;break}for(var xa in ea)ea.hasOwnProperty(xa)&&(xa==="Cumul_"+ia.name&&(ka=ea[xa]),xa==="Cumul_"+fa.name&&(ma=ea[xa]));ea="esriTrafficLabelHidden";na=G.widgets.directions.noTraffic;qa=C.totalTime-
C.totalDriveTime;qa=(ma-this._convertCostValue(qa,ia.units,fa.units))/(ka-qa||1);0<qa&&.8>qa?(ea="esriTrafficLabelHeavy",na=G.widgets.directions.heavyTraffic):1===qa?(ea="esriTrafficLabelNone",na=G.widgets.directions.noTraffic):1.25<qa&&(ea="esriTrafficLabelLight",na=G.widgets.directions.ligthTraffic);fa=this._formatTime(ma,!1,fa.units);return{label:na,labelClass:ea,ratio:qa,noTrafficCostStr:1!==qa&&fa?fa+" "+G.widgets.directions.onAverage+"\x3cbr\x3e":"",trafficCost:ka,noTrafficCost:ma,timeAtt:ia}});
if(C.totalLength||C.totalTime){N=N();var V=this._getImpedanceAttribute();J+="\x3cdiv class\x3d'"+this._css.resultsSummaryClass+"' data-full-route\x3d'true'\x3e\x3cdiv class\x3d'esriImpedanceCost'\x3e";if(this._isTimeUnits(V.units))J+=this._formatTime(N.trafficCost,!0,N.timeAtt.units)+"\x3cdiv class\x3d'esriImpedanceCostHrMin'\x3e\x3cdiv class\x3d'esriImpedanceCostHr'\x3e"+G.widgets.directions.time.hr+"\x3c/div\x3e\x3cdiv class\x3d'esriImpedanceCostMin'\x3e"+G.widgets.directions.time.min+"\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'esriOtherCosts'\x3e"+
(N.noTrafficCost?"\x3cdiv class\x3d'esriTrafficLabel "+N.labelClass+"'\x3e"+N.label+"\x3c/div\x3e"+N.noTrafficCostStr:"")+this._formatDistance(C.totalLength);else{V=(V=G.widgets.directions.units[this.directionsLengthUnits])?V.name:"";var S=this.serviceDescription&&10.6<=this.serviceDescription.currentVersion,ba=this.directions.features[0].attributes;J+=D.format(C.totalLength,{places:1})+"\x3cdiv class\x3d'esriImpedanceCostDist'\x3e"+V+"\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'esriOtherCosts'\x3e"+
(N.noTrafficCost&&S?"\x3cdiv class\x3d'esriTrafficLabel "+N.labelClass+"'\x3e"+N.label+"\x3c/div\x3e"+N.noTrafficCostStr:"")+this._formatTime(C.totalTime)+" "+("none"!==this.startTime&&N.noTrafficCost&&S?G.widgets.directions.atTheMoment+" "+this._toSpatiallyLocalTimeString(ba.arriveTimeUTC,ba.ETA):"")}J+="\x3c/div\x3e\x3c/div\x3e"}return J},_renderDirectionsTable:function(C){for(var J=0,N=0,V=0,S='\x3ctable summary\x3d"'+C.routeName+'"\x3e\x3ctbody role\x3d"menu"\x3e',ba=0;ba<C.features.length;ba++){var ea=
C.features[ba].attributes;"esriDMTDepart"===ea.maneuverType&&(N=V=0);V+=ea.length;N+=ea.time;J+=ea.time;S+=this._renderDirectionsItemTR(C.features[ba],V,N,J)}return S+"\x3c/tbody\x3e\x3c/table\x3e"},_renderDirectionsItemTR:function(C,J,N,V){var S=this.directions,ba=S?m.indexOf(S.features,C):-1;V="";var ea=this._css.routeClass,ia=C._associatedStopWithReturnToStart&&C._associatedStopWithReturnToStart.attributes,fa=C.attributes;if(-1<ba){fa&&(fa.step=ba+1);fa.maneuverType&&(ea+=" "+fa.maneuverType);
ia&&null===ia.ArriveCurbApproach&&null!==ia.DepartCurbApproach?ea+=" "+this._css.routeOriginClass:ia&&null!==ia.ArriveCurbApproach&&null===ia.DepartCurbApproach&&(ea+=" "+this._css.routeDestinationClass+" "+this._css.routeLastClass);V+='\x3ctr tabindex\x3d"0" role\x3d"menuitem" class\x3d"'+ea+" "+this._css.routeZoomClass+'" data-segment\x3d"'+ba+'"\x3e';V+='\x3ctd class\x3d"'+this._css.routeIconColumnClass+'"\x3e';V+='\x3cdiv class\x3d"'+this._css.routeIconClass+'"\x3e';V+=this._getLetter(C._associatedStop);
V=V+'\x3c/div\x3e\x3c/td\x3e\x3ctd class\x3d"'+(this._css.routeTextColumnClass+'"\x3e');V+='\x3cdiv class\x3d"'+this._css.routeInfoClass+'"\x3e';V+='\x3cdiv class\x3d"'+this._css.routeTextClass+'"\x3e';C=(S.strings[ba]||[]).slice();if("esriDMTDepart"===fa.maneuverType||"esriDMTStop"===fa.maneuverType)for(S=0;S<this.stops.length;S++)this.stops[S]&&this.stops[S].name&&C.push({string:this.stops[S].name});if(C){ea=fa.text;for(S=0;S<C.length;S++)ea=this._boldText(ea,C[S].string);fa.formattedText=ea}else fa.formattedText=
fa.text;if("esriDMTStop"===fa.maneuverType&&(J||N)||"esriDMTDepart"===fa.maneuverType&&0===ba)J=this._formatDistance(J-fa.length,!0),N=this._formatTime(N-fa.time),ba=this._formatTime(fa.time),C=this._formatDistance(fa.length,!0),fa.formattedText+="\x3cdiv class\x3d'esriRouteTextColumnCumulative'\x3e"+J+(J&&N?" \x26middot; ":"")+N+(J||N?"\x3cbr\x3e":"")+(ba?G.widgets.directions.serviceTime+":\x26nbsp;"+ba:"")+(ba&&C?"\x3cbr\x3e":"")+(C?G.widgets.directions.serviceDistance+":\x26nbsp;"+C:"")+"\x3c/div\x3e";
V+="\x3cstrong\x3e"+D.format(fa.step)+".\x3c/strong\x3e "+fa.formattedText;V+="\x3c/div\x3e";J=this._formatDistance(fa.length,!0);N=this._formatTime(fa.time);"esriDMTStop"!==fa.maneuverType&&"esriDMTDepart"!==fa.maneuverType||!this.routeParams.startTime||-22091616E5===fa.ETA?J&&(V+='\x3cdiv class\x3d"'+this._css.routeLengthClass+'"\x3e',V+=J,N&&(V+="\x26nbsp;\x26middot;\x3cwbr\x3e\x26nbsp;"+N),V+="\x3c/div\x3e"):V+='\x3cdiv class\x3d"'+this._css.routeLengthClass+'"\x3e'+this._toSpatiallyLocalTimeString(fa.arriveTimeUTC,
fa.ETA)+"\x3c/div\x3e";V+="\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e"}return V},_toSpatiallyLocalTimeString:function(C,J){var N=new Date(J),V=new Date(N.getTime()+6E4*N.getTimezoneOffset());V=b.date.locale.format(V,{selector:"time"});var S="";C?(S=(J-C)/1E3/60/60,N=Math.floor(S),S=60*(S-N),N=G.widgets.directions.GMT+(0>N?"":"+")+D.format(N,{pattern:"00"})+D.format(S,{pattern:"00"}),S=V+" "+N):S="now"===this.startTime?b.date.locale.format(N,{selector:"time"}):V;return S},_addStopWrapperToGraphic:function(C,
J){return{extent:new ja({xmin:C.geometry.x-.25,ymin:C.geometry.y-.25,xmax:C.geometry.x+.25,ymax:C.geometry.y+.25,spatialReference:C.geometry.spatialReference}),feature:C,name:J}},_clearBarriersGraphics:function(){this._barriersLayer.clear();this._polylineBarriersLayer.clear();this._polygonBarriersLayer.clear()},_showBarriers:function(){this._clearBarriersGraphics();var C=this.routeParams,J=C.polylineBarriers&&C.polylineBarriers.features||[],N=C.polygonBarriers&&C.polygonBarriers.features||[];m.forEach(C.barriers&&
C.barriers.features||[],x.hitch(this,function(V){this._barriersLayer.add(V)}));m.forEach(J,x.hitch(this,function(V){this._polylineBarriersLayer.add(V)}));m.forEach(N,x.hitch(this,function(V){this._polygonBarriersLayer.add(V)}));this._barriersLayer.refresh();this._polylineBarriersLayer.refresh();this._polygonBarriersLayer.refresh()},_showRoute:function(C){this._clearDisplayAfterSolve();var J=C.routeResults[0].directions,N=new P;if(J){this.set("solveResult",C);this.set("directions",J);var V=C.routeResults[0].stops,
S,ba;if(V&&V.length){var ea=[];for(S=0;S<V.length;S++){var ia=V[S];ia.attributes.isWaypoint=ia.attributes.Name===this._waypointName||ia.attributes.isWaypoint;ia=this._addStopWrapperToGraphic(ia,ia.attributes.Name);this.stops[S]&&this.stops[S].feature&&this.stops[S].feature.attributes&&this.stops[S].feature.attributes.Name===this._userDefinedStopName&&(ia.feature.attributes.Name=this._userDefinedStopName);this._returnToStartStop&&this._returnToStartStop._resultsStopIndex===S?this._returnToStartStop=
ia:ea.push(ia)}if(this.stops.length>ea.length)for(S=0;S<this.stops.length;S++)this.stops[S].feature||""!==this.stops[S].name||ea.splice(S,0,this._emptyStop);this.stops=ea;for(S=0;S<this.stops.length;S++)this._updateStop(this.stops[S],S);this._setStops();this._setMenuNodeValues()}this.set("mergedRouteGraphic",new R(J.mergedGeometry,this.get("routeSymbol")));V=[];ea=[];for(S=ia=0;S<J.featuresWithWaypoints.length;S++){var fa=J.featuresWithWaypoints[S];if("esriDMTDepart"===fa.attributes.maneuverType)for(ba=
0;ba<this.stops.length;ba++)if(this.stops[ba].feature===fa._associatedStop){ia=ba+1;break}fa.setSymbol(this.get("routeSymbol"));this._routeLayer.add(fa);V.push(fa);(ba=fa.getDojoShape())&&ba.moveToBack();ba=new R(fa.geometry,this._symbolEventPaddingDirections,fa.attributes);ba._nextStopIndex=ia-.5;ba._isSnapFeature=!0;fa._associatedSnapFeature=ba;this._waypointsEventLayer.add(ba);"esriDMTDepart"!==fa.attributes.maneuverType&&(ba=fa.geometry.getPoint(0,0))&&(ba=new R(ba,this.maneuverSymbol),ba._directionsFeature=
fa._associatedFeatureNoWaypoints,ea.push(ba),this._waypointsEventLayer.add(ea[ea.length-1]))}this.set("displayedRouteGraphics",V);this.set("displayedManeuverPointGraphics",ea);this._renderDirections();for(S=0;S<this.stops.length;S++)if(this._isStopAWaypoint(this.stops[S])&&this._modifiedWaypointIndex===S){for(ba=0;ba<J.featuresWithWaypoints.length;ba++)if(V=J.featuresWithWaypoints[ba],V._associatedStop===this.stops[S].feature){if("esriDMTStop"===V.attributes.maneuverType||"esriDMTDepart"===V.attributes.maneuverType)this.stops[S].feature.geometry.x=
V.geometry.paths[0][0][0],this.stops[S].feature.geometry.y=V.geometry.paths[0][0][1];break}this._modifiedWaypointIndex=null;break}z.set(this._savePrintBtnContainer,"display","inline-block");this.onDirectionsFinish(C)}else C=C.routeResults[0].route,C.setSymbol(this.routeSymbol),this._routeLayer.add(C),this._incrementalRouteSegment=C;N.resolve();this._moveLayersToFront();this.createRouteSymbols();return N.promise},_setGeocodersStopReference:function(){if(this.geocoders)for(var C=0;C<this.geocoders.length;C++)this.geocoders[C]&&
this.stops[C]&&(this.geocoders[C]._stopReference=this.stops[C])},_setStops:function(){this._setGeocodersStopReference();this.createRouteSymbols();this._set("stops",this.stops);this.onStopsUpdate(this.stops)},_getCandidates:function(C){var J=[];if(C&&C.length){for(var N=0;N<C.length;N++)J.push(this._getCandidate(C[N]));return M(J)}C=new P;C.resolve([]);return C.promise},_clearResultsHTML:function(){this._resultsNode.innerHTML="";z.set(this._savePrintBtnContainer,"display","none")},_showSegmentPopup:function(C){if(C&&
this.get("showSegmentPopup")&&this.get("map").infoWindow){var J=C.geometry.getPoint(0,0);C=new R(J,null,C.attributes,this.get("segmentInfoTemplate"));var N=this.get("map").infoWindow;N.setFeatures([C]);N.show(J)}},_addStopButton:function(){this.addStop().then(x.hitch(this,function(){this.get("focusOnNewStop")&&this.geocoders[this.stops.length-1].focus()}))},_sortGeocoders:function(){var C=this._dnd.getAllNodes();this.geocoders.sort(x.hitch(this,function(N,V){return N.domNode&&N.domNode.parentNode&&
N.domNode.parentNode.parentNode&&V.domNode&&V.domNode.parentNode&&V.domNode.parentNode.parentNode?m.indexOf(C,N.domNode.parentNode.parentNode)>m.indexOf(C,V.domNode.parentNode.parentNode)?1:-1:0}));this.stops.length===this.geocoders.length&&this._sortStops();for(var J=0;J<this.geocoders.length;J++)this.geocoders[J]&&this.geocoders[J].inputNode&&(this.geocoders[J].inputNode.title=G.widgets.directions.stopNoTitle+(J+1));this._setLocateButtonVisibilityEvents()},_disconnectResults:function(){if(this._resultEvents&&
this._resultEvents.length)for(var C=0;C<this._resultEvents.length;C++)this._resultEvents[C]&&this._resultEvents[C].remove();this._resultEvents=[]},_formatArbitraryCostsForRouteTooltip:function(C){var J="",N;for(N in C)if(0===N.indexOf("Total_")&&C.hasOwnProperty(N)){var V=this._getCostAttribute(N.substr(6));V&&(J+=this._isTimeUnits(V.units)?this._formatTime(C[N],!1,V.units):this._formatDistance(C[N],!0,V.units),J+=J?" \x26middot; ":"")}J&&(J=G.widgets.directions.toNearbyStops+": \x3cb\x3e"+J.substr(0,
J.length-10)+"\x3c/b\x3e");return J},_formatTime:function(C,J,N){N||(N=(this._getDirectionsTimeAttribute()||{}).units);var V="";N=Math.round(this._convertCostValue(C,N,"esriNAUMinutes"));C=Math.floor(N/60);N=Math.floor(N%60);J?V=D.format(C,{pattern:100>C?"00":"000"})+":"+D.format(N,{pattern:"00"}):(C&&(V+=C+" "+G.widgets.directions.time.hr+" "),V+=C||N?N+" "+G.widgets.directions.time.min:"");return V},_formatDistance:function(C,J,N){N||(N=this.directionsLengthUnits);var V=this.directionsLengthUnits,
S=G.widgets.directions.units[V],ba=V.replace("esri","").toLowerCase();C=this._convertCostValue(C,N,V);S&&(ba=J?S.abbr:S.name);return C?D.format(C,{locale:"root",places:2})+" "+ba:""},_projectToGeographic:function(C){var J=new P;if(!C)return J.reject("Directions:: 'geometry' is not defined.",{geometry:C}),J.promise;if(4326==C.spatialReference.wkid)return J.resolve(C),J.promise;if(!this._geometryService)return J.reject("Directions:: Geometry service is not defined."),J.promise;var N=new ab;N.outSR=
new L(4326);N.geometries=[C];this._geometryService.project(N).then(function(V){J.resolve(V&&V[0])},J.reject);return J.promise},_createToolbars:function(){this.editToolbar||(this.editToolbar=new Xa(this.map));this.drawToolbar||(this.drawToolbar=new bb(this.map),G.toolbars.draw.freehand=G.widgets.directions.lineBarrierFreehand,this.drawToolbar.onDrawComplete=x.hitch(this,function(C){var J=new R(C.geometry,null,{BarrierType:0});this._projectToGeographic(C.geographicGeometry||C.geometry).then(x.hitch(this,
function(N){1<Q.geodesicLengths([N],da.METERS)[0]&&(this._polylineBarriersLayer.add(J),this.routeParams.polylineBarriers||(this.routeParams.polylineBarriers=new Va),this.routeParams.polylineBarriers.features.push(J),this._clearStopsStatusAttr(),this.getDirections(!0))}))}))},_destroyGlobalGeocoder:function(){this._globalGeocoder&&(this._globalGeocoder.destroy(),this._globalGeocoder=null)},_createGlobalGeocoder:function(){var C=new P;this._globalGeocoder=new db(this.get("searchOptions"));q.once(this._globalGeocoder,
"load",C.resolve,C.reject);this._globalGeocoder.startup();return C.promise},_init:function(){var C=new P;this.set("loaded",!1);this._enableButton(this._getDirectionsButtonNode,!1);z.set(this._saveAsButton,"display","none");this.clearMessages();if(this.get("map").loaded)this._configure().always(C.resolve);else q.once(this.get("map"),"load",x.hitch(this,function(){this._configure().always(C.resolve)}));return C.promise},_setDefaultStops:function(){var C=new P;this.defaults.stops&&this.defaults.stops.length?
this._updateStops(this.defaults.stops).then(x.hitch(this,function(){this._removeEmptyStops();C.resolve()}),C.reject):C.resolve();return C.promise},_configure:function(){var C=new P;this._handle&&this._handle._remove();this._createDnD();this._createDepartAtControls();this._setSearchOptions();this._createGlobalGeocoder().then(x.hitch(this,function(){this._createToolbars();this._usingAGOL()||(this.printTaskUrl=this.geometryTaskUrl=null);this._createGeometryTask();this._createPrintTask();this._showActivateButton();
this._showBarriersButton();this._createTravelModesDDL();this._createSearchSourceDDL();var J=[this._createRouteTask(),this._setDefaultStops()];M(J).then(x.hitch(this,function(){this._setDefaultUnits();this._setTrafficOptions();this._setMenuNodeValues();this._setupEvents();var N=this.directionsLanguage||this.userOptions.routeParams&&this.userOptions.routeParams.directionsLanguage||b.locale.toLowerCase();this._setDirectionsLanguageByLocale(N);this._setupTravelModes().then(x.hitch(this,function(){this.set("loaded",
!0);this.onLoad();C.resolve(!0)}),function(V){C.reject(V)})}),function(N){C.reject(N)})}),function(J){C.reject(J)});this._naRouteSharing=null;return C.promise},_setDirectionsLanguageByLocale:function(C){var J=this.serviceDescription.directionsSupportedLanguages,N=function(S){if(J)for(var ba=0;ba<J.length;ba++)if(J[ba].toLowerCase().substr(0,2)===S)return J[ba];return null},V=N(C);V||(C=C.substr(0,2),V=N(C));this.directionsLanguage=V;return this.routeParams.directionsLanguage=V},_getStopSymbol:function(C,
J){var N=C&&(C.feature&&C.feature.attributes||C.attributes),V=this.stopSymbol;N&&(V=this._isStopAWaypoint(C)?this.waypointSymbol:void 0===N.Status||0===N.Status||6===N.Status?null===N.ArriveCurbApproach&&null!==N.DepartCurbApproach?this.get(J?"fromSymbolDrag":"fromSymbol"):null!==N.ArriveCurbApproach&&null===N.DepartCurbApproach?this.get(J?"toSymbolDrag":"toSymbol"):this.get(J?"stopSymbolDrag":"stopSymbol"):this.get(J?"unreachedSymbolDrag":"unreachedSymbol"));return V},_addTrafficLayer:function(){this.trafficLayer&&
!this._trafficLayerAdded&&this.map&&(this.map.addLayer(this.trafficLayer),this.trafficLayer.show(),this._trafficLayerAdded=!0)},_toggleUnits:function(C){C.target===this._useMilesNode?this.setDirectionsLengthUnits(da.MILES):C.target===this._useKilometersNode&&this.setDirectionsLengthUnits(da.KILOMETERS)},_toggleCheckbox:function(C){var J=A.get(C.target,"checked");C.target===this._findOptimalOrderNode?this.set("optimalRoute",J):C.target===this._useTrafficNode?this.set("traffic",J):C.target===this._returnToStartNode&&
this.set("returnToStart",J)},_isStopLocated:function(C){return C&&C.feature&&C.feature.attributes&&(!C.feature.attributes.Status||6===C.feature.attributes.Status)},_configureRouteOptions:function(){var C=this.get("routeParams"),J;this.get("directionsLengthUnits")?C.directionsLengthUnits=this.get("directionsLengthUnits"):this.set("directionsLengthUnits",C.directionsLengthUnits);C.findBestSequence=this.get("optimalRoute");if(C.findBestSequence)for(C.preserveFirstStop=this._isStopLocated(this.stops[0]),
C.preserveLastStop=!this.returnToStart&&this._isStopLocated(this.stops[this.stops.length-1])||this.returnToStart&&this._isStopLocated(this.stops[0]),J=0;J<this.stops.length;)this._isStopAWaypoint(this.stops[J])?this._removeStop(J,!0,!0):J++;if(!this.returnToStart&&this.stops.length&&this._isStopAWaypoint(this.stops[this.stops.length-1]))for(J=this.stops.length-1;0<J;)this._isStopAWaypoint(this.stops[J])&&this._removeStop(J,!0,!0),J--;if(this._isTimeUnits(this._getImpedanceAttribute().units)||this.serviceDescription&&
10.6<=this.serviceDescription.currentVersion)if(C.useTimeWindows=!0,"now"===this.startTime)C.timeWindowsAreUTC=!0,C.startTimeIsUTC=!0,C.startTime=new Date;else if("none"===this.startTime)C.startTime=null;else{C.timeWindowsAreUTC=!1;C.startTimeIsUTC=!1;var N=this._departAtTime,V=6E4*N.getValue().getTimezoneOffset();N=new Date(N.getValue().getTime()+this._departAtDate.getValue().getTime()-V);N=new Date(N.getTime()-6E4*N.getTimezoneOffset());C.startTime=N}else C.startTime=null,C.useTimeWindows=!1;N=
this._getImpedanceAttribute();V=this._getTimeNeutralAttribute();var S=this._getDirectionsTimeAttribute();J=this.routeParams.accumulateAttributes||this.serviceDescription.accumulateAttributeNames;V&&-1===m.indexOf(J,V.name)&&J.push(V.name);!this._isTimeUnits(N.units)&&this.serviceDescription&&10.6<=this.serviceDescription.currentVersion&&S&&-1===m.indexOf(J,S.name)&&J.push(S.name);this.routeParams.accumulateAttributes=J;C.returnStops=!0;S=[];for(J=0;J<this.stopGraphics.length;J++)if(this.stopGraphics[J]&&
(S.push(new R(this.stopGraphics[J].toJson())),J)){var ba=S[0].attributes,ea=S[J].attributes;for(ia in ea)ea.hasOwnProperty(ia)&&!ba.hasOwnProperty(ia)&&(ba[ia]=null)}if(this.get("returnToStart")&&this.stopGraphics.length&&this._isStopLocated(this.stops[0])){var ia=new R(this.stopGraphics[0].toJson());this._returnToStartStop=this._addStopWrapperToGraphic(ia,ia.attributes.Name);S.push(ia)}else this._returnToStartStop=null;C.stops.features=S;if(V)for(J=0;J<S.length;J++)S[J].attributes["Attr_"+V.name]=
this._convertCostValue(S[J].attributes["Attr_"+N.name],N.units,V.units);this.set("routeParams",C)},_configureRoute:function(){var C=new P;C.promise.always(x.hitch(this,function(){this._checkMaxStops()}));this.createRouteSymbols();this._configureRouteOptions();if(this.routeParams.returnRoutes&&this._incrementalSolveStopRange){var J=this._incrementalSolveStopRange;J.start<J.end?this.routeParams.stops.features=this.routeParams.stops.features.slice(J.start,J.end+1):J.start>J.end&&(this.routeParams.stops.features=
this.routeParams.stops.features.slice(J.start,this.routeParams.stops.features.length-1).concat(this.routeParams.stops.features.slice(0,J.end+1)))}else this._incrementalSolveStopRange=null;var N={},V=this.routeParams.stops.features;for(J=0;J<V.length;J++){var S=V[J].attributes.address;var ba=(J===this._handle._index&&!this._handle.attributes.isWaypoint&&this._incrementalSolveStopRange?this._waypointName:S)+"_"+this._stopSequence++;V[J].attributes.Name=ba;N[ba]=S;delete V[J].attributes.address;delete V[J].attributes.isWaypoint;
delete V[J].attributes.Status}this._solveInProgress=!0;var ea={_incrementalSolveStopRange:this._incrementalSolveStopRange};this.routeTask.solve(this.routeParams,x.hitch(this,function(ia){this._solveResultProcessing(ia,N,ea).then(C.resolve,C.reject)}),x.hitch(this,function(ia){x.mixin(this,ea);this._solveInProgress=!1;for(var fa=0;fa<this.stops.length;fa++)this.stops[fa].feature&&(this.stops[fa].feature.attributes=x.mixin(this.stops[fa].feature.attributes,{Status:5}));this.set("directions",null);this._clearDisplayAfterSolve();
this.createRouteSymbols();this._routeTaskError(ia);C.reject(ia)}));return C.promise},_solveResultProcessing:function(C,J,N){var V=new P;x.mixin(this,N);this._solveInProgress=!1;N=C.routeResults[0];var S=N.directions;N=N.stops;if(S){this._solverMessages=C.messages;var ba=function(ma){for(var na in J)if(ma&&0===S.routeName.indexOf(na)||!ma&&0<S.routeName.indexOf(na))return J[na];return""};var ea=ba(!0);ba=ba(!1);S.routeName=(ea!==this._waypointName?ea:G.widgets.directions.waypoint)+" \u2014 "+(ba!==
this._waypointName?ba:G.widgets.directions.waypoint);for(ea=0;ea<S.features.length;ea++)if(ba=S.features[ea].attributes,"esriDMTDepart"===ba.maneuverType||"esriDMTStop"===ba.maneuverType)for(var ia in J)if(J.hasOwnProperty(ia)&&-1<ba.text.indexOf(ia)){ba.text=ba.text.replace(ia,J[ia]);for(var fa=0;fa<N.length;fa++){var ka=N[fa].attributes;if(ka.Name===ia){x.mixin(S.features[ea],{_associatedStop:N[this.returnToStart&&fa===N.length-1?0:fa],_associatedStopWithReturnToStart:N[fa]});if(!ka.ArriveTime&&
!ka.ArriveTimeUTC&&ba.ETA&&ba.arriveTimeUTC){ka.ArriveTime=ba.ETA;ka.ArriveTimeUTC=ba.arriveTimeUTC;fa=0;if(0==ea&&"esriDMTDepart"===ba.maneuverType||0<ea&&"esriDMTStop"===ba.maneuverType)fa=this._convertCostValue(ba.time,(this._getDirectionsTimeAttribute()||{}).units,"milliseconds");ka.DepartTime=ka.ArriveTime+fa;ka.DepartTimeUTC=ka.ArriveTimeUTC+fa}break}}}for(ea=0;ea<N.length;ea++)this._returnToStartStop&&N[ea].attributes.Name===this._returnToStartStop.feature.attributes.Name&&(this._returnToStartStop._resultsStopIndex=
ea),N[ea].attributes.Name=J[N[ea].attributes.Name];this._directionsPostprocessing(S);this.traffic&&this._updateMapTimeExtent()}this._showRoute(C).always(x.hitch(this,function(){this._incrementalSolveStopRange=null;V.resolve(C)}));return V.promise},_directionsPostprocessing:function(C){var J,N=function(ba,ea){var ia=C.features[ba]._associatedFeaturesWithWaypoints||[];ia.push(C.featuresWithWaypoints[ea]);C.features[ba]._associatedFeaturesWithWaypoints=ia;C.featuresWithWaypoints[ea]._associatedFeatureNoWaypoints=
C.features[ba]};var V=x.hitch(this,function(ba){return"\x3cdiv class\x3d'"+this.theme+"'\x3e\x3ctable class\x3d'esriRoutesTooltip'\x3e"+this._renderDirectionsItemTR(ba._associatedFeatureNoWaypoints)+"\x3c/table\x3e\x3c/div\x3e"});C.featuresWithWaypoints=[];for(J=0;J<C.features.length;J++){var S=new R(C.features[J].toJson());S.setInfoTemplate(new Z({title:this._i18n.widgets.directions.maneuver,content:V}));C.featuresWithWaypoints.push(S);C.featuresWithWaypoints[J]._associatedStop=C.features[J]._associatedStop;
C.featuresWithWaypoints[J]._associatedStopWithReturnToStart=C.features[J]._associatedStopWithReturnToStart}C.stringsWithWaypoints=x.mixin([],C.strings);C.eventsWithWaypoints=x.mixin([],C.events);for(V=J=0;J<C.features.length;)C.features[J]._associatedStop&&C.features[J]._associatedStop.attributes.Name===this._waypointName?(C.features.splice(J,J?2:1),C.strings.splice(J,J?2:1),C.events.splice(J,J?2:1),J&&C.features[J]&&"esriDMTStraight"===C.features[J].attributes.maneuverType?(S=C.features.splice(J,
1)[0],C.strings[J-1]=(C.strings[J-1]||[]).concat(C.strings.splice(J,1)[0]||[]),C.strings[J-1].length||(C.strings[J-1]=void 0),C.events[J-1]=(C.events[J-1]||[]).concat(C.events.splice(J,1)[0]||[]),C.events[J-1].length||(C.events[J-1]=void 0),C.features[J-1].attributes.length+=S.attributes.length,C.features[J-1].attributes.time+=S.attributes.time,C.features[J-1].geometry.paths[0]=C.features[J-1].geometry.paths[0].concat(S.geometry.paths[0]),N(J-1,V++),N(J-1,V++),N(J-1,V++)):(J&&N(J-1,V++),J<C.features.length&&
N(J,V++))):(N(J,V++),J++)},_boldText:function(C,J){var N=C;try{var V=new RegExp("[^\x3cstrong\x3e\x26nbsp;]"+J.replace(/(\||\$|\^|\(|\)|\[|\]|\{|\}|\/|\.|\+|\*|\?|\?)/g,"\\$1")+"[^\x26nbsp;\x3c/strong\x3e]","g");N=(" "+N+" ").replace(V,"\x3cstrong\x3e\x26nbsp;"+J+"\x26nbsp;\x3c/strong\x3e");N=N.trim()}catch(S){}return N},_clearStopGraphics:function(){if(this.stopGraphics&&this.stopGraphics.length)for(var C=0;C<this.stopGraphics.length;C++)this._stopLayer.remove(this.stopGraphics[C]),this._stopLayer.remove(this.textGraphics[C]);
this.set("stopGraphics",[]);this.set("textGraphics",[])},_updateMapTimeExtent:function(){if(this.map){var C=this.directions&&this.directions.features[0]&&this.directions.features[0].attributes||{},J=(new Date).getTime();J="none"==this.startTime?J:C.arriveTimeUTC||J;this._useTrafficItemNode.title="none"!==this.startTime&&C.arriveTimeUTC?G.widgets.directions.trafficLabelDepartAt+": "+this._toSpatiallyLocalTimeString(C.arriveTimeUTC,C.ETA):"";this._myTimeExtentUpdate=!0;C=new Date(J);this.map.setTimeExtent(new U(C,
C))}},_restoreMapTimeExtent:function(){this.map&&(this._myTimeExtentUpdate=!0,this.map.setTimeExtent(this._externalTimeExtent))},_clearRouteGraphics:function(){for(var C=this.displayedRouteGraphics,J=this.displayedManeuverPointGraphics,N=this._routeLayer,V=this._waypointsEventLayer,S=0,ba=0,ea=this._incrementalSolveStopRange?this._incrementalSolveStopRange:{start:0,end:this.stops?this.stops.length:-1};C&&ba<C.length;){if(C[ba]._associatedStop)for(var ia=0;ia<this.stops.length;ia++)if(this.stops[ia].feature===
C[ba]._associatedStop){S=ia;break}S>=ea.start&&S<ea.end||ea.start>=ea.end&&(S>=ea.start||S<ea.end)?(N.remove(C[ba]),C.splice(ba,1)):ba++}N.remove(this._incrementalRouteSegment);this.set("displayedRouteGraphics",C?C:[]);J&&J.length&&m.forEach(J,function(fa){V.remove(fa)});this.set("displayedManeuverPointGraphics",[]);this._waypointsEventLayer.clear();this.unhighlightSegment(!0)},_clearInfoWindow:function(){var C=this.get("map").infoWindow;C&&(C.hide(),C.clearFeatures())},_clearDisplayBeforeSolve:function(){this._toggleSaveMenu(!1);
this._clearInfoWindow();this._clearResultsHTML()},_clearDisplayAfterSolve:function(){this._clearStopGraphics();this._clearRouteGraphics();this._clearBarriersGraphics();this.clearMessages()},_getLetter:function(C){var J=this.alphabet,N="",V=function(ea){var ia="";"0123456789"===J||"1234567890"===J?ia=String(ea+1):(ea=ea||0,ea>=J.length&&(ia=V(Math.floor(ea/J.length)-1),ea%=J.length),ia+=J[ea]);return ia},S=C instanceof R?x.hitch(this,function(){for(var ea=this.get("returnToStart")?0:-1,ia=0;ia<this.stops.length;ia++)if(this.stops[ia].feature===
C){ea=ia;break}return ea})():C;if(-1<S&&J&&J.length){J instanceof Array&&(J=J.toString().replace(/,/g,""));N=-1;for(var ba=0;ba<=S;ba++)N+=this._isStopAWaypoint(this.stops[ba])?0:1;N=V(N)}return N},_solveAndZoom:function(C){if(this.autoSolve)return this._getDirections().then(x.hitch(this,function(){C||this.zoomToFullRoute()}));var J=new P;J.resolve();return J.promise},_setupEvents:function(){this._onEvents.push(q(this.domNode,"[data-blur-on-click]:click",function(){this.blur()}));this._onEvents.push(q(this._dndNode,
"[data-reverse-stops]:click, [data-reverse-stops]:keydown",x.hitch(this,function(S){S&&("click"===S.type||"keydown"===S.type&&S.keyCode===k.ENTER)&&this.modifyStopSequence()})));this._onEvents.push(q(this._printButton,"click, keydown",x.hitch(this,function(S){S&&("click"===S.type||"keydown"===S.type&&S.keyCode===k.ENTER)&&this._printDirections()})));this._onEvents.push(q(this._resultsNode,"[data-full-route]:click, [data-full-route]:keydown",x.hitch(this,function(S){S&&("click"===S.type||"keydown"===
S.type&&S.keyCode===k.ENTER)&&this.zoomToFullRoute()})));this._onEvents.push(q(this._dndNode,"[data-remove]:click, [data-remove]:keydown",x.hitch(this,function(S){if(S&&("click"===S.type||"keydown"===S.type&&S.keyCode===k.ENTER)){var ba=y("[data-remove]",this._dndNode);S=m.indexOf(ba,S.target);this.removeStop(S)}})));this._onEvents.push(q(this._dndNode,"[data-center-at]:click, [data-center-at]:keydown",x.hitch(this,function(S){if(S&&("click"===S.type||"keydown"===S.type&&S.keyCode===k.ENTER)){var ba=
y("[data-center-at]",this._dndNode);S=m.indexOf(ba,S.target);this.stops[S]&&this.stops[S].feature&&this.stops[S].feature.geometry&&this.map.centerAndZoom(this.stops[S].feature.geometry)}})));this._onEvents.push(q(this.map,"zoom-end",x.hitch(this,function(){var S=this._segmentGraphics;S&&S[0]&&void 0!==S[0].attributes._index&&this.highlightSegment(S[0].attributes._index,!0)})));this._onEvents.push(q(this._dnd,"Drop",x.hitch(this,function(){this._dnd.sync();this.set("optimalRoute",!1);var S,ba=!1,ea=
[],ia=this._dnd.getAllNodes();for(S=0;S<this.geocoders.length;S++){var fa=m.indexOf(ia,this.geocoders[S]._tr);if(-1<fa&&S!==fa&&S!==fa-1){for(;0<fa&&this._isStopAWaypoint(this.stops[fa]);)fa--;ba=!0;break}}ba&&(ea=this._markWPsForRemovalAfterUserChangedStopSequence(S,fa));this._sortGeocoders();this.setListIcons();this._removeSomeWaypoints(ea);this.stops[fa].name&&this.getDirections()})));this._onEvents.push(q(this._dnd,"DndStart",x.hitch(this,function(){var S=y("body")[0];B.add(S,this._css.dndDragBodyClass);
this._removeLocateButtonVisibilityEvents()})));this._onEvents.push(q(this._dnd,"DndDrop, DndCancel",x.hitch(this,function(){var S=y("body")[0];B.remove(S,this._css.dndDragBodyClass);this._setLocateButtonVisibilityEvents()})));var C=this._handle,J=x.hitch(this,function(S){var ba=x.hitch(this,function(ia,fa,ka,ma,na){var qa=C._isShown();C.setGeometry(ia);C._tooltip.style.left=S.screenPoint.x+"px";C._tooltip.style.top=S.screenPoint.y+"px";!qa||C._index===ka&&C.attributes.isWaypoint===ma||(C._remove(),
qa=!1);C.setSymbol(fa);C._index=ka;C._isStopIcon=C._index===Math.floor(C._index);C.attributes.isWaypoint=ma;C._isStopIcon&&(C.attributes.address=this.stopGraphics[ka].attributes.address,C.setInfoTemplate(this.stopGraphics[ka].infoTemplate));if(this.canModifyWaypoints||C._isStopIcon)qa||(this._stopLayer.add(C),(ia=C.getDojoShape())&&ia[ma?"moveToBack":"moveToFront"].call(ia)),this.editToolbar.activate(Xa.MOVE,C);ma=ma?C._isStopIcon?G.widgets.directions.dragWaypoint:this.canModifyWaypoints?G.widgets.directions.dragRoute:
"":G.widgets.directions.dragStop;C._showTooltip(na||ma)});this.unhighlightSegment();if(this.mapClickActive&&this.dragging&&!this._solveInProgress&&!this._moveInProgress&&!C._solveTimeout)if(clearTimeout(C._removeTimeout),(S.graphic._isStopIcon||S.graphic._isStopLabel)&&!S.graphic.attributes.isWaypoint&&this.canModifyStops||S.graphic._isStopIcon&&S.graphic.attributes.isWaypoint&&this.canModifyWaypoints){var ea=S.graphic._isStopLabel?this.stopGraphics[S.graphic._index]:S.graphic;ba(ea.geometry,this._getStopSymbol(this.stops[ea._index],
!0),ea._index,!0===ea.attributes.isWaypoint);this._stopLayer.remove(this.stopGraphics[ea._index]);this._stopLayer.remove(this.textGraphics[ea._index])}else if(S.graphic._isSnapFeature||S.graphic._isHandle&&!S.graphic._isStopIcon)this._snappingManager||(this._snappingManager=this.map.snappingManager),this._snappingManager.getSnappingPoint(S.screenPoint).then(x.hitch(this,function(ia){if(!this.maxStopsReached&&!this._moveInProgress&&ia){for(var fa=this.displayedManeuverPointGraphics,ka=null,ma=0;ma<
fa.length;ma++)if(fa[ma].geometry.x===ia.x&&fa[ma].geometry.y===ia.y){ka=fa[ma]._directionsFeature;fa=m.indexOf(this.directions.features,ka);-1<fa&&this.highlightSegment(fa);break}ba(ia,S.graphic._isHandle?C.symbol:this.waypointSymbol,S.graphic._isHandle?C._index:S.graphic._nextStopIndex,S.graphic._isHandle?C.attributes.isWaypoint:!0,ka)}}))}),N=x.hitch(this,function(){clearTimeout(C._removeTimeout);C._removeTimeout=setTimeout(C._remove,100);this.unhighlightSegment()}),V=x.hitch(this,function(S){if(this.barrierToolActive){S=
S.graphic;var ba=this.routeParams,ea=ba.barriers?m.indexOf(ba.barriers.features,S):-1,ia=ba.polygonBarriers?m.indexOf(ba.polygonBarriers.features,S):-1,fa=ba.polylineBarriers?m.indexOf(ba.polylineBarriers.features,S):-1;-1<ea&&ba.barriers.features.splice(ea,1);-1<ia&&ba.polygonBarriers.features.splice(ia,1);-1<fa&&ba.polylineBarriers.features.splice(fa,1);this._barriersLayer.remove(S);this._polygonBarriersLayer.remove(S);this._polylineBarriersLayer.remove(S);this._clearStopsStatusAttr();this.getDirections(!0)}});
this._onEvents.push(this._waypointsEventLayer.on("mouse-move",J));this._onEvents.push(this._waypointsEventLayer.on("mouse-out",N));this._onEvents.push(this._stopLayer.on("mouse-move",J));this._onEvents.push(this._stopLayer.on("mouse-out",N));this._onEvents.push(this._barriersLayer.on("click",V));this._onEvents.push(this._polylineBarriersLayer.on("click",V));this._onEvents.push(this._polygonBarriersLayer.on("click",V));this._editToolbarEvents();this._watchEvents.push(this.watch("theme",this._updateThemeWatch));
this._watchEvents.push(this.watch("canModifyStops",this._updateCanModifyStops));this._watchEvents.push(this.watch("canModifyWaypoints",this._updateCanAddWaypoints));this._watchEvents.push(this.watch("showReturnToStartOption",this._optionsMenu));this._watchEvents.push(this.watch("showOptimalRouteOption",this._optionsMenu));this._watchEvents.push(this.watch("returnToStart",this._setMenuNodeValues));this._watchEvents.push(this.watch("optimalRoute",this._setMenuNodeValues));this._watchEvents.push(this.watch("startTime",
this._setStartTime));this._watchEvents.push(this.watch("traffic",this._setMenuNodeValues));this._watchEvents.push(this.watch("trafficLayer",this._trafficLayerUpdate));this._watchEvents.push(this.watch("routeTaskUrl",x.hitch(this,function(){this._createRouteTask();this._setTrafficOptions()})));this._watchEvents.push(this.watch("printTaskUrl",x.hitch(this,function(){this._createPrintTask()})));this._watchEvents.push(this.watch("geometryTaskUrl",x.hitch(this,function(){this._createGeometryTask()})));
this._watchEvents.push(this.watch("routeParams",x.hitch(this,function(){this._createRouteParams();this._setDefaultUnits()})));this._watchEvents.push(this.watch("searchOptions",x.hitch(this,function(){this._setSearchOptions();this._createGlobalGeocoder();var S=this.get("searchOptions").sources;if(S)for(var ba=0;ba<this.geocoders.length;ba++)this.geocoders[ba].set("sources",S)})));this._watchEvents.push(this.watch("showReverseStopsButton",this.setListIcons));this._watchEvents.push(this.watch("editToolbar",
this._editToolbarEvents));this._watchEvents.push(this.watch("showTravelModesOption",this._showTravelModesOption));this._watchEvents.push(this.watch("showMilesKilometersOption",this._showMilesKilometersOption));this._watchEvents.push(this.watch("showClearButton",this._showClearButton));this._watchEvents.push(this.watch("directionsLengthUnits",this.setDirectionsLengthUnits));this._watchEvents.push(this.watch("directionsLanguage",this.setDirectionsLanguage));this._watchEvents.push(this.watch("mapClickActive",
this._activate));this._watchEvents.push(this.watch("barrierToolActive",this._activateBarrierTool));this._watchEvents.push(this.watch("showActivateButton",this._showActivateButton));this._watchEvents.push(this.watch("showBarriersButton",this._showBarriersButton));this._watchEvents.push(this.watch("showPrintPage",function(){z.set(this._printButton,"display",this.showPrintPage?"inline-block":"none")}));this._watchEvents.push(this.watch("showSaveButton",function(){z.set(this._saveMenuButton,"display",
this.showSaveButton&&this.owningSystemUrl?"inline-block":"none")}))},_editToolbarEvents:function(){var C=x.hitch(this,function(N){var V="";if((N=N.routeResults?N.routeResults[0]:null)&&N.route){N=N.route.attributes;var S=this.routeParams.travelMode;if(S){V+="\x3cb\x3e"+S.name+"\x3c/b\x3e "+G.widgets.directions.toNearbyStops+": ";var ba=void 0!==N["Total_"+S.timeAttributeName]?this._formatTime(N["Total_"+S.timeAttributeName],!1,(this._getCostAttribute(S.timeAttributeName)||{}).units):"";V+=(void 0!==
N["Total_"+S.distanceAttributeName]?this._formatDistance(N["Total_"+S.distanceAttributeName],!0,(this._getCostAttribute(S.distanceAttributeName)||{}).units):"")+(ba?" \x26middot; "+ba:"")}else V=this._formatArbitraryCostsForRouteTooltip(N)}this._handle._showTooltip(V)}),J=x.hitch(this,function(N,V){var S=new P,ba=this._handle,ea=this.map.toScreen(ba._origPoint).offset(N.transform.dx+ba.symbol.xoffset,N.transform.dy+ba.symbol.yoffset);N.origMapPoint||(N.origMapPoint=this.map.toMap(ea));z.set(ba._tooltip,
"left",ea.x+"px");z.set(ba._tooltip,"top",ea.y+"px");clearTimeout(ba._solveTimeout);if(this._solveInProgress||!this._requestQueueTail.isFulfilled())ba._solveTimeout=setTimeout(function(){J(N,V).always(S.resolve)},100);else if(ba._isStopIcon){ea=N.graphic._index;var ia=this.stops[ea];(ia=ia?{name:ia.name,extent:ia.extent,feature:new R(ia.feature.toJson())}:null)?(ia.feature.setGeometry(N.origMapPoint),this._modifiedWaypointIndex=this._isStopAWaypoint(this.stops[ea])?ea:null,this._incrementalSolveStopRange=
{start:this.returnToStart?(this.stops.length+ea-1)%this.stops.length:Math.max(0,ea-1),end:this.returnToStart?(ea+1)%this.stops.length:Math.min(this.stops.length-1,ea+1)},this.updateStop(ia,ea,V).always(x.hitch(this,function(fa){ba._solveTimeout=null;fa.routeResults&&C(fa);S.resolve()}))):S.resolve()}else S.resolve();return S.promise});this._onEvents.push(q(this.editToolbar,"graphic-click",x.hitch(this,function(N){if(N.graphic.attributes.isWaypoint)!N.graphic._isStopIcon||this._moveInProgress||this._solveInProgress||
(this._handle._remove(),this._moveInProgress=!0,this.removeStop(N.graphic._index,!0).always(x.hitch(this,function(){this._moveInProgress=!1})));else{var V=this.get("map").infoWindow;V&&(V.setFeatures([N.graphic]),V.show(N.graphic.geometry))}})));this._onEvents.push(q(this.editToolbar,"graphic-move-start",x.hitch(this,function(N){this._blurGeocoders();this._moveInProgress=!0;this._removeEmptyStops();this.routeParams.returnDirections=!1;this.routeParams.returnRoutes=!0;N=N.graphic;N._origPoint=new ha(N.geometry.toJson());
N._maxDeviation=0;N._solveHasHappened=!1;this.map.disableMapNavigation()})));this._onEvents.push(q(this.editToolbar,"graphic-move-stop",x.hitch(this,function(N){this.map.enableMapNavigation();this.routeParams.returnDirections=!0;this.routeParams.returnRoutes=!1;if(this._handle._isStopIcon)if(this._handle._solveHasHappened)if(this._handle.attributes.isWaypoint)J(N,!0).always(x.hitch(this,function(){this._moveInProgress=!1;this._handle._isStopIcon=!0;this._handle._remove();this._showLoadingSpinner()}));
else{clearTimeout(this._handle._solveTimeout);this._handle._solveTimeout=null;var V=this.stops[N.graphic._index],S=(V&&V.feature&&V.feature.attributes&&V.feature.attributes.Name)===this._userDefinedStopName,ba=V&&V.name;this._reverseGeocode(new R(N.graphic.toJson())).then(x.hitch(this,function(ea){S&&(ea.name=ba,ea.feature.attributes.Name=this._userDefinedStopName);this._setReverseGeocode(ea,ea.feature.geometry,N.graphic._index).always(x.hitch(this,function(){this._moveInProgress=!1;this._handle._remove();
this._showLoadingSpinner()}))}))}else this._moveInProgress=!1;else this._moveInProgress=!1})));this._onEvents.push(q(this.editToolbar,"graphic-move",x.hitch(this,function(N){var V=this._handle,S=N.transform;S.dx&&S.dy&&(N.graphic._maxDeviation=Math.max(V._maxDeviation,Math.sqrt(S.dx*S.dx+S.dy*S.dy)));10<V._maxDeviation&&(V._solveHasHappened=!0,N.graphic===V&&V.attributes.isWaypoint&&!V._isStopIcon?(this.set("optimalRoute",!1),V._index+=.5,V._isStopIcon=!0,N.graphic._stopIndex=V._index,this._incrementalSolveStopRange=
{start:this.returnToStart?(this.stops.length+V._index-1)%this.stops.length:Math.max(0,V._index-1),end:this.returnToStart?(V._index+1)%(this.stops.length+1):Math.min(this.stops.length,V._index+1)},this.addStop({name:this._waypointName,feature:new R(V.geometry,V.symbol,{isWaypoint:!0,CurbApproach:3})},N.graphic._stopIndex)):((V=N.graphic.getDojoShape())&&V.moveToFront(),J(N)))})))},_isStopAWaypoint:function(C){return C&&C.feature&&C.feature.attributes&&C.feature.attributes.isWaypoint},_getStopCount:function(){var C=
0,J;for(J=0;J<this.stops.length;J++)C+=!this._isStopAWaypoint(this.stops[J])&&this.stops[J].name?1:0;return C},_getWaypointCount:function(){var C=0,J;for(J=0;J<this.stops.length;J++)C+=this._isStopAWaypoint(this.stops[J])?1:0;return C},_decorateUngeocodedStop:function(C){var J=new P,N=function(S,ba){J.resolve({name:void 0===S?G.widgets.directions.unlocatedStop:S.toFixed(6)+" "+ba.toFixed(6),feature:C})};if(C.geometry)if(C.geometry.spatialReference&&4326!==C.geometry.spatialReference.wkid)if(this.map&&
this.map.spatialReference&&this.map.spatialReference.isWebMercator()){var V=ca.xyToLngLat(C.geometry.x,C.geometry.y);N(V[0],V[1])}else this._geometryService?(V=new ab,V.outSR=new L(4326),V.geometries=[C.geometry],this._geometryService.project(V).then(x.hitch(this,function(S){S&&S.length?N(S[0].x,S[0].y):N(C.geometry.x,C.geometry.y)}),x.hitch(this,function(){N()}))):N(C.geometry.x,C.geometry.y);else N(C.geometry.x,C.geometry.y);else N();return J.promise},_trafficLayerUpdate:function(C,J,N){C=this.get("map");
J&&this._trafficLayerAdded&&(C.removeLayer(J),this._trafficLayerAdded=!1);N&&this.get("traffic")&&!this._trafficLayerAdded&&(C.addLayer(N),N.show(),this._trafficLayerAdded=!0)},_routeTaskError:function(C){var J=G.widgets.directions.error.routeTask,N=C.details,V=function(S){return(res=S.match(/(\d+)/))?": "+res[0]:"."};N&&1===N.length&&("The distance between any inputs must be less than 50 miles (80 kilometers) when walking."===N[0]?J=G.widgets.directions.error.maxWalkingDistance:"Driving a truck is currently not supported outside of North America and Central America."===
N[0]?J=G.widgets.directions.error.nonNAmTruckingMode:0===N[0].indexOf("The number of input locations loaded into Barriers")?J=G.widgets.directions.error.tooManyBarriers+V(N[0]):0===N[0].indexOf("The number of input locations loaded into PolygonBarriers")?J=G.widgets.directions.error.tooManyPolygonBarriers+V(N[0]):0===N[0].indexOf("The number of input locations loaded into PolylineBarriers")&&(J=G.widgets.directions.error.tooManyPolylineBarriers+V(N[0])));this._showMessage(J);this.onDirectionsFinish(C)},
_showMessage:function(C,J){var N="";this.messages.push({msg:C,error:!J});if(this.messages.length){N+="\x3cul\x3e";for(var V=0;V<this.messages.length;V++)N+='\x3cli class\x3d"'+(this.messages[V].error?this._css.routesErrorClass:this._css.routesInfoClass)+'"\x3e'+this.messages[V].msg+"\x3c/li\x3e";N+="\x3c/ul\x3e"}this._msgNode&&(this._msgNode.innerHTML=N);if(!J)this.onError(C)},_isTimeUnits:function(C){return"milliseconds"===C||"esriNAUSeconds"===C||"esriNAUMinutes"===C||"esriNAUHours"===C||"esriNAUDays"===
C},_getImpedanceAttribute:function(){return this._getCostAttribute(this.routeParams&&this.routeParams.travelMode&&this.routeParams.travelMode.impedanceAttributeName||this.routeParams.impedanceAttribute||this.serviceDescription.impedance)},_getDirectionsTimeAttribute:function(){return this._getCostAttribute(this.routeParams&&this.routeParams.travelMode&&this.routeParams.travelMode.timeAttributeName||this.routeParams.directionsTimeAttribute||this.serviceDescription.directionsTimeAttribute)},_getTimeNeutralAttribute:function(){var C=
(this._getDirectionsTimeAttribute()||{}).timeNeutralAttributeName;return this._getCostAttribute(C)},_getCostAttribute:function(C){for(var J=this.serviceDescription&&this.serviceDescription.networkDataset.networkAttributes||[],N,V=0;V<J.length;V++)if(J[V].name===C&&"esriNAUTCost"===J[V].usageType){N=J[V];break}return N},_convertCostValue:function(C,J,N){var V=this._isTimeUnits(J),S=this._isTimeUnits(N);J=V?this._toMinutes(C,J):this._toMeters(C,J);return V===S?S?this._fromMinutes(J,N):this._fromMeters(J,
N):C},_toMinutes:function(C,J,N){C=C||0;switch(J){case "milliseconds":C/=Math.pow(6E4,N?-1:1);break;case "esriNAUSeconds":C/=Math.pow(60,N?-1:1);break;case "esriNAUHours":C*=Math.pow(60,N?-1:1);break;case "esriNAUDays":C*=Math.pow(1440,N?-1:1)}return C},_fromMinutes:function(C,J){return this._toMinutes(C,J,!0)},_toMeters:function(C,J,N){C=C||0;switch((J||"").replace("esriNAU","esri")){case "esriInches":C*=Math.pow(.0254,N?-1:1);break;case "esriFeet":C*=Math.pow(.3048,N?-1:1);break;case "esriYards":C*=
Math.pow(.9144,N?-1:1);break;case "esriMiles":C*=Math.pow(1609.344,N?-1:1);break;case "esriNauticalMiles":C*=Math.pow(1851.995396854,N?-1:1);break;case "esriMillimeters":C/=Math.pow(1E3,N?-1:1);break;case "esriCentimeters":C/=Math.pow(100,N?-1:1);break;case "esriKilometers":C*=Math.pow(1E3,N?-1:1);break;case "esriDecimeters":C/=Math.pow(10,N?-1:1)}return C},_fromMeters:function(C,J){return this._toMeters(C,J,!0)},_createRouteTask:function(){var C=new P;this.set("routeTask",new Sa(this.get("routeTaskUrl")));
this._createRouteParams();this.routeTask.getServiceDescription(this.travelModesServiceUrl,this.doNotFetchTravelModesFromOwningSystem).then(x.hitch(this,function(J){J.networkDataset?(this.set("serviceDescription",J),this.set("maxStops",parseInt(this.userOptions.maxStops||J.serviceLimits&&J.serviceLimits.Route_MaxStops||this.defaults.maxStops)),this.defaults.portalUrl?(this.owningSystemUrl=this.defaults.portalUrl,C.resolve()):this.routeTask.getOwningSystemUrl().then(x.hitch(this,function(N){this.owningSystemUrl=
N;C.resolve()}),C.reject)):(this._showMessage(G.widgets.directions.error.cantFindRouteServiceDescription),C.reject(Error(G.widgets.directions.error.cantFindRouteServiceDescription)))}),x.hitch(this,function(){this._showMessage(G.widgets.directions.error.cantFindRouteServiceDescription);C.reject(Error(G.widgets.directions.error.cantFindRouteServiceDescription));this.mapClickActive=!1;this._activate()}));return C.promise},_createSearchSourceDDL:function(){if(this._globalGeocoder&&this._globalGeocoder.sources&&
1<this._globalGeocoder.sources.length){var C=x.hitch(this,function(V){this._searchSourceSelector.domNode.blur();this._globalGeocoder.set("activeSourceIndex",V);for(var S=0;S<this.geocoders.length;S++)this.geocoders[S].set("activeSourceIndex",V);this._truncateSearchSourceIfNeeded()});if(!this._searchSourceSelector){for(var J=[{value:"all",label:G.widgets.Search.main.all,selected:!0}],N=0;N<this._globalGeocoder.sources.length;N++)J.push({value:String(N),label:this._globalGeocoder.sources[N].name});
this._searchSourceSelector=new c({className:"esriSearchSourcesDDL",style:"width:100%;",options:J},this._searchSourceSelectorContainer);this._searchSourceSelector.startup();this._searchSourceSelector.on("change",C);this._searchSourceSelector.domNode.style.width=""}C("all")}else 2>this._globalGeocoder.sources.length&&(this._searchSourceContainerNode.style.display="none")},_createTravelModesDDL:function(){this._travelModeSelector||(this._travelModeSelector=new c({className:"esriTravelModesDDL",style:"width:100%;"},
this._travelModeSelectorContainer),this._travelModeSelector.startup(),this._travelModeSelector._interractive=!0,this._travelModeSelector.on("change",x.hitch(this,function(C){this._travelModeSelector._interractive?this._enqueue(function(){return this._setTravelMode(C).always(x.hitch(this,function(){this._travelModeSelector._interractive=!0}))}):this._travelModeSelector._interractive=!0})))},_setupTravelModes:function(){var C=this.get("serviceDescription"),J=C.supportedTravelModes,N=new P;if(J&&J.length&&
this._travelModeSelector){for(var V=J[0].name,S=[],ba=0;ba<J.length;ba++){for(var ea="AUTOMOBILE"===J[ba].type?"Driving":"TRUCK"===J[ba].type?"Trucking":"WALK"===J[ba].type?"Walking":"Other",ia="",fa=C.networkDataset.networkAttributes,ka=0;ka<fa.length;ka++){var ma=fa[ka];if(ma.name===J[ba].impedanceAttributeName){if("esriNAUCentimeters"===ma.units||"esriNAUDecimalDegrees"===ma.units||"esriNAUDecimeters"===ma.units||"esriNAUFeet"===ma.units||"esriNAUInches"===ma.units||"esriNAUKilometers"===ma.units||
"esriNAUMeters"===ma.units||"esriNAUMiles"===ma.units||"esriNAUMillimeters"===ma.units||"esriNAUNauticalMiles"===ma.units||"esriNAUYards"===ma.units)ia="Distance";else if("esriNAUDays"===ma.units||"esriNAUHours"===ma.units||"esriNAUMinutes"===ma.units||"esriNAUSeconds"===ma.units)ia="Time";break}}S.push({id:J[ba].name,label:'\x3cdiv class\x3d"esriTravelModesDirectionsIcon esriTravelModesType'+ea+ia+'"\x3e\x26nbsp;\x3c/div\x3e\x3cdiv class\x3d"esriTravelModesTypeName" title\x3d"'+J[ba].description+
'"\x3e'+J[ba].name+"\x3c/div\x3e"});!C.defaultTravelMode||J[ba].id!==C.defaultTravelMode&&J[ba].itemId!==C.defaultTravelMode||(V=J[ba].name)}this._showTravelModesOption();this._travelModeSelector.setStore(new e({objectStore:new g({data:S})}));this._travelModeSelector._interractive=!1;this._travelModeSelector.setValue(V);this._setTravelMode(V).always(N.resolve)}else this._checkStartTimeUIAvailability(),this.set("showTravelModesOption",!1),N.resolve();return N.promise},_createPrintTask:function(){this._printService=
(this.printTaskUrl=this._usingAGOL()?this.printTaskUrl:this.defaults.printTaskUrl)?new La(this.printTaskUrl,{async:!1}):null;var C=new ya;C.exportOptions={width:670,height:750,dpi:96};C.format="PNG32";C.layout="MAP_ONLY";C.preserveScale=!1;C.showAttribution=!1;var J=new $a;J.map=this.map;J.outSpatialReference=this.map.spatialReference;J.template=C;this._printParams=J},_createGeometryTask:function(){this._geometryService=null;this._usingAGOL()?this._geometryService=new Ta(this.geometryTaskUrl):this.geometryTaskUrl=
(this._geometryService=this.defaults.geometryTaskUrl?new Ta(this.defaults.geometryTaskUrl):cb.defaults.geometryService)?this._geometryService.url:null},_showTravelModesOption:function(){var C=this.get("serviceDescription");z.set(this._travelModeContainerNode,"display",this.showTravelModesOption&&C&&C.supportedTravelModes&&C.supportedTravelModes.length&&!this.doNotFetchTravelModesFromOwningSystem?"block":"none")},_showMilesKilometersOption:function(){z.set(this._agolDistanceUnitsNode,"display",this.showMilesKilometersOption?
"block":"none")},_showClearButton:function(){z.set(this._clearDirectionsButtonNode,"display",this.showClearButton?"inline-block":"none")},_showActivateButton:function(){z.set(this._activateButtonNode,"display",this.showActivateButton?"inline-block":"none");this.showActivateButton||this.deactivate()},_showBarriersButton:function(){z.set(this._lineBarrierButtonNode,"display",this.showBarriersButton?"inline-block":"none");this.showBarriersButton||this.deactivateBarrierTool()},_createRouteParams:function(){var C=
{returnDirections:!0,returnRoutes:!1,outputLines:"esriNAOutputLineTrueShape",preserveFirstStop:!0,preserveLastStop:!0,directionsOutputType:"complete",stops:new Va,ignoreInvalidLocations:!0,doNotLocateOnRestrictedElements:!0,outSpatialReference:this.get("map").spatialReference};this.get("routeParams")||(this.routeParams={});var J=new Ra;this.routeParams=x.mixin(J,{outputGeometryPrecision:0,outputGeometryPrecisionUnits:"esriMeters",restrictUTurns:"esriNFSBAtDeadEndsOnly"},this.get("routeParams"),C)},
_markWPsForRemovalAfterUserChangedStopSequence:function(C,J){for(var N=C-1,V=[];0<=N&&this._isStopAWaypoint(this.stops[N]);)V.push(this.stops[N]),N--;for(N=C+1;N<this.stops.length&&this._isStopAWaypoint(this.stops[N]);)V.push(this.stops[N]),N++;if(J>C)for(N=J+1;N<this.stops.length&&this._isStopAWaypoint(this.stops[N]);)V.push(this.stops[N]),N++;else if(void 0!==J)for(N=J-1;0<=N&&this._isStopAWaypoint(this.stops[N]);)V.push(this.stops[N]),N--;else if(this.returnToStart&&0===C)for(N=this.stops.length-
1;0<=N&&this._isStopAWaypoint(this.stops[N]);)V.push(this.stops[N]),N--;return V},_removeSomeWaypoints:function(C){for(var J=new P,N=[],V=0;V<C.length;V++){var S=m.indexOf(this.stops,C[V]);-1<S&&N.push(this._removeStop(S,!0,!0))}M(N).always(J.resolve);return J.promise},_modifyStopSequence:function(C,J){var N=this._dnd.getAllNodes(),V=new P,S,ba=[];if(N.length)if(this._removeLocateButtonVisibilityEvents(),arguments.length&&void 0!==C)if(0<=C&&0<=J&&C<this.stops.length&&J<this.stops.length&&C!==J){N=
this._markWPsForRemovalAfterUserChangedStopSequence(C,J);var ea=this.stops.splice(C,1);this.stops.splice(J,0,ea[0]);for(S=0;S<this.stops.length;S++)ba.push(this._updateStop(this.stops[S],S));ba.push(this._removeSomeWaypoints(N));M(ba).always(x.hitch(this,function(){this._solveAndZoom().always(V.resolve)}))}else V.reject("Invalid From and To values.");else{for(S=0;S<this.stops.length;)this._isStopAWaypoint(this.stops[S])?ba.push(this._removeStop(S,!0,!0)):S++;M(ba).always(x.hitch(this,function(){ba=
[];this.stops.reverse();for(S=0;S<this.stops.length;S++)ba.push(this._updateStop(this.stops[S],S));M(ba).always(x.hitch(this,function(){this._solveAndZoom().always(V.resolve)}))}))}else V.resolve();return V.promise},_setMenuNodeValues:function(C){"traffic"!==C&&this._clearDisplayBeforeSolve();C=this.get("optimalRoute");this._findOptimalOrderNode&&A.set(this._findOptimalOrderNode,"checked",C);this._returnToStartNode&&(C=this.returnToStart&&!this.maxStopsReached&&this.stops[0]&&(!this.stops[0].feature||
this._isStopLocated(this.stops[0])),A.set(this._returnToStartNode,"checked",C),this.set("returnToStart",C),this.maxStopsReached&&this.returnToStart&&this._showMessage(G.widgets.directions.error.maximumStops));if(!this.returnToStart&&!this._incrementalSolveStopRange&&this.directions)for(this._incrementalSolveStopRange={start:this.stops.length-1,end:this.stops.length},this._clearRouteGraphics(),this._incrementalSolveStopRange=null,C=this.stops.length;0<C--&&this._isStopAWaypoint(this.stops[C]);)this._removeSomeWaypoints([this.stops[C]]);
this._useTrafficNode&&(A.set(this._useTrafficNode,"checked",this.traffic),this.traffic?(this._updateMapTimeExtent(),this._addTrafficLayer()):(this._removeTrafficLayer(),this._restoreMapTimeExtent()));switch(this.get("directionsLengthUnits")){case da.KILOMETERS:A.set(this._useKilometersNode,"checked",!0);A.set(this._useMilesNode,"checked",!1);break;case da.MILES:A.set(this._useKilometersNode,"checked",!1),A.set(this._useMilesNode,"checked",!0)}z.set(this._printButton,"display",this.showPrintPage?"inline-block":
"none");z.set(this._saveMenuButton,"display",this.showSaveButton&&this.owningSystemUrl?"inline-block":"none");this._showMilesKilometersOption();this._showClearButton()},_optionsMenu:function(){this._useTrafficItemNode&&z.set(this._useTrafficItemNode,"display",this.get("showTrafficOption")?"block":"none");this._returnToStartItemNode&&z.set(this._returnToStartItemNode,"display",this.get("showReturnToStartOption")?"block":"none");this._findOptimalOrderItemNode&&z.set(this._findOptimalOrderItemNode,"display",
this.get("showOptimalRouteOption")&&3<this._getStopCount()?"block":"none");this.stops.length>=this.get("minStops")?B.add(this._widgetContainer,this._css.stopsOptionsOptionsEnabledClass):(B.remove(this._widgetContainer,this._css.stopsOptionsOptionsEnabledClass),this._optionsMenuNode&&"block"===z.get(this._optionsMenuNode,"display")&&this._toggleOptionsMenu())},_stopsRemovable:function(){2<this._dnd.getAllNodes().length-this._getWaypointCount()?B.add(this._widgetContainer,this._css.stopsRemovableClass):
B.remove(this._widgetContainer,this._css.stopsRemovableClass)},_checkMaxStops:function(){this.set("maxStopsReached",this._getStopCount()+this._getWaypointCount()+(this.returnToStart?1:0)>=this.maxStops);this._showAddDestination()},_updateThemeWatch:function(C,J,N){B.remove(this.domNode,J);B.add(this.domNode,N)},_toggleOptionsMenu:function(){"block"===z.get(this._optionsMenuNode,"display")?(z.set(this._optionsMenuNode,"display","none"),B.remove(this._optionsButtonNode,"esriStopsOptionsOpen"),this._optionsButtonNode.innerHTML=
G.widgets.directions.showOptions):(z.set(this._optionsMenuNode,"display","block"),B.add(this._optionsButtonNode,"esriStopsOptionsOpen"),this._optionsButtonNode.innerHTML=G.widgets.directions.hideOptions)},_toggleSaveMenu:function(C){"block"===z.get(this._saveMenuNode,"display")||!1===C?(z.set(this._saveMenuNode,"display","none"),B.remove(this._saveMenuButton,this._css.stopsPressedButtonClass)):(this.clearMessages(),z.set(this._saveMenuNode,"display","block"),B.add(this._saveMenuButton,this._css.stopsPressedButtonClass),
this._enableSharing().then(x.hitch(this,function(){this._outputLayer.setValue(this.routeLayer.title?this.routeLayer.title:this.directions&&this.directions.routeName);if(this.routeLayer.ownerFolder)for(var J=this._folderSelector.store.objectStore.data,N=0;N<J.length;N++)if(J[N].folderId===this.routeLayer.ownerFolder){this._folderSelector.getValue()!==J[N].id&&(this._folderSelector._interractive=!1,this._folderSelector.setValue(J[N].id));break}this._enableButton(this._saveButton,this.routeLayer.isItemOwner||
!this._userCanCreatePortalItem);this._outputLayer.set("disabled",!1)})))},_showToolbar:function(){B[this.stops.length<this.maxStops&&this.canModifyStops||this.canModifyWaypoints?"add":"remove"].call(I,this._widgetContainer,this._css.addStopsClass)},_showAddDestination:function(){this._showToolbar();this._addDestinationNode.style.display=this.stops.length<this.maxStops&&this.canModifyStops?"inline":"none"},_showMapClickActiveButton:function(){this._showToolbar();this._activateButtonNode.style.display=
this.canModifyStops||this.canModifyWaypoints?"inline-block":"none"},_getAbsoluteUrl:function(C){C=t.toUrl(C);return/^https?:/i.test(C)?C:/^\/\//i.test(C)?Ua+C:/^\//i.test(C)?Ua+"//"+window.location.host+C:C},_getManeuverImage:function(C){return C?"esriDMTStop"===C||"esriDMTDepart"===C?"":this._getAbsoluteUrl("./images/Directions/maneuvers/"+C+".png"):""},_loadPrintDirections:function(C){var J=this.get("printTemplate"),N=new P;this.directionsLengthUnits!==this.routeParams.directionsLengthUnits?this.getDirections().then(N.resolve,
N.reject):N.resolve();N.then(x.hitch(this,function(){if(!J&&this.directions){var V=this._getAbsoluteUrl("./css/Directions.css"),S=this._getAbsoluteUrl("./css/DirectionsPrint.css"),ba=this._getAbsoluteUrl("./images/Directions/print-logo.png");var ea=v.isBodyLtr()?"ltr":"rtl";J="";J+="\x3c!DOCTYPE HTML\x3e";J+='\x3chtml lang\x3d"en" class\x3d"'+this.get("theme")+'" dir\x3d"'+ea+'"\x3e';J+="\x3chead\x3e";J+='\x3cmeta charset\x3d"utf-8"\x3e';J+='\x3cmeta http-equiv\x3d"X-UA-Compatible" content\x3d"IE\x3dEdge,chrome\x3d1"\x3e';
J+="\x3ctitle\x3e"+this.get("directions").routeName+"\x3c/title\x3e";J+='\x3clink rel\x3d"stylesheet" media\x3d"screen" type\x3d"text/css" href\x3d"'+V+'" /\x3e';J+='\x3clink rel\x3d"stylesheet" media\x3d"print" type\x3d"text/css" href\x3d"'+S+'" /\x3e';J+="\x3c/head\x3e";J+='\x3cbody class\x3d"'+this._css.esriPrintPageClass+'"\x3e';J+='\x3cdiv class\x3d"'+this._css.esriPrintBarClass+'"\x3e';J+='\x3cdiv class\x3d"'+this._css.esriCloseButtonClass+'" title\x3d"'+G.common.close+'" onclick\x3d"window.close();"\x3e'+
G.common.close+"\x3c/div\x3e";J+='\x3cdiv id\x3d"printButton" class\x3d"'+this._css.esriPrintButtonClass+'" title\x3d"'+G.widgets.directions.print+'" onclick\x3d"window.print();"\x3e'+G.widgets.directions.print+"\x3c/div\x3e";J+="\x3c/div\x3e";J+='\x3cdiv class\x3d"'+this._css.esriPrintMainClass+'"\x3e';J+='\x3cdiv class\x3d"'+this._css.esriPrintHeaderClass+'"\x3e';J+='\x3cimg class\x3d"'+this._css.esriPrintLogoClass+'" src\x3d"'+ba+'" /\x3e';J+='\x3cdiv class\x3d"'+this._css.esriPrintNameClass+'"\x3e'+
this.get("directions").routeName+"\x3c/div\x3e";J+=this._renderDirectionsSummary(this.directions);C&&(J+='\x3cdiv id\x3d"divMap" class\x3d"esriPrintMap esriPrintWait"\x3e\x3c/div\x3e',J+='\x3chr class\x3d"esriNoPrint"/\x3e');J+='\x3cdiv id\x3d"print_helper"\x3e\x3c/div\x3e';J+='\x3ctextarea onkeyup\x3d"document.getElementById(\'print_helper\').innerHTML\x3dthis.value;" id\x3d"print_area" class\x3d"'+this._css.esriPrintNotesClass+'" placeholder\x3d"'+G.widgets.directions.printNotes+'"\x3e\x3c/textarea\x3e';
J+='\x3cdiv class\x3d"'+this._css.clearClass+'"\x3e\x3c/div\x3e';J+="\x3c/div\x3e";J+='\x3cdiv class\x3d"'+this._css.esriPrintDirectionsClass+'"\x3e';J+=this._renderDirectionsTable(this.directions);J+="\x3c/div\x3e";J+="\x3c/div\x3e";J+="\x3c/div\x3e";J+="\x3c/body\x3e";J+="\x3c/html\x3e"}this._printWindow.document.open("text/html","replace");this._printWindow.document.write(J);this._printWindow.document.close()}))},resize:function(){this._truncateSearchSourceIfNeeded()},_truncateSearchSourceIfNeeded:function(){var C=
this._searchSourceSelector;if(this._searchSourceSelector){var J=C.containerNode.firstChild;z.set(J,"width","");C.domNode.clientWidth>this.domNode.clientWidth&&z.set(J,"width",this._searchSourceContainerNode.clientWidth-20+"px")}},_printDirections:function(){if(this.directions){var C=screen.width/2,J=screen.height/1.5;C="toolbar\x3dno, location\x3dno, directories\x3dno, status\x3dyes, menubar\x3dno, scrollbars\x3dyes, resizable\x3dyes, width\x3d"+C+", height\x3d"+J+", top\x3d"+(screen.height/2-J/2)+
", left\x3d"+(screen.width/2-C/2);this.get("printPage")?(window.directions=this.get("directions"),window.open(this.get("printPage"),"directions_widget_print",C,!0)):(this._printWindow=window.open("","directions_widget_print",C,!0),this._loadPrintDirections(!!this._printService),this._printService&&t(["dojo/_base/window"],x.hitch(this,function(N){this.zoomToFullRoute().then(x.hitch(this,function(){this._printService.execute(this._printParams,x.hitch(this,function(V){N.withDoc(this._printWindow.document,
function(){var S=r.byId("divMap");S&&(B.remove(S,"esriPrintWait"),B.add(S,"esriPageBreak"),I.create("img",{src:V.url,"class":"esriPrintMapImg"},S))})}),x.hitch(this,function(V){N.withDoc(this._printWindow.document,function(){var S=r.byId("divMap");S&&B.remove(S,"esriPrintWait")})}))}))})))}},_enableButton:function(C,J){var N=J||void 0===J;B[N?"remove":"add"].apply(this,[C,"esriDisabledDirectionsButton"]);C._enabled=N},_clearStopsStatusAttr:function(){for(var C=0;C<this.stops.length;C++)this.stops[C].feature&&
this.stops[C].feature.attributes&&(this.stops[C].feature.attributes.Status=void 0)},_enableSharing:function(){var C=new P;!this._naRouteSharing&&this.owningSystemUrl?t(["../tasks/NARouteSharing"],x.hitch(this,function(J){this._naRouteSharing=new J(this.owningSystemUrl,this.map.spatialReference);this._folderSelector||(this._folderSelector=new c({className:"esriFoldersDDL",style:"width: 100%;",sortByLabel:!1,disabled:!0,_interractive:!0,onChange:x.hitch(this,function(){this._folderSelector._interractive?
this._enableButton(this._saveButton,!this.routeLayer.itemId):this._folderSelector._interractive=!0})},this._folderSelectorContainer),this._folderSelector.startup(),this._outputLayer=new l({style:"width: 100%",required:!0,trim:!0,regExp:'[^\x26|\x3c|\x3e|%|#|?|\\|"|/|+]+',maxLength:98,disabled:!0,onKeyPress:x.hitch(this,function(){this._enableButton(this._saveButton,!this.routeLayer.itemId||!this._userCanCreatePortalItem)}),onFocus:x.hitch(this,function(){this.map&&this.map.disableKeyboardNavigation()}),
onBlur:x.hitch(this,function(){this.map&&this.map.enableKeyboardNavigation()})},this._outputLayerContainer),this._outputLayer.startup());this._naRouteSharing.getFolders().then(x.hitch(this,function(N){for(var V=[],S=0;S<N.length;S++)V.push({id:N[S].url,folderId:N[S].id,label:N[S].title});this._folderSelector.setStore(new e({objectStore:new g({data:V})}));this._naRouteSharing.canCreateItem().then(x.hitch(this,function(ba){this._folderSelector.set("disabled",!ba);this._userCanCreatePortalItem=ba}));
this._enableButton(this._saveButton);C.resolve()}),x.hitch(this,function(N){this._naRouteSharing=null;this._toggleSaveMenu(!1);C.reject(N)}))})):this.owningSystemUrl?C.resolve():(C.reject(Error("Owning system is not defined, or the Directions widget is not done initializing.")),this._naRouteSharing=null);return C.promise},_storeRouteUI:function(){var C=new P;this._outputLayer&&this._outputLayer.isValid()?this._storeRoute(this._outputLayer.getValue(),this._folderSelector.getValue(),this._folderSelector.store.objectStore.get(this._folderSelector.getValue()).folderId).then(C.resolve,
C.reject):(this._outputLayer&&this._outputLayer.focus(),C.reject(Error("Need result layer name specified.")));return C.promise},_storeRoute:function(C,J,N){var V=new P,S=this.directions;if(this._savingRoute||!this._naRouteSharing)return this._saveButton.blur(),V.reject(Error("Not ready to store route.")),V.promise;this.clearMessages();V.then(null,x.hitch(this,function(pa){this._showMessage(G.widgets.directions.error.cantSaveRoute)}));V.promise.always(x.hitch(this,function(){this._enableButton(this._saveButton);
z.set(this._saveAsButton,"display",this.routeLayer.itemId&&this._userCanCreatePortalItem?"inline-block":"none");this._showLoadingSpinner();this._savingRoute=!1}));if(S&&S.features&&S.features.length&&this.stops&&this.stops.length)if(this.owningSystemUrl)if(this.routeParams&&this.routeParams.travelMode)if(C&&J){var ba=x.hitch(this,function(pa){return this._naRouteSharing.getAttributeUnits(pa,this.serviceDescription)});var ea=this.routeParams.travelMode.timeAttributeName;var ia=this.routeParams.travelMode.distanceAttributeName,
fa=ba(ea),ka=ba(ia),ma=this.routeParams.directionsLengthUnits||this.serviceDescription.directionsLengthUnits,na=this._naRouteSharing.toMeters,qa=this._naRouteSharing.toMinutes,xa=function(pa,Ea,Ja){var Ga;for(Ga in pa)if(pa.hasOwnProperty(Ga)&&0===Ga.indexOf(Ea)&&-1===m.indexOf(Ja,Ga.substr(Ea.length))){var fb=fb||{};fb[Ga.substr(Ea.length)]=pa[Ga]}return fb},ta=[],ua=[],Da=[];if(ea&&fa&&ia&&ka){var Ma=[],Ha=this.routeParams.accumulateAttributes||this.serviceDescription.accumulateAttributeNames||
[],Ia=this.serviceDescription.networkDataset.networkAttributes;for(ba=0;ba<Ia.length;ba++)"esriNAUTCost"===Ia[ba].usageType&&-1===m.indexOf(Ha,Ia[ba].name)&&Ia[ba].name!==ea&&Ia[ba].name!==ia&&Ma.push(Ia[ba].name);Ha=this.get("stops");var Aa={xmin:Infinity,ymin:Infinity,xmax:-Infinity,ymax:-Infinity};for(ba=0;ba<Ha.length;ba++)if(Ha[ba].feature&&Ha[ba].feature.toJson){Ia=Ha[ba].feature.toJson();var ra=Ia.attributes;var sa=Ia.geometry,Ka=this._naRouteSharing.getUTCOffset(ra.ArriveTime,ra.ArriveTimeUTC),
Pa=this._naRouteSharing.getUTCOffset(ra.DepartTime,ra.DepartTimeUTC);x.mixin(Aa,{xmin:Aa.xmin>sa.x?sa.x:Aa.xmin,ymin:Aa.ymin>sa.y?sa.y:Aa.ymin,xmax:Aa.xmax<sa.x?sa.x:Aa.xmax,ymax:Aa.ymax<sa.y?sa.y:Aa.ymax});Ia.attributes={__OBJECTID:ba+1,CurbApproach:ra.CurbApproach,ArrivalCurbApproach:ra.ArriveCurbApproach,DepartureCurbApproach:ra.DepartCurbApproach,Name:ra.Name===this._waypointName?G.widgets.directions.waypoint:ra.Name===this._userDefinedStopName?Ha[ba].name:ra.Name,RouteName:S.routeName,Sequence:ra.Sequence,
Status:ra.Status,LocationType:ra.isWaypoint?1:0,TimeWindowStart:ra.TimeWindowStart,TimeWindowEnd:ra.TimeWindowEnd,TimeWindowStartUTCOffset:Ka,TimeWindowEndUTCOffset:Ka,ServiceMinutes:qa(ra["Attr_"+ea],fa),ServiceMeters:na(ra["Attr_"+ia],ka),ServiceCosts:H.stringify(xa(ra,"Attr_",Ma)),CumulativeMinutes:qa(ra["Cumul_"+ea],fa),CumulativeMeters:na(ra["Cumul_"+ia],ka),CumulativeCosts:H.stringify(xa(ra,"Cumul_",Ma)),LateMinutes:qa(ra["Violation_"+ea],fa),WaitMinutes:qa(ra["Wait_"+ea],fa),ArrivalTime:this._naRouteSharing.toUTCTime(ra.ArriveTime,
Ka),DepartureTime:this._naRouteSharing.toUTCTime(ra.DepartTime,Pa),ArrivalUTCOffset:Ka,DepartureUTCOffset:Pa};ta.push(Ia)}ia=0;ka=function(pa){try{pa.strings=H.parse(pa.strings)}catch(Ja){Za.strings=void 0}if(pa.strings&&pa.strings.length)for(var Ea=0;Ea<pa.strings.length;Ea++)if("esriDSTGeneral"===pa.strings[Ea].stringType)return pa.strings[Ea].string};Ha=function(pa,Ea){for(var Ja=[],Ga=0;Ga<(pa||[]).length;Ga++)pa[Ga].stringType!==Ea&&Ea||Ja.push(pa[Ga].string);return Ja.length?Ja.toString():void 0};
Ia=function(pa){switch(pa){case "esriDMTStop":return"esriDPTManeuverArrive";case "esriDMTDepart":return"esriDPTManeuverDepart";case "esriDMTDoorPassage":return"esriDPTManeuverDoor";case "esriDMTBearLeft":return"esriDPTManeuverBearLeft";case "esriDMTBearRight":return"esriDPTManeuverBearRight";case "esriDMTElevator":return"esriDPTManeuverElevator";case "esriDMTEscalator":return"esriDPTManeuverEscalator";case "esriDMTFerry":return"esriDPTManeuverFerryOn";case "esriDMTEndOfFerry":return"esriDPTManeuverFerryOff";
case "esriDMTForkCenter":return"esriDPTManeuverForkCenter";case "esriDMTForkLeft":return"esriDPTManeuverForkLeft";case "esriDMTForkRight":return"esriDPTManeuverForkRight";case "esriDMTPedestrianRamp":return"esriDPTManeuverPedestrianRamp";case "esriDMTRampLeft":return"esriDPTManeuverRampLeft";case "esriDMTRampRight":return"esriDPTManeuverRampRight";case "esriDMTRoundabout":return"esriDPTManeuverRoundabout";case "esriDMTTurnLeft":return"esriDPTManeuverTurnLeft";case "esriDMTLeftLeft":return"esriDPTManeuverTurnLeftLeft";
case "esriDMTLeftRight":return"esriDPTManeuverTurnLeftRight";case "esriDMTTurnRight":return"esriDPTManeuverTurnRight";case "esriDMTRightLeft":return"esriDPTManeuverTurnRightLeft";case "esriDMTRightRight":return"esriDPTManeuverTurnRightRight";case "esriDMTSharpLeft":return"esriDPTManeuverSharpLeft";case "esriDMTSharpRight":return"esriDPTManeuverSharpRight";case "esriDMTStraight":return"esriDPTManeuverStraight";case "esriDMTStrairs":return"esriDPTManeuverStairs";case "esriDMTUTurn":return"esriDPTManeuverUTurn"}return"esriDPTUnknown"};
for(ba=0;ba<S.featuresWithWaypoints.length;ba++){var Qa=S.featuresWithWaypoints[ba];sa=Qa.toJson();Ka=sa.attributes;Pa=sa.geometry&&sa.geometry.paths&&sa.geometry.paths[0]||[];var Ya=sa.geometry.hasM||Pa[0]&&3===Pa[0].length;ra=this._naRouteSharing.getUTCOffset(Ka.ETA,Ka.arriveTimeUTC);sa.attributes={__OBJECTID:ba+1,Sequence:++ia,StopID:function(){var pa=void 0,Ea=Qa._associatedStopWithReturnToStart&&Qa._associatedStopWithReturnToStart.attributes.Sequence;if(Ea)for(var Ja=0;Ja<ta.length;Ja++)if(ta[Ja].attributes.Sequence===
Ea){pa=ta[Ja].attributes.__OBJECTID;break}return pa}(),DirectionPointType:Ia(Ka.maneuverType),DisplayText:Qa._associatedStopWithReturnToStart&&Qa._associatedStopWithReturnToStart.attributes.isWaypoint?Ka.text.replace(this._waypointName,G.widgets.directions.waypoint):Ka.text,ArrivalTime:this._naRouteSharing.toUTCTime(Ka.ETA,ra),ArrivalUTCOffset:ra,Azimuth:void 0,Name:Ha(S.stringsWithWaypoints[ba],"esriDSTStreetName"),AlternateName:Ha(S.stringsWithWaypoints[ba],"esriDSTAltName"),ExitName:Ha(S.stringsWithWaypoints[ba],
"esriDSTExit"),IntersectingName:Ha(S.stringsWithWaypoints[ba],"esriDSTCrossStreet"),BranchName:Ha(S.stringsWithWaypoints[ba],"esriDSTBranch"),TowardName:Ha(S.stringsWithWaypoints[ba],"esriDSTToward"),ShortVoiceInstruction:void 0,VoiceInstruction:void 0,Level:void 0};delete sa.symbol;delete sa.infoTemplate;Pa.length?(sa.geometry={x:Pa[0][0],y:Pa[0][1],spatialReference:sa.geometry.spatialReference},Ya&&x.mixin(sa.geometry,{m:Pa[0][2]})):delete sa.geometry;ua.push(sa);sa=Qa.toJson();Ka=sa.attributes;
Pa=sa.geometry&&sa.geometry.paths&&sa.geometry.paths[0]||[];ra=!0;for(ea=0;ea<Pa.length-1;ea++)if(Pa[ea][0]!==Pa[ea+1][0]||Pa[ea][1]!==Pa[ea+1][1]){ra=!1;break}ra||(sa.attributes={DirectionPointID:ba+1,DirectionLineType:"esriDLTSegment",Meters:na(Ka.length,ma),Minutes:qa(Ka.time,fa),FromLevel:void 0,ToLevel:void 0},sa.geometry.hasM=Ya,delete sa.symbol,delete sa.infoTemplate,Da.push(sa));var Za=S.eventsWithWaypoints[sa.attributes.Sequence]||[];for(ea=0;ea<Za.length;ea++)sa=Za[ea].toJson(),Ka=sa.attributes,
ra=this._naRouteSharing.getUTCOffset(Ka.ETA,Ka.arriveTimeUTC),sa.attributes={Sequence:++ia,DirectionPointType:"esriDPTEvent",DisplayText:ka(Ka),ArrivalTime:this._naRouteSharing.toUTCTime(Ka.ETA,ra),ArrivalUTCOffset:ra,Name:Ka.strings},ua.push(sa)}ea=this.routeParams.barriers&&this.routeParams.barriers.features||[];var Na=[];for(ba=0;ba<ea.length;ba++)ia=ea[ba].toJson(),ka=ia.attributes,ia.attributes={BarrierType:ka.BarrierType||0,FullEdge:ka.FullEdge||!1,AddedCost:ka["Attr_"+this._getImpedanceAttribute().name]||
0,Costs:H.stringify(xa(ka,"Attr_",Ma)),CurbApproach:ka.CurbApproach||0,Name:ka.Name},Na.push(ia);ea=this.routeParams.polylineBarriers&&this.routeParams.polylineBarriers.features||[];var eb=[];for(ba=0;ba<ea.length;ba++)ia=ea[ba].toJson(),ka=ia.attributes,ia.attributes={BarrierType:ka.BarrierType||0,ScaleFactor:ka["Attr_"+this._getImpedanceAttribute().name]||1,Costs:H.stringify(xa(ka,"Attr_",Ma)),Name:ka.Name},eb.push(ia);ea=this.routeParams.polygonBarriers&&this.routeParams.polygonBarriers.features||
[];var Oa=[];for(ba=0;ba<ea.length;ba++)ia=ea[ba].toJson(),ka=ia.attributes,ia.attributes={BarrierType:ka.BarrierType||0,ScaleFactor:ka["Attr_"+this._getImpedanceAttribute().name]||1,Costs:H.stringify(xa(ka,"Attr_",Ma)),Name:ka.Name},Oa.push(ia);var ib={geometry:S.mergedGeometry,attributes:{RouteName:S.routeName,TotalMinutes:qa(S.totalTime,fa),TotalMeters:na(S.totalLength,ma),TotalLateMinutes:function(){for(var pa=0,Ea=0;Ea<ta.length;Ea++)pa+=ta[Ea].attributes.LateMinutes||0;return pa}(),TotalWaitMinutes:function(){for(var pa=
0,Ea=0;Ea<ta.length;Ea++)pa+=ta[Ea].attributes.WaitMinutes||0;return pa}(),TotalCosts:ta[ta.length-1].attributes.CumulativeCosts,StartTime:"none"!==this.startTime?ta[0].attributes.ArrivalTime:null,EndTime:"none"!==this.startTime?ta[ta.length-1].attributes.DepartureTime:null,StartUTCOffset:ta[0].attributes.ArrivalUTCOffset,EndUTCOffset:ta[ta.length-1].attributes.DepartureUTCOffset,Messages:H.stringify(this._solverMessages),AnalysisSettings:H.stringify({travelMode:x.hitch(this,function(){var pa=x.clone(this.routeParams.travelMode);
"\x26lt;"===pa.name.substr(0,4)&&"\x26gt;"===pa.name.substr(pa.name.length-4,4)&&(pa.name=pa.name.substr(4,pa.name.length-8));return pa})(),directionsLanguage:this.routeParams.directionsLanguage||this.serviceDescription.directionsLanguage,startTimeIsUTC:this.routeParams.startTimeIsUTC,timeWindowsAreUTC:this.routeParams.timeWindowsAreUTC,findBestSequence:this.routeParams.findBestSequence,preserveFirstStop:this.routeParams.preserveFirstStop,preserveLastStop:this.routeParams.preserveLastStop,accumulateAttributeNames:this.routeParams.accumulateAttributes||
this.serviceDescription.accumulateAttributeNames})}};this._enableButton(this._saveButton,!1);this._savingRoute=!0;this._showLoadingSpinner(!0);x.hitch(this,function(){var pa=new P;this._printService?this.zoomToFullRoute().then(x.hitch(this,function(){var Ea=this._printParams.template,Ja=Ea.exportOptions;Ea.exportOptions={width:200,height:133,dpi:96};this._printService.execute(this._printParams,function(Ga){Ea.exportOptions=Ja;pa.resolve(Ga.url)},function(Ga){Ea.exportOptions=Ja;pa.resolve()})})):
pa.resolve();return pa.promise})().then(x.hitch(this,function(pa){var Ea={folder:J,name:C,stops:ta,directionPoints:ua,directionLines:Da,barriers:Na,polylineBarriers:eb,polygonBarriers:Oa,extent:x.mixin(x.clone(S.extent),{xmin:Aa.xmin>S.extent.xmin?S.extent.xmin:Aa.xmin,ymin:Aa.ymin>S.extent.ymin?S.extent.ymin:Aa.ymin,xmax:Aa.xmax<S.extent.xmax?S.extent.xmax:Aa.xmax,ymax:Aa.ymax<S.extent.ymax?S.extent.ymax:Aa.ymax}),routeInfo:ib,thumbnail:pa};this._userCanCreatePortalItem?this._naRouteSharing.store(Ea,
this.routeLayer.itemId,"1.0.0").then(x.hitch(this,function(Ja){if(Ja.success){var Ga=this._naRouteSharing.portal;Ga="//"+(Ga.isPortal?Ga.portalHostname:Ga.urlKey+"."+Ga.customBaseUrl);this._toggleSaveMenu();this._showMessage(G.widgets.directions.routeIsSaved+"\x3cbr/\x3e\x3ca class\x3d'esriLinkButton' target\x3d'_blank' href\x3d'"+Ga+"/home/item.html?id\x3d"+Ja.id+"'\x3e"+G.widgets.directions.share+"\x3c/a\x3e",!0);if(this.routeLayer.itemId)this.onRouteItemUpdated(Ja.id);else this.onRouteItemCreated(Ja.id);
x.mixin(this.routeLayer,{itemId:Ja.id,title:Ea.name,isItemOwner:!0,ownerFolder:N});V.resolve(Ja)}else V.reject(Ja)}),V.reject):this._naRouteSharing.createFeatureCollection(Ea,"1.0.0").then(x.hitch(this,function(Ja){V.resolve(Ja);this._toggleSaveMenu();this.onFeatureCollectionCreated(Ja)}),V.reject)}))}else V.reject(Error("Cannot deduce the impedance used."))}else V.reject(Error("Missing required parameter: layerName, folder must be specified."));else V.reject(Error("Shared route must be built using a Travel Mode."));
else V.reject(Error("Cannot store route: owning system to store routes is not defined. Please specify Portal or ArcGIS Online Url in constructor."));else V.reject(Error("No route to share. Build a route first."));return V.promise},_loadRoute:function(C){var J=new P;J.promise.always(x.hitch(this,function(){this._showLoadingSpinner(!1);z.set(this._saveAsButton,"display",this.routeLayer.itemId&&this._userCanCreatePortalItem?"inline-block":"none");this._enableButton(this._saveButton,this.routeLayer.isItemOwner)}));
this._reset().then(x.hitch(this,function(){this._showLoadingSpinner(!0);this._enableSharing().then(x.hitch(this,function(){var N=x.clone(this.serviceDescription),V=x.hitch(this,function(fa){x.mixin(this.routeLayer,{itemId:C,title:fa.title,isItemOwner:fa.isItemOwner,ownerFolder:fa.ownerFolder})}),S,ba,ea,ia;N.directionsLengthUnits=this.directionsLengthUnits;this._naRouteSharing.load(C,N).then(x.hitch(this,function(fa){if(fa.routeParameters){x.mixin(this.routeParams,fa.routeParameters);this.routeParams.accumulateAttributes=
fa.routeParameters.accumulateAttributeNames;this.set("optimalRoute",this.routeParams.findBestSequence);this.startTime=this.routeParams.startTime?this.routeParams.startTime:"none";this._setStartTime(void 0,void 0,this.startTime);var ka=fa.routeParameters.travelMode,ma=ka?this._getCostAttribute(ka.impedanceAttributeName):void 0;ma=ma?this._isTimeUnits(ma.units)?"Time":"Distance":"";ia=N.supportedTravelModes&&N.supportedTravelModes.length?this._travelModeSelector.store.objectStore.data.slice():[];if(canUseRouteLayerTM=
1!==fa.successCode&&ma){var na="AUTOMOBILE"===ka.type?"Driving":"TRUCK"===ka.type?"Trucking":"WALK"===ka.type?"Walking":"Other";ka.name="\x26lt;"+ka.name+"\x26gt;";this.serviceDescription.supportedTravelModes=(N.supportedTravelModes||[]).concat(ka);ia.push({id:ka.name,label:'\x3cdiv class\x3d"esriTravelModesDirectionsIcon esriTravelModesType'+na+ma+'"\x3e\x26nbsp;\x3c/div\x3e\x3cdiv class\x3d"esriTravelModesTypeName"\x3e'+ka.name+"\x3c/div\x3e"});this._travelModeSelector.setStore(new e({objectStore:new g({data:ia})}));
this._travelModeSelector._interractive=!1;this._travelModeSelector.setValue(ka.name)}else{ma=!1;if(ka&&ka.name)for(ia=N.supportedTravelModes||[],S=0;S<ia.length;S++)if(ia[S].name===ka.name){ma=!0;this._travelModeSelector._interractive=!1;this._travelModeSelector.setValue(ka.name);this.routeParams.travelMode=ia[S].impedanceAttributeName?ia[S]:ia[S].itemId;fa.loadMessages.push({message:G.widgets.directions.error.tmFromPortalSameName+" "+ka.name,messageType:"Warning"});break}if(!ma)if((ka=N.defaultTravelMode)&&
ia)for(S=0;S<ia.length;S++){if(ia[S].id===ka){this.routeParams.travelMode=ia[S].impedanceAttributeName?ia[S]:ia[S].itemId;fa.loadMessages.push({message:G.widgets.directions.error.tmFromPortalDefault+" "+(ia[S].name?ia[S].name:ia[S].itemId),messageType:"Warning"});break}}else this.routeParams.travelMode=null}this._checkStartTimeUIAvailability()}if(fa.solveResult&&fa.solveResult.routeResults){var qa=Infinity,xa=-Infinity;ka=fa.solveResult.routeResults[0].stops;var ta=fa.solveResult.routeResults[0].directions.features;
ma={};for(S=0;S<ka.length;S++){var ua=ka[S].attributes;if(ua.isWaypoint)for(ba=0;ba<ta.length;ba++)na=ta[ba].attributes,na._stopSequence===ua.Sequence&&(na.text=na.text.replace(ua.Name,this._waypointName));ea=ua.Name+"_"+this._stopSequence++;ma[ea]=ua.isWaypoint?this._waypointName:ua.Name;ua.Name=ea;if(ua.Sequence<qa&&(null!==ua.ArriveCurbApproach||null!==ua.DepartCurbApproach)){var Da=ua.Name;qa=ua.Sequence}if(ua.Sequence>xa&&(null!==ua.ArriveCurbApproach||null!==ua.DepartCurbApproach)){var Ma=ua.Name;
xa=ua.Sequence}}ea=Da+" - "+Ma;fa.solveResult.routeResults[0].routeName=ea;fa.solveResult.routeResults[0].directions.routeName=ea;for(S=0;S<ta.length;S++)if(na=ta[S].attributes,void 0!==na._stopSequence)for(ba=0;ba<ka.length;ba++)if(na._stopSequence===ka[ba].attributes.Sequence){ea=ka[ba].attributes.Name;na.text=(na.text||"").replace(ma[ea],ea);delete na._stopSequence;break}Da=ka[ka.length-1];ka[0].geometry.x===Da.geometry.x&&ka[0].geometry.y===Da.geometry.y&&(this._returnToStartStop=this._addStopWrapperToGraphic(new R(Da.geometry,
null,Da.attributes),ma[Da.attributes.Name]),this.set("returnToStart",!0));this._solveResultProcessing(fa.solveResult,ma).then(x.hitch(this,function(){this._setStartTime(void 0,void 0,this.startTime);V(fa);this.zoomToFullRoute();J.resolve(fa)}),J.reject)}else{if(fa.routeParameters){Da=fa.routeParameters.stops.features;this.stops=[];for(S=0;S<Da.length;S++)this.stops.push(this._addStopWrapperToGraphic(Da[S],Da[S].attributes.Name)),this._updateStop(this.stops[S],S);this._setStops();fa.loadMessages.push({message:G.widgets.directions.routeLayerStopsOnly,
messageType:"Warning"})}else fa.loadMessages.push({message:G.widgets.directions.routeLayerEmpty,messageType:"Warning"});V(fa);J.resolve(fa)}for(S=0;S<fa.loadMessages.length;S++)this._showMessage(fa.loadMessages[S].message)}),x.hitch(this,function(fa){J.reject(fa);this._showMessage("GWM_0003"===fa.messageCode?G.widgets.directions.error.accessDenied+this._naRouteSharing.portal.getPortalUser().username:G.widgets.directions.error.loadError)}))}),J.reject)}),J.reject);return J.promise}});x.setObject("dijit.Directions",
p,O);return p})},"dijit/layout/AccordionPane":function(){define(["dojo/_base/declare","dojo/_base/kernel","./ContentPane"],function(t,p,x){return t("dijit.layout.AccordionPane",x,{constructor:function(){p.deprecated("dijit.layout.AccordionPane deprecated, use ContentPane instead","","2.0")},onSelected:function(){}})})},"arcgisonline/sharing/geow/MemberReadStore":function(){define(["dojo","dijit","dojox","dojo/require!dojox/data/QueryReadStore,arcgisonline/sharing/geow/Content"],function(t,p,x){t.provide("arcgisonline.sharing.geow.MemberReadStore");
t.require("dojox.data.QueryReadStore");t.require("arcgisonline.sharing.geow.Content");t.declare("arcgisonline.sharing.geow.MemberReadStore",x.data.QueryReadStore,{_fetchItems:function(b,m,f){var d=b.serverQuery||b.query||{};d.start=b.start||0;d.start++;b.count&&(d.num=b.count);arcgisonline.sharing.util.getJson(this.url,t.hitch(this,function(a){this._items=[];var c=null,l="";if(a.users){l="groupMembers";this._total=a.users.length+a.admins.length;t.publish("onMemberCount",[this._total]);var h={name:a.owner,
memberType:"owner",requestType:l,groupowner:a.owner||"",groupadmins:a.admins||[]};this._items.push({i:h,r:this});t.forEach(a.admins,function(n,g){n!=a.owner&&(h={name:n,memberType:"admin",requestType:l,groupowner:a.owner||"",groupadmins:a.admins||[]},this._items.push({i:h,r:this}))},this);t.forEach(a.users,function(n,g){h={name:n,memberType:"member",requestType:l,groupowner:a.owner||"",groupadmins:a.admins||[]};this._items.push({i:h,r:this})},this)}else c=a.applications,l="groupApplications",t.publish("onAppCount",
[a.applications.length]),this._total=c.length,t.forEach(c,function(n,g){this._items.push({i:{name:n.username,fullname:n.fullname,requestType:l,groupowner:a.owner||"",groupadmins:a.admins||[],received:n.received||-1},r:this})},this);this._itemsByIdentity={};this._identifier="name";for(i=0;i<this._items.length;++i)h=this._items[i].i,c=h.name,this._itemsByIdentity.name||(this._itemsByIdentity[c]=h);m(this._items,b,this._total);this.lastRequestHash=(new Date).getTime()+"-"+String(Math.random()).substring(2);
this._lastServerQuery=t.mixin({},d)}))}})})},"arcgisonline/sharing/dijit/DataGrid":function(){define(["dojo","dijit","dojox","dojo/require!dojox/grid/DataGrid"],function(t,p,x){t.provide("arcgisonline.sharing.dijit.DataGrid");t.require("dojox.grid.DataGrid");t.declare("arcgisonline.sharing.dijit.DataGrid",x.grid.DataGrid,{sort:function(){this.inherited(arguments);setTimeout(t.hitch(this,"update"),300)},_onFetchComplete:function(b,m){var f=!this._isLoaded;this.inherited(arguments);f&&this.update()}})})},
"arcgisonline/sharing/dijit/FeatureLayerQueryResult":function(){define("esri/main dojo/_base/declare dojo/Evented dojo/_base/lang dojo/_base/kernel dojo/_base/Deferred dojo/DeferredList dojo/_base/array esri/IdentityManager".split(" "),function(t,p,x,b,m,f,d,a){var c=function(l){function h(n){l[n]||(l[n]=function(){var g=arguments;return f.when(l,function(e){Array.prototype.unshift.call(g,e.features||e);return c(m[n].apply(m,g))})})}if(!l)return l;l.then&&(l=b.delegate(l));l.total||(l.total=f.when(l,
function(n){return t._isDefined(n.total)?n.total:n.length||0}));h("forEach");h("filter");h("map");h("some");h("every");return l};b.setObject("arcgisonline.sharing.dijit.FeatureLayerQueryResult",c);return c})},"arcgisonline/sharing/dijit/FeatureLayerQueryStore":function(){define(["dojo","dijit","dojox","dojo/require!arcgisonline/sharing/dijit/FeatureLayerQueryResult"],function(t,p,x){t.provide("arcgisonline.sharing.dijit.FeatureLayerQueryStore");t.require("arcgisonline.sharing.dijit.FeatureLayerQueryResult");
t.declare("arcgisonline.sharing.dijit.FeatureLayerQueryStore",null,{queryUrl:"",idProperty:"id",data:[],constructor:function(b){t.mixin(this,b);this.layer=b.layer;this.objectIds=b.objectIds;this.where=b.where;this.orderByFields=b.orderByFields;this.totalCount=b.totalCount;this.batchCount=b.batchCount||25;this.idProperty=this.layer.objectIdField},get:function(b,m){return this.data[b]},getIdentity:function(b){return b[this.idProperty]},query:function(b,m){var f=new esri.tasks.Query,d=m.start||0,a=this.batchCount;
this.objectIds?f.objectIds=this.objectIds.length>=d+this.batchCount?this.objectIds.slice(d,d+a):this.objectIds.slice(d):(f.start=d,f.num=a,f.where=this.where,f.orderByFields=this.orderByFields);f.returnGeometry=!1;f.outFields=["*"];var c=this.totalCount;d=this.layer.queryFeatures(f);d.total=d.then(t.hitch(this,function(l){if(this.objectIds){var h=l.objectIdFieldName;if(!h)for(var n=0;n<l.fields.length;n++)if("esriFieldTypeOID"==l.fields[n].type){h=l.fields[n].name;break}var g={};for(n=0;n<l.features.length;n++)g[l.features[n].attributes[h]]=
l.features[n];l.features=t.map(f.objectIds,function(e){return g[e]})}for(n=0;n<l.features.length;n++)l.features[n]=l.features[n].attributes,this.data[l.features[n][h]]=l.features[n];l=l.features;return c}),function(){return 0});return arcgisonline.sharing.dijit.FeatureLayerQueryResult(d)}})})},"arcgisonline/sharing/dijit/OrganizationSetup":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/kernel dojo/cookie dojo/debounce dojo/dom-attr dojo/dom-class dojo/dom-style dojo/on dijit/a11yclick dojo/string dojo/when dojox/html/entities dojo/io-query dojo/Deferred dojo/data/ItemFileReadStore dojo/store/Memory dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/form/Button dijit/form/CheckBox dijit/form/FilteringSelect dijit/form/TextBox dijit/layout/ContentPane dijit/Tooltip esri/lang esri/request esri/IdentityManager esri/arcgis/OAuthInfo ../../esriGeowConfig ../util ../../pages/pageUtil ../../pages/utils/culture ../../pages/utils/dom ../../pages/utils/signin ../../pages/utils/storage ../../pages/utils/tooltips ../geow/Account ../geow/Geow ./dialog/GeneralDlg dojo/i18n!../../nls/arcgisonline dojo/text!./templates/OrganizationSetup.html".split(" "),
function(t,p,x,b,m,f,d,a,c,l,h,n,g,e,k,w,q,u,r,v,z,B,A,y,D,G,E,F,I,M,P,W,H,O,K,R,da,U,Z,L,T,Y,ca){return t("arcgisonline.sharing.dijit.OrganizationSetup",[u,r,v],{declaredClass:"arcgisonline.sharing.dijit.OrganizationSetup",templateString:ca,widgetsInTemplate:!0,DEFAULT_ACCOUNT_NAME:"My Account",ACCOUNT_ADMIN_ROLE:"account_admin",BROWSER_DEFAULT:"browser",ACCESS_DENIED_ERROR_PATH:"error.html?c\x3dAccessDenied",_user:null,_onlineDefaults:null,_settings:null,_validUrlKey:!1,_urlKeyAlreadySet:!1,_tooltips:[],
postMixInProperties:function(){this.inherited(arguments);this.i18n=p.mixin(Y.common,Y.organizationSetup);p.mixin(this.i18n,{usageTrackingDesc:Y.myOrganization.generalTab.usageTrackingDesc,usageTrackingSetting:Y.myOrganization.generalTab.usageTrackingSetting,allowArcgisOnlineToCollectInfo:Y.usageTracking.allowArcgisOnlineToCollectInfo})},destroy:function(){this.inherited(arguments);this._tooltips.forEach(function(Q){Q&&Q.destroyRecursive&&Q.destroyRecursive()})},startup:function(){this.inherited(arguments);
var Q=new k;R.checkSignInStatus().then(function(X){X&&(P.userInfo={username:X.userId,credential:X,token:X.token});this._checkAccess(X);this._initHandlers();this._initImages();this._initRedirects();this._initLocalization();this._initTooltips();Z.getSupportedLanguagesAndRegions().then(function(ha){ha&&(this._initLanguage(ha.languages),this._initRegion(ha.regions),this._loadOrganization())}.bind(this),this._handleError.bind(this));Q.resolve()}.bind(this));return Q},getClientId:function(){try{return da.getLocalStorageItem("portalAppClientId")||
da.getSessionStorageItem("portalAppClientId")||P.clientId||"arcgisonline"}catch(Q){return P.clientId||"arcgisonline"}},_handleError:function(Q){},_showAlert:function(Q,X){var ha=new T;c.once(ha._dialog,"hide",function(){ha._dialog.destroyRecursive();ha.destroyRecursive()});ha.show({title:Q,message:X})},_urlContainsInvalidChars:function(Q){return!Q.match(/^[a-zA-Z0-9\-]*$/)},_handleUrlKeyCheck:function(Q){!Q||Q.code||Q.message?(this._validUrlKey=!1,this._clearUrlKeyStatus()):Q.available?this._setGoodUrlKeyStatus(this.i18n.available):
this._setBadUrlKeyStatus(this.i18n.unavailable)},_initHandlers:function(){var Q=this.checkUrlKey.bind(this);this.own(l(this._sslCheckBox,this.onSSLCheck.bind(this)),l(this._saveBtn,this.onSave.bind(this)),l(this._signOutBtn,this.onSignOut.bind(this)),c(this._urlKeyTextBox,"change",Q),H.registerKeystrokeHandler(this._urlKeyTextBox,m(Q,500)),c(this._languageSelect,"change",this.onLanguageChange.bind(this)))},_initImages:function(){this._orgNameImg&&f.set(this._orgNameImg,"src",W.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-general-logo-name.png"));
this._orgAbbrImg&&f.set(this._orgAbbrImg,"src",W.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-general-logo-name.png"));this._languageImg&&f.set(this._languageImg,"src",W.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-language.png"));this._languageFormatImg&&f.set(this._languageFormatImg,"src",W.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/helpIcon.png"));this._regionImg&&f.set(this._regionImg,"src",W.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-region.png"));
this._securityImg&&f.set(this._securityImg,"src",W.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-security-https.png"));this._linkImg&&f.set(this._linkImg,"src",W.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-links.png"));this._usageTrackingImg&&f.set(this._usageTrackingImg,"src",W.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb_euei.png"))},_checkAccess:function(Q){Q?Z.getSelf(function(X){P.userInfo&&(P.userInfo.credential=Q,P.userInfo.token=
Q.token);this._user=X.user;this._user.orgId||this._user.role===this.ACCOUNT_ADMIN_ROLE||(window.location=P.baseUrl+this.ACCESS_DENIED_ERROR_PATH)}.bind(this),function(X){}.bind(this)):this._showUser||W.requireAuthentication()},_initRedirects:function(){this.geodeUrl=P.baseUrl+"geoanalyticsengine.html";this.redirectUrl=P.baseUrl+"index.html";this.orgRedirectUrl=P.baseUrl+"organization.html"},_initLocalization:function(){f.set(dojo.byId("item-title"),"innerHTML",this.i18n.setupYourOrg);this._sslCheckBoxLabel.innerHTML=
h.substitute(this.i18n.securityDesc,{span:'\x3cspan id\x3d"sslTooltip" style\x3d"border-bottom: 1px dotted #487696;"\x3e',spanEnd:"\x3c/span\x3e"});f.set(this._linkTooltip,"innerHTML",h.substitute(this.i18n.contactUs,{startSpan:'\x3cspan class\x3d"orgSettingTooltip"\x3e',endSpan:"\x3c/span\x3e"}));this._link.set("placeholder",this.i18n.contactUsExample)},_initTooltips:function(){this._tooltips.push(U.createTooltip("linkTooltip",this.i18n.contactUsTooltip));this._tooltips.push(U.createTooltip("sslTooltip",
this.i18n.sslTooltip));this._tooltips.push(U.createTooltip("languageFormatTooltip",this.i18n.learnNumDateFormat))},_initLanguage:function(Q){if(Q){var X=[{culture:this.BROWSER_DEFAULT,displayName:this.i18n.browserDefaultSelection,language:this.i18n.browserDefaultSelection,localizedName:this.i18n.browserDefaultSelection}];Q.forEach(function(ha){ha=p.mixin({displayName:g.decode((ha.localizedName?ha.localizedName+" - ":"")+ha.language+"\x26lrm;")},ha);ha.cultureFormats&&ha.cultureFormats.length&&ha.cultureFormats.forEach(function(ja){ja.displayName=
g.decode((ja.localizedName?ja.localizedName+" - ":"")+ja.name+"\x26lrm;")});X.push(ha)});Q=new q({idProperty:"culture",label:"displayName",data:X});this._languageSelect.set("store",Q);this._languageSelect.set("searchAttr","displayName")}},_initLanguageFormat:function(Q,X){if(Q&&Q!==this.BROWSER_DEFAULT&&X&&X.length){var ha=O.getSelectedFormat(this._settings.cultureFormat,X||[]),ja=new q({idProperty:"format",label:"displayName",data:X});this._languageFormatSelect.set("store",ja);this._languageFormatSelect.set("searchAttr",
"displayName");ha?this._languageFormatSelect.set("displayedValue",ha.displayName):this._languageFormatSelect.set("displayedValue",X[0].displayName);K.showNode(this._languageFormatContainer)}else K.hideNode(this._languageFormatContainer)},_initRegion:function(Q){Q&&(Q=new q({idProperty:"region",label:"localizedName",data:Q}),this._regionSelect.set("store",Q),this._regionSelect.set("searchAttr","localizedName"))},_loadOrganization:function(){F({url:W.getSecureUrl(P.restBaseUrl)+"portals/self",content:{f:"json"}}).then(function(Q){this._onlineDefaults=
Q;Z.getSelf(function(X){if(!X||X.code||X.message)this._handleError(X);else{this._settings=X;this._settings.customBaseUrl=this._settings.customBaseUrl||this._onlineDefaults.customBaseUrl;this._sslCheckBox.set("checked",!0);this._settings.name&&this.DEFAULT_ACCOUNT_NAME!==this._settings.name&&this._nameTextBox.set("value",this._settings.name);this._settings.urlKey?(this._urlKeyAlreadySet=this._validUrlKey=!0,this._settings.customBaseUrl?f.set(this._sampleUrlTextBox,"innerHTML","https://"+this._settings.urlKey+
"."+this._settings.customBaseUrl):f.set(this._sampleUrlTextBox,"innerHTML",W.getSecureUrl(P.baseUrl)),this._urlKeyTextBox.set("disabled",!0),this._urlKeyTextBox.set("value",this._settings.urlKey)):(this._validUrlKey=!1,f.set(this._sampleUrlTextBox,"innerHTML",""));var ha=this._languageSelect.get("store");this._settings.culture=O.getActualCulture(X.culture,ha.query());ha=(ha=ha.query({culture:X.culture||this.BROWSER_DEFAULT}).shift())?ha.displayName:this.i18n.browserDefaultSelection;this._languageSelect.set("displayedValue",
ha);f.set(this._languageFormatHelpLink,"href",P.self.helpBase+(P.self.helpMap.m["120001487"]||""));(X=this._regionSelect.get("store").query({region:X.region}).shift())&&X.localizedName?this._regionSelect.set("displayedValue",X.localizedName):this._regionSelect.set("value",P.self&&P.self.ipCntryCode||"WO");this._settings.portalProperties&&this._settings.portalProperties.links&&this._settings.portalProperties.links.contactUs&&(this._linkCheckBox.set("checked",!!this._settings.portalProperties.links.contactUs.visible),
this._link.set("value",this._settings.portalProperties.links.contactUs.url));X=P.restBaseUrl.replace("http:","https:").replace("/rest/","/geoip.jsp");W.getJson(X,this._setUsageTrackingCheckbox.bind(this),this._setUsageTrackingCheckbox.bind(this))}}.bind(this))}.bind(this))},_setUsageTrackingCheckbox:function(Q){this._usageTrackingCheckBox.set("checked",P.urlKey?!!this._settings.eueiEnabled:"US"===Q.country)},_makeAuthorizeRequest:function(Q,X,ha){var ja=R.getClientId();Q={portalUrl:R.getPortalUrl(),
returnUrl:Q,useLandingPage:!1,initialAdmin:!0,clientId:ja};ha=ha?ha:P.baseUrl;ja={client_id:ja,display:"default",response_type:"token",state:JSON.stringify(Q),expiration:P.expiration||20160,locale:this._settings.culture?this._settings.culture.toLowerCase():x.locale,redirect_uri:ha.replace("http:","https:")+"accountswitcher-callback.html",force_login:!1,hideCancel:!0,showSignupOption:!1,canHandleCrossOrgSignIn:!0,signuptype:"esri",redirectToUserOrgUrl:!0};X=(X?X+"/sharing/rest/":P.restBaseUrl).replace(/^http:/i,
"https:")+"oauth2/authorize?"+e.objectToQuery(ja);document.location.replace(X)},_handleUpdateAccount:function(Q){if(!Q||Q.code||Q.message)this._handleError(Q),this._showAlert(this.i18n.errorTitle,this.i18n.errors.unableToSave),this._saveBtn.set("disabled",!1),this._saveBtn.set("label",this.i18n.saveContinue);else{var X=R.getClientId();this._settings.urlKey&&this._settings.customBaseUrl?(Q="https://"+this._settings.urlKey+"."+this._settings.customBaseUrl,"geoanalyticsengine"===X?Q=this.geodeUrl.replace("http:",
"https:"):(X=P.baseUrl.indexOf(location.host),Q=-1<X?P.isDebug?this.orgRedirectUrl.replace("http:","https:"):Q+(P.baseUrl.substring(X+location.host.length).replace("http:","https:")+"organization.html"):this.redirectUrl.replace("http:","https:")),this._makeAuthorizeRequest(Q)):window.location="geoanalyticsengine"===X?this.geodeUrl.replace("http:","https:"):"account_admin"!==user.role||this._settings.urlKey?this.redirectUrl.replace("http:","https:"):this.orgRedirectUrl.replace("http:","https:")}},
_validates:function(){var Q=this._nameTextBox.getValue(),X=this._link.get("value"),ha=this._linkCheckBox.get("checked"),ja=this.i18n.errors.pleaseCorrect,aa=!1;Q?(Q=h.trim(Q),0<Q.length?-1<Q.indexOf("\x3c")||-1<Q.indexOf("\x3e")||-1<Q.indexOf("%")?(aa=!0,ja+="\x3cbr\x3e"+this.i18n.errors.orgNameInvalidChars):55<Q.length&&(aa=!0,ja+="\x3cbr\x3e"+this.i18n.errors.orgNameTooLong):(aa=!0,ja+="\x3cbr\x3e"+this.i18n.errors.orgNameRequired)):(aa=!0,ja+="\x3cbr\x3e"+this.i18n.errors.orgNameRequired);this._validUrlKey||
(aa=!0,ja+="\x3cbr\x3e"+this.i18n.errors.urlKeyRequired);!ha||esri.isDefined(X)&&0!==X.length||(aa=!0,ja+="\x3cbr\x3e"+this.i18n.errors.finishContactUsSetup);aa&&this._showAlert(this.i18n.errorTitle,ja);return!aa},_setGoodUrlKeyStatus:function(Q){this._validUrlKey=!0;this._urlKeyStatusLabel.innerHTML=Q;d.remove(this._urlKeyStatusLabel,"statusBad");d.add(this._urlKeyStatusLabel,"statusGood")},_setBadUrlKeyStatus:function(Q){this._validUrlKey=!1;this._urlKeyStatusLabel.innerHTML=Q;d.remove(this._urlKeyStatusLabel,
"statusGood");d.add(this._urlKeyStatusLabel,"statusBad")},_clearUrlKeyStatus:function(){this._urlKeyStatusLabel.innerHTML="";d.remove(this._urlKeyStatusLabel,"statusGood");d.remove(this._urlKeyStatusLabel,"statusBad")},checkUrlKey:function(){if(!this._urlKeyAlreadySet){var Q=this._urlKeyTextBox.getValue(),X=this._handleUrlKeyCheck.bind(this);Q&&(Q=h.trim(Q));Q&&0<Q.length&&17>Q.length?this._urlContainsInvalidChars(Q)?this._setBadUrlKeyStatus(this.i18n.errors.urlKeyInvalidChars):"-"===Q[0]||"-"===
Q[Q.length-1]?this._setBadUrlKeyStatus(this.i18n.errors.urlKeyEndHyphen):(f.set(this._sampleUrlTextBox,"innerHTML","https://"+Q+"."+this._settings.customBaseUrl),W.getJson(P.restBaseUrl+"portals/isUrlKeyAvailable?urlKey\x3d"+Q,X,X)):(this._validUrlKey=!1,f.set(this._sampleUrlTextBox,"innerHTML",""),Q&&16<Q.length?this._setBadUrlKeyStatus(this.i18n.urlKeyTooLong):this._clearUrlKeyStatus())}},onLanguageChange:function(){var Q=this._languageSelect.get("store").query({displayName:this._languageSelect.get("displayedValue")}).shift();
Q&&this._initLanguageFormat(Q.culture,Q.cultureFormats)},onSSLCheck:function(){var Q=this._sslCheckBox.attr("checked");this._showAlert(this.i18n.warning,Q?this.i18n.sslOnWarning:this.i18n.sslOffWarning)},onSave:function(){this._saveBtn.set("disabled",!0);this._saveBtn.set("label",this.i18n.saving);if(this._validates()){var Q=this._handleUpdateAccount.bind(this),X=this._nameTextBox.getValue(),ha=this._urlKeyTextBox.getValue(),ja=this._sslCheckBox.attr("checked");this._settings.name=h.trim(X);this._settings.urlKey=
h.trim(ha);this._settings.allSSL=ja;X=(ha=this._languageSelect.get("store").query({displayName:this._languageSelect.get("displayedValue")}).shift())&&ha.culture?ha.culture:this.BROWSER_DEFAULT;this._settings.culture=X===this.BROWSER_DEFAULT?"":X;ha&&ha.cultureFormats?(ha=(ha=this._languageFormatSelect.get("store").query({displayName:this._languageFormatSelect.get("displayedValue")}).shift())&&ha.format?ha.format:void 0)?(this._settings.culture=X+"-"+ha,this._settings.cultureFormat=ha):this._settings.cultureFormat=
"":this._settings.cultureFormat="";X=this._regionSelect.get("store").query({localizedName:this._regionSelect.get("displayedValue")}).shift();this._settings.region=X&&X.region||"";this._settings.portalProperties=this._settings.portalProperties||{};this._settings.portalProperties.mustWelcome=!0;this._settings.portalProperties.links=this._settings.portalProperties.links||{};X=this._link.get("value");E.isDefined(X)&&0<X.length?(0!==X.indexOf("http")&&0!==X.indexOf("mailto:")&&0<X.indexOf("@")?X="mailto:"+
X:0!==X.indexOf("http")&&0>X.indexOf("mailto:")&&0>X.indexOf("@")&&(X="http://"+X),this._settings.portalProperties.links.contactUs={url:X,visible:!!this._linkCheckBox.get("checked")}):delete this._settings.portalProperties.links.contactUs;this._settings.eueiEnabled=this._usageTrackingCheckBox.checked;this._settings.basemapGalleryGroupQuery=null;this._settings.colorSetsGroupQuery=null;this._settings.defaultBasemap=null;this._settings.defaultExtent=null;this._settings.featuredGroups=null;this._settings.featuredGroupsId=
null;this._settings.featuredItemsGroupQuery=null;this._settings.homePageFeaturedContent=null;this._settings.layerTemplatesGroupQuery=null;this._settings.rotatorPanels=null;this._settings.symbolSetsGroupQuery=null;this._settings.templatesGroupQuery=null;this._settings.contacts=this._settings.contacts||[];Z.updateAccount(this._settings,Q,Q)}else this._saveBtn.set("disabled",!1),this._saveBtn.set("label",this.i18n.saveContinue)},onSignOut:function(){b("esri_webmap","",{expires:-1,path:"/"});var Q=this.allSSL?
W.getSecureUrl():W.getHttpUrl();L.signout(Q+"index.html")}})})},"arcgisonline/pages/utils/culture":function(){define(["require","exports","tslib","dojo/string","dojo/_base/kernel"],function(t,p,x,b,m){b=x.__importDefault(b);m=x.__importDefault(m);return function(){function f(){}f.getString=function(d,a,c){var l,h="id ja ko th vi zh-cn zh-hk zh-tw".split(" "),n="en ca da de el es et fi hi hu it nb nl pt-pt sv tr".split(" "),g=null!==(l=f.getRootLocale(m["default"].locale))&&void 0!==l?l:"en";c?c.number=
a:c={number:a};return 1===a||-1<h.indexOf(g)?b["default"].substitute(d.single,c):1!==a&&-1<n.indexOf(g)?b["default"].substitute(d.multiple,c):b["default"].substitute(d.unknown,c)};f.stripCultureFormat=function(d,a){if((null===d||void 0===d?0:d.length)&&(null===a||void 0===a?0:a.length)){var c=d.indexOf("-"+a);if(-1<c)return d.substring(0,c)}return d};f.getRootLocale=function(d){if(null===d||void 0===d?0:d.length){d=d.split("-")[0];if(null===d||void 0===d?0:d.length)d=d.toLowerCase();return d}return d};
f.getLocaleFormat=function(d){if(null===d||void 0===d?0:d.length)if(d=d.split("-"),1<d.length)return d[1].toLowerCase()};f.getTrialLocale=function(d){var a=["pt-br","pt-pt","zh-cn","zh-hk","zh-tw"];return-1<(null===d||void 0===d?void 0:d.indexOf("-"))&&-1===a.indexOf(d)?this.getRootLocale(d):d};f.getActualCulture=function(d,a){var c,l=null!==(c=null===d||void 0===d?void 0:d.toLowerCase())&&void 0!==c?c:"",h=l.split("-");if(1<h.length){if(c=a.filter(function(n){return n.culture===l}).shift())return l;
c=a.filter(function(n){return n.culture===h[0]}).shift();if(null===c||void 0===c?0:c.cultureFormats){if(c.cultureFormats.filter(function(n){return n.format===h[1]}).shift())return c.culture}else if(c)return c.culture}return d};f.getSelectedFormat=function(d,a){return a.filter(function(c){return c.format===d}).shift()};f.getPercentString=function(d){var a=m["default"].locale.toLowerCase();return"ar"===a?"%"+100*d:d.toLocaleString(a,{style:"percent"})};return f}()})},"arcgisonline/sharing/dijit/Troubleshoot":function(){define(["dojo",
"dijit","dojox","dojo/i18n!arcgisonline/nls/arcgisonline","dojo/require!dijit/_Widget,dijit/_Templated,dijit/layout/ContentPane,arcgisonline/sharing/util,arcgisonline/sharing/dijit/dialog/GeneralDlg,arcgisonline/pages/dijit/PasswordStrength"],function(t,p,x){t.provide("arcgisonline.sharing.dijit.Troubleshoot");t.require("dijit._Widget");t.require("dijit._Templated");t.require("dijit.layout.ContentPane");t.require("arcgisonline.sharing.util");t.require("arcgisonline.sharing.dijit.dialog.GeneralDlg");
t.require("arcgisonline.pages.dijit.PasswordStrength");t.requireLocalization("arcgisonline","arcgisonline");t.declare("arcgisonline.sharing.dijit.Troubleshoot",[p._Widget,p._Templated],{widgetsInTemplate:!0,templateString:'\x3cdiv dojoAttachPoint\x3d"containerNode" class\x3d"esriItemLinks troubleshoot"\x3e\r\n        \x3cdiv class\x3d"subnav"\x3e\r\n          \x3cdiv class\x3d"container"\x3e\r\n            \x3ch1 class\x3d"padding-leader-half padding-trailer-half text-white"\x3e${i18n.troubleshootTitle}\x3c/h1\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"respond"\x3e\r\n        \x3cp id\x3d"instructions"\x3e${i18n.instructions}\x3c/p\x3e\r\n         \x3cdiv data-dojo-attach-point\x3d"_stackContainer" class\x3d"newStyles"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"forgotUsername" class\x3d"contentPane"\x3e\r\n              \x3ch2\x3e${i18n.forgotUsername}\x3c/h2\x3e\r\n              \x3cp\x3e${!i18n.forgotUsernameInstructions}\x3c/p\x3e\r\n              \x3clabel class\x3d"esriFloatLeading" for\x3d"email"\x3e${i18n.emailLabel}\x26nbsp;\x3c/label\x3e\r\n              \x3cinput id\x3d"email" data-dojo-attach-point\x3d"_email" name\x3d"email" data-dojo-type\x3d"dijit/form/ValidationTextBox" trim\x3d"true"/\x3e\r\n              \x3cbr /\x3e\r\n              \x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-attach-event\x3d"onClick:_submitEmail" class\x3d"esriFloatLeading calcite blue"\x3e${i18n.send}\x3c/button\x3e\r\n              \x3cbr/\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"forgotPassword" class\x3d"contentPane"\x3e\r\n              \x3ch2\x3e${i18n.forgotPassword}\x3c/h2\x3e\r\n              \x3cp\x3e${!i18n.forgotPasswordInstructions}\x3c/p\x3e\r\n              \x3clabel class\x3d"esriFloatLeading" for\x3d"username"\x3e${i18n.usernameLabel}\x26nbsp;\x3c/label\x3e\r\n              \x3cinput id\x3d"username" name\x3d"userName" data-dojo-attach-point\x3d"_userName" data-dojo-type\x3d"dijit/form/ValidationTextBox" trim\x3d"true"/\x3e\r\n              \x3cbr /\x3e\r\n              \x3cbutton data-dojo-attach-event\x3d"onClick:_submitUsername" data-dojo-type\x3d"dijit/form/Button" class\x3d"esriFloatLeading calcite blue"\x3e${i18n.customRoles.continueLabel}\x3c/button\x3e\r\n              \x3cbr /\x3e\r\n          \x3c/div\x3e\r\n         \x3cdiv class\x3d"contentPane newStyles" dojoAttachPoint\x3d"changePassword" style\x3d"display:none;"\x3e\r\n             \x3ch2\x3e${i18n.resetPassword}\x3c/h2\x3e\r\n             \x3cp dojoAttachPoint\x3d"_securityQuestionInstructions" class\x3d"securityQuestion"\x3e${i18n.securityQuestionInstructions}\x3c/p\x3e\r\n             \x3clabel class\x3d"securityQuestion esriFloatLeading" dojoAttachPoint\x3d"_securityQuestion"\x3e\x3c/label\x3e\r\n             \x3cinput dojoAttachPoint\x3d"_securityAnswer" name\x3d"answer" dojoType\x3d"dijit.form.ValidationTextBox" trim\x3d"true" class\x3d"ieFix securityQuestion" /\x3e\r\n             \x3cdiv class\x3d"prompt securityQuestion"\x3e${i18n.securityQuestionPrompt}\x3c/div\x3e\r\n             \x3cdiv class\x3d"portal-only" style\x3d"display:none;"\x3e\r\n                 \x3cbr/\x3e\r\n                 \x3cp\x3e${i18n.enterNewPassword}\x3c/p\x3e\r\n                 \x3cdiv class\x3d"password-1"\x3e\r\n                     \x3cspan\x3e\x3clabel for\x3d"password"\x3e${i18n.newPasswordLabel}\x3c/label\x3e\r\n                      \x3cinput id\x3d"password" dojoAttachPoint\x3d"_newPassword" name\x3d"password" dojoAttachEvent\x3d"onKeyUp:isValidPassword" class\x3d"required" dojoType\x3d"dijit.form.TextBox" type\x3d"password" trim\x3d"true"\x3e\r\n                      \x3cdiv class\x3d"strength-meter"\x3e\r\n                        \x3cdiv data-dojo-attach-point\x3d"_strengthMeter"\x3e\x3c/div\x3e\r\n                        \x3cdiv class\x3d"input-error-message" data-dojo-attach-point\x3d"_passwordError"\x3e\x3c/div\x3e\r\n                      \x3c/div\x3e\r\n                    \x3c/span\x3e\r\n                 \x3c/div\x3e\r\n                 \x3cbr /\x3e\r\n                 \x3cdiv class\x3d"password-2"\x3e\r\n                     \x3clabel class\x3d"left"\x3e${i18n.reenterPasswordLabel}\x3c/label\x3e\r\n                     \x3cinput name\x3d"verify" dojoAttachPoint\x3d"_verifyPassword" type\x3d"password" dojotype\x3d"dijit.form.ValidationTextBox" trim\x3d"true"/\x3e\r\n                 \x3c/div\x3e\r\n             \x3c/div\x3e\r\n             \x3cbutton dojoAttachEvent\x3d"onClick:_submitReset" dojoType\x3d"dijit.form.Button" class\x3d"calcite blue esriFloatLeading indentBtn" style\x3d"margin-left: 205px;"\x3e${i18n.mosaicRulePanel.resetLabel}\x3c/button\x3e\r\n         \x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"mfaHelp" class\x3d"contentPane"\x3e\r\n             \x3cbr /\x3e\r\n             \x3ch2\x3e${i18n.mfaHelpMsg}\x3c/h2\x3e\r\n             \x3cp\x3e${!i18n.mfaHelpInstructions}\x3c/p\x3e\r\n             \x3clabel class\x3d"esriFloatLeading" for\x3d"username"\x3e${i18n.usernameLabel}\x26nbsp;\x3c/label\x3e\r\n             \x3cinput id\x3d"mfa_username" name\x3d"userName" data-dojo-attach-point\x3d"_mfaUserName" data-dojo-type\x3d"dijit/form/ValidationTextBox" trim\x3d"true"/\x3e\r\n             \x3cbr /\x3e\r\n             \x3cbutton data-dojo-attach-event\x3d"onClick:_submitMfaUsername" data-dojo-type\x3d"dijit/form/Button" class\x3d"esriFloatLeading calcite blue"\x3e${i18n.customRoles.continueLabel}\x3c/button\x3e\r\n             \x3cbr /\x3e\r\n          \x3c/div\x3e\r\n         \x3cdiv class\x3d"contentPane newStyles" dojoAttachPoint\x3d"disableMfa" style\x3d"display:none;clear:both;"\x3e\r\n             \x3cbr /\x3e\r\n             \x3ch2\x3e${i18n.mfaSecurityQuestionTitle}\x3c/h2\x3e\r\n             \x3cp class\x3d"securityQuestion"\x3e${i18n.mfaSecurityQuestionMsg}\x3c/p\x3e\r\n             \x3clabel class\x3d"mfaSecurityQuestion esriFloatLeading" dojoAttachPoint\x3d"_mfaSecurityQuestion"\x3e\x3c/label\x3e\r\n             \x3cinput dojoAttachPoint\x3d"_mfaSecurityAnswer" name\x3d"answer" dojoType\x3d"dijit.form.ValidationTextBox" trim\x3d"true" class\x3d"ieFix securityQuestion" /\x3e\r\n             \x3cdiv class\x3d"prompt mfaSecurityQuestion"\x3e${i18n.securityQuestionPrompt}\x3c/div\x3e\r\n             \x3cbutton dojoAttachEvent\x3d"onClick:_submitMfaReset" dojoType\x3d"dijit.form.Button" class\x3d"calcite blue esriFloatLeading indentBtn" style\x3d"margin-left: 205px;"\x3e${i18n.send}\x3c/button\x3e\r\n         \x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"register" title\x3d"${i18n.links.register}" style\x3d"display:none;"\x3e\r\n            \x3cp class\x3d"marginless"\x3e\x3cb\x3e${i18n.signInWidget.agsTrial}\x3c/b\x3e\x3c/p\x3e\r\n            \x3cp\x3e${i18n.signInWidget.agsSubscriptionInfo}\x3c/p\x3e\r\n            \x3ca class\x3d"calcite btn small blue" href\x3d"/about/free-trial.html?origin\x3darcgis"\x3e${i18n.signInWidget.ags30DayTrial}\x3c/a\x3e\x3cbr/\x3e\r\n            \x3cp\x3e\x3cb\x3e${i18n.signInWidget.agsNoTrial}\x3c/b\x3e\x3c/p\x3e\r\n            \x3cp\x3e${i18n.signInWidget.agsCreatePersonalMsg}.\x3c/p\x3e\r\n            \x3cp\x3e${i18n.signInWidget.agsHavePersonal}\x3c/p\x3e\r\n            \x3ca id\x3d"registerBtn" class\x3d"calcite btn small light"\x3e${i18n.signInWidget.agsRegisterPersonalBtn}\x3c/a\x3e\x3cbr/\x3e\r\n            \x3cp\x3e${i18n.signInWidget.agsCreatePersonal}\x3c/p\x3e\r\n            \x3ca id\x3d"createBtn" class\x3d"calcite btn small light"\x3e${i18n.signInWidget.agsCreatePersonalBtn}\x3c/a\x3e\r\n          \x3c/div\x3e\r\n          \x3cbr /\x3e\r\n          \x3cp data-dojo-attach-point\x3d"gotoStart" class\x3d"indent notstart" style\x3d"display:none;"\x3e${i18n.otherQuestions}\x26nbsp;\x26nbsp;\x3ca target\x3d"_blank" data-dojo-attach-event\x3d"onclick:_troubleshoot"\x3e${i18n.seeTroubleshooting}\x3c/a\x3e\x3c/p\x3e\r\n      \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cbr /\x3e\r\n      \x3cbr /\x3e\r\n\x3c/div\x3e\r\n',
baseClass:"esriTroubleshoot",_util:arcgisonline.sharing.util,_account:arcgisonline.sharing.geow.Account,postMixInProperties:function(){this.inherited(arguments);t.mixin(this,t.queryToObject(window.location.search.slice(1)));if(this.returnUrl){var b=window.location.host.split(".").slice(-2).join(".")+"/";-1===this.returnUrl.indexOf(b)&&-1===this.returnUrl.indexOf("arcgis.com/")&&-1===this.returnUrl.indexOf("esri.com/")&&(this.returnUrl=null)}this.i18n=t.mixin({},t.i18n.getLocalization("arcgisonline",
"arcgisonline").common);t.mixin(this.i18n,t.i18n.getLocalization("arcgisonline","arcgisonline").troubleshoot);t.mixin(this.i18n,{customRoles:t.i18n.getLocalization("arcgisonline","arcgisonline").customRoles});t.mixin(this.i18n,{mosaicRulePanel:t.i18n.getLocalization("arcgisonline","arcgisonline").mosaicRulePanel});t.mixin(this.i18n,t.i18n.getLocalization("arcgisonline","arcgisonline").newUser);t.mixin(this.i18n,{signInWidget:t.i18n.getLocalization("arcgisonline","arcgisonline").signInWidget});this.i18n.errors=
t.mixin(t.i18n.getLocalization("arcgisonline","arcgisonline").common.errors,t.i18n.getLocalization("arcgisonline","arcgisonline").troubleshoot.errors,t.i18n.getLocalization("arcgisonline","arcgisonline").newUser.errors);this.i18n.questions=t.mixin(t.i18n.getLocalization("arcgisonline","arcgisonline").securityQuestions,{0:this.i18n.questions.question0})},startup:function(){this.inherited(arguments);this._connects=[];esri.config.defaults.io.proxyUrl=esriGeowConfig.proxyServer;this._errorDlg=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance();
this._svcUrl=esriGeowConfig.restBaseUrl+(esriGeowConfig.restBaseUrl.lastIndexOf("/")===esriGeowConfig.restBaseUrl.length-1?"":"/");this._communityUrl=this._svcUrl+"community/";this._userUrl=this._communityUrl+"users/";this._requestParams={f:"json"};this._createStrengthMeter();this.connect(t.byId("registerBtn"),"onclick",t.hitch(this,function(){window.location=esriGeowConfig.signup}));this.connect(t.byId("createBtn"),"onclick",t.hitch(this,function(){window.location=esriGeowConfig.createAccount}));
this.connect(this._stackContainer,"onClick",t.hitch(this,function(){t.style(this.changePassword,"display","none")}));this._account.getSelf(t.hitch(this,function(b){this.portalSelf=b;this._initHelpMgr();this._troubleshoot()}))},destroy:function(){this.inherited(arguments);t.forEach(this._connects,t.disconnect)},_initHelpMgr:function(){var b=arcgisonline.sharing.dijit.HelpManager.prototype.statics.getInstance(),m=setInterval(t.hitch(this,function(){if(b.isLoaded())if(clearInterval(m),esriGeowConfig&&
esriGeowConfig.self&&esriGeowConfig.self.isPortal)t.query(".helpLink").forEach(esri.hide),t.query("#instructions").forEach(function(d){t.style(d,"visibility","hidden")});else{var f=b.getHelpUrl("120000466");t.query(".helpLink").attr("href",f)}}),200)},_createStrengthMeter:function(){this._account.getSelf(function(b){this._strengthMeter=new arcgisonline.pages.dijit.PasswordStrength({portal:esriGeowConfig.self},this._strengthMeter);this._strengthMeter.update()}.bind(this))},isValidPassword:function(){var b=
this._newPassword.get("value");return this._strengthMeter.update(b).then(function(m){m=m.isValid;this._showInvalidPasswordError(m);return m}.bind(this))},_showInvalidPasswordError:function(b){b?t.addClass(this._passwordError,"hide"):(t.attr(this._passwordError,"innerHTML",this.i18n.passwordHintText),t.removeClass(this._passwordError,"hide"))},_switchPane:function(b){},_forgotPassword:function(){t.attr(this._forgotPasswordTitle,"innerHTML",this.i18n.forgotPassword);this._switchPane(this.forgotPassword);
this._userName.focus()},_changePassword:function(){t.attr(this._forgotPasswordTitle,"innerHTML",this.i18n.resetPassword);this._switchPane(this.forgotPassword);this._userName.focus()},_forgotUsername:function(){this._switchPane(this.forgotUsername);this._email.focus()},_troubleshoot:function(){var b=this.portalSelf||{};!1===esriGeowConfig.showForgotUsername&&this._stackContainer.removeChild(this.forgotUsername);this.isPortal=b&&b.isPortal;b&&(b.isPortal||b.urlKey)&&(this._stackContainer.removeChild(this.register),
this.isPortal&&(t.query(".portal-only").forEach(esri.show),t.attr(this._securityQuestionInstructions,"innerHTML",this.i18n.securityQuestionInstructionsNoEmail),this._stackContainer.removeChild(this.mfaHelp)));this._clear();this._securityQuestionIdx=-1;this._switchPane(this._start)},_redirectToSignin:function(){window.location=this.returnUrl||"signin.html"},_submitEmail:function(b){b.preventDefault();if(!this._checkRequired([this._email]))return b=this._communityUrl+"forgotUsername",this._disable(!0),
this._request(b,{email:this._getCleanString(this._email)}).then(t.hitch(this,function(){this._redirectToSignin()}))},_submitUsername:function(b){b.preventDefault();this._newPassword.set("value","");this._verifyPassword.set("value","");if(!this._checkRequired([this._userName]))return b=this._userUrl+this._getCleanString(this._userName)+"/forgotPassword",this._disable(!0),this._request(b,{}).then(t.hitch(this,function(m){m=m||{};"arcgis"===m.provider?(this._securityQuestionIdx=(-1===m.securityQuestionIdx?
0:m.securityQuestionIdx)||0,t.attr(this._securityQuestion,"innerHTML",this.i18n.questions[m.securityQuestionIdx]),this._securityQuestionIdx||this._showError(this.i18n.errors[this.isPortal?"noSecurityPortal":"noSecurity"]),t.query(".securityQuestion",this.domNode).style("display",""),t.style(this.changePassword,"display",this._securityQuestionIdx?"":"none"),this._securityAnswer.focus()):"enterprise"===m.provider?this._showError(this.i18n.errors.administrator):(this._isEcas=!0,t.query(".securityQuestion",
this.domNode).style("display","none"),t.style(this.changePassword,"display",""))}))},_getCleanString:function(b){b=b.get("value")||"";return(new DOMParser).parseFromString(b,"text/html").body.textContent||""},_submitMfaUsername:function(b){b.preventDefault();if(!this._checkRequired([this._mfaUserName]))return b=this._userUrl+this._getCleanString(this._mfaUserName)+"/forgotPassword",this._disable(!0),this._mfaUserNameCheck=!0,this._request(b,{}).then(t.hitch(this,function(m){m=m||{};this._securityQuestionIdx=
(-1===m.securityQuestionIdx?0:m.securityQuestionIdx)||0;t.attr(this._mfaSecurityQuestion,"innerHTML",this.i18n.questions[m.securityQuestionIdx]);this._securityQuestionIdx||this._showError(this.i18n.errors.noSecurity);t.query(".disableMfa",this.domNode).style("display","");t.style(this.disableMfa,"display",this._securityQuestionIdx?"":"none");this._mfaSecurityAnswer.focus()}))},_submitMfaReset:function(b){b.preventDefault();b={securityAnswer:this._getCleanString(this._mfaSecurityAnswer),securityQuestionIdx:this._securityQuestionIdx};
if(!this._checkRequired([this._mfaSecurityAnswer])){var m=this._util.getSecureUrl(this._userUrl)+this._mfaUserName.get("value")+"/disableMfaRequest";this._disable(!0);return this._request(m,b).then(t.hitch(this,function(f){var d=t.connect(this._errorDlg,"onHide",t.hitch(this,function(){d.remove();this._redirectToSignin()}));this._showError(this.i18n.errors.mfaEmailSent)}))}},_submitReset:function(b){b.preventDefault();var m={securityAnswer:this._getCleanString(this._securityAnswer),securityQuestionIdx:this._securityQuestionIdx};
if(this.isPortal){b=[this._newPassword,this._verifyPassword];this._isEcas||b.unshift(this._securityAnswer);if(this._checkRequired(b))return;if(this._newPassword.get("value")!==this._verifyPassword.get("value"))return this._verifyPassword.focus(),this._showError(this.i18n.errors.passwordsNotMatch);m.newPassword=this._newPassword.get("value")}else{b=[this._securityAnswer];if(this._checkRequired(b))return;m.email=!0}if(this.isPortal)this.isValidPassword().then(function(f){if(f)return this._makeResetRequest(m);
this._newPassword.focus();return!this._showError(t.mixin(this.i18n.errors.invalidPassword,{message:this.i18n.passwordHintText}))}.bind(this));else return this._makeResetRequest(m)},_makeResetRequest:function(b){var m=this._util.getSecureUrl(this._userUrl)+this._userName.get("value")+"/reset";this._disable(!0);return this._request(m,b).then(t.hitch(this,function(f){if(this.isPortal)this._redirectToSignin();else{var d=t.connect(this._errorDlg,"onHide",t.hitch(this,function(){d.remove();this._redirectToSignin()}));
this._showError(this.i18n.errors.emailSent)}}))},_disable:function(b){t.query(".esriTroubleshoot .dijitTextBox, .esriTroubleshoot .dijitButton").map(p.byNode).forEach(function(m){m.set("disabled",b)})},_clear:function(){t.query(".esriTroubleshoot .dijitTextBox").map(p.byNode).forEach(function(b){b.set("value","")})},_checkRequired:function(b){return(b=t.filter(b,t.hitch(this,function(m){return this._isEmpty(m)})))&&b.length?(b[0].focus(),this._showError(this.i18n.errors.required[b[0].name])):!1},
_isEmpty:function(b){b=b.get("value");return(this.trim?/^\s*$/:/^$/).test(b)},_request:function(b,m){return this._util.request({url:b,content:m},{usePost:!0}).then(t.hitch(this,function(f){this._mfaUserNameCheck=!1;this._disable(!1);return f.error?this._showError(f.error):f}),t.hitch(this,function(f){this._disable(!1);f&&"COM_0018"===f.messageCode&&this._userName?(f=this._mfaUserNameCheck?this._getCleanString(this._mfaUserName):this._getCleanString(this._userName),f={message:esri.substitute({username:f},
this.i18n.errors.COM_0018)}):f&&"COM_0049"===f.messageCode?f={message:this.i18n.errors.COM_0049.message}:f&&"COM_1037"===f.messageCode?f={message:this.i18n.errors.COM_1037}:f&&"COM_1059"===f.messageCode?f={message:this.i18n.errors.COM_1059}:f&&"COM_1055"===f.messageCode?f={message:this.i18n.errors.COM_1055}:f&&"DB_0003"===f.messageCode?f={message:this.i18n.errors.DB_0003}:f&&"DB_0002"===f.messageCode&&(f={message:this.i18n.errors.DB_0002});this._showError(f);this._mfaUserNameCheck=!1;throw f;}))},
_showError:function(b){b.message=b.message&&b.message.replace(/[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/gi,"")||"";b.message=this._util.stripHTML(b.message);b=b.error||b||{};b.code=b.code||0;b=t.mixin(t.mixin({},this.i18n.errors.error),b);this._errorDlg.show(b);return!0}})})},"arcgisonline/sharing/dijit/dialog/ExportDlg":function(){define("require exports tslib ../../../esriGeowConfig ../../../pages/pageUtil ../../../pages/serviceUtil ../../../pages/utils/categories ../../../pages/utils/dom ../../util ../SaveItem ./GeneralDlg ../../../tsutils/declareDecorator dijit/a11yclick dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Deferred dojo/promise/all dojo/string dojo/on dojo/topic esri/config esri/lang esri/Evented dojo/i18n!../../../nls/arcgisonline dojo/text!./templates/ExportDlg.html ../ComboBox".split(" "),
function(t,p,x,b,m,f,d,a,c,l,h,n,g,e,k,w,q,u,r,v,z,B,A,y,D,G){b=x.__importDefault(b);m=x.__importDefault(m);f=x.__importDefault(f);d=x.__importDefault(d);a=x.__importDefault(a);c=x.__importDefault(c);l=x.__importDefault(l);h=x.__importDefault(h);n=x.__importDefault(n);g=x.__importDefault(g);e=x.__importDefault(e);k=x.__importDefault(k);w=x.__importDefault(w);q=x.__importDefault(q);u=x.__importDefault(u);r=x.__importDefault(r);v=x.__importDefault(v);z=x.__importDefault(z);B=x.__importDefault(B);A=
x.__importDefault(A);y=x.__importDefault(y);D=x.__importDefault(D);G=x.__importDefault(G);var E;(function(F){F.ShapeFile="Shapefile";F.CSV="CSV";F.FileGDB="File Geodatabase";F.GeoJson="GeoJson";F.FeatureCollection="Feature Collection";F.KML="KML";F.Excel="Excel";F.TilePackage="Tile Package"})(E||(E={}));return function(){function F(){this.declaredClass="arcgisonline.sharing.dijit.dialog.ExportDlg";this.widgetsInTemplate=!0;this.templateString=G["default"];this.layerId=-1;this.init=!1;this.checkStatusInterval=
null;this.checkingStatus=!1;this.statusCheckIntervalTime=4E3;this._setMessageAttr={node:"_message",type:"innerHTML"};this.typeLookup={shapefileType:E.ShapeFile,csvType:E.CSV,fileGDB:E.FileGDB,geoJson:E.GeoJson,featureCollection:E.FeatureCollection,kmlType:E.KML,excelType:E.Excel,CSV:"CSV Collection",KML:"KML Collection",Excel:"Microsoft Excel",tilePackage:E.TilePackage};this.requiredBorder="1px dotted orangered";this.normalBorder="1px solid #bbb"}F.prototype.onDone=function(I){};F.prototype.postMixInProperties=
function(){this.inherited(arguments);this.i18n=x.__assign(x.__assign(x.__assign({},D["default"].common),D["default"].exportDlg),{defaultError:D["default"].errorWidget.defaultError,generalize:D["default"].addLayerFromFileDlg.generalize,keepOrig:D["default"].addLayerFromFileDlg.keepOrig,notEnoughCreditsTitle:D["default"].publishTileServiceDlg.notEnoughCreditsTitle,itemProperties:D["default"].itemProperties});this._webMercatorValues={3857:1,102113:1,102100:1,900913:1}};F.prototype.postCreate=function(){this.inherited(arguments);
this.init||(this.init=!0,this.saveItem=new l["default"]({},this.saveItemForm))};F.prototype.startup=function(){this.inherited(arguments);B["default"].defaults.io.proxyUrl=b["default"].proxyServer;b["default"].proxyUrl&&(B["default"].defaults.io.proxyUrl=b["default"].proxyUrl)};F.prototype.destroy=function(){this._onSaveItemValidateHandle&&(this._onSaveItemValidateHandle.remove(),this._onSaveItemValidateHandle=null);this.exportDialog.destroyRecursive();this._pendingCanceller=this.exportDialog=null;
this.inherited(arguments)};F.prototype.show=function(I,M,P,W){var H=this;this.showDlg(I,M,P);W&&setTimeout(function(){H._message.style.maxWidth=H.saveItem.domNode.clientWidth+"px";H.setWait(!0);W.waitForCredits.then(function(O){H._pendingCanceller=null;if(O.success)return H.set("message",O.message),H.unsetWait();H.displayError(O,H.i18n.notEnoughCreditsTitle)},function(O){H._pendingCanceller=null;H.displayError(O)});H._pendingCanceller=W.canceller},0)};F.prototype.showShapefile=function(I,M){this.showDlg(I,
M,E.ShapeFile)};F.prototype.showCSV=function(I,M){this.showDlg(I,M,E.CSV)};F.prototype.showFileGDB=function(I,M){this.showDlg(I,M,E.FileGDB)};F.prototype.showGeoJson=function(I,M){this.showDlg(I,M,E.GeoJson)};F.prototype.showFeatureCollection=function(I,M){this.showDlg(I,M,E.FeatureCollection)};F.prototype.showDlg=function(I,M,P){this.clear();this.item=I;this.setDialogTitle(P);this.setLayerDetails(M);this.checkForStaleData(I,M);this.initTags();this.initCategories();this.exportDialog.show();I=this.onCancel.bind(this);
this.own(g["default"](this.exportDialog.closeButtonNode,I),v["default"](this.cancelBtn,"click",I),v["default"](this.exportBtn,"click",this.onExport.bind(this)));this.exportDialog.closeButtonNode.tabIndex=0};F.prototype.checkForStaleData=function(I,M){var P,W,H,O;(null===(P=I.layers)||void 0===P?0:P.length)&&"Feature Service"===I.type&&-1<I.typeKeywords.indexOf("Hosted Service")&&(M&&!M.length?O=null===(W=M.editingInfo)||void 0===W?void 0:W.lastEditDate:I.layers.forEach(function(K){var R;(H=null===
(R=K.editingInfo)||void 0===R?void 0:R.lastEditDate)&&(!O||O<H)&&(O=H)}))};F.prototype.initTags=function(){var I=this;this.saveItem.loadTags().then(function(){I.saveItem.set("tags",[])})};F.prototype.initCategories=function(){this.saveItem.loadCategories(this.item.categories)};F.prototype.setDialogTitle=function(I){this.exportType=I;I=this.i18n.itemProperties;var M=this.i18n.exportDialogTitle;E.ShapeFile===this.exportType?M=I.exportToShapefile:E.CSV===this.exportType?M=I.exportToCSVFile:E.FileGDB===
this.exportType?M=I.exportToFileGDB:E.GeoJson===this.exportType?M=I.exportToGeoJson:E.FeatureCollection===this.exportType?M=I.exportToFeatureCollection:E.KML===this.exportType?M=I.exportToKML:E.Excel===this.exportType?M=I.exportToExcel:E.TilePackage===this.exportType&&(M=I.exportToTilePackage);this.exportDialog.set("title",M)};F.prototype.setLayerDetails=function(I){var M,P,W,H;this._isTableLayer=this._isWebMercator=!1;I&&A["default"].isDefined(I.id)?(this.layerId=I.id,this._layers=[I],this.saveItem.set("title",
I.name),this._isWebMercator=(null===(P=null===(M=I.extent)||void 0===M?void 0:M.spatialReference)||void 0===P?void 0:P.wkid)in this._webMercatorValues,this._extent=I.extent):I&&I.length&&(this._layers=I,this._isWebMercator=(null===(H=null===(W=I[0].extent)||void 0===W?void 0:W.spatialReference)||void 0===H?void 0:H.wkid)in this._webMercatorValues,this._isTableLayer=I.every(function(O){return"Table"===O.type}),this._extent=I[0].extent,this.saveItem.set("title",1===I.length?I[0].name:this.item.title));
this._isWebMercator&&!this._isTableLayer&&this.exportType===E.FeatureCollection&&(this.featureCollectionDiv.classList.remove("hide"),this.generalizeChk.checked=!0)};F.prototype.clear=function(){this.exportDialog.set("title",this.i18n.exportDialogTitle);this.item=null;this.layerId=-1;this.checkStatusInterval=this.exportResponse=this.exportType=null;this.checkingStatus=!1;this.saveItem.set("title","");this.saveItem.set("tags",[]);this.saveItem.set("summary","");this.saveItem.set("requires",["title"]);
this.exportingLabel.style.visibility="hidden";this.exportBtn.disabled=!0;this._onSaveItemValidateHandle=z["default"].subscribe("onSaveItemValidate",this.validate.bind(this));this.saveItem.hideRow("folder");a["default"].forEachNode(this.saveItem.domNode.querySelectorAll(".select2-container.select2-container-multi"),function(I){I.style.minWidth="33px"});this.featureCollectionDiv.classList.add("hide");this.generalizeChk.checked=!1};F.prototype.hide=function(){return this.exportDialog.hide()};F.prototype.validate=
function(I){I=this.saveItem.get("title");this.exportBtn.disabled=!I};F.prototype.validates=function(){return!!this.saveItem.get("title")};F.prototype.setWait=function(I){this.exportDialog.domNode.style.cursor="wait";I?this.set("message",this.i18n.estimatingCredits):this.exportingLabel.style.visibility="visible";this.exportBtn.disabled=!0};F.prototype.unsetWait=function(){this.exportDialog.domNode.style.cursor="default";this.exportingLabel.style.visibility="hidden";this.exportBtn.disabled=!1};F.prototype.exportImageryItem=
function(){var I=this,M=this.saveItem.get("title");M=f["default"].exportImageryToTilePackage(this.item,M);var P=M.dfd;this._pendingCanceller=M.canceller;P.then(function(W){var H=W.success;W=W.outputValue;I._pendingCanceller=null;H&&W.itemId?(I.exportResponse={exportItemId:W.itemId},I.updateExportedItemDetails({itemId:W.itemId,statusMessage:""})):I.displayError(I.i18n.defaultError)},function(){I._pendingCanceller=null;I.displayError(I.i18n.defaultError)})};F.prototype.exportItem=function(){var I=this;
if(this._moveFailed)this.updateItem(this._moveFailed.itemId,"/").then(function(K){I.unsetWait();I.onDone(K)});else{this.setWait();if("Image Service"===this.item.type&&E.TilePackage===this.exportType)return this.exportImageryItem();var M=this.saveItem.get("title"),P=this.generalizeChk.checked,W={maxAllowableOffset:1,quantizationParameters:{tolerance:1}},H=E.ShapeFile;E.CSV===this.exportType?H=E.CSV:E.FileGDB===this.exportType?H=E.FileGDB:E.GeoJson===this.exportType?H=E.GeoJson:E.FeatureCollection===
this.exportType?H=E.FeatureCollection:E.KML===this.exportType?H="kml":E.Excel===this.exportType&&(H="excel");var O=this._layers.map(function(K){return P?x.__assign({id:K.id},W):{id:K.id}});M={itemId:this.item.id,title:M,exportFormat:H,exportParameters:-1<this.layerId?{layers:O}:P?W:null};this.item.isOwner&&this.item.isDataView&&(M.exportParameters=x.__assign(x.__assign({},M.exportParameters||{}),{enforceFieldVisibility:!0}));M.exportParameters&&(M.exportParameters=JSON.stringify(M.exportParameters));
H=c["default"].getUser();c["default"].request({url:b["default"].restBaseUrl+"content/users/"+H.username+"/export",content:M},{usePost:!0}).then(this.handleExport.bind(this),this.displayError.bind(this))}};F.prototype.handleExport=function(I){!I||I.code||I.message?this.displayError(I):(this.exportResponse=I,this.checkStatusInterval=setInterval(this.checkStatus.bind(this),this.statusCheckIntervalTime))};F.prototype.checkStatus=function(){var I=this;if(this.exportResponse&&!this.checkingStatus){var M=
{jobId:this.exportResponse.jobId,jobType:"export"},P=c["default"].getUser();P=b["default"].restBaseUrl+"content/users/"+P.username+"/items/"+this.exportResponse.exportItemId+"/status";this.checkingStatus=!0;c["default"].request({url:P,content:M}).then(function(W){I.handleStatusCheck(W);I.checkingStatus=!1},function(W){I.displayError(W);I.checkingStatus=!1})}};F.prototype.handleStatusCheck=function(I){"completed"===(null===I||void 0===I?void 0:I.status)?(clearInterval(this.checkStatusInterval),this.updateExportedItemDetails(I)):
"failed"===I.status&&(clearInterval(this.checkStatusInterval),this.updateExportedItemDetailsAndFail(I))};F.prototype.updateExportedItemDetailsAndFail=function(I){var M=this;this.getItemDetails(this.exportResponse.exportItemId).then(function(P){var W=[],H=b["default"].self.hasCategorySchema&&M.saveItem.get("categories")||[];0<H.length&&W.push(d["default"].setItemCategories([P.id],H));W.push(M.updateItem(P.id,P.ownerFolder));u["default"](W).then(function(){M.unsetWait();M.displayFailure(I.statusMessage)})})};
F.prototype.updateExportedItemDetails=function(I){var M=this;this.getItemDetails(I.itemId).then(function(P){var W=[],H=b["default"].self.hasCategorySchema&&M.saveItem.get("categories")||[];0<H.length&&W.push(d["default"].setItemCategories([P.id],H));W.push(M.updateItem(P.id,P.ownerFolder));u["default"](W).then(function(){M.unsetWait();M.onDone(I)})})};F.prototype.moveItem=function(I,M){var P=this,W=new q["default"],H=c["default"].getUser();H=b["default"].restBaseUrl+"content/users/"+H.username+"/items/"+
I+"/move";var O={folder:M||"/"};this._moveFailed=null;M&&"/"!==M&&""!==M?c["default"].request({url:H,content:O},{usePost:!0}).then(function(K){W.resolve(K)},function(K){if(K&&"CONT_0011"===K.messageCode){var R=P.saveItem.get("title");R=r["default"].substitute(P.i18n.duplicateFound,{type:P.exportType,title:R});m["default"].createSpecifiedDialog(h["default"]).show({title:P.i18n.errorTitle,message:R});P._moveFailed=x.__assign(x.__assign({},K),{itemId:I,folderId:M});P.unsetWait()}}):W.resolve({itemId:I});
return W};F.prototype.updateItem=function(I,M){var P=this.saveItem.get("title"),W=this.saveItem.get("tags"),H=this.saveItem.get("summary"),O=this.saveItem.get("folderId"),K=b["default"].restBaseUrl+"content/items/"+this.exportResponse.exportItemId+"/data",R=c["default"].getUser();R=b["default"].restBaseUrl+"content/users/"+R.username;M&&0<M.length&&(R+="/"+M);R+="/items/"+this.exportResponse.exportItemId+"/update";P={title:P,tags:W,snippet:H};this._moveFailed||(P.folderId=O);E.KML===this.exportType&&
(P.url=K);return c["default"].request({url:R,content:P},{usePost:!0}).then(this.moveItem.bind(this,I,O))};F.prototype.getItemDetails=function(I){return c["default"].request({url:b["default"].restBaseUrl+"content/items/"+I})};F.prototype.goToItem=function(I){var M=this;this.hide().then(function(){M.unsetWait();window.location.href=b["default"].baseUrl+"item.html?id\x3d"+I})};F.prototype.checkTitle=function(){var I=this.saveItem.get("title"),M=this.saveItem.get("folderId"),P=this.typeLookup[this.exportType]||
this.exportType,W=c["default"].getUser().username;return c["default"].request({url:b["default"].restBaseUrl+"search",content:{q:'title:"'+I+'" AND type:"'+P+'" AND owner:"'+W+'" AND ownerfolder:"'+(M&&"/"!==M?M:"root")+'"'}})};F.prototype.displayFailure=function(I){var M=this;if(I)try{var P=JSON.parse(I)}catch(O){P=I}var W=m["default"].createSpecifiedDialog(h["default"]);W.onOkClick=function(){W.hide();M.onCancel()};var H=this.i18n.errorTitle;P.message&&(I=P.message);W.show({title:H,message:I})};
F.prototype.displayError=function(I,M){var P=this;M=M||this.i18n.errorTitle;if(I){var W=m["default"].createSpecifiedDialog(h["default"]);W.onOkClick=function(){W.hide();P.onCancel()};W.show({title:M,message:(null===I||void 0===I?0:I.code)&&I.message?I.message:I})}};F.prototype.onExport=function(){var I=this;this.validates()&&this.checkTitle().then(function(M){0<M.total?(M=I.saveItem.get("title"),M=r["default"].substitute(I.i18n.duplicateFound,{type:I.typeLookup[I.exportType]||I.exportType,title:M}),
m["default"].createSpecifiedDialog(h["default"]).show({title:I.i18n.errorTitle,message:M})):I.exportItem()})};F.prototype.onCancel=function(I){var M,P;null===(M=null===I||void 0===I?void 0:I.preventDefault)||void 0===M?void 0:M.call(I);null===(P=this._pendingCanceller)||void 0===P?void 0:P.call(this);this.hide();this.destroy()};return F=x.__decorate([n["default"](e["default"],k["default"],w["default"],y["default"])],F)}()})},"arcgisonline/pages/serviceUtil":function(){define("require exports tslib dojo/Deferred dojo/json dojo/promise/all dojo/sniff esri/lang esri/layers/FeatureLayer esri/request esri/tasks/Geoprocessor ./pageUtil ./utils/arrays arcgisonline/sharing/dijit/Role ../sharing/util ../esriGeowConfig".split(" "),
function(t,p,x,b,m,f,d,a,c,l,h,n,g,e,k,w){b=x.__importDefault(b);m=x.__importDefault(m);f=x.__importDefault(f);d=x.__importDefault(d);a=x.__importDefault(a);c=x.__importDefault(c);l=x.__importDefault(l);h=x.__importDefault(h);n=x.__importDefault(n);g=x.__importDefault(g);e=x.__importDefault(e);k=x.__importDefault(k);w=x.__importDefault(w);return function(){function q(){}q.getDateFields=function(u){return((null===u||void 0===u?void 0:u.fields)||[]).filter(function(r){return"esriFieldTypeDate"===(null===
r||void 0===r?void 0:r.type)})};q.fetchServerToken=function(u,r){var v=u.portal,z=r||u.url;return z?k["default"].request({url:k["default"].getSecureUrl(v.portalUrl+"generateToken"),content:{serverUrl:z}},{usePost:!0}).then(function(B){return B.token}):null};q.fetchItemAdminUrl=function(u,r){var v;return u.portal.isPortal?(null===r||void 0===r?0:r.adminUrl)&&r.url?this.getAdminUrl(u,r):u.url:(null===(v=u.url)||void 0===v?void 0:v.replace("/rest/","/rest/admin/"))||null};q.getAdminUrl=function(u,r){var v=
u.url;v=v.replace(v.split("/rest/")[0],r.adminUrl);return u.isSDS||"Knowledge Graph"===u.type?v.replace("/rest/","/rest/admin/"):v.replace("/rest/","/admin/").replace("/FeatureServer",".MapServer").replace("/MapServer",".MapServer").replace("/VectorTileServer",".VectorTileServer").replace("/SceneServer",".SceneServer").replace("/ImageServer",".ImageServer")};q.fetchServiceLayers=function(u){return k["default"].request({url:u+"/layers"}).then(function(r){return(null===r||void 0===r?void 0:r.layers)||
[]})};q.renameServiceLayers=function(u,r){var v=new b["default"],z=r.adminUrl+"/"+u.layerId,B={name:u.layerRename};"Map Service"===r.type?(z+="/edit",B={layerDefinition:JSON.stringify(B)}):(z+="/updateDefinition",B={updateDefinition:JSON.stringify(B),async:!1});k["default"].request({url:z,content:B},{usePost:!0}).then(function(){return v.resolve()},function(A){return v.reject(A)});return v};q.updateServiceDefinition=function(u){var r=u.layerId,v=u.item;u=u.definition;var z=new b["default"];k["default"].request({url:v.adminUrl+
"/"+r+"/updateDefinition",content:{updateDefinition:JSON.stringify(u),async:!1}},{usePost:!0}).then(function(){return z.resolve()},function(B){return z.reject(B)});return z};q.queryGeocodeCounts=function(u){var r=[],v=u.url,z={where:"1\x3d1",returnCountOnly:!0},B=u.reviewTable,A=v+"/"+(u.layers||[])[0].id+"/query",y=new b["default"];u.canUpdate&&u.isHostedService&&u.hasGeocodeReviewTable?(r.push(k["default"].request({url:A,content:z})),B&&(u=v+"/"+B.id+"/query",r.push(k["default"].request({url:u,
content:z}))),f["default"](r).then(function(D){var G=(null===D||void 0===D?void 0:D.length)&&D[0].count||0;y.resolve({successful:G,total:G+(1<(null===D||void 0===D?void 0:D.length)&&D[1].count||0)})},function(D){y.resolve(null)})):y.resolve(null);return y};q.adjustHostedServerForProtocol=function(u){return"https:"===location.protocol?u.replace("http:","https:").replace(":6080",":6443"):u.replace("https:","http:").replace(":6443",":6080")};q.checkForResources=function(u){var r=u.itemUrl+"/resources/styles/root.json";
"Vector Tile Service"!==u.type||a["default"].isDefined(u.hasResources)?(r=new b["default"],r.resolve(!!u.hasResources)):r=k["default"].request({url:r}).then(function(){return!0},function(){return!1});return r};q.setFeatureServiceScaleRanges=function(u){var r=this,v=new b["default"],z=u.url,B=u.sourceData||{},A=u.featureLayers||[];!u.numViews&&u.isHostedService&&"Feature Service"===u.type&&"Service Definition"!==B.type?f["default"](A.map(function(y){return r.setScaleRange(z+"/"+y.id,u,y.id)})).then(function(){return v.resolve(!0)}):
v.resolve(!0);return v};q.setScaleRange=function(u,r,v){var z=new b["default"],B=new c["default"](u);u=r.adminUrl;v=a["default"].isDefined(v)?"/"+v:"";var A=""+u+v+"/updateDefinition";B.addPlugin("esri/plugins/FeatureLayerStatistics").then(function(){B.statisticsPlugin.getSuggestedScaleRange().then(function(y){y={updateDefinition:m["default"].stringify({maxScale:y.maxScale||0,minScale:y.relaxedMinScale||0})};k["default"].request({url:A,content:y},{usePost:!0}).then(function(){return z.resolve(r)},
function(){return z.resolve(r)})},function(y){z.resolve(r)})});return z};q.getSuggestedScaleRange=function(u){var r=new b["default"],v=new c["default"](u);v.addPlugin("esri/plugins/FeatureLayerStatistics").then(function(){v.statisticsPlugin.getSuggestedScaleRange({sampleSize:100,forPublishingTiles:!0}).then(function(z){return r.resolve(z)},function(z){r.resolve(null)})},function(z){r.resolve(null)});return r};q.encodeServiceName=function(u,r){if(d["default"]("ie")||d["default"]("trident")||d["default"]("edge")){var v=
u.indexOf("admin/services/Hosted/"),z=k["default"].isPortal()&&!r?-1<u.indexOf(".MapServer")?u.indexOf(".MapServer"):-1<u.indexOf(".VectorTileServer")?u.indexOf(".VectorTileServer"):u.indexOf("/SceneServer"):u.indexOf("/FeatureServer");0<v&&(u=u.substring(0,v+22)+encodeURIComponent(u.substring(v+22,z))+u.substring(z))}return u};q.getImageryToTilePackageParams=function(u,r){var v,z=u.id,B=u.itemUrl||u.portal.portalUrl+"content/items/"+z,A=u.portal.getPortalUser();A=(null===(v=null===A||void 0===A?
void 0:A.credential)||void 0===v?void 0:v.token)||(null===A||void 0===A?void 0:A.token);return{inputImageryLayer:JSON.stringify({itemId:z,url:B+"?token\x3d"+A}),outputTilePackage:r||"tpk"+z,context:"{}"}};q.exportImageryToTilePackage=function(u,r,v){u=q.getImageryToTilePackageParams(u,r);u=x.__assign(x.__assign({},u),{f:"json"});return q.createImageryTask({taskName:"ExportToTilePackage",inputParameters:u,updateDelay:2E4,statusCallback:v,outputParameterName:"outTilePackage"})};q.fetchExportImageryCredits=
function(u){u=q.getImageryToTilePackageParams(u);u={inputAnalysisTask:JSON.stringify({name:"ExportToTilePackage",parameters:u}),f:"json",context:"{}"};return q.createImageryTask({taskName:"EstimateRasterAnalysisCost",inputParameters:u,updateDelay:2E3,outputParameterName:"outCost"})};q.createImageryTask=function(u){var r=u.taskName,v=u.updateDelay,z=u.inputParameters,B=u.outputParameterName,A=u.statusCallback,y=new b["default"],D=new h["default"](w["default"].self.helperServices.rasterAnalytics.url+
"/"+r);v&&D.setUpdateDelay(v);var G,E=!1,F=function(I){return!E&&y.reject(I)};D.on("error",F);D.submitJob(z,function(I){if(!E)if("esriJobSucceeded"===I.jobStatus){if(!B)return y.resolve({success:!0});D.getResultData(I.jobId,B).then(function(M){y.resolve({success:null!=(null===M||void 0===M?void 0:M.value),outputValue:null===M||void 0===M?void 0:M.value})},F)}else y.resolve({success:!1})},function(I){G=I.jobId;null===A||void 0===A?void 0:A(I)},F);return{canceller:function(){G&&(E=!0,D.cancelJobStatusUpdates(G),
D.cancelJob(G,null,null))},dfd:y}};q.fetchPartialUpdateScenePublishingCredits=function(u,r,v){var z=new b["default"],B=(u.adminServiceInfo||{}).layers||[],A=r.serviceInfo||{},y=A.layers||[];u=u.url+"/extractChanges";var D={returnIdsOnly:!0,returnInserts:!0,returnUpdates:!0,returnDeletes:!0,layers:[],layerServerGens:[],async:!1,dataFormat:"json"},G={},E={textured:0,untextured:0},F=(r.portal||{}).portalUrl+"portals/self/usageCost",I={name:A.name,etype:"tilegencnt",stype:"scene"},M;v.forEach(function(P){var W;
D.layers.push(P.id);(M=g["default"].find(B,function(O){return O.id===P.id}))||1!==B.length||(M=B[0]);if(M){var H=P.id;H!==M.id&&(H=M.id);M.isTextured=!(null===(W=null===M||void 0===M?void 0:M.multiPatchInfo)||void 0===W||!W.hasTexture);G[H]=M}});y.forEach(function(P){-1<D.layers.indexOf(P.id)&&P.serviceUpdateTimeStamp&&D.layerServerGens.push({id:P.id,serverGen:P.serviceUpdateTimeStamp.lastUpdate})});k["default"].request({url:u,content:x.__assign(x.__assign({},D),{layers:JSON.stringify(D.layers),layerServerGens:JSON.stringify(D.layerServerGens)})},
{usePost:!0}).then(function(P){(null===P||void 0===P?0:P.edits)?(Object.keys(P.edits).forEach(function(W){W=P.edits[W];var H=W.objectIds;E[G[W.id].isTextured?"textured":"untextured"]+=H.adds.length+H.updates.length+H.deletes.length}),f["default"]({textured:0<E.textured?k["default"].request({url:F,content:x.__assign({num:E.textured,task:"textured"},I)}):null,untextured:0<E.untextured?k["default"].request({url:F,content:x.__assign({num:E.untextured,task:"nontextured"},I)}):null}).then(function(W){var H,
O;W=((null===(H=null===W||void 0===W?void 0:W.textured)||void 0===H?void 0:H.credits)||0)+((null===(O=null===W||void 0===W?void 0:W.untextured)||void 0===O?void 0:O.credits)||0);z.resolve(W)},function(){z.resolve(0)})):z.resolve(0)},function(P){z.resolve(0)});return z};q.fetchScenePublishingCredits=function(u,r,v){var z=new b["default"],B=u.adminServiceInfo||{},A=B.layers||[],y=u.url+"/query",D={},G={},E={textured:0,untextured:0},F=(u.portal||{}).portalUrl+"portals/self/usageCost",I={name:B.name,
etype:"tilegencnt",stype:"scene"},M;r.length&&v?A.forEach(function(P){var W;P.isTextured=!(null===(W=null===P||void 0===P?void 0:P.multiPatchInfo)||void 0===W||!W.hasTexture);G[P.id]=P;D[P.id]="1\x3d1"}):r.forEach(function(P){var W;(M=g["default"].find(A,function(O){return O.id===P.id}))||1!==A.length||(M=A[0]);if(M){var H=P.id;H!==M.id&&(H=M.id);M.isTextured=!(null===(W=null===M||void 0===M?void 0:M.multiPatchInfo)||void 0===W||!W.hasTexture);G[H]=M;D[H]="1\x3d1"}});k["default"].request({url:y,content:x.__assign(x.__assign({},
{}),{layerDefs:JSON.stringify(D),returnCountOnly:!0})}).then(function(P){(null===P||void 0===P?0:P.layers)?(P.layers.forEach(function(W){E[G[W.id].isTextured?"textured":"untextured"]+=W.count}),f["default"]({textured:0<E.textured?k["default"].request({url:F,content:x.__assign({num:E.textured,task:"textured"},I)}):null,untextured:0<E.untextured?k["default"].request({url:F,content:x.__assign({num:E.untextured,task:"nontextured"},I)}):null}).then(function(W){var H,O;W=((null===(H=null===W||void 0===
W?void 0:W.textured)||void 0===H?void 0:H.credits)||0)+((null===(O=null===W||void 0===W?void 0:W.untextured)||void 0===O?void 0:O.credits)||0);z.resolve(W)},function(){z.resolve(0)})):z.resolve(0)},function(){z.resolve(0)});return z};q.getServerLicenseInfo=function(u){u+="/admin/system/licenses";return k["default"].request({url:u},{useProxy:w["default"].isDebug||k["default"].shouldUseProxy(u)})};q.findManagedDataStoreItems=function(u){u+="/admin/data/findItems";return k["default"].request({url:u,
content:{managed:!0}},{useProxy:w["default"].isDebug||k["default"].shouldUseProxy(u)})};q.findRasterStoreItems=function(u){u+="/admin/data/findItems";return k["default"].request({url:u,content:{types:"rasterStore",decrypt:!0}},{useProxy:w["default"].isDebug||k["default"].shouldUseProxy(u)})};q.isBackedBySDS=function(u){var r,v=new b["default"],z=(null===(r=null===w["default"]||void 0===w["default"]?void 0:w["default"].self)||void 0===r?void 0:r.user)||{};r=new e["default"]({portalUser:z});var B=!1,
A;z&&(r.isBasedOnAdmin()||r.isBasedOnPublisher())&&u&&!n["default"].isEmptyObject(u)?this.findManagedDataStoreItems(u.adminUrl).then(function(y){A=((null===y||void 0===y?void 0:y.items)||y||[]).filter(function(D){var G;return"arcgis data store"===(null===(G=null===D||void 0===D?void 0:D.provider)||void 0===G?void 0:G.toLowerCase())});B=!(null===A||void 0===A||!A.length);v.resolve(B)},function(){v.resolve(B)}):v.resolve(B);return v};q.isImageManagementTask=function(u){if(!u||-1===u.indexOf("RasterAnalysisTools")||
-1===u.indexOf("GPServer/"))return!1;u=u.slice(u.indexOf("GPServer/")+9);-1<u.indexOf("/")&&(u=u.slice(0,u.indexOf("/")));var r="buildfootprints buildoverview calculatestatistics definenodata computecolorcorrection computeseamlines".split(" ");return u&&-1<r.indexOf(u.toLowerCase())};q.getBackingDataStoreInfo=function(u){var r,v=new b["default"],z=(null===(r=null===w["default"]||void 0===w["default"]?void 0:w["default"].self)||void 0===r?void 0:r.user)||{};r=new e["default"]({portalUser:z});var B=
!0,A=!1,y=!1,D=!1,G,E,F;z&&(r.isBasedOnAdmin()||r.isBasedOnPublisher())&&u&&!n["default"].isEmptyObject(u)?this.findManagedDataStoreItems(u.adminUrl).then(function(I){I=(null===I||void 0===I?void 0:I.items)||I||[];G=I.filter(function(M){var P;return"arcgis data store"===(null===(P=null===M||void 0===M?void 0:M.provider)||void 0===P?void 0:P.toLowerCase())});E=I.filter(function(M){var P,W,H;return"arcgis data store"===(null===(P=null===M||void 0===M?void 0:M.provider)||void 0===P?void 0:P.toLowerCase())&&
"spatiotemporal"===(null===(H=null===(W=M.info)||void 0===W?void 0:W.dsFeature)||void 0===H?void 0:H.toLowerCase())});F=I.filter(function(M){var P,W,H,O;return"arcgis data store"===(null===(P=null===M||void 0===M?void 0:M.provider)||void 0===P?void 0:P.toLowerCase())&&"nosql"===(null===(W=M.type)||void 0===W?void 0:W.toLowerCase())&&"graphstore"===(null===(O=null===(H=M.info)||void 0===H?void 0:H.dsFeature)||void 0===O?void 0:O.toLowerCase())});B=0===I.length;A=!(null===G||void 0===G||!G.length);
y=!(null===E||void 0===E||!E.length);D=!(null===F||void 0===F||!F.length);v.resolve({isSDS:A,isSTDS:y,isGraph:D,none:B})},function(){v.resolve({isSDS:A,isSTDS:y,isGraph:D,none:B})}):v.resolve({isSDS:A,isSTDS:y,isGraph:D,none:B});return v};q.cacheMaxAgeCheck=function(u,r){var v;if(!u.ignoreCache&&u.layers&&"Feature Service"===u.type&&u.isHostedService&&0<(null===(v=null===r||void 0===r?void 0:r.adminServiceInfo)||void 0===v?void 0:v.cacheMaxAge)&&(u.ignoreCache=function(){var B=this;this.ignoreCacheFlagTimestamp=
(new Date).getTime();var A=function(y){y.content=y.content||{};y.content._ts=B.ignoreCacheFlagTimestamp;return y};this.ignoreCacheFlag||(l["default"].setRequestPreCallback(A),this.ignoreCacheFlag=!0)},u.layers)){var z=0;u.layers.forEach(function(B){var A;(null===(A=B.editingInfo)||void 0===A?0:A.lastEditDate)&&z<B.editingInfo.lastEditDate&&(z=B.editingInfo.lastEditDate)});0<z&&((new Date).getTime()-z)/1E3<r.adminServiceInfo.cacheMaxAge&&u.ignoreCache()}};q.isServiceProxy=function(u){var r=(u||"").toLowerCase();
u=-1<r.indexOf("/servers/")&&-1<r.indexOf("/rest/services/");var v=w["default"].self.isPortal&&-1<r.indexOf(w["default"].self.portalHostname);r=!w["default"].self.isPortal&&-1<r.indexOf(".arcgis.com");return u&&(v||r)};q.ASYNC_POLL_INTERVALS=[2E3,2E3,2E3,2E3,2E3,2E3,2E3,2E3,2E3,2E3,2E3,2E3,2E3,2E3,2E3,15E3,15E3,3E4,3E4,3E4,3E4,3E4,3E4,3E4,3E4,3E4,3E4,12E4];return q}()})},"arcgisonline/sharing/dijit/SaveItem":function(){define("require exports tslib ../../esriGeowConfig ../../pages/pageUtil ../../pages/dijit/CategoryPicker ../../pages/utils/arrays ../../pages/utils/dom ../../pages/utils/storage ../util ../geow/Folder ../../tsutils/declareDecorator arcgis-components/wrappers/Tags dijit/_TemplatedMixin dijit/_WidgetBase dijit/_WidgetsInTemplateMixin dojo/Deferred dojo/on dojo/topic dojo/data/ItemFileWriteStore dojo/i18n!../../nls/arcgisonline dojo/text!./templates/SaveItem.html".split(" "),
function(t,p,x,b,m,f,d,a,c,l,h,n,g,e,k,w,q,u,r,v,z,B){b=x.__importDefault(b);m=x.__importDefault(m);f=x.__importDefault(f);d=x.__importDefault(d);a=x.__importDefault(a);c=x.__importDefault(c);l=x.__importDefault(l);h=x.__importDefault(h);n=x.__importDefault(n);e=x.__importDefault(e);k=x.__importDefault(k);w=x.__importDefault(w);q=x.__importDefault(q);u=x.__importDefault(u);r=x.__importDefault(r);v=x.__importDefault(v);z=x.__importDefault(z);B=x.__importDefault(B);return function(){function A(y,D){this.declaredClass=
"arcgisonline.sharing.dijit.SaveItem";this.widgetsInTemplate=!0;this.templateString=B["default"];this.baseClass="esriAGOSaveItemForm";this.init=!1;this.folders={}}A.prototype.postMixInProperties=function(){this.i18n=x.__assign(x.__assign(x.__assign({},z["default"].common),z["default"].saveItem),{addTags:z["default"].itemCompleteness.addTags})};A.prototype.postCreate=function(){this.inherited(arguments);this.init||(this.saveItemTags=new g.TagsWrapper(this.saveItemTagsContainer,{activeTags:[],knownTags:[],
maxWidth:"100%",minWidth:"100%"}),this.getFolders(),this.init=!0)};A.prototype.startup=function(){this.inherited(arguments);this.initHandlers()};A.prototype.hideRow=function(y){a["default"].hideNodes(this.domNode.querySelectorAll(".save-item-"+y+"-row"))};A.prototype.loadTags=function(y){var D=l["default"].getUser();y&&(D=y);return l["default"].loadUserTags(D.username)};A.prototype.loadCategories=function(y){var D=this,G=new q["default"],E=this.domNode.querySelectorAll(".categories-container");b["default"].self.hasCategorySchema?
l["default"].request({url:b["default"].restBaseUrl+"portals/self/categorySchema"}).then(function(F){D.categories=new f["default"]({categories:y||[],schema:F.categorySchema},D.saveItemCategories);D.categories.startup();a["default"].showNodes(E);G.resolve()},function(){a["default"].hideNodes(E);G.resolve()}):(a["default"].hideNodes(E),G.resolve());return G};A.prototype.initHandlers=function(){var y=this.validate.bind(this);this.own(u["default"](this.saveItemFolder,"change",this.onFolderChange.bind(this)),
u["default"](this.saveItemTitle,"change",y),u["default"](this.saveItemSummary,"change",y),m["default"].registerKeystrokeHandler(this.saveItemTitle,y),m["default"].registerKeystrokeHandler(this.saveItemSummary,y))};A.prototype.validate=function(){var y,D;if(!this.beingDestroyed){var G=!0,E=this.saveItemTitle.get("value"),F=(null===(D=null===(y=this.saveItemTags)||void 0===y?void 0:y.getTags())||void 0===D?void 0:D.join(","))||"";y=this.saveItemSummary.get("value");null===this.requires?G=!!(E&&F&&y):
(d["default"].includes(this.requires,"title")&&(G=G&&!!E),d["default"].includes(this.requires,"tags")&&(G=G&&0!==F.length),d["default"].includes(this.requires,"summary")&&(G=G&&!!y));r["default"].publish("onSaveItemValidate",[G])}};A.prototype.getFolders=function(){var y=this,D=l["default"].getUser();if(null!==D){var G=new v["default"]({url:null,data:{identifier:"name",items:[]}});G.newItem({name:D.username,id:""});this.saveItemFolder.set("store",G);this.saveItemFolder.set("value",D.username);h["default"].getFolders(function(E){var F=
null,I=c["default"].getCookie("ESRI_Content");I&&I.folderId&&(F=I.folderId);y.foldersJson=E.folders;E.folders.forEach(function(M,P){G.newItem({name:M.title,id:M.id});y.folders["id"+M.id]=M.title.replace(/"/g,'\\"');F===M.id&&(y.saveItemFolder.set("value",M.title),y.folderId=F,y.folderName=M.title)});G.save({})},function(E){})}};A.prototype.onFolderChange=function(y){var D=this;this.saveItemFolder.get("store").fetch({onComplete:function(G){G.forEach(function(E){E.name[0]===y&&(D.folderId=E.id[0],D.folderName=
E.name[0])})}})};A.prototype._setTitleAttr=function(y){this.saveItemTitle.set("value",y)};A.prototype._getTitleAttr=function(){return this.saveItemTitle.get("value")};A.prototype._setTagsAttr=function(y){this.saveItemTags.setTags(y)};A.prototype._getTagsAttr=function(){return this.saveItemTags.getTags()};A.prototype._setCategoriesAttr=function(y){var D=this;y&&y.forEach(function(G){D.categories.addCategory(G)})};A.prototype._getCategoriesAttr=function(){return this.categories.getCategories(!0)};A.prototype._setSummaryAttr=
function(y){this.saveItemSummary.set("value",y)};A.prototype._getSummaryAttr=function(){return this.saveItemSummary.get("value")};A.prototype._setFolderAttr=function(y){var D=this;this.saveItemFolder.get("store").fetch({onComplete:function(G){G.forEach(function(E){E.name[0]===y&&(D.folderId=E.id[0],D.folderName=E.name[0],D.saveItemFolder.set("value",D.folderName))})}})};A.prototype._getFolderAttr=function(){return this.folderName};A.prototype._setFolderIdAttr=function(y){var D=this;this.saveItemFolder.get("store").fetch({onComplete:function(G){G.forEach(function(E){E.id[0]===
y&&(D.folderId=E.id[0],D.folderName=E.name[0],D.saveItemFolder.set("value",E.name[0]))})}})};A.prototype._getFolderIdAttr=function(){return this.folderId};A.prototype._setRequiresAttr=function(y){this.requires=y?y:null};A.prototype._setTitlePlaceHolderAttr=function(y){this.saveItemTitle.set("placeHolder",y)};A.prototype._setTagsPlaceHolderAttr=function(y){this.saveItemTitle.set("placeHolder",y)};A.prototype._setSummaryPlaceHolderAttr=function(y){this.saveItemSummary.set("placeHolder",y)};return A=
x.__decorate([n["default"](k["default"],e["default"],w["default"])],A)}()})},"arcgis-components/wrappers/Tags":function(){define(["../Component","../Inputs/Tags/index"],function(t,p){return function(x){function b(f){if(m[f])return m[f].exports;var d=m[f]={i:f,l:!1,exports:{}};return x[f].call(d.exports,d,d.exports,b),d.l=!0,d.exports}var m={};return b.m=x,b.c=m,b.d=function(f,d,a){b.o(f,d)||Object.defineProperty(f,d,{enumerable:!0,get:a})},b.r=function(f){"undefined"!=typeof Symbol&&Symbol.toStringTag&&
Object.defineProperty(f,Symbol.toStringTag,{value:"Module"});Object.defineProperty(f,"__esModule",{value:!0})},b.t=function(f,d){if((1&d&&(f=b(f)),8&d)||4&d&&"object"==typeof f&&f&&f.__esModule)return f;var a=Object.create(null);if(b.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:f}),2&d&&"string"!=typeof f)for(var c in f)b.d(a,c,function(l){return f[l]}.bind(null,c));return a},b.n=function(f){var d=f&&f.__esModule?function(){return f["default"]}:function(){return f};return b.d(d,"a",
d),d},b.o=function(f,d){return Object.prototype.hasOwnProperty.call(f,d)},b.p="",b(b.s=965)}({0:function(x,b,m){function f(e,k){function w(){this.constructor=e}if("function"!=typeof k&&null!==k)throw new TypeError("Class extends value "+String(k)+" is not a constructor or null");n(e,k);e.prototype=null===k?Object.create(k):(w.prototype=k.prototype,new w)}function d(e,k){var w={},q;for(q in e)Object.prototype.hasOwnProperty.call(e,q)&&0>k.indexOf(q)&&(w[q]=e[q]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var u=
0;for(q=Object.getOwnPropertySymbols(e);u<q.length;u++)0>k.indexOf(q[u])&&Object.prototype.propertyIsEnumerable.call(e,q[u])&&(w[q[u]]=e[q[u]])}return w}function a(e,k,w,q){var u,r=arguments.length,v=3>r?k:null===q?q=Object.getOwnPropertyDescriptor(k,w):q;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)v=Reflect.decorate(e,k,w,q);else for(var z=e.length-1;0<=z;z--)(u=e[z])&&(v=(3>r?u(v):3<r?u(k,w,v):u(k,w))||v);return 3<r&&v&&Object.defineProperty(k,w,v),v}function c(e,k,w,q){return new (w||
(w=Promise))(function(u,r){function v(A){try{B(q.next(A))}catch(y){r(y)}}function z(A){try{B(q["throw"](A))}catch(y){r(y)}}function B(A){var y;A.done?u(A.value):(y=A.value,y instanceof w?y:new w(function(D){D(y)})).then(v,z)}B((q=q.apply(e,k||[])).next())})}function l(e,k){function w(B){return function(A){return function(y){if(q)throw new TypeError("Generator is already executing.");for(;z;)try{if(q=1,u&&(r=2&y[0]?u["return"]:y[0]?u["throw"]||((r=u["return"])&&r.call(u),0):u.next)&&!(r=r.call(u,y[1])).done)return r;
switch(u=0,r&&(y=[2&y[0],r.value]),y[0]){case 0:case 1:r=y;break;case 4:return z.label++,{value:y[1],done:!1};case 5:z.label++;u=y[1];y=[0];continue;case 7:y=z.ops.pop();z.trys.pop();continue;default:if(!(r=z.trys,(r=0<r.length&&r[r.length-1])||6!==y[0]&&2!==y[0])){z=0;continue}if(3===y[0]&&(!r||y[1]>r[0]&&y[1]<r[3]))z.label=y[1];else if(6===y[0]&&z.label<r[1])z.label=r[1],r=y;else if(r&&z.label<r[2])z.label=r[2],z.ops.push(y);else{r[2]&&z.ops.pop();z.trys.pop();continue}}y=k.call(e,z)}catch(D){y=
[6,D],u=0}finally{q=r=0}if(5&y[0])throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}([B,A])}}var q,u,r,v,z={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return v={next:w(0),"throw":w(1),"return":w(2)},"function"==typeof Symbol&&(v[Symbol.iterator]=function(){return this}),v}function h(e,k){for(var w=0,q=k.length,u=e.length;w<q;w++,u++)e[u]=k[w];return e}m.d(b,"d",function(){return f});m.d(b,"a",function(){return g});m.d(b,"f",function(){return d});m.d(b,"c",function(){return a});
m.d(b,"b",function(){return c});m.d(b,"e",function(){return l});m.d(b,"g",function(){return h});var n=function(e,k){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(w,q){w.__proto__=q}||function(w,q){for(var u in q)Object.prototype.hasOwnProperty.call(q,u)&&(w[u]=q[u])})(e,k)},g=function(){return(g=Object.assign||function(e){for(var k,w=1,q=arguments.length;w<q;w++)for(var u in k=arguments[w])Object.prototype.hasOwnProperty.call(k,u)&&(e[u]=k[u]);return e}).apply(this,arguments)};
Object.create;Object.create},17:function(x,b){x.exports=t},699:function(x,b){x.exports=p},965:function(x,b,m){m.r(b);m.d(b,"TagsWrapper",function(){return l});var f=m(0),d=m(17);x=m(699);m=m.n(x);var a=function(h,n){switch(n.type){case "UPDATE_ACTIVE_TAGS":return Object(f.a)(Object(f.a)({},h),{activeTags:n.payload});case "UPDATE_KNOWN_TAGS":return Object(f.a)(Object(f.a)({},h),{knownTags:n.payload});default:return h}},c=Object(d.connect)(function(h){return{activeTags:h.activeTags,knownTags:h.knownTags}},
function(h){return{onChange:function(n){h({type:"UPDATE_ACTIVE_TAGS",payload:n})}}})(m.a),l=function(){function h(n,g){this.renderContainer=n;this.store=Object(d.createStore)(a,{activeTags:g.activeTags,knownTags:g.knownTags});this.projector=Object(d.createProjector)(this.store,function(e){return e(c,Object(f.a)({key:"wrapped-tags"},g))},this.renderContainer)}return h.prototype.destroy=function(){this.projector.stop();this.renderContainer.remove?this.renderContainer.remove():this.renderContainer.parentNode&&
this.renderContainer.parentNode.removeChild(this.renderContainer)},h.prototype.focus=function(){var n=this.renderContainer.querySelector("input");n&&n.focus()},h.prototype.getTags=function(){return this.store.getState().activeTags},h.prototype.setTags=function(n){this.store.dispatch({type:"UPDATE_ACTIVE_TAGS",payload:n})},h.prototype.getKnownTags=function(){return this.store.getState().knownTags},h.prototype.setKnownTags=function(n){this.store.dispatch({type:"UPDATE_KNOWN_TAGS",payload:n})},h.prototype.watchTags=
function(n){var g=this,e=this.store.getState().activeTags;return this.store.subscribe(function(){var k=g.store.getState().activeTags;k!==e&&n(e=k)})},h}()}})})},"arcgis-components/Inputs/Tags/index":function(){define(["../../Component","dojo/i18n!../../Inputs/Tags/nls/resources"],function(t,p){return function(x){function b(f){if(m[f])return m[f].exports;var d=m[f]={i:f,l:!1,exports:{}};return x[f].call(d.exports,d,d.exports,b),d.l=!0,d.exports}var m={};return b.m=x,b.c=m,b.d=function(f,d,a){b.o(f,
d)||Object.defineProperty(f,d,{enumerable:!0,get:a})},b.r=function(f){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(f,Symbol.toStringTag,{value:"Module"});Object.defineProperty(f,"__esModule",{value:!0})},b.t=function(f,d){if((1&d&&(f=b(f)),8&d)||4&d&&"object"==typeof f&&f&&f.__esModule)return f;var a=Object.create(null);if(b.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:f}),2&d&&"string"!=typeof f)for(var c in f)b.d(a,c,function(l){return f[l]}.bind(null,c));
return a},b.n=function(f){var d=f&&f.__esModule?function(){return f["default"]}:function(){return f};return b.d(d,"a",d),d},b.o=function(f,d){return Object.prototype.hasOwnProperty.call(f,d)},b.p="",b(b.s=839)}({0:function(x,b,m){function f(e,k){function w(){this.constructor=e}if("function"!=typeof k&&null!==k)throw new TypeError("Class extends value "+String(k)+" is not a constructor or null");n(e,k);e.prototype=null===k?Object.create(k):(w.prototype=k.prototype,new w)}function d(e,k){var w={},q;
for(q in e)Object.prototype.hasOwnProperty.call(e,q)&&0>k.indexOf(q)&&(w[q]=e[q]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var u=0;for(q=Object.getOwnPropertySymbols(e);u<q.length;u++)0>k.indexOf(q[u])&&Object.prototype.propertyIsEnumerable.call(e,q[u])&&(w[q[u]]=e[q[u]])}return w}function a(e,k,w,q){var u,r=arguments.length,v=3>r?k:null===q?q=Object.getOwnPropertyDescriptor(k,w):q;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)v=Reflect.decorate(e,k,w,q);else for(var z=
e.length-1;0<=z;z--)(u=e[z])&&(v=(3>r?u(v):3<r?u(k,w,v):u(k,w))||v);return 3<r&&v&&Object.defineProperty(k,w,v),v}function c(e,k,w,q){return new (w||(w=Promise))(function(u,r){function v(A){try{B(q.next(A))}catch(y){r(y)}}function z(A){try{B(q["throw"](A))}catch(y){r(y)}}function B(A){var y;A.done?u(A.value):(y=A.value,y instanceof w?y:new w(function(D){D(y)})).then(v,z)}B((q=q.apply(e,k||[])).next())})}function l(e,k){function w(B){return function(A){return function(y){if(q)throw new TypeError("Generator is already executing.");
for(;z;)try{if(q=1,u&&(r=2&y[0]?u["return"]:y[0]?u["throw"]||((r=u["return"])&&r.call(u),0):u.next)&&!(r=r.call(u,y[1])).done)return r;switch(u=0,r&&(y=[2&y[0],r.value]),y[0]){case 0:case 1:r=y;break;case 4:return z.label++,{value:y[1],done:!1};case 5:z.label++;u=y[1];y=[0];continue;case 7:y=z.ops.pop();z.trys.pop();continue;default:if(!(r=z.trys,(r=0<r.length&&r[r.length-1])||6!==y[0]&&2!==y[0])){z=0;continue}if(3===y[0]&&(!r||y[1]>r[0]&&y[1]<r[3]))z.label=y[1];else if(6===y[0]&&z.label<r[1])z.label=
r[1],r=y;else if(r&&z.label<r[2])z.label=r[2],z.ops.push(y);else{r[2]&&z.ops.pop();z.trys.pop();continue}}y=k.call(e,z)}catch(D){y=[6,D],u=0}finally{q=r=0}if(5&y[0])throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}([B,A])}}var q,u,r,v,z={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return v={next:w(0),"throw":w(1),"return":w(2)},"function"==typeof Symbol&&(v[Symbol.iterator]=function(){return this}),v}function h(e,k){for(var w=0,q=k.length,u=e.length;w<q;w++,u++)e[u]=
k[w];return e}m.d(b,"d",function(){return f});m.d(b,"a",function(){return g});m.d(b,"f",function(){return d});m.d(b,"c",function(){return a});m.d(b,"b",function(){return c});m.d(b,"e",function(){return l});m.d(b,"g",function(){return h});var n=function(e,k){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(w,q){w.__proto__=q}||function(w,q){for(var u in q)Object.prototype.hasOwnProperty.call(q,u)&&(w[u]=q[u])})(e,k)},g=function(){return(g=Object.assign||function(e){for(var k,
w=1,q=arguments.length;w<q;w++)for(var u in k=arguments[w])Object.prototype.hasOwnProperty.call(k,u)&&(e[u]=k[u]);return e}).apply(this,arguments)};Object.create;Object.create},20:function(x,b){x.exports=t},405:function(x,b){x.exports=p},531:function(x,b,m){b.a=function(f,d){var a=f.name;return d("li",{"class":"inp-tags__tag",key:a},d("span",{title:a,"class":"inp-tags__tag-innards",onkeydown:f.onKeyDown,id:"tag-"+a,tabindex:"-1"},a,d("button",{"class":"inp-tags__tag-remove-btn","data-value":a,onclick:f.onRemove,
tabindex:"-1",type:"button"},d("svg",{role:"img",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 32 32"},d("path",{d:"M18.404 16l9.9 9.9-2.404 2.404-9.9-9.9-9.9 9.9L3.696 25.9l9.9-9.9-9.9-9.898L6.1 3.698l9.9 9.899 9.9-9.9 2.404 2.406-9.9 9.898z"})))))}},532:function(x,b,m){var f=m(405);b.a=function(d,a){var c=d.onSuggestionFocus,l=d.onSuggestionBlur,h=d.onSuggestionClick,n=d.onSuggestionKeyDown;if(!d.visible)return null;var g=d.matchingTags.map(function(k,w){return a("li",{id:"suggestion-"+
w,classes:{"inp-tags__suggestion":!0,"inp-tags__suggestion--grey":0==w%2,"inp-tags__suggestion--white":0!=w%2},"data-value":k,"data-index":w,key:k,title:k,onfocus:c,onblur:l,onmousedown:h,onkeydown:n,tabindex:"0"},k)}),e=a("div",{"class":"inp-tags__no-suggestions",id:"no-matching-div"},a("div",{"class":"inp-tags__no-suggestions-text",id:"no-matching-text"},f.noTagsFound));return a("ul",{id:"tag-suggestions","class":"inp-tags__suggestions",key:"tag-suggestions"},g[0]?g:e)}},839:function(x,b,m){m.r(b);
var f=m(0);x=m(20);var d=m(405),a=m(531),c=m(532);m=function(l){function h(n){n=l.call(this,n)||this;return n.state={value:"",isFocused:!1,isTyping:!1,hasBeenFocused:!1},n.handleInputBlur=n.handleInputBlur.bind(n),n.handleInputChange=n.handleInputChange.bind(n),n.handleInputFocus=n.handleInputFocus.bind(n),n.handleInputKeyDown=n.handleInputKeyDown.bind(n),n.handleSuggestionBlur=n.handleSuggestionBlur.bind(n),n.handleSuggestionClick=n.handleSuggestionClick.bind(n),n.handleSuggestionFocus=n.handleSuggestionFocus.bind(n),
n.handleSuggestionKeyDown=n.handleSuggestionKeyDown.bind(n),n.handleWidgetClick=n.handleWidgetClick.bind(n),n.spliceTag=n.spliceTag.bind(n),n.handleTagInputKeyDown=n.handleTagInputKeyDown.bind(n),n}return Object(f.d)(h,l),h.prototype.render=function(n){var g=this,e={"inp-tags__active-tags":!0,"inp-tags__active-tags--focused":this.state.isFocused},k=this.props.knownTags.filter(function(w){return-1!==w.toLowerCase().indexOf(g.state.value.toLowerCase())&&-1===g.props.activeTags.indexOf(w)});return n("div",
{id:"tags-container",classes:{"inp-tags__container":!0},style:"\n                        min-width: "+(this.props.minWidth?this.props.minWidth:"auto")+";\n                        max-width: "+(this.props.maxWidth?this.props.maxWidth:"auto")+";\n                    "},n("ul",{classes:e,key:"active-tags",id:"active-tags"},this.props.activeTags.filter(function(w){return w}).map(function(w){return n(a.a,{name:w,onRemove:g.spliceTag,onKeyDown:g.handleTagInputKeyDown})}),n("input",{id:"tags-input","class":"inp-tags__input",
placeholder:d.addTags,value:this.state.value,onkeydown:this.handleInputKeyDown,onfocus:this.handleInputFocus,onblur:this.handleInputBlur,oninput:this.handleInputChange,afterCreate:this.handler})),n(c.a,{matchingTags:k,onSuggestionBlur:this.handleSuggestionBlur,onSuggestionClick:this.handleSuggestionClick,onSuggestionFocus:this.handleSuggestionFocus,onSuggestionKeyDown:this.handleSuggestionKeyDown,visible:this.state.isTyping}))},h.prototype.handler=function(n){},h.prototype.addTag=function(n,g){var e=
this;void 0===g&&(g=!0);var k=[];n.split(",").forEach(function(q){(q=e.stripHTML(q.trim()))&&-1===e.props.activeTags.indexOf(q)&&-1===k.indexOf(q)&&k.push(q)});this.props.onChange(this.props.activeTags.concat(k));var w=document.getElementById("tags-input");w&&g&&w.focus()},h.prototype.spliceTag=function(n){n=n.currentTarget||n.target;var g=Object(f.g)([],this.props.activeTags);g.splice(this.props.activeTags.indexOf(n.dataset.value),1);this.props.onChange(g)},h.prototype.handleInputBlur=function(n){var g=
this;setTimeout(function(){var e=document.getElementById("tags-container");(null==e?0:e.contains(document.activeElement))||(g.addTag(n.target.value,!1),g.setState({value:"",hasBeenFocused:!0,isFocused:!1,isTyping:!1}))})},h.prototype.handleInputChange=function(n){this.setState({value:n.target.value})},h.prototype.handleInputFocus=function(){this.setState({isFocused:!0})},h.prototype.handleInputKeyDown=function(n){switch(n.key){case "Enter":n.target.value&&(this.addTag(n.target.value),this.setState({value:"",
isTyping:!1}),(g=document.getElementById("tags-input"))&&(g.focus(),g.value=""));break;case "Tab":var g;n.target.value&&(n.preventDefault(),this.addTag(n.target.value),this.setState({value:"",isTyping:!1}),(g=document.getElementById("tags-input"))&&(g.focus(),g.value=""));break;case "Backspace":n.target.value||(n=Object(f.g)([],this.props.activeTags),n.pop(),this.props.onChange(n),this.setState({value:"",isTyping:!1}));break;case "Down":case "ArrowDown":g=document.getElementById("suggestion-0");this.state.isTyping&&
g?(n.preventDefault(),g.focus()):this.setState({isTyping:!0});break;case "Up":case "ArrowUp":case "Left":case "ArrowLeft":this.focusElement(document.getElementById("tag-"+this.props.activeTags[this.props.activeTags.length-1]));break;default:this.setState({isTyping:!0})}},h.prototype.handleSuggestionBlur=function(n){n.preventDefault();this.setState({isFocused:!1,isTyping:!1})},h.prototype.handleSuggestionClick=function(n){n.preventDefault();this.addTag(n.target.dataset.value);this.setState({value:"",
isFocused:!0,isTyping:!1});(n=document.getElementById("tags-input"))&&(n.focus(),n.value="")},h.prototype.handleSuggestionFocus=function(n){n.preventDefault();this.setState({isFocused:!0,isTyping:!0})},h.prototype.handleSuggestionKeyDown=function(n){switch(n.preventDefault(),n.key){case "Up":case "ArrowUp":0===n.target["data-index"]?this.focusElement(document.getElementById("tags-input")):this.focusElement(document.getElementById("suggestion-"+(n.target["data-index"]-1)));break;case "Down":case "ArrowDown":(n=
document.getElementById("suggestion-"+(n.target["data-index"]+1)))?n.focus():this.focusElement(document.getElementById("suggestion-0"));break;case "Tab":case "Enter":this.handleSuggestionClick(n);break;case "Escape":n.preventDefault(),this.focusElement(document.getElementById("tags-input"))}},h.prototype.handleWidgetClick=function(n){(n=document.getElementById("tags-input"))&&n.focus()},h.prototype.handleTagInputKeyDown=function(n){var g=document.activeElement.getAttribute("title");if(g){var e=this.props.activeTags.indexOf(g);
switch(n.key){case "Left":case "ArrowLeft":this.focusElement(document.getElementById(0<e?"tag-"+this.props.activeTags[e-1]:"tag-"+this.props.activeTags[this.props.activeTags.length-1]));break;case "Right":case "ArrowRight":this.focusElement(document.getElementById(e<this.props.activeTags.length-1?"tag-"+this.props.activeTags[e+1]:"tag-"+this.props.activeTags[0]));break;case "Down":case "ArrowDown":this.focusElement(document.getElementById("tags-input"));break;case "Backspace":case "Delete":n=Object(f.g)([],
this.props.activeTags),n.splice(this.props.activeTags.indexOf(g),1),this.props.onChange(n),this.focusElement(document.getElementById("tag-"+this.props.activeTags[e<this.props.activeTags.length-1?e+1:e-1]))}}},h.prototype.focusElement=function(n){n&&n.focus()},h.prototype.stripHTML=function(n){return n&&n.replace(/<(?:.|\s)*?>/g,"")},h}(x.Component);b["default"]=m}})})},"arcgisonline/sharing/dijit/dialog/InvitationsDlg":function(){define("require esri/declare esri/Evented esri/lang dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/on dojo/query dojo/string dojo/topic dojo/mouse dijit/a11yclick dojo/promise/all dojo/date/locale dojo/store/Memory dijit/Tooltip dijit/Dialog dijit/form/Button dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin ../../util ../../../pages/pageUtil ../../../pages/utils/formatters ../../../pages/utils/icons ../Grid ./ConfirmDialog ./GeneralDlg dojo/i18n!../../../nls/arcgisonline dojo/text!./templates/InvitationsDlg.html dojo/text!./templates/InvitationsDlgGroup.html".split(" "),
function(t,p,x,b,m,f,d,a,c,l,h,n,g,e,k,w,q,u,r,v,z,B,A,y,D,G,E,F,I,M,P,W){var H=p("arcgisonline.sharing.dijit.dialog.InvitationsDlg",[v,z,B,x],{basePath:t.toUrl("arcgisonline/sharing/dijit/dialog"),baseClass:"esriInvitationsDlg",widgetsInTemplate:!0,templateString:P,invitations:null,groupsUser:null,postMixInProperties:function(){this.inherited(arguments);this.i18n=m.mixin({},M.common);m.mixin(this.i18n,M.invitationsDlg);m.mixin(this.i18n,M.invitationsGrid)},postCreate:function(){this.loadConnections()},
show:function(O,K){this.clearStore();K&&(K.username||K.email)&&(this.groupsUser=K);this.invitations=O;this.getGroupInfos();this._dialog.show()},update:function(O){this.clearStore();this.invitations=O;this.getGroupInfos();this._dialog.show()},getGroupInfos:function(){var O=A.getUser(),K=[];if(null!==O){var R=this.groupsUser&&this.groupsUser.username?this.groupsUser.username:this.groupsUser&&this.groupsUser.email?this.groupsUser.email:O.username;for(O=0;O<this.invitations.length;O++)K.push(A.request({url:esriGeowConfig.restBaseUrl+
"community/users/"+R+"/invitations/"+this.invitations[O].groupId}));e(K).then(function(da){f.forEach(da,function(Z,L){this.invitations[L].fromUsername=Z.fromUsername.username;this.invitations[L].fromUserFullname=Z.fromUsername.fullname;this.invitations[L].groupTitle=Z.group.title;this.invitations[L].groupOwner=Z.group.owner;this.invitations[L].groupIsPrivate="private"===Z.group.access;this.invitations[L].groupAccess=Z.group.access;this.invitations[L].groupDescription=Z.group.description;this.invitations[L].groupThumbnail=
Z.group.thumbnail;this.invitations[L].leavingDisallowed=Z.group.leavingDisallowed;this.groupsUser&&(this.invitations[L].asUser=R)}.bind(this));var U=this._invitationsGrid._grid.store;f.forEach(this.invitations,function(Z){U.put(Z)}.bind(this));this.refresh()}.bind(this))}},loadConnections:function(){this.own(c(".jevent").on("click",function(O){O&&O instanceof Event&&O.preventDefault()}),a(this._closeBtn,"click",function(){this._dialog.hide()}.bind(this)),h.subscribe("onInvitationAccept",this.onInvitationAccept.bind(this)),
h.subscribe("onInvitationDecline",this.onInvitationDecline.bind(this)))},createGrid:function(){this._invitationsGrid=new E({id:"invitationsGrid",columns:this.getInvitationGridColumns(),noDataMessage:this.i18n.noGroupInvites,showLoadingMessage:!1,showHeader:!1,showFooter:!1,selectionMode:"none",rowsPerPage:5,className:"invitations-grid",store:new w({idProperty:"id",label:"groupTitle",data:[]}),sort:[{attribute:"received",descending:!1}]},this._invitationsGridContainer);this._invitationsGrid.startup()},
clearStore:function(){this._invitationsGrid||this.createGrid();var O=this._invitationsGrid&&this._invitationsGrid._grid&&this._invitationsGrid._grid.store||void 0;O&&f.forEach(m.clone(O.query()),function(K){O.remove(K.id)})},getInvitationGridColumns:function(){return{groupTitle:{label:this.i18n.groupName,sortable:!1,renderCell:function(O){var K=!1;this.groupsUser&&(this.groupsUser.privileges&&-1<this.groupsUser.privileges.indexOf("portal:admin:viewGroups")?K=!0:this.groupsUser.privileges&&-1<this.groupsUser.privileges.indexOf("portal:user:viewOrgGroups")&&
"private"!==O.groupAccess?K=!0:"public"===O.groupAccess&&(K=!0));var R=O.groupThumbnail?esriGeowConfig.restBaseUrl+"community/groups/"+O.groupId+"/info/"+O.groupThumbnail+"?token\x3d"+A.getToken():"",da=k.format(new Date(O.received),{selector:"date",formatLength:"long"});da=l.substitute(M.GroupWidget.invitedEventDescription,{fullName:O.fromUserFullname,fullDate:da});K={i18n:M,icons:G,id:O.groupId,title:O.groupTitle,thumbnail:O.groupThumbnail,thumbnailUrl:R,notificationSummary:da,fillColor:"#"+O.groupId.substr(O.groupId.length-
6),useLetter:O.groupTitle.charAt(0)&&O.groupTitle.charAt(0).match(/^\w+$/),isPrivate:!K};K=d.toDom(l.substitute(W,K,null,{hide:D.hide,show:D.show,firstChar:D.firstChar,stripHTML:D.stripHTML}));R=c(".js-accept-invitation",K).shift();da=c(".js-decline-invitation",K).shift();var U=O.asUser?O.asUser:null,Z=O.leavingDisallowed?this.confirmLeavingDisallowed.bind(this,O,U):this.acceptInvitation.bind(this,O,U);O=this.declineInvitation.bind(this,O,U);this.own(g(R,Z),g(da,O));return K}.bind(this)}}},confirmLeavingDisallowed:function(O,
K){var R=M.invitationsDlg.leavingDisabled,da=y.createSpecifiedDialog(F,{"class":"general-dialog",title:M.invitationsDlg.joinGroup,buttonOkLabel:M.invitationsDlg.joinGroup,style:{height:"auto"}});da.setContent(R);da.show().then(function(U){"onOk"===U&&(this.acceptInvitation(O,K),da.hide())}.bind(this))},acceptInvitation:function(O,K){var R=A.getUser(),da=this._invitationsGrid._grid.store,U=O.groupId;R&&A.request({url:esriGeowConfig.restBaseUrl+"community/users/"+(K?K:R.username)+"/invitations/"+U+
"/accept",content:{}},{usePost:!0}).then(function(Z){da.remove(O.id);h.publish("onInvitationAccept",{})}.bind(this),function(Z){var L=A.getUser();L=L&&L.orgId?this.i18n.acceptFailure:this.i18n.acceptFailurePublic;"COM_1050"===Z.messageCode?L=this.i18n.privilegeError:"ORG_3103"===Z.messageCode&&(L=this.i18n.maxExternalOrgs);y.createSpecifiedDialog(I).show({title:this.i18n.errorTitle,message:L})}.bind(this))},declineInvitation:function(O,K){var R=A.getUser(),da=O.groupId,U=this._invitationsGrid._grid.store;
R&&A.request({url:esriGeowConfig.restBaseUrl+"community/users/"+(K?K:R.username)+"/invitations/"+da+"/decline"},{usePost:!0}).then(function(){U.remove(O.id);h.publish("onInvitationDecline",{})}.bind(this))},onInvitationAccept:function(){0===this._invitationsGrid._grid.store.query().length?this.hide():this.refresh()},onInvitationDecline:function(){0===this._invitationsGrid._grid.store.query().length?this.hide():this.refresh()},hide:function(){this._dialog.hide()},refresh:function(){if(this._invitationsGrid._grid&&
this._invitationsGrid._grid._started){var O=this._invitationsGrid._grid._currentPage||1,K=this._invitationsGrid._grid.store?this._invitationsGrid._grid.store.query().length:0;a.once(this._invitationsGrid._grid,"dgrid-refresh-complete",function(R){R.grid._currentPage!==O&&0<K&&R.grid.gotoPage(O)});this._invitationsGrid._grid.resize();this._invitationsGrid._grid.refresh()}}});H.prototype.statics={getInstance:function(){this._instance||(this._instance=new H);return this._instance}};return H})},"arcgisonline/sharing/dijit/Grid":function(){define("dojo/_base/declare dojo/_base/lang dojo/string dojo/_base/array dojo/date/locale dojo/on dojo/dom esri/lang dojo/aspect dijit/_WidgetBase dojo/_base/window dijit/TooltipDialog dijit/popup dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/form/DropDownButton dijit/DropDownMenu dijit/MenuItem dgrid/Grid dgrid/extensions/Pagination dgrid/extensions/DijitRegistry dgrid/OnDemandGrid dgrid/extensions/ColumnResizer dgrid/Keyboard ./_RefreshMixin ./Rating dojo/query dojo/dom-class dojo/dom-style dojo/dom-geometry dojo/dom-construct dojo/when dojo/store/Memory dgrid/Selection dgrid/selector dojo/store/Observable put-selector/put dgrid/util/mouse dgrid/util/touch arcgisonline/sharing/util ../../pages/utils/keys arcgisonline/sharing/geow/Content dojo/i18n!arcgisonline/nls/arcgisonline".split(" "),
function(t,p,x,b,m,f,d,a,c,l,h,n,g,e,k,w,q,u,r,v,z,B,A,y,D,G,E,F,I,M,P,W,H,O,K,R,da,U,Z,L,T,Y,ca){esri.i18nBundle=ca;return t("arcgisonline.sharing.dijit.Grid",[l],{postMixInProperties:function(){this.inherited(arguments);this._util=L;this._content=Y;this._supportedViews=["gallery","details","table"];this._favorites={};this._portalUser=this._util.getUser();this._galleryTemplate=this._galleryTemplate||"\x3cdiv style\x3d'opacity:0;' class\x3d'grid-item gallery-view'\x3e${item:_formatThumbnail}\x3ch5\x3e${item:_formatItemTitle}\x3c/h5\x3e${item:_formatItemTypeIcon}\x3c/div\x3e";
this._detailsTemplate=this._detailsTemplate||'\x3cdiv style\x3d\'opacity:0;\' class\x3d\'grid-item detail-view\'\x3e${item:_formatThumbnail}\x3ch5\x3e${item:_formatItemTitle}\x3c/h5\x3e\x3cdiv class\x3d"rating-system"\x3e\x3cdiv data-dojo-type\x3d\'arcgisonline/sharing/dijit/Rating\' data-dojo-props\x3d\'numStars:5,value:${item.avgRating},disabled:true\'\x3e\x3c/div\x3e\x26nbsp;\x3cspan\x3e(${item.numRatings})\x3c/span\x3e\x3c/div\x3e${item:_formatItemTypeIcon}\x3cp class\x3d"grid-item-type"\x3e${item:_formatType}\x3c/p\x3e\x3cp class\x3d"grid-item-desc"\x3e${item.snippet}\x3c/p\x3e${item:_formatPremiumContentIcon}\x3cspan class\x3d"openItem" id\x3d"openItem"\x3e\x3c/span\x3e\x3ca href\x3d"item.html?id\x3d${item.id}" class\x3d"calcite btn small primary details-button"\x3e${i18n.gallery.details}\x3c/a\x3e\x3c/div\x3e';
this._itemPopupTemplate=this._itemPopupTemplate||'\x3cdiv class\x3d"grid-item-hover"\x3e\x3ch5\x3e${item:_formatItemTitle}\x3c/h5\x3e\x3cspan id\x3d\'openItem\'\x3e\x3c/span\x3e\x3ca href\x3d"item.html?id\x3d${item.id}" class\x3d"calcite btn small primary details-button"\x3e${i18n.details}\x3c/a\x3e\x3cp class\x3d"item-hover-type"\x3e${item:_formatItemTypeIcon}${item:_formatType} by\x26nbsp;${item.owner:_formatOwnerLink}\x3c/p\x3e\x3cp class\x3d"item-hover-desc"\x3e${item.snippet}\x3c/p\x3e${item:_formatPremiumContentIcon}\x3cdiv class\x3d"rating-system"\x3e\x3cdiv data-dojo-type\x3d\'arcgisonline/sharing/dijit/Rating\' data-dojo-props\x3d\'numStars:5,value:${item.avgRating},disabled:true\'\x3e\x3c/div\x3e\x26nbsp;\x3cspan\x3e(${item.numRatings})\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e';
this._renderers=p.mixin(this._renderers||{},{gallery:p.hitch(this,function(Q){Q.snippet=Q.snippet||"";var X=da("div"),ha=new (t([l,e,k],{templateString:x.substitute(this._galleryTemplate,{item:Q,i18n:ca.gallery},null,this)}));Q.widget=ha;X.appendChild(ha.domNode);return X}),details:p.hitch(this,function(Q){Q.snippet=Q.snippet||"";var X=da("div"),ha=new (t([l,e,k],{templateString:x.substitute(this._detailsTemplate,{item:Q,i18n:ca},null,this)})),ja=new w({label:ca.gallery.open,className:"btn calcite primary",
dropDown:this._getOpenInMenu(Q)},E(".openItem",X)[0]);Q.widget=ha;X.appendChild(ha.domNode);E(".openItem",X).replaceWith(ja.domNode);0===ja.dropDown.getChildren().length&&ja.set("disabled",!0);return X}),table:function(){return da("div",r.prototype.renderRow.apply(this,arguments))}})},buildRendering:function(){this.inherited(arguments);var Q=t([r,z,v,A,O,D]),X=this.columns||{title:{label:"title"},type:{label:"type"},modified:{label:"last modified"},access:{label:"sharing"}};this._view=this.view||
"table";this._query=this.query;this._sort=this.sort||[{attribute:"title",descending:!1}];this._queryOptions=this.queryOptions||{sort:this.sort};this._store=this.store||new H({data:[]});this._rowsPerPage=this.rowsPerPage||9;this._pagingLinks=this.pagingLinks?this.pagingLinks:3;this._showHeader=this.showHeader||!1;this._selectionMode=this.selectionMode||"extended";this._useTouchScroll=this.useTouchScroll||!1;this._grid=new Q({columns:X,renderRow:this._renderers[this._view],noDataMessage:this.noDataMessage||
"",showHeader:this._showHeader,store:this._store,query:this._query,showLoadingMessage:!1,firstLastArrows:this._pagingLinks,previousNextArrows:this._pagingLinks,rowsPerPage:this._rowsPerPage,pagingLinks:this._pagingLinks,allowSelectAll:!0,selectionMode:this._selectionMode,sort:this._sort},this.domNode);this._grid.startup()},postCreate:function(){this.inherited(arguments);this.own(this._grid.on("refresh",p.hitch(this,function(){this._grid.showFooter=this._grid._total>this._grid.rowsPerPage;this._onGridRefresh()})),
c.before(this._grid,"removeRow",p.hitch(this,function(Q){Q&&(Q=this._grid.row(Q),(Q=(Q.data||Q).widget)&&Q.destroyRecursive())})),this._grid.on(".fav-icon a:click",p.hitch(this,function(Q){Q.preventDefault();var X=this._grid.row(Q),ha=Q.target.parentNode.parentNode.parentNode,ja=F.contains(Q.target.parentNode,"fav-off");Q=this._content[ja?"addToFavorites":"removeFromFavorites"](X.data).then(p.hitch(this,function(){this._favorites[X.data.id].id=ja?X.data.id:!1}));E(".fav-on",ha).style({display:ja?
"":"none"});E(".fav-off",ha).style({display:ja?"none":""});setTimeout(p.hitch(this,function(){E(".fav-on",ha).style({width:ja?"200px":"24px"});E(".fav-off",ha).style({width:ja?"24px":"200px"});setTimeout(p.hitch(this,function(){E(".fav-on, .fav-off").style({width:"24px"})}),2500)}),50);Q.then(p.hitch(this,function(){}))})),this._grid.on(".fav-icon a:mouseout",p.hitch(this,function(Q){I.set(Q.target.parentNode,{width:"24px"})})));!esri.isTouchEnabled||"gallery"!==this._view&&"details"!==this._view?
"gallery"!==this._view&&"details"!==this._view||this.own(this._grid.on(U.enterRow,p.hitch(this,function(Q){if(Q.relatedTarget&&!1===F.contains(Q.relatedTarget,"dijitMenu")&&!1===F.contains(Q.relatedTarget,"dijitReset")){var X=this._grid.row(Q),ha=E("img",X.element)[0];clearTimeout(this._showPopupTimeout);ha&&(this._showPopupTimeout=setTimeout(p.hitch(this,function(){this._portalUser?this._isFavorite(X.data.id).then(p.hitch(this,function(ja){this._showPopup(X.data,ha.parentNode)})):this._showPopup(X.data,
ha)}),400))}})),this._grid.on(U.leaveRow,p.hitch(this,function(Q){Q.relatedTarget&&!1===F.contains(Q.relatedTarget,"dijitTooltipDialog")&&!1===F.contains(Q.relatedTarget,"dijitTooltipConnector")&&(clearTimeout(this._showPopupTimeout),clearTimeout(this._closePopupTimeout),this._closePopupTimeout=setTimeout(p.hitch(this,function(){E(".fav-on, .fav-off",this.domNode).style("display","none").style("width","24px");this._closePopup()}),10))}))):this.own(this._grid.on(Z.selector(".dgrid-content .dgrid-row",
Z.tap),p.hitch(this,function(Q){Q.preventDefault();var X=this._grid.row(Q);this._portalUser?this._isFavorite(X.data.id).then(p.hitch(this,function(ha){this._showPopup(X.data,E("img",X.element)[0].parentNode)})):this._showPopup(X.data,E("img",X.element)[0])})),this._grid.on(".dgrid-row:click",p.hitch(this,function(Q){Q.preventDefault();var X=this._grid.row(Q);this._portalUser?this._isFavorite(X.data.id).then(p.hitch(this,function(ha){this._showPopup(X.data,E("img",X.element)[0].parentNode)})):this._showPopup(X.data,
E("img",X.element)[0])})))},_onGridRefresh:function(Q){this.emit("onRefresh",{currentPage:this._grid._currentPage});this._pagingLinks&&(E(".dgrid-navigation",this._grid.domNode)[this._grid._total<=this._grid.rowsPerPage?"addClass":"removeClass"]("hide"),E(".dgrid-pagination",this._grid.domNode)[0===this._grid._total?"addClass":"removeClass"]("hide"))},_getGridAttr:function(){return this._grid},_showPopup:function(Q,X){"details"===this._view?this._portalUser&&this._isFavorite(Q.id).then(p.hitch(this,
function(ha){E(".fav-on",X.parentNode).style("display",ha.id?"":"none");E(".fav-off",X.parentNode).style("display",ha.id?"none":"")})):"gallery"===this._view&&Q.id&&Q.id!==this._popupId&&(this._portalUser&&this._isFavorite(Q.id).then(p.hitch(this,function(ha){E(".fav-on",X.parentNode).style("display",ha.id?"":"none");E(".fav-off",X.parentNode).style("display",ha.id?"none":"")})),this._closePopup(),this._popupId=Q.id,this._tooltip=new n({onMouseLeave:p.hitch(this,"_closePopup"),content:new (t([l,e,
k],{templateString:x.substitute(this._itemPopupTemplate,{item:Q,i18n:ca.gallery},null,this)}))}),g.open({popup:this._tooltip,around:X,orient:["after-centered","before-centered"]}),this._popupButton=new w({label:ca.gallery.open,className:"calcite btn small primary",dropDown:this._getOpenInMenu(Q)}),E("#openItem").replaceWith(this._popupButton.domNode),0===this._popupButton.dropDown.getChildren().length&&this._popupButton.set("disabled",!0))},_closePopup:function(Q){Q&&Q.relatedTarget&&(!0===F.contains(Q.relatedTarget,
"dijitBackgroundIframe")||!0===F.contains(Q.relatedTarget,"dijitMenu")||!0===F.contains(Q.relatedTarget,"dijitReset"))||!this._tooltip||(g.close(this._tooltip),this._popupConnect&&this._popupConnect.remove(),this._popupButton&&this._popupButton.destroyRecursive(),this._tooltip.destroyRecursive(),this._popupId=this._tooltip=null)},_isFavorite:function(Q){return W(this._favorites[Q]||this._searchItems('(group:"'+this._portalUser.favGroupId+'" AND id:"'+Q+'")').then(p.hitch(this,function(X){this._favorites[Q]=
X.results[0]||{id:!1};return this._favorites[Q]})))},_searchItems:function(Q){return this._util.request({url:esriGeowConfig.restBaseUrl+"search",content:{q:Q,f:"json"}})},refresh:function(){this._grid&&(this._grid.set("query",this._query,this._queryOptions),E(".dgrid-row",this._grid.domNode).attr("tabindex","0"),this.own(f(this._grid.domNode.querySelector(".dgrid-content"),"keyup",function(Q){var X=Q.target;X.classList.contains("dgrid-row")&&Q.keyCode===T.ENTER&&("single"===this._grid.selectionMode&&
this._grid.clearSelection(),this._grid.select(X))}.bind(this))))},gotoPage:function(Q){this._grid.query=this._query;this._grid.queryOptions=this._queryOptions;this._grid._sort=this._queryOptions.sort;this._grid.gotoPage(Q)},_formatItemTitle:function(Q){return Q.title||Q.name||""},_formatType:function(Q){return this._content.changeTypename({type:Q.type,typeKeywords:Q.typeKeywords},!1)||Q.type},_formatLargeThumbnail:function(Q){return Q?"\x3cimg class\x3d'grid-item-thumb' alt\x3d'' src\x3d'"+Q+"'\x3e":
"\x3cimg class\x3d'grid-item-thumb' alt\x3d'' src\x3d'"+this._util.getStaticImagesUrl()+"/desktopapp.png'\x3e"},_getDefaultThumbnail:function(Q){var X=this._util.getStaticImagesUrl();return"web mapping application"==Q?X+"/webapp.png":"mobile application"==Q?X+"/mobileapp.png":"workforce project"===Q?X+"/workforceproject.png":"hub initiative"===Q?X+"/hubinitiative.png":"hub page"===Q?X+"/hubpage.png":"hub site application"===Q?X+"/hubsite.png":"dashboard"===Q?X+"/opsdashboard.png":"geoprocessing service"===
Q&&esriGeowConfig.self&&esriGeowConfig.self.isPortal?X+"/webtool.png":"web scene"===Q||"scene service"===Q?X+"/scene.png":"ortho mapping project"===Q?X+"/orthomappingproject.png":"ortho mapping template"===Q?X+"/orthomappingtemplate.png":X+"/desktopapp.png"},_formatThumbnail:function(Q){var X=Q.thumbnailUrl||this._getDefaultThumbnail(Q.type&&Q.type.toLowerCase()),ha=this._util.getHomePageGalleryLinkInfo(Q),ja=-1<dojo.indexOf(Q.typeKeywords,"Web AppBuilder for ArcGIS");ja=esriGeowConfig.self&&esriGeowConfig.self.isPortal&&
ja||"Application"===Q.type||"Web Mapping Application"===Q.type&&!ja||"Mobile Application"===Q.type||"Document Link"===Q.type;var aa="Application"===Q.type||"Web Mapping Application"===Q.type||"Mobile Application"===Q.type||"Document Link"===Q.type||"CityEngine Web Scene"===Q.type||"Dashboard"===Q.type;Q='\x3ca href\x3d"'+(esri.isTouchEnabled?"#":ja?Q.url||"item.html?id\x3d"+Q.id:ha&&ha.href&&ha.href.replace(/"/g,"'")||"item.html?id\x3d"+Q.id)+'" target\x3d"'+(aa?"_blank":"")+'"\x3e\x3cimg class\x3d"grid-item-thumb" alt\x3d"" src\x3d"'+
X+'" /\x3e\x3c/a\x3e';X=esriGeowConfig.userRole&&esriGeowConfig.userRole.isCustom();X=!X||X&&esriGeowConfig.userRole.canShareItemToGroup();ha='\x3cdiv class\x3d"gallery-img"\x3e\x3cdiv class\x3d"fav-icon"\x3e\x3ca href\x3d"#"\x3e\x3cdiv class\x3d"fav-on" style\x3d"display:none;"\x3e\x3cdiv class\x3d"star-on"\x3e\x3c/div\x3e\x3cp id\x3d"addString"\x3e'+ca.gallery.addFavorite+'\x3c/p\x3e\x3c/div\x3e\x3c/a\x3e\x3ca href\x3d"#"\x3e\x3cdiv class\x3d"fav-off" style\x3d"display:none;"\x3e\x3cdiv class\x3d"star-off"\x3e\x3c/div\x3e\x3cp id\x3d"remString"\x3e'+
ca.gallery.removeFavorite+"\x3c/p\x3e\x3c/div\x3e\x3c/a\x3e\x3c/div\x3e"+Q+"\x3c/div\x3e";return X&&this._portalUser?ha:Q},_formatItemTypeIcon:function(Q){return"\x3cimg class\x3d'grid-item-icon' alt\x3d'' src\x3d'"+this._content._getItemIconUrl(Q)+"'\x3e"},_formatPremiumContentIcon:function(Q){var X=Q.isPremiumContent,ha=Q.getTypeInfo(),ja=esriGeowConfig.self&&esriGeowConfig.self.isPortal?"portal":"";Q=-1<b.indexOf(Q.typeKeywords,"Requires Credits");return X?'\x3cp class\x3d"grid-item-type" title\x3d"'+
(Q?ca.common["premiumcontentcreditstitle"+ja]:ca.common["premiumcontenttitle"+ja])+"\"\x3e\x3cimg class\x3d'grid-premium-icon' alt\x3d'' src\x3d'"+ha.premiumIconUrl+"'\x3e"+(Q?ca.common.premiumcontent:ca.common.subscriptioncontent)+"\x3c/p\x3e":""},_formatDate:function(Q){!1===Q instanceof Date&&(Q=new Date(Q));return Q?m.format(Q,{selector:"date",datePattern:"MMMM yyy"}):""},_formatOwnerLink:function(Q){return'\x3ca href\x3d"user.html?user\x3d'+Q+'"\x3e'+Q+"\x3c/a\x3e"},_getOpenInMenu:function(Q){Q=
this._util.getItemOpenLinkObjects(Q);var X;var ha=new q({autoFocus:!0,_destroyOnRemove:!0,showTitle:!1});b.forEach(Q,function(ja){X=new u({label:ja.label,onClick:function(){ja.onClick()}});ha.addChild(X)});ha.startup();return ha},_setViewAttr:function(Q){this._view=Q=-1===b.indexOf(this._supportedViews,Q)?this._view:Q;this._grid&&(this._grid.renderRow=this._renderers[Q],da(this._grid.domNode,"!table!gallery!details."+Q),this._grid.set("showHeader","table"===this._view))},_setStoreAttr:function(Q){this._store=
Q},_setQueryAttr:function(Q,X){this._query=Q||this._query;this._queryOptions=X||this._queryOptions},_setItemsAttr:function(Q){(this._store=this._store||new R(new H({data:Q,identifier:"id",label:"id"})),this._store.setData)?this._store.setData(Q):this._store=new R(new H({data:Q}));this.set("store",this._store);this.set("view",this._view)}})})},"arcgisonline/sharing/dijit/Rating":function(){define("dojo/_base/declare dojox/form/Rating dojo/dom-attr dojo/dom-construct dojo/string ../../pages/utils/icons dojo/i18n!../../nls/arcgisonline".split(" "),
function(t,p,x,b,m,f,d){return t([p],{constructor:function(a){t.safeMixin(this,a)},postCreate:function(){this.inherited(arguments);var a=m.substitute(d.common.ratingMsg2,{stars:this.params.value});x.set(this.domNode,"aria-label",a);x.set(this.domNode,"tabindex",0);[].slice.call(this.domNode.querySelectorAll(".dojoxRatingInput")).forEach(function(c){b.place(f["star-f"]["16"],c,"after");b.place(f.star["16"],c,"after")})},_onMouse:function(){this.get("disabled")||this.inherited(arguments)},onStarClick:function(){this.get("disabled")||
this.inherited(arguments)},_setValueAttr:function(a){a=Math.round(a);this.inherited(arguments)}})})},"dojox/form/Rating":function(){define("dojo/_base/declare dojo/_base/lang dojo/dom-attr dojo/dom-class dojo/mouse dojo/on dojo/string dojo/query dijit/form/_FormWidget".split(" "),function(t,p,x,b,m,f,d,a,c){return t("dojox.form.Rating",c,{templateString:null,numStars:3,value:0,buildRendering:function(l){for(var h='\x3clabel class\x3d"dojoxRatingStar dijitInline ${hidden}"\x3e\x3cspan class\x3d"dojoxRatingLabel"\x3e${value} stars\x3c/span\x3e\x3cinput type\x3d"radio" name\x3d"rating-'+
Math.random().toString(36).substring(2)+'" value\x3d"${value}" dojoAttachPoint\x3d"focusNode" class\x3d"dojoxRatingInput"\x3e\x3c/label\x3e',n='\x3cdiv dojoAttachPoint\x3d"domNode" class\x3d"dojoxRating dijitInline"\x3e\x3cdiv data-dojo-attach-point\x3d"list"\x3e'+d.substitute(h,{value:0,hidden:"dojoxRatingHidden"})+"${stars}\x3c/div\x3e\x3c/div\x3e",g="",e=0;e<this.numStars;e++)g+=d.substitute(h,{value:e+1,hidden:""});this.templateString=d.substitute(n,{stars:g});this.inherited(arguments)},postCreate:function(){this.inherited(arguments);
this._renderStars(this.value);this.own(f(this.list,f.selector(".dojoxRatingStar","mouseover"),p.hitch(this,"_onMouse")),f(this.list,f.selector(".dojoxRatingStar","click"),p.hitch(this,"_onClick")),f(this.list,f.selector(".dojoxRatingInput","change"),p.hitch(this,"onStarChange")),f(this.list,m.leave,p.hitch(this,function(){this._renderStars(this.value)})))},_onMouse:function(l){var h=+x.get(l.target.querySelector("input"),"value");this._renderStars(h,!0);this.onMouseOver(l,h)},_onClick:function(l){if("LABEL"===
l.target.tagName){var h=+x.get(l.target.querySelector("input"),"value");l.target.value=h;this.onStarClick(l,h);h==this.value&&(l.preventDefault(),this.onStarChange(l))}},_renderStars:function(l,h){a(".dojoxRatingStar",this.domNode).forEach(function(n,g){g>l?(b.remove(n,"dojoxRatingStarHover"),b.remove(n,"dojoxRatingStarChecked")):(b.remove(n,"dojoxRatingStar"+(h?"Checked":"Hover")),b.add(n,"dojoxRatingStar"+(h?"Hover":"Checked")))})},onStarChange:function(l){l=+x.get(l.target,"value");this.setAttribute("value",
l==this.value?0:l);this._renderStars(this.value);this.onChange(this.value)},onStarClick:function(l,h){},onMouseOver:function(){},setAttribute:function(l,h){this.set(l,h)},_setValueAttr:function(l){this._set("value",l);this._renderStars(l);var h=a("input[type\x3dradio]",this.domNode)[l];h&&(h.checked=!0);this.onChange(l)}})})},"arcgisonline/pages/utils/keys":function(){define(["require","exports"],function(t,p){Object.defineProperty(p,"__esModule",{value:!0});p.DOWN=p.RIGHT=p.UP=p.LEFT=p.TAB=p.SPACEBAR=
p.ENTER=p.ESCAPE=void 0;p.ESCAPE=27;p.ENTER=13;p.SPACEBAR=32;p.TAB=9;p.LEFT=37;p.UP=38;p.RIGHT=39;p.DOWN=40;p["default"]={ESCAPE:p.ESCAPE,ENTER:p.ENTER,TAB:p.TAB,UP:p.UP,DOWN:p.DOWN,LEFT:p.LEFT,RIGHT:p.RIGHT,SPACEBAR:p.SPACEBAR}})},"arcgisonline/sharing/dijit/dialog/JoinGroupDlg":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/on dijit/a11yclick dijit/Dialog dijit/form/Button dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin ../../util ../../../pages/utils/dom dojo/i18n!../../../nls/arcgisonline dojo/text!./templates/JoinGroupDlg.html".split(" "),
function(t,p,x,b,m,f,d,a,c,l,h,n,g,e,k){var w=p("arcgisonline.sharing.dijit.dialog.JoinGroupDlg",[c,l,h],{declaredClass:"arcgisonline.sharing.dijit.dialog.JoinGroupDlg",basePath:t.toUrl("arcgisonline/sharing/dijit/dialog"),templateString:k,widgetsInTemplate:!0,postMixInProperties:function(){this.inherited(arguments);this.i18n=x.mixin(e.common,e.joinGroupDlg)},postCreate:function(){this.inherited(arguments);this._loadConnections()},show:function(q,u,r){this.groupId=q;this.leavingDisallowed=u;r&&(this.successHandler=
r);this.leavingDisallowed&&g.showNode(this._administrativeGroup);this._dialog.show()},hide:function(q){q&&q.preventDefault();this._dialog.hide()},_loadConnections:function(){this.own(f(this._okBtn,x.hitch(this,"_submitRequest")),f(this._cancelBtn,x.hitch(this,"hide")))},_submitRequest:function(q){q&&q.preventDefault();var u=n.request({url:esriGeowConfig.restBaseUrl+"community/groups/"+this.groupId+"/join"},{usePost:!0}).then(dojo.hitch(this,function(r,v){this.hide();this.successHandler&&this.successHandler(r,
v)}),dojo.hitch(this,function(r){if(!u.canceled){var v=r.message;r.messageCode&&"COM_1082"===r.messageCode?v=this.i18n.levelOneSharedUpdateCapabilities:-1<v.indexOf("You have already applied to join this group.")?v=this.i18n.alreadyRequested+"\x3cbr\x3e"+this.i18n.applicationConsidered:-1<v.indexOf("Unable to apply to join group:")?v=this.i18n.cannotAccept:-1<v.indexOf(" is by invitation only.")&&(v=this.i18n.byInviteOnly);arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.joinGroupError,
message:v})}this.hide()}))}});w.prototype.statics={_instance:null,getInstance:function(){null==this._instance&&(this._instance=new w);return this._instance}};return w})},"arcgisonline/sharing/dijit/dialog/ManageSubscriptionDlg":function(){define("require exports tslib dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/string dojo/on dojo/query ../../../esriGeowConfig ../../../pages/pageUtil ../../../pages/utils/dom ../../../pages/utils/subscription ../../util ./ChoiceDlg ./GeneralDlg ../../geow/Geow ../../../tsutils/declareDecorator dojo/i18n!../../../nls/arcgisonline dojo/text!./templates/ManageSubscriptionDlg.html".split(" "),
function(t,p,x,b,m,f,d,a,c,l,h,n,g,e,k,w,q,u,r,v){b=x.__importDefault(b);m=x.__importDefault(m);f=x.__importDefault(f);d=x.__importDefault(d);a=x.__importDefault(a);c=x.__importDefault(c);l=x.__importDefault(l);h=x.__importDefault(h);n=x.__importDefault(n);g=x.__importDefault(g);e=x.__importDefault(e);k=x.__importDefault(k);w=x.__importDefault(w);q=x.__importDefault(q);u=x.__importDefault(u);r=x.__importDefault(r);v=x.__importDefault(v);return function(){function z(){this.widgetsInTemplate=!0;this.templateString=
v["default"];this.i18n=x.__assign(x.__assign({},r["default"].common),r["default"].manageSubscriptionDlg);this._instance=null;this._converting=!1}var B=z;z.prototype.postCreate=function(){this.inherited(arguments);this.addListeners()};z.prototype.getInstance=function(){null==this._instance&&(this._instance=new B);return this._instance};z.prototype.show=function(A){this.portal=A;this._showManageView()};z.prototype.showManage=function(A){this.portal=A;this.clear();this._showManageView();this._dialog.show()};
z.prototype.showUpgrade=function(A){this.portal=A;this.clear();this._showUpgradeView();this._dialog.show()};z.prototype._showUpgradeView=function(){var A;this._dialog.set("title",this.i18n.upgradeSubscriptionTitle);var y=null===(A=this.portal.subscriptionInfo)||void 0===A?void 0:A.type;"Trial"!==y&&"Trial Press"!==y&&"Evaluation"!==y||this._dialog.set("title",this.i18n.manageSubscriptionTitle);A=this.portal.isPortal;g["default"].isPersonalUse(y,A)||g["default"].isStudentUse(y,A)?(this._inUSDiv.innerHTML=
d["default"].substitute(this.i18n.visitMyEsri,{startLink:'\x3cspan class\x3d"esriItemLinks"\x3e\x3ca target\x3d"_blank" href\x3d"'+l["default"].purchaseUrls.renew+'"\x3e',endLink:"\x3c/a\x3e\x3c/span\x3e"}),this._outsideUSDiv.innerHTML=d["default"].substitute(this.i18n.contactLocalOffice,{officeLinkStart:'\x3cspan class\x3d"esriItemLinks"\x3e\x3ca target\x3d"_blank" href\x3d"http://www.esri.com/about-esri/offices/"\x3e',officeLinkEnd:"\x3c/a\x3e\x3c/span\x3e"})):(this._inUSDiv.innerHTML=d["default"].substitute(this.i18n.upgradeInsideUS,
{officeLinkStart:'\x3cspan class\x3d"esriItemLinks"\x3e\x3ca target\x3d"_blank" href\x3d"http://www.esri.com/about-esri/offices/"\x3e',officeLinkEnd:"\x3c/a\x3e\x3c/span\x3e"}),this._outsideUSDiv.innerHTML=d["default"].substitute(this.i18n.upgradeOutsideUS,{officeLinkStart:'\x3cspan class\x3d"esriItemLinks"\x3e\x3ca target\x3d"_blank" href\x3d"http://www.esri.com/about-esri/offices/"\x3e',officeLinkEnd:"\x3c/a\x3e\x3c/span\x3e"}));n["default"].hideNodes([this._manageSubscriptionDiv,this._convertSubscriptionDiv,
this._nextBtn,this._convertBtn,this._cancelBtn]);"active"!==this.portal.subscriptionInfo.state||"Trial"!==this.portal.subscriptionInfo.type&&"Trial Press"!==this.portal.subscriptionInfo.type&&"Evaluation"!==this.portal.subscriptionInfo.type||this._dialog.set("title",this.i18n.manageSubscriptionTitle);n["default"].showNodes([this._upgradeSubscriptionDiv,this._okBtn])};z.prototype._showManageView=function(){var A;this._dialog.set("title",this.i18n.manageSubscriptionTitle);n["default"].hideNodes([this._upgradeSubscriptionDiv,
this._convertSubscriptionDiv,this._okBtn,this._convertBtn]);"Evaluation"===(null===(A=this.portal.subscriptionInfo)||void 0===A?void 0:A.type)?(n["default"].hideNodes([this._convertOptionDiv,this._manageSubscriptionContainer]),n["default"].showNode(this._evalSubscriptionContainer),this._purchaseInUSDiv.innerHTML=d["default"].substitute(this.i18n.upgradeInsideUS,{officeLinkStart:'\x3cspan class\x3d"esriItemLinks"\x3e\x3ca target\x3d"_blank" href\x3d"http://www.esri.com/about-esri/offices/"\x3e',officeLinkEnd:"\x3c/a\x3e\x3c/span\x3e"}),
this._purchaseOutsideUSDiv.innerHTML=d["default"].substitute(this.i18n.upgradeOutsideUS,{officeLinkStart:'\x3cspan class\x3d"esriItemLinks"\x3e\x3ca target\x3d"_blank" href\x3d"http://www.esri.com/about-esri/offices/"\x3e',officeLinkEnd:"\x3c/a\x3e\x3c/span\x3e"}),n["default"].showNode(this._okBtn),n["default"].hideNodes([this._nextBtn,this._cancelBtn])):n["default"].showNodes([this._nextBtn,this._cancelBtn]);n["default"].showNode(this._manageSubscriptionDiv)};z.prototype._showConvertView=function(){this._dialog.set("title",
this.i18n.convertToPersonalTitle);this._importantMsgDiv.innerHTML=d["default"].substitute(this.i18n.completeDetailsWithLinkMsg,{helpLinkStart:'\x3cspan class\x3d"esriItemLinks"\x3e\x3ca target\x3d"_blank" href\x3d"'+(""+this.portal.helpBase+this.portal.helpMap.m["120000592"])+'"\x3e',helpLinkEnd:"\x3c/a\x3e"});n["default"].hideNodes([this._upgradeSubscriptionDiv,this._manageSubscriptionDiv,this._okBtn,this._nextBtn]);n["default"].showNodes([this._convertSubscriptionDiv,this._convertBtn,this._cancelBtn])};
z.prototype.addListeners=function(){var A=this.onCancel.bind(this);this.own(a["default"](this._okBtn,"click",A),a["default"](this._nextBtn,"click",this.onNext.bind(this)),a["default"](this._convertBtn,"click",this.onConvert.bind(this)),a["default"](this._cancelBtn,"click",A));c["default"](".jevent").connect("onclick",function(y){y.preventDefault()})};z.prototype.clear=function(){var A;this._converting=!1;this._choiceDlg=h["default"].createSpecifiedDialog(k["default"]);null===(A=this._dialog)||void 0===
A?void 0:A.set("title","");if(A=this._dialog.domNode.querySelector(".dijitDialogCloseIcon"))A.tabIndex=0;n["default"].hideNodes([this._upgradeSubscriptionDiv,this._manageSubscriptionDiv,this._convertSubscriptionDiv]);n["default"].showNodes([this._convertOptionDiv,this._manageSubscriptionContainer]);n["default"].hideNode(this._evalSubscriptionContainer);this._upgradeRadioBtn.checked=!0};z.prototype.hide=function(){this._dialog.hide()};z.prototype.onNext=function(A){this._convertRadioBtn.checked?this._showConvertView():
this._showUpgradeView()};z.prototype.onConvert=function(A){this._converting||(A={title:this.i18n.convertToPersonalTitle,message:this.i18n.noReturnMsg,choiceOneTitle:this.i18n.yesLabel,choiceTwoTitle:this.i18n.noLabel,choiceOneHandler:this.doConvert.bind(this)},this._choiceDlg.show(A))};z.prototype.doConvert=function(){var A=this,y;if(!this._converting&&(null===(y=l["default"].self)||void 0===y?0:y.id)){this._converting=!0;this._convertBtn.disabled=!0;var D=(""+l["default"].baseUrl.replace(location.host,
l["default"].self.portalHostname)+l["default"].signin).replace("http:","https:");e["default"].request({url:l["default"].restBaseUrl+"portals/self/convert",content:{target:"personal",timeout:12E4}},{usePost:!0}).then(function(G){q["default"].signout(D)},function(G){A._converting=!1;A._convertBtn.disabled=!1;var E=h["default"].createSpecifiedDialog(w["default"]);E.onOkClick=function(){E.hide();A._dialog.hide()};E.show({title:A.i18n.errorTitle,message:A.i18n.unableToConvert})})}};z.prototype.onCancel=
function(A){this.hide()};z.prototype.onHide=function(){};return z=B=x.__decorate([u["default"](b["default"],m["default"],f["default"])],z)}()})},"arcgisonline/sharing/dijit/dialog/ManageTilesDlg":function(){define("require esri/declare esri/Evented esri/config esri/lang esri/request dojo/_base/lang dojo/on dojo/query dojo/sniff dojo/topic dojo/json dijit/a11yclick dojo/number dojo/string dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/Deferred dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/Dialog dojo/store/Memory dojo/store/Observable dgrid/OnDemandGrid dgrid/selector dgrid/Selection dgrid/extensions/DijitRegistry esri/geometry/Extent esri/geometry/webMercatorUtils ../../../map/core/projectExtent ../../../map/utils/clipOnHorizon ../DefineExtent ./GeneralDlg ./ChoiceDlg ../../../pages/pageUtil ../../../pages/utils/arrays ../../../pages/utils/dom ../../../pages/serviceUtil ../../util calcite-web/js/calcite-web dojo/i18n!../../../nls/arcgisonline dojo/text!./templates/ManageTilesDlg.html".split(" "),
function(t,p,x,b,m,f,d,a,c,l,h,n,g,e,k,w,q,u,r,v,z,B,A,y,D,G,E,F,I,M,P,W,H,O,K,R,da,U,Z,L,T,Y,ca,Q,X){var ha=p(null,{showFooter:!0,buildRendering:function(){this.inherited(arguments);var aa=this.summaryAreaNode=r.create("div",{className:"summary-row",role:"row",style:{overflow:"hidden"}},this.footerNode);this.on("scroll",function(){aa.scrollLeft=this.getScrollPosition().x}.bind(this));this.summary&&this._setSummary(this.summary)},_updateColumns:function(){this.inherited(arguments);this.summary&&this._setSummary(this.summary)},
_renderSummaryCell:function(aa,la,oa){la.appendChild(document.createTextNode(aa[oa.field]||""))},_setSummary:function(aa){var la=this.summaryTableNode;this.summary=aa;la&&r.destroy(la);la=this.summaryTableNode=this.createRowCells("td",this._renderSummaryCell.bind(this,aa));this.summaryAreaNode.appendChild(la);this._started&&this.resize()}}),ja=p("arcgisonline.sharing.dijit.dialog.ManageTilesDlg",[z,B,A],{declaredClass:"arcgisonline.sharing.dijit.dialog.ManageTilesDlg",templateString:X,widgetsInTemplate:!0,
basePath:t.toUrl("arcgisonline/sharing/dijit/dialog"),baseClass:"esriManageTiles",PROCESSING:"PROCESSING",SUBMITTED:"SUBMITTED",DEFAULT_TILE_WIDTH:256,DEFAULT_TILE_HEIGHT:256,TIME_TO_NEXT_UPDATE:1E4,TABS:{LEVELS:"levels",EXTENT:"extent"},_noSourceData:!1,_isSourceTilePackage:!1,_isVisible:!1,_isProcessing:!1,_wasProcessing:!1,_allTilesComplete:!1,_createClicked:!1,_tab:"levels",postMixInProperties:function(){this.inherited(arguments);this.i18n=d.mixin({},Q.common);this.i18n=d.mixin(this.i18n,Q.manageTilesDlg)},
postCreate:function(){this.inherited(arguments);b.defaults.io.proxyUrl=esriGeowConfig.proxyServer;esriGeowConfig.proxyUrl&&(b.defaults.io.proxyUrl=esriGeowConfig.proxyUrl);var aa=this.hide.bind(this);this.own(g(this._buildButton,this._createClick.bind(this)),g(this._cancelButton,this._cancelClick.bind(this)),g(this._closeButton,aa),g(this.dialog.closeButtonNode,aa),g(this._levelsTab,this._levelsTabClick.bind(this)),g(this._extentTab,this._extentTabClick.bind(this)))},destroy:function(){this.inherited(arguments);
this._defineExtent&&this._defineExtent.destroy()},setServerTokens:function(aa,la,oa){this._hostedServer=aa;this._serverToken=la;this._adminServerToken=oa},displayTabs:function(aa){this._mustDisplayTabs=aa},show:function(aa,la,oa,wa){la=this._handleServiceInfo.bind(this,la);ca.tabs();this._setFlags();this.item=aa;this._isSourceTilePackage=!(!oa||!oa.tilePackage);this._isSourceServiceDefinition=!(!oa||!oa.serviceDefinition);this._isSourceTilePackage?(q.set(this._buildButton,"innerHTML",this.i18n.publishButton),
q.set(this.dialog,"title",this.i18n.publishButton),this._canShowTabs=!1):this._isPortal?this._canShowTabs=!1:(q.set(this.dialog,"title",this.i18n.buildTitle),this._canShowTabs=!(!esriGeowConfig.tilesOnDemandEnabled||!this._mustDisplayTabs));this._showTabs(this._canShowTabs);wa?la(wa):(aa=this._isPortal?f({url:this.item.url,content:{f:"json",token:this._serverToken}}):Y.request({url:this.item.url}),aa.then(la,la))},showNoSource:function(aa,la){this._noSourceData=!0;this.show(aa,la,!1)},hide:function(){this._noSourceData=
!1;this.dialog.hide();(this._createClicked||this._wasProcessing)&&h.publish("manage-tiles/update",{tileInfoChanged:!0});this._isVisible=this._wasProcessing=this._createClicked=!1},_showTabs:function(aa){L.showHide(this._tabNav,aa);c(".tab-contents").forEach(function(la){u[aa?"remove":"add"](la,"no-border")})},_setFlags:function(){this._isPortal=Y.isPortal();this._roleCanPublishTiles=(this._roleCanCreateItem=esriGeowConfig.userRole.canCreateItem())&&esriGeowConfig.userRole.canPublishTiles();this._createClicked=
this._allTilesComplete=this._wasProcessing=this._isProcessing=this._isVisible=this._isSourceTilePackage=this._noSourceData=!1;this._refreshTilesEnabled=!this._isPortal&&esriGeowConfig.tilesOnDemandEnabled},_handleServiceInfo:function(aa,la){!la||la.code||la.message||(this._serviceFullExtent=la.fullExtent,this._serviceTileInfo=la.tileInfo,this._serviceTileInfo.width=this._serviceTileInfo.width||this.DEFAULT_TILE_WIDTH,this._serviceTileInfo.height=this._serviceTileInfo.height||this.DEFAULT_TILE_HEIGHT,
this.serviceMinScale=la.minScale?la.minScale:this._serviceTileInfo.lods[0].scale,this.serviceMaxScale=la.maxScale?la.maxScale:this._serviceTileInfo.lods[this._serviceTileInfo.lods.length-1].scale,this.serviceMinLOD=m.isDefined(la.minLOD)?la.minLOD:void 0,this.serviceMaxLOD=m.isDefined(la.maxLOD)?la.maxLOD:void 0,this.dialog.show(),this._isVisible=!0,this._updateStatus(aa))},_handleReportCacheStatus:function(aa){aa&&aa.results&&!aa.message?(aa=aa.results[0],aa.serviceName=this._lastTileStatus.serviceName,
aa.type=this._lastTileStatus.type,aa.lodInfos=aa.value.lodInfos,aa.cacheExecutionStatus=aa.value.cacheExecutionStatus,aa.minScale=this._lastTileStatus.minScale,aa.maxScale=this._lastTileStatus.maxScale,this._updateStatus(aa)):this._updateStatus(aa)},_getStatus:function(){var aa=this;if(this._isVisible)if(aa._isPortal){var la=aa._handleReportCacheStatus.bind(aa),oa=aa.item.url.indexOf("/services/")+10,wa=aa.item.url.indexOf("/"+aa._lastTileStatus.serviceName+"/")+1;oa=aa.item.url.substring(oa,wa)+
aa._lastTileStatus.serviceName+":"+aa._lastTileStatus.type;var za=T.adjustHostedServerForProtocol(aa._hostedServer.url)+"/rest/services/System/ReportingTools/GPServer/ReportCacheStatus/execute",Fa={service_url:oa,report_mode:"esriCacheStatus",f:"json",token:aa._serverToken,job_id:aa._jobId,ts:(new Date).getTime()};aa._jobId?f({url:za,content:Fa}).then(la,la):(oa={service_url:oa,report_mode:"esriJobSummary",f:"json",token:aa._serverToken,ts:(new Date).getTime()},f({url:za,content:oa}).then(function(Ba){Ba&&
Ba.results&&Ba.results[0]&&Ba.results[0].value.esriJobStatus&&Ba.results[0].value.esriJobStatus[0]&&(aa._jobId=Ba.results[0].value.esriJobStatus[0].cancelJobID,Fa.job_id=aa._jobId);f({url:za,content:Fa}).then(la,la)}))}else oa=aa.item.url.replace("/rest/","/rest/admin/"),wa=aa._updateStatus.bind(aa),Y.request({url:oa,content:{ts:(new Date).getTime()}}).then(wa,wa)},_updateStatus:function(aa){if(this._isVisible&&(!aa||"Error"!==aa.name||"Unknown runtime error"!==aa.message)){this._lastTileStatus=aa;
this._lastTileStatus.minScale=this._lastTileStatus.minScale||this.serviceMinScale;this._lastTileStatus.maxScale=this._lastTileStatus.maxScale||this.serviceMaxScale;this._lastTileStatus.minLOD=this._lastTileStatus.minLOD||this.serviceMinLOD||void 0;this._lastTileStatus.maxLOD=this._lastTileStatus.maxLOD||this.serviceMaxLOD||void 0;if(this._isProcessing=aa.cacheExecutionStatus===this.PROCESSING||aa.cacheExecutionStatus===this.SUBMITTED)this._wasProcessing=!0,setTimeout(this._getStatus.bind(this),this.TIME_TO_NEXT_UPDATE);
this._refreshUI()}},_refreshUI:function(){this._updateData();this._grid?this._updateGrid():this._createGrid();this._updateTotals();this._updateExtent();this._updateDescription();this._updateButtons();this._updateMessage();this._updateTabs()},_updateExtent:function(){if(this._defineExtent&&this._defineExtent._started&&!this._updatedExtent){var aa=[[],[]],la;4326!==this._serviceFullExtent.spatialReference.wkid&&(la=W.webMercatorToGeographic(new P(this._serviceFullExtent)));aa[1][1]=parseFloat(la.ymax);
aa[0][0]=parseFloat(la.xmin);aa[1][0]=parseFloat(la.xmax);aa[0][1]=parseFloat(la.ymin);this._defineExtent.set("extent",aa)}},_updateTabs:function(){this._isProcessing?(this._canShowTabs&&(u.remove(this._extentTab,"is-active"),u.remove(this._extentSection,"is-active"),u.add(this._levelsTab,"is-active"),u.add(this._levelsSection,"is-active")),this._showTabs(!1)):this._showTabs(this._canShowTabs)},_updateButtons:function(){this._roleCanPublishTiles?this._isProcessing||this._allTilesComplete&&!this._refreshTilesEnabled?
(this._hideButtons(),this._isProcessing&&this._isPortal&&this._jobId?this._showCancel():this._hideCancel()):(this._showButtons(),this._hideCancel()):this._hideButtons()},_updateMessage:function(){this._isProcessing||this._allTilesComplete&&!this._refreshTilesEnabled||(this._noSourceData?q.set(this._messageDiv,"innerHTML",this.i18n._noSourceData):q.set(this._messageDiv,"innerHTML",this._isSourceTilePackage?this.i18n.selectTilesPublish:this.i18n.selectTiles+"\x3cbr\x3e"+this.i18n.adjustVisibleRange))},
_updateData:function(){var aa=this.i18n.totals,la=this._lastTileStatus;this._gridStore=new G(new D({data:this._getTileStatusData(),identifier:"id"}));this._gridStore.getTotals||(this._gridStore.getTotals=function(){var wa={},za=0,Fa=0,Ba=0;this.data.forEach(function(va){za+=parseInt(va.created,10);Fa+=parseInt(va.expected,10);Ba+=va.storageSize?parseInt(va.storageSize,10):0});var Ca=e.round(za/Fa*100,2)||0;Ca=100<Ca?100:Ca;wa.selected="";wa.scaleLevel=aa;wa.created=e.format(za);wa.expected=e.format(Fa);
wa.pctComplete=String(Ca);wa.storageSize=U.sizeInMB(la&&la.size||Ba);return wa});if(this._noSourceData)L.hideNode(this._scalesSelectedSpan);else{var oa=k.substitute(this.i18n.scalesSelected,{scales:0});q.set(this._scalesSelectedSpan,"innerHTML",oa)}},_getTileStatusData:function(){var aa=this,la=[],oa=0,wa=0,za,Fa,Ba,Ca;aa._serviceTileInfo.lods.forEach(function(va){Math.floor(va.scale)<=aa._lastTileStatus.minScale&&Math.ceil(va.scale)>=aa._lastTileStatus.maxScale&&(za=U.calculateExpectedTiles(aa._serviceTileInfo,
aa._serviceFullExtent,va),la.push({id:va.level,selected:!1,scaleLevel:"1:"+e.format(Math.round(va.scale),{pattern:"#,###,###,##0"}),scale:va.scale,created:0,expected:za,pctComplete:0,storageSize:0}))});aa._lastTileStatus&&aa._lastTileStatus.lodInfos&&0<aa._lastTileStatus.lodInfos.length&&aa._lastTileStatus.lodInfos.forEach(function(va){for(Ca=0;Ca<la.length;Ca++)if(la[Ca]&&la[Ca].id===va.levelID){Fa=Math.round(va.tileCount/va.expectedTileCount*100);100<Fa&&(Fa=100);aa._isPortal&&va.pct&&(Fa=va.pct);
Ba=la[Ca];Ba.created=va.tileCount;Ba.expected=va.expectedTileCount;Ba.pctComplete=Fa;Ba.storageSize=va.tilesSize?va.tilesSize:0;break}});la.forEach(function(va){oa+=va.created;wa+=va.expected});aa._allTilesComplete=oa===wa;aa._disableButtons();return la},_updateTotals:function(){var aa=this,la=aa._grid.on("dgrid-refresh-complete",function(){aa._scrollNode&&aa._currentScrollPos&&(aa._scrollNode.scrollTop=aa._currentScrollPos);la.remove()});aa._scrollPos&&(aa._currentScrollPos=aa._scrollPos);aa._grid.set("summary",
aa._gridStore.getTotals());aa._grid.resize();aa._grid.refresh()},_updateDescription:function(){q.set(this._dialogDescription,"innerHTML","\x3cstrong\x3e"+(this._isProcessing?this._isSourceTilePackage?this.i18n.jobStatusPublishing:this.i18n.jobStatus:this.i18n.noJobStatus)+"\x3c/strong\x3e\x3cbr/\x3e")},_hideButtons:function(){L.hideNodes(c("div.messageContainer"));L.hideNodes(c("div.selected-scales-container"));L.hideNode(this._buildButton)},_showButtons:function(){L.showNode(this._buildButton);L.showNodes(c("div.selected-scales-container"));
L.showNodes(c("div.messageContainer"))},_hideCancel:function(){L.hideNode(this._cancelButton)},_showCancel:function(){L.showNode(this._cancelButton)},_updateGrid:function(){this._grid.set("columns",this._getGridLayout());this._grid.set("store",this._gridStore)},_createGrid:function(){this._grid=new (p([E,M,I,ha]))({id:"scaleGrid",columns:this._getGridLayout(),showLoadingMessage:!1,showFooter:!0,noDataMessage:"",selectionMode:"none",gridScope:this,allowSelectAll:!0,store:this._gridStore,sort:[{attribute:"id",
descending:!1}]},this._gridContainer);this._grid.startup();this.own(this._grid.on(".dgrid-header-row .field-selected:click",function(aa){this._toggleAll("INPUT"===aa.target.tagName?aa.target:aa.target.childNodes[0])}.bind(this)));this.own(this._grid.on(".dgrid-row .field-selected:click",function(aa){aa="INPUT"===aa.target.tagName?aa.target:aa.target.childNodes[0];var la=aa.parentNode.parentNode.parentNode.parentNode.id;la=la.substring(la.indexOf("scaleGrid-row-")+14);this._toggleScale(aa,la)}.bind(this)));
this.own(this._grid.on("scroll",function(aa){this._scrollPos=(this._scrollNode=aa&&aa.scrollTarget||null)&&this._scrollNode.scrollTop||0}.bind(this)))},_getGridLayout:function(){var aa=[];this._isProcessing||this._allTilesComplete&&!this._refreshTilesEnabled||this._noSourceData||!this._roleCanPublishTiles||aa.push(F({field:"selected",sortable:!1,selectorType:"checkbox"}));aa.push({field:"scaleLevel",label:this.i18n.grid.scaleLevel,sortable:!1,formatter:this._contentFormatter});aa.push({field:"created",
label:this._isSourceTilePackage?this.i18n.grid.tilesPublished:this.i18n.grid.tilesCreated,sortable:!1,formatter:this._tilesFormatter});aa.push({field:"expected",label:this.i18n.grid.totalTiles,sortable:!1,formatter:this._tilesFormatter});aa.push({field:"pctComplete",label:this.i18n.grid.percentComplete,sortable:!1,formatter:this._contentFormatter});aa.push({field:"storageSize",label:this.i18n.grid.storageSize,sortable:!1,formatter:this._sizeFormatter});return aa},_levelsTabClick:function(){this._tab=
this.TABS.LEVELS;this._updateMessage();this._checkToggled()},_extentTabClick:function(){var aa=[[],[]],la;this._tab=this.TABS.EXTENT;this._defineExtent||(this._defineExtent=new K({id:"defineExtent"},this._extentContainer),this._defineExtent.startup(),4326!==this._serviceFullExtent.spatialReference.wkid&&(la=W.webMercatorToGeographic(new P(this._serviceFullExtent))),aa[1][1]=parseFloat(la.ymax),aa[0][0]=parseFloat(la.xmin),aa[1][0]=parseFloat(la.xmax),aa[0][1]=parseFloat(la.ymin),this._defineExtent.set("extent",
aa),this.own(h.subscribe("define-extent/change",this._onExtentChange.bind(this))));q.set(this._messageDiv,"innerHTML",this.i18n.defineExtent);this._checkToggled()},_onExtentChange:function(aa){this._serviceFullExtent.spatialReference.wkid===aa.spatialReference.wkid?this._updatedExtent=aa:H(aa,this._serviceFullExtent.spatialReference,function(la){la&&la.length&&(la=la.shift());this._updatedExtent=O(la)}.bind(this),null,this._defineExtent.map);this._checkToggled()},_calculateIntersection:function(aa,
la){var oa=new P(aa),wa=new P(la);return(oa=oa.intersects(wa))?oa.toJson():null},_cancelClick:function(){var aa=this;L.disableNode(aa._cancelButton,!0);var la=function(oa){m.isDefined(oa.error)&&(U.createSpecifiedDialog(R).show({title:aa.i18n.errorTitle,message:aa.i18n.cantCancelJob}),aa._cancelButton.set("disabled",!1))};f({url:aa._hostedServer.adminUrl+"/rest/services/System/CachingControllers/GPServer/Manage%20Map%20Cache%20Tiles/jobs/"+aa._jobId+"/cancel",content:{f:"json",token:aa._adminServerToken}},
{usePost:!0}).then(la,la)},_checkCredits:function(aa){var la=new v,oa=esriGeowConfig.restBaseUrl+"portals/self/cost";aa={generatedTileCount:aa};this._isPortal||this._isSourceTilePackage?la.resolve():Y.request({url:oa,content:aa}).then(function(wa){la.resolve(wa)},function(){la.resolve()});return la},_createClick:function(){var aa=this._getAvgTileSize(this._serviceTileInfo),la=0,oa=0,wa=0,za=[],Fa=[],Ba,Ca,va,Va,Sa=0,Ra=0,Ta;this._grid.store.query().forEach(function(ya){Ca=parseInt(ya.created,10);
va=parseInt(ya.expected,10);Va=parseInt(ya.storageSize,10);!0===ya.selected&&(Ba=parseInt(ya.expected,10)-parseInt(ya.created,10),0<Ba&&(this._isPortal?za.push(""+ya.scale):za.push(ya.id)),esriGeowConfig.tilesOnDemandEnabled&&!this._isPortal&&this._updatedExtent?Sa=(Ta=this._calculateIntersection(this._updatedExtent,this._serviceFullExtent))?Sa+U.calculateExpectedTiles(this._serviceTileInfo,Ta,this._serviceTileInfo.lods[ya.id]):Sa+0:Sa+=Ca<=va?Ca:va,Ra+=va);oa+=Ca;wa+=Va}.bind(this));Fa=this._grid.store.query().filter(function(ya){return!0===
ya.selected}.bind(this));var Wa=esriGeowConfig.tilesOnDemandEnabled&&!this._isPortal&&this._updatedExtent?n.stringify(this._updatedExtent):this._serviceFullExtent.xmin+","+this._serviceFullExtent.ymin+","+this._serviceFullExtent.xmax+","+this._serviceFullExtent.ymax;if(0<za.length){la=esriGeowConfig.tilesOnDemandEnabled&&!this._isPortal&&this._updatedExtent?Sa:Ra-Sa;var La=this._formatSizeWithUnits((0<wa&&0<oa?wa/oa:aa)*la),$a=this._isPortal?za.join(";"):za.join(",");this._checkCredits(la).then(function(ya){var Xa=
"\x3cp\x3e"+k.substitute(this._isSourceTilePackage?this.i18n.aboutToPublish:this.i18n.aboutToCreate,{tiles:la,storage:La})+"\x3c/p\x3e",bb=!1;!this._isPortal&&!this._isSourceTilePackage&&m.isDefined(ya.transactionCreditCost)&&m.isDefined(ya.availableCredits)&&(ya.transactionCreditCost>ya.availableCredits?bb=!0:Xa+="\x3cp\x3e"+k.substitute(this.i18n.aboutToCreateCost,{credits:e.format(ya.transactionCreditCost),creditsLeft:e.format(ya.availableCredits)})+"\x3c/p\x3e");Xa+="\x3cp\x3e"+(this._isSourceTilePackage?
this.i18n.reallyPublishTiles:this.i18n.reallyCreateTiles)+"\x3c/p\x3e";!this._isPortal&&bb?U.createSpecifiedDialog(R).show({title:this.i18n.notice,message:this.i18n.notEnoughCredits}):(ya={title:this._isSourceTilePackage?this.i18n.publishTiles:this.i18n.createTiles,message:Xa,choiceOneTitle:this._isSourceTilePackage?this.i18n.yesPublishTiles:this.i18n.yesCreateTiles,choiceTwoTitle:this._isSourceTilePackage?this.i18n.noPublishTiles:this.i18n.noCreateTiles},ya.choiceOneHandler=function(){this._createClicked=
!0;var cb=Fa.length&&Fa[0]||Z.find(this._serviceTileInfo.lods,function(ka){return this.serviceMinScale===ka.scale}),ab=Fa.length&&Fa[Fa.length-1]||Z.find(this._serviceTileInfo.lods,function(ka){return this.serviceMaxScale===ka.scale}),Ua=m.isDefined(this.serviceMinLOD)||m.isDefined(this.serviceMaxLOD),db=Ua&&cb&&cb.id<this.serviceMinLOD;Ua=Ua&&ab&&ab.id>this.serviceMaxLOD;var C=this._isSourceServiceDefinition&&(db||Ua);if(this._isPortal){L.disableNode(this._cancelButton,!1);var J=this.item.url.indexOf("/services/")+
10,N=this.item.url.indexOf(this._lastTileStatus.serviceName);J=this.item.url.substring(J,N);var V=this._hostedServer.adminUrl+"/rest/services/System/CachingControllers/GPServer/Manage%20Map%20Cache%20Tiles/submitJob",S={f:"json",token:this._adminServerToken,service_url:J+this._lastTileStatus.serviceName+":"+this._lastTileStatus.type,constraining_extent:Wa,levels:$a,update_mode:"RECREATE_ALL_TILES",thread_count:-1},ba=function(ka){ka.code&&ka.message?U.createSpecifiedDialog(R).show({title:this.i18n.errorTitle,
message:ka.message}):(this._jobId=ka.jobId,this._isProcessing=!0,this._isVisible&&(this._updatedExtent=void 0,this._refreshUI(),setTimeout(this._getStatus.bind(this),this.TIME_TO_NEXT_UPDATE)))}.bind(this);C?(C={},db&&(C.minLOD=cb.id),Ua&&(C.maxLOD=ab.id),Y.request({url:ea.replace("/updateTiles","/edit"),content:{serviceDefinition:JSON.stringify(C)}},{usePost:!0}).then(function(ka){f({url:V,content:S},{usePost:!0}).then(ba,ba)},function(ka){})):f({url:V,content:S},{usePost:!0}).then(ba,ba)}else{var ea=
this.item.url.replace("/rest/","/rest/admin/")+"/updateTiles";9>=l("ie")&&(J=ea.indexOf("admin/services/"),N=ea.indexOf("/MapServer"),ea=ea.substring(0,J+15)+encodeURIComponent(ea.substring(J+15,N))+ea.substring(N));var ia={levels:$a,extent:Wa},fa=function(ka){if(ka.code&&ka.message){var ma=ka.message;ka.message&&-1<ka.message.toLowerCase().indexOf("credit")?ma=this.i18n.notEnoughCredits:ka.message&&-1<ka.message.toLowerCase().indexOf("invalid extent")&&(ma=this.i18n.invalidExtent);U.createSpecifiedDialog(R).show({title:this.i18n.errorTitle,
message:ma})}else this._isProcessing=!0,this._isVisible&&(this._updatedExtent=void 0,this._refreshUI(),setTimeout(this._getStatus.bind(this),this.TIME_TO_NEXT_UPDATE))}.bind(this);C?(C={},db&&(C.minLOD=cb.id),Ua&&(C.maxLOD=ab.id),Y.request({url:ea.replace("/updateTiles","/edit"),content:{serviceDefinition:JSON.stringify(C)}},{usePost:!0}).then(function(ka){Y.request({url:ea,content:ia},{usePost:!0}).then(fa,fa)},function(ka){})):Y.request({url:ea,content:ia},{usePost:!0}).then(fa,fa)}}.bind(this),
ya.choiceTwoHandler=function(){}.bind(this),this._createChoiceDlg().show(ya))}.bind(this))}},_createChoiceDlg:function(){if(w.byId("choice-dialog"))var aa=da.prototype.statics.getInstance();else aa=new da,a.once(aa._dialog,"hide",function(){aa._dialog.destroyRecursive();aa.destroyRecursive()});return aa},_contentFormatter:function(aa){return'\x3cspan class\x3d"esriContentTypeName"\x3e'+aa+"\x3c/span\x3e"},_tilesFormatter:function(aa){var la="esriContentTypeName";aa&&1E10<=aa&&(la="esriContentTypeNameSmall");
return'\x3cspan class\x3d"'+la+'"\x3e'+e.format(aa)+"\x3c/span\x3e"},_sizeFormatter:function(aa){return'\x3cspan class\x3d"esriContentTypeName"\x3e'+U.sizeInMB(aa)+"\x3c/span\x3e"},_getAvgTileSize:function(aa){return 1E3*(aa.rows?aa.rows/10:25.6)},_formatSizeWithUnits:function(aa){var la=aa,oa=" "+this.i18n.megabytes;1048567E3<aa?(la=aa/1048567E3,oa=" "+this.i18n.gigabytes):0<aa&&(la=aa/1048567);la=Math.round(100*la)/100;return e.format(la)+oa},_enableButtons:function(aa,la,oa){var wa=this._tab===
this.TABS.LEVELS?this.i18n.tilesToCreate:this.i18n.tilesToCreateInExtent,za=this.i18n.tilesToPublish,Fa=this.i18n.noTilesToCreate,Ba=this.i18n.noTilesToPublish,Ca="";aa!==la?(aa=la-aa,oa=this._formatSizeWithUnits(oa*aa),Ca=k.substitute(this._isSourceTilePackage?za:wa,{tiles:aa,storage:oa}),L.disableNode(this._buildButton,!1)):(Ca=k.substitute(this._isSourceTilePackage?Ba:Fa,{tiles:0}),L.disableNode(this._buildButton,!0));q.set(this._messageDiv,"innerHTML",Ca)},_disableButtons:function(){q.set(this._messageDiv,
"innerHTML",this._isSourceTilePackage?this.i18n.selectTilesPublish:this.i18n.selectTiles+"\x3cbr\x3e"+this.i18n.adjustVisibleRange);L.disableNode(this._buildButton,!0)},_setScalesSelected:function(aa){aa=k.substitute(this.i18n.scalesSelected,{scales:aa});this._scalesSelectedSpan&&q.set(this._scalesSelectedSpan,"innerHTML",aa)},_toggleAll:function(aa){if(aa){var la=q.get(aa,"checked");this._grid&&this._grid.store&&(this._grid.store.query().forEach(function(oa){oa.selected=la}),this._checkToggled())}},
_toggleScale:function(aa,la){if(this._grid.store){var oa=this._grid.store.query({id:la}).shift();oa&&(oa.selected=q.get(aa,"checked"));this._checkToggled()}},_checkToggled:function(){var aa=this,la=0,oa=0,wa=0,za=0,Fa=0,Ba;if(aa._grid.store)if(aa._grid.store.query().forEach(function(va){var Va=parseInt(va.created,10),Sa=parseInt(va.expected,10),Ra=parseInt(va.storageSize,10);va.selected&&(la++,esriGeowConfig.tilesOnDemandEnabled&&!aa._isPortal&&aa._updatedExtent?oa=(Ba=aa._calculateIntersection(aa._updatedExtent,
aa._serviceFullExtent))?oa+U.calculateExpectedTiles(aa._serviceTileInfo,Ba,aa._serviceTileInfo.lods[va.id]):oa+0:oa+=Va<=Sa?Va:Sa,wa+=Sa);za+=Va;Fa+=Ra}),la){var Ca=0<Fa?Fa/za:aa._getAvgTileSize(aa._serviceTileInfo);esriGeowConfig.tilesOnDemandEnabled&&!aa._isPortal&&aa._updatedExtent?aa._enableButtons(wa-oa,wa,Ca):aa._enableButtons(oa,wa,Ca)}else aa._disableButtons();else aa._disableButtons();aa._setScalesSelected(la)}});ja.prototype.statics={getInstance:function(){this._instance||(this._instance=
new ja);return this._instance}};return ja})},"calcite-web/js/calcite-web":function(){(function(t,p){"object"===typeof exports&&"undefined"!==typeof module?module.exports=p():"function"===typeof define&&define.amd?define(p):t.calcite=p()})(this,function(){function t(L,T){var Y;for(Y=T;Y;Y=Y.parentNode){var ca=Y&&Y.getAttribute&&Y.getAttribute("class")||"";ca=(new RegExp("(\\s|^)"+L+"(\\s|$)")).test(ca);if(1===Y.nodeType&&ca)break}return Y}function p(L){return Array.isArray(L)?L:Array.prototype.slice.call(L)}
function x(L,T){var Y=(T||document).querySelectorAll(L);return p(Y)}function b(L,T){return(new RegExp("(\\s|^)"+T+"(\\s|$)")).test(L.getAttribute("class"))}function m(L,T){T.split(" ").forEach(function(Y){if(!b(L,Y)){var ca=L.getAttribute("class")||"";L.setAttribute("class",ca+" "+Y)}})}function f(L,T){T.split(" ").forEach(function(Y){var ca=(L.getAttribute("class")||"").replace(new RegExp("(\\s|^)"+Y+"(\\s|$)","g"),"$2");b(L,Y)&&L.setAttribute("class",ca)})}function d(L){L=p(L);L.forEach(function(T){f(T,
"is-active")})}function a(L,T){d(L);m(T,"is-active")}function c(L,T,Y){if(L.addEventListener)return L.addEventListener(T,Y,!1);if(L.attachEvent)return L.attachEvent("on"+T,Y)}function l(L,T,Y){if(L.removeEventListener)return L.removeEventListener(T,Y,!1);if(L.detachEvent)return L.detachEvent("on"+T,Y)}function h(L){if(L.preventDefault)return L.preventDefault();L.returnValue&&(L.returnValue=!1)}function n(L){L=L||window.event;if(L.stopPropagation)return L.stopPropagation();L.cancelBubble&&(L.cancelBubble=
!0)}function g(){}function e(L){for(var T="",Y=0;Y<L;Y++)T+=(65536*(1+Math.random())|0).toString(16).substring(1);return T}function k(L){if(!L)throw new TypeError("Invalid argument `value` has no value.");this.value=k.EMPTY;L&&L instanceof k?this.value=L.toString():L&&"[object String]"===Object.prototype.toString.call(L)&&k.isGuid(L)&&(this.value=L);this.equals=function(T){return k.isGuid(T)&&this.value===T};this.isEmpty=function(){return this.value===k.EMPTY};this.toString=function(){return this.value};
this.toJSON=function(){return this.value}}function w(L){n(L);L=t("accordion-section",L.target||L.srcElement);R.emit("accordion:toggle",{node:L})}function q(L){var T=L.node;b(T,"is-active")?f(T,"is-active"):m(T,"is-active");(L=L.node.querySelector(".accordion-title"))&&("true"===L.getAttribute("aria-expanded")?L.setAttribute("aria-expanded","false"):L.setAttribute("aria-expanded","true"))}function u(L){13!==L.keyCode&&32!==L.keyCode||!b(L.target||L.srcElement,"accordion-title")||(h(L),n(L),w(L))}function r(L){var T=
x(".js-accordion");L?v(L.node):T.forEach(function(Y){v(Y)})}function v(L){L.setAttribute("aria-live","polite");L.setAttribute("role","tablist");p(L.children).forEach(function(T){var Y=T.querySelector(".accordion-title"),ca=T.querySelector(".accordion-content"),Q=ca.id||k.raw();ca.id=Q;Y.setAttribute("role","tab");Y.setAttribute("tabindex","0");Y.setAttribute("aria-controls",Q);Y.setAttribute("aria-expanded",b(T,"is-active")?"true":"false");var X=!1;K.accordions.forEach(function(ha){ha.target===Y&&
"click"===ha.event&&ha.fn===w&&(X=!0)});X||(K.accordions.push({target:Y,event:"click",fn:w}),K.accordions.push({target:T,event:"keydown",fn:u}),c(Y,"click",w),c(T,"keydown",u))})}function z(){U||(R.on("accordion:bind",r),R.on("accordion:toggle",q),U=!0);R.emit("accordion:bind")}function B(L){l(document.body,"click",B);x(".js-dropdown").forEach(function(T){f(T,"is-active")});x(".js-dropdown-toggle").forEach(function(T){T.setAttribute("aria-expanded","false")});l(document,"keydown",D);l(document.body,
"focusin",A)}function A(L){L.target&&!t("js-dropdown",L.target)&&R.emit("dropdown:close")}function y(L){if(L){var T=b(L.node,"is-active");R.emit("dropdown:close");T||(m(L.node,"is-active"),L.target&&L.target.setAttribute("aria-expanded","true"),c(document,"keydown",D));b(L.node,"is-active")&&(c(document.body,"click",B),c(document.body,"focusin",A))}}function D(L){40===L.keyCode|38===L.keyCode&&L.preventDefault()}function G(L){x(".js-dropdown-toggle").forEach(function(T){var Y=!1;K.dropdowns.forEach(function(ca){ca.target===
T&&"click"===ca.event&&ca.fn===P&&(Y=!0)});Y||(K.dropdowns.push({target:T,event:"click",fn:P}),c(T,"click",P))})}function E(){var L=document.querySelector(".js-dropdown.is-active");return L?L:!1}function F(L){var T=L.links.indexOf(document.activeElement);-1===T?T=L.forward?0:L.links.length-1:L.forward?(T+=1,T===L.links.length&&(T=0)):(--T,-1===T&&(T=L.links.length-1));L.links[T].focus()}function I(){var L=E();L&&(L=x(".dropdown-link",L).filter(function(T){return null!==T.offsetParent}),R.emit("dropdown:focus",
{links:L,forward:!0}))}function M(){var L=E();L&&(L=x(".dropdown-link",L).filter(function(T){return null!==T.offsetParent}),R.emit("dropdown:focus",{links:L,forward:!1}))}function P(L){h(L);n(L);var T=t("js-dropdown",L.target);R.emit("dropdown:toggle",{node:T,target:L.target})}function W(){Z||(R.on("dropdown:toggle",y),R.on("dropdown:close",B),R.on("keyboard:escape",B),R.on("keyboard:arrow:down",I),R.on("keyboard:arrow:up",M),R.on("dropdown:focus",F),Z=!0);G()}function H(){R.on("scrolling:at",function(T){L.forEach(function(Y){var ca=
Y.element;b(Y.element,"is-sticky")&&(ca=Y.element.getAttribute("data-sticky-id"),ca=document.querySelector('.js-shim[data-sticky-id\x3d"'+ca+'"]'));if(ca){var Q=ca.getAttribute("data-top")||0;Y.top=ca.offsetTop-parseInt(Q,0)}Y.top<T?R.emit("sticky:stick",Y):R.emit("sticky:unstick",Y)})});R.on("sticky:stick",function(T){var Y=T.element.getAttribute("data-sticky-id"),ca=document.querySelector('.js-shim[data-sticky-id\x3d"'+Y+'"]');Y&&ca&&(m(T.element,"is-sticky"),ca.style.display="")});R.on("sticky:unstick",
function(T){var Y=T.element.getAttribute("data-sticky-id"),ca=document.querySelector('.js-shim[data-sticky-id\x3d"'+Y+'"]');Y&&ca&&(f(T.element,"is-sticky"),ca.style.display="none")});var L=x(".js-sticky").map(function(T){var Y=T.offsetTop,ca=T.getAttribute("data-top")||0;T.style.top=ca+"px";if(!T.getAttribute("data-sticky-id")){var Q=k.raw();T.setAttribute("data-sticky-id",Q);var X=T.parentNode,ha=T.cloneNode("deep");m(ha,"js-shim");f(ha,"js-sticky");ha.setAttribute("data-sticky-id",Q);ha.style.visibility=
"hidden";ha.style.display="none";X.insertBefore(ha,T)}return{top:Y-parseInt(ca,0),element:T}})}function O(){function L(Q){var X=Q.getAttribute("data-tab");if(X)return X;X=k.raw();Q.setAttribute("data-tab",X);return X}function T(Q){var X=Q.target;b(X,"js-tab")||(X=Q.currentTarget);Q=t("js-tab-group",X);var ha=L(Q);return{parent:Q,id:ha,active:X}}function Y(Q){Q.preventDefault();Q=T(Q);R.emit("tabs:active",Q)}function ca(Q){var X=T(Q);if(13===Q.keyCode||32===Q.keyCode)Q.preventDefault(),R.emit("tabs:active",
X);if(39===Q.keyCode||37===Q.keyCode){var ha=p(X.parent.querySelectorAll(".js-tab")),ja=ha.indexOf(document.activeElement);-1<ja&&b(document.activeElement,"js-tab")&&(X=ha[ja+1]||ha[0],ha=ha[ja-1]||ha[ha.length-1],(39===Q.keyCode?X:ha).focus())}}R.on("tabs:bind",function(){var Q=x(".js-tab"),X=x(".js-tab-group"),ha=x(".js-tab-section");X.forEach(function(ja){ja.setAttribute("aria-live","polite");L(ja);ja.children[0].setAttribute("role","tablist");ja=ja.querySelectorAll(".js-tab");for(var aa=100/ja.length,
la=0;la<ja.length;la++)ja[la].style.maxWidth=aa+"%"});Q.forEach(function(ja){ja.setAttribute("aria-expanded","false");ja.setAttribute("role","tab");ja.setAttribute("tabindex","0");c(ja,"click",Y);c(ja,"keydown",ca)});ha.forEach(function(ja){ja.setAttribute("role","tabpanel");b(ja,"is-active")?ja.setAttribute("aria-expanded",!0):ja.setAttribute("aria-expanded",!1)})});R.on("tabs:active",function(Q){var X=Q.parent,ha=p(X.querySelectorAll(".js-tab"));Q=Q.active;X=p(X.querySelectorAll(".js-tab-section"));
var ja=ha.indexOf(Q);ja=X[ja];ha.forEach(function(aa){aa.setAttribute("aria-expanded",!1)});Q.setAttribute("aria-expanded",!0);a(ha,Q);X.forEach(function(aa){aa.setAttribute("aria-expanded",!1)});ja.setAttribute("aria-expanded",!0);a(X,ja);Q.focus()});R.emit("tabs:bind")}var K={dropdowns:[],accordions:[],modals:[]};g.prototype={on:function(L,T,Y){var ca=this.e||(this.e={});(ca[L]||(ca[L]=[])).push({fn:T,ctx:Y});return this},once:function(L,T,Y){function ca(){Q.off(L,ca);T.apply(Y,arguments)}var Q=
this;ca._=T;return this.on(L,ca,Y)},emit:function(L){var T=[].slice.call(arguments,1),Y=((this.e||(this.e={}))[L]||[]).slice(),ca=0,Q=Y.length;for(ca;ca<Q;ca++)Y[ca].fn.apply(Y[ca].ctx,T);return this},off:function(L,T){var Y=this.e||(this.e={}),ca=Y[L],Q=[];if(ca&&T)for(var X=0,ha=ca.length;X<ha;X++)ca[X].fn!==T&&ca[X].fn._!==T&&Q.push(ca[X]);Q.length?Y[L]=Q:delete Y[L];return this}};var R=new g,da=/^[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$/i;k.EMPTY="00000000-0000-0000-0000-000000000000";
k.isGuid=function(L){return L&&(L instanceof k||da.test(L.toString()))};k.create=function(){return new k([e(2),e(1),e(1),e(1),e(3)].join("-"))};k.raw=function(){return[e(2),e(1),e(1),e(1),e(3)].join("-")};var U=!1,Z=!1;c(document,"keyup",function(L){27===L.keyCode?R.emit("keyboard:escape"):13===L.keyCode?R.emit("keyboard:return"):32===L.keyCode?R.emit("keyboard:space"):38===L.keyCode?R.emit("keyboard:arrow:up"):40===L.keyCode?R.emit("keyboard:arrow:down"):37===L.keyCode?R.emit("keyboard:arrow:left"):
39===L.keyCode&&R.emit("keyboard:arrow:right")});c(window,"scroll",function(L,T,Y){var ca,Q,X;var ha=function(){ca=!1;Q&&(X.apply(Y,Q),Q=!1)};return X=function(){ca?Q=arguments:(L.apply(Y,arguments),setTimeout(ha,T),ca=!0)}}(function(){R.emit("scrolling:at",window.pageYOffset)},100));return{bus:R,accordion:z,dropdown:W,sticky:H,tabs:O,init:function(){[z,W,H,O].forEach(function(L){L()})}}})},"arcgisonline/sharing/dijit/dialog/MembershipRequestsDlg":function(){define("require esri/declare esri/Evented dojo/_base/lang dojo/_base/array dojo/on dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-style dojo/query dojo/string dojo/topic dojo/date/locale dojo/store/Memory dijit/a11yclick dijit/Dialog dijit/form/Button dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin ../../../esriGeowConfig ../../../pages/utils/icons ../../util ../Grid ./GeneralDlg dojo/i18n!arcgisonline/nls/arcgisonline dojo/text!arcgisonline/sharing/dijit/dialog/templates/MembershipRequestsDlg.html".split(" "),
function(t,p,x,b,m,f,d,a,c,l,h,n,g,e,k,w,q,u,r,v,z,B,A,y,D,G,E,F){var I=p("arcgisonline.sharing.dijit.dialog.MembershipRequestsDlg",[r,v,z,x],{baseClass:"esriMembershipRequestsDlg",widgetsInTemplate:!0,templateString:F,groupId:null,postMixInProperties:function(){this.inherited(arguments);this.i18n=b.mixin({},E.common);b.mixin(this.i18n,E.membershipRequestsDlg);b.mixin(this.i18n,E.groupMembershipRequestsGrid);b.mixin(this.i18n,{error:E.inviteUsersDlg.error})},postCreate:function(){this.loadConnections()},
loadConnections:function(){this.own(h(".jevent").on("click",function(M){M.preventDefault()}),w(this._closeBtn,b.hitch(this,function(){this._dialog.hide()})),g.subscribe("onApplicationAccept",b.hitch(this,"onApplicationApprove")),g.subscribe("onApplicationDecline",b.hitch(this,"onApplicationDecline")))},show:function(M){this.groupId=M;this.clearStore();this.requestApplications();this._dialog.show()},approveApplication:function(M,P){var W=y.getUser(),H=this._requestsGrid._grid.store;W&&y.request({url:B.restBaseUrl+
"community/groups/"+this.groupId+"/applications/"+P+"/accept"},{usePost:!0}).then(b.hitch(this,function(){H.remove(M.id);g.publish("onApplicationAccept",{})}),b.hitch(this,function(){var O=new G;f.once(O._dialog,"hide",function(){O._dialog.destroyRecursive();O.destroyRecursive()});O.show({title:this.i18n.errorTitle,message:n.substitute(this.i18n.error.unableToAddPrivs,{user:P})});H.remove(M.id);g.publish("onApplicationAccept",{})}))},declineApplication:function(M,P){var W=y.getUser(),H=this._requestsGrid._grid.store;
W&&y.request({url:B.restBaseUrl+"community/groups/"+this.groupId+"/applications/"+P+"/decline"},{usePost:!0}).then(b.hitch(this,function(){H.remove(M.id);g.publish("onApplicationDecline",{})}))},onApplicationApprove:function(){0===this._requestsGrid._grid.store.query().length?this.hide():this.refresh()},onApplicationDecline:function(){0===this._requestsGrid._grid.store.query().length?this.hide():this.refresh()},requestApplications:function(){var M=this._requestsGrid._grid.store;return y.request({url:B.restBaseUrl+
"community/groups/"+this.groupId+"/applications"}).then(b.hitch(this,function(P){P.applications&&(m.forEach(P.applications,function(W,H){W.id=H;M.put(W)}),this.refresh())}))},clearStore:function(){this._requestsGrid||this.createGrid();var M=this._requestsGrid&&this._requestsGrid._grid&&this._requestsGrid._grid.store||void 0;M&&m.forEach(b.clone(M.query()),function(P){M.remove(P.id)})},createGrid:function(){this._requestsGrid=new D({id:"requestsGrid",columns:this.getRequestGridColumns(),noDataMessage:this.i18n.noMembershipRequests,
showLoadingMessage:!1,showHeader:!1,showFooter:!1,selectionMode:"none",rowsPerPage:5,className:"requests-grid",store:new k({idProperty:"id",label:"fullname",data:[]}),sort:[{attribute:"received",descending:!1}]},this._requestsGridContainer);this._requestsGrid.startup();h(".dgrid-status").forEach(function(M){M.tabIndex=-1;a.add(M,"left")})},getRequestGridColumns:function(){return{fullname:{label:" ",sortable:!1,formatter:b.hitch(this,function(M){return M})},username:{label:" ",sortable:!1,formatter:b.hitch(this,
function(M){return M})},received:{label:" ",sortable:!1,formatter:b.hitch(this,function(M){M=new Date(parseFloat(M));return e.format(M,{selector:"date",formatLength:"long"})})},yourResponse:{label:" ",sortable:!1,renderCell:b.hitch(this,function(M){var P=M.username,W=c.create("div",{className:"esriFloatTrailing"}),H=c.create("button",{innerHTML:"\x3cspan class\x3d'text-green'\x3e"+A.inline.check["16"]+"\x3c/span\x3e"+this.i18n.approve,className:"btn-link btn-link-off-black clickable margin-right-1"},
W),O=c.create("button",{innerHTML:"\x3cspan class\x3d'text-red'\x3e"+A.inline["minus-circle"]["16"]+"\x3c/span\x3e"+this.i18n.decline,className:"btn-link btn-link-off-black clickable"},W);this.own(w(H,b.hitch(this,"approveApplication",M,P)),w(O,b.hitch(this,"declineApplication",M,P)));return W})}}},hide:function(){this._dialog.hide()},refresh:function(){if(this._requestsGrid._grid&&this._requestsGrid._grid._started){var M=this._requestsGrid._grid._currentPage||1,P=this._requestsGrid._grid.store?this._requestsGrid._grid.store.query().length:
0;f.once(this._requestsGrid._grid,"dgrid-refresh-complete",function(W){W.grid._currentPage!==M&&0<P&&W.grid.gotoPage(M)});this._requestsGrid._grid.resize();this._requestsGrid._grid.refresh()}}});I.prototype.statics={getInstance:function(){this._instance||(this._instance=new I);return this._instance}};return I})},"arcgisonline/sharing/dijit/dialog/RendererDlg":function(){define(["dojo","dijit","dojox","dojo/require!dijit/_Widget,dijit/_Templated,dijit/Dialog,arcgisonline/sharing/dijit/dialog/SymbolDlg"],
function(t,p,x){t.provide("arcgisonline.sharing.dijit.dialog.RendererDlg");t.require("dijit._Widget");t.require("dijit._Templated");t.require("dijit.Dialog");t.require("arcgisonline.sharing.dijit.dialog.SymbolDlg");t.declare("arcgisonline.sharing.dijit.dialog.RendererDlg",[p._Widget,p._Templated],{util:arcgisonline.sharing.util,folder:arcgisonline.sharing.geow.Folder,widgetsInTemplate:!0,templateString:'\x3cdiv class\x3d"widgetContainer"\x3e\r\n  \x3cdiv dojotype\x3d"dijit.Dialog" id\x3d"renderer-dialog" title\x3d"${i18n.rendererDlgTitle}" execute\x3d""\x3e\r\n  \t\r\n    \x3cdiv\x3e\r\n      \x3ctable cellspacing\x3d"10" width\x3d"100%"\x3e\x3ctbody\x3e\r\n\t\t\t\x3ctr\x3e\x3ctd\x3e\r\n        \x3clabel\x3e${i18n.labelLabel}\x3c/label\x3e\r\n      \x3c/td\x3e\x3ctd\x3e\r\n        \x3cdiv dojoAttachPoint\x3d"rendererLabel" dojotype\x3d"dijit.form.TextBox" trim\x3d"true" required\x3d"true" style\x3d"width:100%; padding:2px;"\x3e\x3c/div\x3e\r\n      \x3c/td\x3e\x3c/tr\x3e\r\n      \x3ctr\x3e\x3ctd\x3e\r\n        \x3clabel\x3e${i18n.valueLabel}\x3c/label\x3e\r\n      \x3c/td\x3e\x3ctd\x3e\r\n        \x3clabel id\x3d"renderer-value"\x3e\x3c/label\x3e\r\n      \x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\x3c/table\x3e\r\n      \x3cdiv\x3e\r\n        \x3cbutton dojotype\x3d"dijit.form.Button" type\x3d"button" dojoAttachPoint\x3d"_rendererSymbolUpdateButton" class\x3d"default esriFloatLeading" dojoAttachEvent\x3d"onClick:_onRendererSymbolUpdateButtonClick"\x3e\r\n          \x3cspan\x3e${i18n.changeSymbolBtn}\x3c/span\x3e\r\n        \x3c/button\x3e\r\n        \x3cbutton dojoAttachEvent\x3d"onClick:_onCancelClick" dojoAttachPoint\x3d"rendererCancelBtn" class\x3d"jevent cancel esriFloatTrailing" type\x3d"cancel" dojotype\x3d"dijit.form.Button"\x3e\r\n          ${i18n.cancel}\r\n        \x3c/button\x3e\r\n        \x3cbutton dojoAttachEvent\x3d"onClick:_onOkClick" dojoAttachPoint\x3d"rendererOkBtn" class\x3d"jevent primary esriFloatTrailing" dojotype\x3d"dijit.form.Button"\x3e\r\n          ${i18n.ok}\r\n        \x3c/button\x3e\r\n\t\t\t\x3c/div\x3e\r\n      \x3cdiv style\x3d"clear:both;"\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\t\t\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
i18n:null,symbol:null,onRendererSymbolChangeHandler:null,onRendererSymbolChangeCancelHandler:null,applyRendererEditsHandler:null,statics:{_instance:null,getInstance:function(){null==this._instance&&(this._instance=new arcgisonline.sharing.dijit.dialog.RendererDlg);return this._instance}},postMixInProperties:function(){this.inherited(arguments);this.i18n=t.clone(t.i18n.getLocalization("arcgisonline","arcgisonline").common);t.mixin(this.i18n,t.i18n.getLocalization("arcgisonline","arcgisonline").rendererPanel);
t.mixin(this.i18n,t.i18n.getLocalization("arcgisonline","arcgisonline").rendererDlg)},postCreate:function(){this.loadConnections()},show:function(b){this.symbol=esri.symbol.fromJson(b.symbol.toJson());null===b.value?t.byId("renderer-value").innerHTML=this.i18n.other:t.byId("renderer-value").innerHTML=b.value;this.rendererLabel.set("value",b.label);this.applyRendererEditsHandler=t.subscribe("applyRendererEdits",t.hitch(this,"_onApplyEdits"));p.byId("renderer-dialog").show()},loadConnections:function(){t.query(".jevent").connect("onclick",
function(b){b.preventDefault()})},_onCancelClick:function(){t.publish("onRendererItemChange",[null,null]);p.byId("renderer-dialog").hide()},hide:function(){this.onRendererSymbolChangeHandler&&(t.unsubscribe(this.onRendererSymbolChangeHandler),t.unsubscribe(this.onRendererSymbolChangeCancelHandler));this.applyRendererEditsHandler&&t.unsubscribe(this.applyRendererEditsHandler);this.rendererCancelBtn.set("disabled",!1);this._rendererSymbolUpdateButton.set("disabled",!1);p.byId("renderer-dialog").hide()},
_onRendererSymbolUpdateButtonClick:function(b){this.onRendererSymbolChangeHandler&&(t.unsubscribe(this.onRendererSymbolChangeHandler),t.unsubscribe(this.onRendererSymbolChangeCancelHandler));this.onRendererSymbolChangeHandler=t.subscribe("onSymbolChange",t.hitch(this,"_onRendererSymbolChange"));this.onRendererSymbolChangeCancelHandler=t.subscribe("onSymbolChangeCancel",t.hitch(this,function(){this.onRendererSymbolChangeHandler&&(t.unsubscribe(this.onRendererSymbolChangeHandler),t.unsubscribe(this.onRendererSymbolChangeCancelHandler));
this.rendererCancelBtn.set("disabled",!1);this._rendererSymbolUpdateButton.set("disabled",!1)}));this.rendererCancelBtn.set("disabled",!0);this._rendererSymbolUpdateButton.set("disabled",!0);arcgisonline.sharing.dijit.dialog.SymbolDlg.prototype.statics.getInstance().showSymbol(this.symbol,{applyHandler:t.hitch(this,"_onApplyEdits"),okHandler:t.hitch(this,function(m){this._rendererSymbolUpdateButton.set("disabled",!1);this.symbol=m;t.publish("onRendererItemChange",[m,this.rendererLabel.get("value")]);
t.publish("saveRenderer",[])})})},_onRendererSymbolChange:function(b){this.rendererCancelBtn.set("disabled",!1);this._rendererSymbolUpdateButton.set("disabled",!1);var m=b.toJson();"esriPMS"!=b.type||0!=m.url.length&&"http://"!=m.url||(b=esri.symbol.fromJson(this.markerJson));this.symbol=b},_onOkClick:function(b){b.preventDefault();t.publish("onRendererItemChange",[esri.symbol.fromJson(this.symbol.toJson()),this.rendererLabel.get("value")]);this.hide()},_onApplyEdits:function(b){t.publish("onRendererItemChange",
[b,this.rendererLabel.get("value")]);t.publish("saveRenderer",[])},onKeyDown:function(b){if(window.event)var m=b.keyCode;else b.which&&(m=b.which);13==m&&this._onOkClick(b)}})})},"arcgisonline/sharing/dijit/dialog/SymbolDlg":function(){define(["dojo","dijit","dojox","dojo/require!dijit/Dialog,dijit/_Widget,dijit/_Templated,arcgisonline/sharing/dijit/SymbolOptions"],function(t,p,x){t.provide("arcgisonline.sharing.dijit.dialog.SymbolDlg");t.require("dijit.Dialog");t.require("dijit._Widget");t.require("dijit._Templated");
t.require("arcgisonline.sharing.dijit.SymbolOptions");t.declare("arcgisonline.sharing.dijit.dialog.SymbolDlg",[p._Widget,p._Templated],{widgetsInTemplate:!0,templateString:'\x3cdiv class\x3d"widgetContent" \x3e\r\n  \x3cdiv dojotype\x3d"dijit.Dialog" id\x3d"symbol-dialog" title\x3d"${i18n.symbolDlgTitle}" execute\x3d""\x3e\r\n\t  \x3cdiv id\x3d"symbol-dialog-symboloptions" dojotype\x3d"arcgisonline.sharing.dijit.SymbolOptions" dojoAttachPoint\x3d"symbolOptions"\x3e\x3c/div\x3e\r\n    \x3cdiv\x3e\r\n      \x3cbutton dojoAttachPoint\x3d"cancelButton" dojoAttachEvent\x3d"onClick:onCancelClick" class\x3d"jevent cancel esriFloatTrailing" dojoType\x3d"dijit.form.Button"\x3e${i18n.cancel}\x3c/button\x3e\r\n      \x3cbutton id\x3d"symbol-dialog-apply" dojoAttachPoint\x3d"applyButton" dojoAttachEvent\x3d"onClick:onApplyClick" class\x3d"jevent cancel esriFloatTrailing" dojoType\x3d"dijit.form.Button"\x3e${i18n.apply}\x3c/button\x3e\r\n  \t  \x3cbutton id\x3d"symbol-dialog-done" dojoAttachEvent\x3d"onClick:onDoneClick" class\x3d"jevent primary esriFloatTrailing" dojoType\x3d"dijit.form.Button"\x3e${i18n.done}\x3c/button\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv style\x3d"clear:both;"\x3e\r\n    \x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
i18n:null,applyHandler:null,okHandler:null,statics:{_instance:null,getInstance:function(){null==this._instance&&(this._instance=new arcgisonline.sharing.dijit.dialog.SymbolDlg);return this._instance}},postMixInProperties:function(){this.inherited(arguments);this.i18n=t.clone(t.i18n.getLocalization("arcgisonline","arcgisonline").common);t.mixin(this.i18n,t.i18n.getLocalization("arcgisonline","arcgisonline").symbolDlg)},show:function(b,m){this.cancelButton.set("disabled",!1);var f=b.getLayer();if(b.symbol)this.symbolOptions.symbol=
esri.symbol.fromJson(b.symbol.toJson());else{var d=f.renderer.getSymbol(b);this.symbolOptions.symbol=esri.symbol.fromJson(d.toJson())}for(d=0;d<f.types.length;d++)if(f.types[d].id==b.attributes.TYPEID&&f.types[d].templates&&0<f.types[d].templates.length){this.symbolOptions.template=f.types[d].templates[0];break}m?(this.symbolOptions.endSize=m.endSize,this.symbolOptions.showEndSize=0<m.endSize?!0:!1,this.symbolOptions.showNoBgColor=m.showNoBgColor,this.applyHandler=m.applyHandler,this.okHandler=m.okHandler):
(this.symbolOptions.endSize=0,this.symbolOptions.showEndSize=!1,this.symbolOptions.showNoBgColor=!1,this.okHandler=this.applyHandler=null);this.symbolOptions.init(m?m.noPreDefSymbols:null);p.byId("symbol-dialog").show()},showSymbol:function(b,m){this.cancelButton.set("disabled",!1);this.symbolOptions.symbol=esri.symbol.fromJson(b.toJson());this.symbolOptions.symbol.color||(this.symbolOptions.symbol.color=new t.Color([255,255,255,0]));m?(this.symbolOptions.endSize=m.endSize,this.symbolOptions.showEndSize=
0<m.endSize?!0:!1,this.symbolOptions.showNoBgColor=m.showNoBgColor,this.applyHandler=m.applyHandler,this.okHandler=m.okHandler):(this.symbolOptions.endSize=0,this.symbolOptions.showEndSize=!1,this.symbolOptions.showNoBgColor=!1,this.okHandler=this.applyHandler=null);this.symbolOptions.init(m?m.noPreDefSymbols:null);p.byId("symbol-dialog").show()},hide:function(){this.symbolOptions.hide();p.byId("symbol-dialog").hide()},onDoneClick:function(b){"picturemarkersymbol"===this.symbolOptions.symbol.type&&
8>this.symbolOptions.symbol.url.length||setTimeout(t.hitch(this,function(){var m=0;this.symbolOptions.urlChangesNotApplied&&(m=6E3);setTimeout(t.hitch(this,function(){if(this.okHandler){var f=this.symbolOptions.symbol.toJson();"esriPMS"!=this.symbolOptions.symbol.type||0!=f.url.length&&"http://"!=f.url||(this.symbolOptions.symbol=this.getMarkerJson());this.okHandler(esri.symbol.fromJson(this.symbolOptions.symbol.toJson()))}else this.symbolOptions.showEndSize?t.publish("onSymbolChange",[esri.symbol.fromJson(this.symbolOptions.symbol.toJson()),
this.symbolOptions.endSize]):t.publish("onSymbolChange",[esri.symbol.fromJson(this.symbolOptions.symbol.toJson())]),setTimeout(t.hitch(this,function(){t.publish("applyRendererEdits",[])}),500);this.hide()}),m)}),100)},onApplyClick:function(b){"picturemarkersymbol"===this.symbolOptions.symbol.type&&8>this.symbolOptions.symbol.url.length||setTimeout(t.hitch(this,function(){var m=0;this.symbolOptions.urlChangesNotApplied&&(m=6E3);setTimeout(t.hitch(this,function(){if(this.applyHandler){var f=this.symbolOptions.symbol.toJson();
"esriPMS"!=this.symbolOptions.symbol.type&&"picturemarkersymbol"!=this.symbolOptions.symbol.type||0!=f.url.length&&"http://"!=f.url||(this.symbolOptions.symbol=this.getMarkerJson());this.applyHandler(esri.symbol.fromJson(this.symbolOptions.symbol.toJson()));this.cancelButton.set("disabled",!0)}else this.symbolOptions.showEndSize?t.publish("onSymbolChange",[esri.symbol.fromJson(this.symbolOptions.symbol.toJson()),this.symbolOptions.endSize]):t.publish("onSymbolChange",[esri.symbol.fromJson(this.symbolOptions.symbol.toJson())]),
setTimeout(t.hitch(this,function(){t.publish("applyRendererEdits",[]);this.cancelButton.set("disabled",!0)}),500)}),m)}),100)},onCancelClick:function(b){t.publish("onSymbolChangeCancel",[]);this.hide()}})})},"arcgisonline/sharing/dijit/SymbolOptions":function(){define(["dojo","dijit","dojox","dojo/require!dijit/_Widget,dijit/_Templated,dijit/ColorPalette,dijit/form/HorizontalSlider,arcgisonline/sharing/dijit/dialog/ImgDlg,arcgisonline/sharing/dijit/dialog/GeneralDlg,arcgisonline/sharing/util"],function(t,
p,x){t.provide("arcgisonline.sharing.dijit.SymbolOptions");t.require("dijit._Widget");t.require("dijit._Templated");t.require("dijit.ColorPalette");t.require("dijit.form.HorizontalSlider");t.require("arcgisonline.sharing.dijit.dialog.ImgDlg");t.require("arcgisonline.sharing.dijit.dialog.GeneralDlg");t.require("arcgisonline.sharing.util");t.declare("arcgisonline.sharing.dijit.SymbolOptions",[p._Widget,p._Templated],{widgetsInTemplate:!0,templateString:'\x3cdiv\x3e\r\n  \x3ctable class\x3d"symbolDialogTable"\x3e\r\n   \x3ctbody\x3e\r\n    \x3ctr\x3e \r\n      \x3ctd valign\x3d"top"\x3e\r\n        \x3cdiv\x3e\x3clabel\x3e${i18n.previewLabel}\x3c/label\x3e\x3c/div\x3e\r\n      \x3c/td\x3e\r\n      \x3ctd colspan\x3d"2" valign\x3d"middle" align\x3d"left"\x3e\r\n        \x3cdiv dojoAttachPoint\x3d"symbolImage" style\x3d"height:100%; vertical-align:middle;"\x3e\x3c/div\x3e\r\n      \x3c/td\x3e   \r\n    \x3c/tr\x3e\r\n    \x3ctr\x3e \r\n      \x3ctd colspan\x3d"3" valign\x3d"top"\x3e\r\n        \x3cdiv dojoAttachPoint\x3d"symbolSmallTemplatePicker" style\x3d"display:none;"\x3e\r\n          \x3cdiv dojoAttachPoint\x3d"symbolSimpleMarkerTemplatePickerDiv" class\x3d"symbolTemplatePicker" style\x3d"height:50px; width:350px;"\x3e\r\n            \x3cdiv id\x3d"${id}_symbolSimpleMarkerTemplatePicker"\x3e\x3c/div\x3e  \r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv dojoAttachPoint\x3d"symbolFullTemplatePicker" style\x3d"display:none;"\x3e\r\n          \x3cdiv dojoAttachPoint\x3d"symbolClassesDiv" style\x3d"width:355px;line-height:normal;"\x3e\r\n            \x3cselect dojoAttachPoint\x3d"symbolColorClasses" style\x3d"width:355px;margin:0;" dojoType\x3d"arcgisonline.sharing.dijit.ComboBox"\x3e\r\n            \x3c/select\x3e       \r\n          \x3c/div\x3e\r\n          \x3cdiv dojoAttachPoint\x3d"symbolClassesTemplatePickerDiv" class\x3d"symbolTemplatePicker" style\x3d"height:130px; width:350px;"\x3e\r\n            \x3cdiv id\x3d"${id}_symbolClassesTemplatePicker" \x3e\x3c/div\x3e  \r\n          \x3c/div\x3e\r\n          \x3cdiv dojoAttachPoint\x3d"symbolAddImageDiv" class\x3d"esriItemLinks" style\x3d"line-height:20px;"\x3e\r\n            \x3cA dojoAttachPoint\x3d"symbolAddImage" href\x3d"JavaScript:void(0);"\x3e${i18n.addImage}\x3c/A\x3e  \r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/td\x3e   \r\n    \x3c/tr\x3e\r\n    \x3ctr dojoAttachPoint\x3d"symbolSizeRow"\x3e \r\n      \x3ctd nowrap\x3e\x3clabel dojoAttachPoint\x3d"symbolSizeLabel"\x3e${i18n.symbolSizeLabel}\x3c/label\x3e\x3c/td\x3e\r\n      \x3ctd\x3e\x3cdiv dojoAttachPoint\x3d"symbolSize" dojoType\x3d"dijit.form.HorizontalSlider" class\x3d"symbolSlider" showbuttons\x3d"false" intermediatechanges\x3d"false" minimum\x3d"1" maximum\x3d"120" value\x3d"1" discretevalues\x3d"1" \x3e\x3c/div\x3e\x3c/td\x3e\r\n      \x3ctd valign\x3d"top"\x3e\r\n        \x3cdiv dojoAttachPoint\x3d"symbolSizeInput" dojotype\x3d"dijit.form.TextBox" trim\x3d"true" style\x3d"width:30px;margin-bottom:3px;"\x3e\x3c/div\x3e\r\n        \x3cdiv style\x3d"display:inline;"\x3e${i18n.shortForPixel}\x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr dojoAttachPoint\x3d"symbolEndSizeRow"\x3e \r\n      \x3ctd nowrap\x3e\x3clabel\x3e${i18n.symbolEndSizeLabel}\x3c/label\x3e\x3c/td\x3e\r\n      \x3ctd\x3e\x3cdiv dojoAttachPoint\x3d"symbolEndSize" dojoType\x3d"dijit.form.HorizontalSlider" class\x3d"symbolSlider" showbuttons\x3d"false" intermediatechanges\x3d"false" minimum\x3d"1" maximum\x3d"120" value\x3d"1" discretevalues\x3d"1" \x3e\x3c/div\x3e\x3c/td\x3e\r\n      \x3ctd valign\x3d"top"\x3e\r\n        \x3cdiv dojoAttachPoint\x3d"symbolEndSizeInput" dojotype\x3d"dijit.form.TextBox" trim\x3d"true" style\x3d"width:30px;margin-bottom:3px;"\x3e\x3c/div\x3e\r\n        \x3cdiv style\x3d"display:inline;"\x3e${i18n.shortForPixel}\x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr dojoAttachPoint\x3d"symbolBackgroundColorRow"\x3e\r\n      \x3ctd\x3e\x3clabel\x3e${i18n.colorLabel}\x3c/label\x3e\x3c/td\x3e\r\n      \x3ctd colspan\x3d"2"\x3e\x3cdiv dojoAttachPoint\x3d"symbolBackgroundColor" class\x3d"symbolColorBox"\x3e\x3c/div\x3e\x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr dojoAttachPoint\x3d"symbolLinePatternRow"\x3e\r\n      \x3ctd\x3e\x3clabel\x3e${i18n.patternLabel}\x3c/label\x3e\x3c/td\x3e\r\n      \x3ctd colspan\x3d"2"\x3e\r\n        \x3cdiv\x3e\r\n          \x3cselect dojoAttachPoint\x3d"symbolLinePatternSelect" id\x3d"symbolLinePatternSelect" dojoType\x3d"dijit.form.Select" class\x3d"symbolLinePatternSelect"\x3e\r\n          \x3c/select\x3e\r\n        \x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr dojoAttachPoint\x3d"symbolTransparencyRow"\x3e\r\n      \x3ctd\x3e\x3clabel\x3e${i18n.transparencyLabel}\x3c/label\x3e\x3c/td\x3e\r\n      \x3ctd width\x3d"125" valign\x3d"top"\x3e\r\n        \x3cdiv dojoAttachPoint\x3d"symbolTransparency" dojoType\x3d"dijit.form.HorizontalSlider" class\x3d"symbolSlider" style\x3d"line-height:normal;margin-top:7px;" showbuttons\x3d"false" intermediatechanges\x3d"true" minimum\x3d"0" maximum\x3d"1" value\x3d"0" discretevalues\x3d"0.01" \x3e\r\n          \x3cdiv dojoType\x3d"dijit.form.HorizontalRule" container\x3d"bottomDecoration" count\x3d"2" style\x3d"height:5px;"\x3e\x3c/div\x3e\r\n          \x3col dojoType\x3d"dijit.form.HorizontalRuleLabels" container\x3d"bottomDecoration" style\x3d"font-size:0.8em;"\x3e\r\n            \x3cli\x3e0\x3c/li\x3e\x3cli\x3e100%\x3c/li\x3e\r\n          \x3c/ol\x3e\r\n        \x3c/div\x3e\r\n      \x3c/td\x3e\r\n      \x3ctd\x3e\r\n        \x3cdiv dojoAttachPoint\x3d"symbolTransparencyInput" dojotype\x3d"dijit.form.TextBox" trim\x3d"true" style\x3d"width:30px;margin-bottom:3px;"\x3e\x3c/div\x3e\r\n        \x3cdiv style\x3d"display:inline;"\x3e%\x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr dojoAttachPoint\x3d"symbolOutlineColorRow"\x3e\r\n      \x3ctd\x3e\x3clabel\x3e${i18n.outlineColorLabel}\x3c/label\x3e\x3c/td\x3e\r\n      \x3ctd colspan\x3d"2"\x3e\x3cdiv dojoAttachPoint\x3d"symbolOutlineColor" class\x3d"symbolColorBox"\x3e\x3c/div\x3e\x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr dojoAttachPoint\x3d"symbolWidthRow"\x3e \r\n      \x3ctd\x3e\x3clabel dojoAttachPoint\x3d"symbolWidthLabel" \x3e${i18n.outlineWidthLabel}\x3c/label\x3e\x3c/td\x3e\r\n      \x3ctd\x3e\x3cdiv dojoAttachPoint\x3d"symbolWidth" dojoType\x3d"dijit.form.HorizontalSlider" class\x3d"symbolSlider" showbuttons\x3d"false" intermediatechanges\x3d"true" minimum\x3d"0" maximum\x3d"18" value\x3d"1" discretevalues\x3d"1" \x3e\x3c/div\x3e\x3c/td\x3e\r\n      \x3ctd\x3e\r\n        \x3cdiv dojoAttachPoint\x3d"symbolWidthInput" dojotype\x3d"dijit.form.TextBox" trim\x3d"true" style\x3d"width:30px;margin-bottom:3px;"\x3e\x3c/div\x3e\r\n        \x3cdiv style\x3d"display:inline;"\x3e${i18n.shortForPixel}\x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr dojoAttachPoint\x3d"symbolEndWidthRow"\x3e \r\n      \x3ctd nowrap\x3e\x3clabel\x3e${i18n.symbolEndWidthLabel}\x3c/label\x3e\x3c/td\x3e\r\n      \x3ctd\x3e\x3cdiv dojoAttachPoint\x3d"symbolEndWidth" dojoType\x3d"dijit.form.HorizontalSlider" class\x3d"symbolSlider" showbuttons\x3d"false" intermediatechanges\x3d"false" minimum\x3d"1" maximum\x3d"18" value\x3d"1" discretevalues\x3d"1" \x3e\x3c/div\x3e\x3c/td\x3e\r\n      \x3ctd valign\x3d"top"\x3e\r\n        \x3cdiv dojoAttachPoint\x3d"symbolEndWidthInput" dojotype\x3d"dijit.form.TextBox" trim\x3d"true" style\x3d"width:30px;margin-bottom:3px;"\x3e\x3c/div\x3e\r\n        \x3cdiv style\x3d"display:inline;"\x3e${i18n.shortForPixel}\x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n   \x3c/tbody\x3e\r\n  \x3c/table\x3e                \r\n\r\n  \x3cimg id\x3d"${id}_testImage" style\x3d"position:absolute;top:0;left:-3000px"/\x3e\r\n\r\n  \x3cdiv dojoAttachPoint\x3d"symbolColorTooltip" dojotype\x3d"dijit.TooltipDialog" title\x3d"" style\x3d"display:none; width:265px;"\x3e\r\n    \x3cdiv class\x3d"esriFloatTrailing"\x3e\x3cA class\x3d"symbolColorPaletteClose" dojoAttachPoint\x3d"symbolColorTooltipClose" href\x3d"JavaScript:void(0);" title\x3d"${i18n.close}"\x3e\x3c/A\x3e\x3c/div\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"symbolColorPalette" style\x3d"margin-top: 7px;" dojotype\x3d"dijit.ColorPalette" palette\x3d"7x10" dojoAttachEvent\x3d"onChange:onColorSelection"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \r\n\x3c/div\x3e\r\n',
i18n:null,symbol:null,template:null,colorPicker:"",savedSimpleMarkerSymbol:null,savedPictureMarkerSymbol:null,eventHandlers:null,testImageHandler:null,symbolListItems:null,symbolClassesTemplatePicker:null,simpleMarkerTemplatePicker:null,templatePickerOnSelectionChangeHandler:null,simpleMarkerTemplatePickerOnSelectionChangeHandler:null,templatePickerSymbolClass:null,symbolClassStore:null,urlChangesNotApplied:!1,cachedImages:[],onImageChangeHandler:null,showEndSize:!1,showNoBgColor:!1,endSize:0,simpleMarkerSymbols:[{name:"Circle",
type:"esriSMS",style:"esriSMSCircle",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"Square",type:"esriSMS",style:"esriSMSSquare",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"Diamond",type:"esriSMS",style:"esriSMSDiamond",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"Cross",type:"esriSMS",style:"esriSMSCross",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"X",type:"esriSMS",style:"esriSMSX",
color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}}],markerJson:{type:"esriPMS",url:"/Symbols/Basic/RedSphere.png",imageData:"iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAGXRFWHRTb2Z0d2FyZQBQYWludC5ORVQgdjMuNS4xTuc4+QAAB3VJREFUeF7tmPlTlEcexnve94U5mANQbgQSbgiHXHINlxpRIBpRI6wHorLERUmIisKCQWM8cqigESVQS1Kx1piNi4mW2YpbcZONrilE140RCTcy3DDAcL/zbJP8CYPDL+9Ufau7uqb7eZ7P+/a8PS8hwkcgIBAQCAgEBAICAYGAQEAgIBAQCAgEBAICAYGAQEAgIBAQCDx/AoowKXFMUhD3lQrioZaQRVRS+fxl51eBTZUTdZ41U1Rox13/0JF9csGJ05Qv4jSz/YPWohtvLmSKN5iTGGqTm1+rc6weICOBRbZs1UVnrv87T1PUeovxyNsUP9P6n5cpHtCxu24cbrmwKLdj+osWiqrVKhI0xzbmZ7m1SpJ+1pFpvE2DPvGTomOxAoNLLKGLscZYvB10cbYYjrJCb7A5mrxleOBqim+cWJRakZY0JfnD/LieI9V1MrKtwokbrAtU4Vm0A3TJnphJD4B+RxD0u0LA7w7FTE4oprOCMbklEGNrfdGf4IqnQTb4wc0MFTYibZqM7JgjO8ZdJkpMln/sKu16pHZGb7IfptIWg389DPp9kcChWODoMuDdBOhL1JgpisbUvghM7AqFbtNiaFP80RLnhbuBdqi0N+1dbUpWGde9gWpuhFi95yL7sS7BA93JAb+Fn8mh4QujgPeTgb9kAZf3Apd2A+fXQ38yHjOHozB1IAJjOSEY2RSIwVUv4dd4X9wJccGHNrJ7CYQ4GGjLeNNfM+dyvgpzQstKf3pbB2A6m97uBRE0/Ergcxr8hyqg7hrwn0vAtRIKIRX6Y2pMl0RhIj8co9nBGFrvh55l3ngU7YObng7IVnFvGS+BYUpmHziY/Ls2zgP9SX50by/G9N5w6I+ogYvpwK1SoOlHQNsGfWcd9Peqof88B/rTyzF9hAIopAByQzC0JQB9ST5oVnvhnt+LOGsprvUhxNIwa0aY7cGR6Cp7tr8+whkjawIxkRWC6YJI6N+lAKq3Qf/Tx+B77oGfaQc/8hB8w2Xwtw9Bf3kzZspXY/JIDEbfpAB2BKLvVV90Jvjgoac9vpRxE8kciTVCBMMkNirJ7k/tRHyjtxwjKV4Yp3t/6s+R4E+/DH3N6+BrS8E314Dvvg2+/Sb4hxfBf5sP/up2TF3ZhonK1zD6dhwGdwail26DzqgX8MRKiq9ZBpkSkmeYOyPM3m9Jjl+1Z9D8AgNtlAq6bZ70qsZi+q+bwV/7I/hbB8D/dAr8Axq89iz474p/G5++koHJy1sx/lkGdBc2YjA3HF0rHNHuboomuQj/5DgclIvOGCGCYRKFFuTMV7YUAD3VDQaLMfyqBcZORGPy01QKYSNm/rYV/Nd/Av9NHvgbueBrsjDzRQamKKDxT9Kgq1iLkbIUDOSHoiNcgnYHgnYZi+9ZExSbiSoMc2eE2flKcuJLa4KGRQz6/U0wlGaP0feiMH4uFpMXEjBVlYjp6lWY+SSZtim0kulYMiYuJEJXuhTDJ9UYPByOvoIwdCxfgE4bAo0Jh39xLAoVpMwIEQyTyFCQvGpLon9sJ0K3J4OBDDcMH1dj9FQsxkrjMPFRPCbOx2GyfLal9VEcxstioTulxjAFNfROJPqLl6Bnfyg6V7ugz5yBhuHwrZjBdiU5YJg7I8wOpifAKoVIW7uQ3rpOBH2b3ekVjYT2WCRG3o+mIGKgO0OrlIaebU/HYOQDNbQnojB4NJyGD0NPfjA0bwTRE6Q7hsUcWhkWN8yZqSQlWWGECAZLmJfJmbrvVSI8taK37xpbdB/wQW8xPee/8xIGjvlj8IQ/hk4G0JbWcX8MHPVDX4kveoq8ocn3xLM33NCZRcPHOGJYZIKfpQyq7JjHS6yJjcHujLHADgkpuC7h8F8zEVqXSNC2awE69lqhs8AamkO26HrbDt2H7dBVQov2NcW26CiwQtu+BWjdY4n2nZboTbfCmKcCnRyDO/YmyLPnDlHvjDH8G6zhS9/wlEnYR7X00fWrFYuWdVI0ZpuhcbcczW/R2qdAcz6t/bRov4mONeaaoYl+p22rHF0bVNAmKtBvweIXGxNcfFH8eNlC4m6wMWMusEnKpn5hyo48pj9gLe4SNG9QoGGLAk8z5XiaJUd99u8122/IpBA2K9BGg2vWWKAvRYVeLzEa7E1R422m2+MsSTem97nSYnfKyN6/mzATv7AUgqcMrUnmaFlLX3ysM0fj+t/b5lQLtK22QEfyAmiSLKFZpUJ7kBRPXKW4HqCYynWVHKSG2LkyZex1uO1mZM9lKem9Tx9jjY5iNEYo0bKMhn7ZAu0r6H5PpLXCAq0rKJClSjSGynE/QIkrQYqBPe6S2X+AJsY2Ped6iWZk6RlL0c2r5szofRsO9R5S1IfQLRCpQL1aifoYFerpsbkuTImaUJXuXIDiH6/Ys8vm3Mg8L2i20YqsO7fItKLcSXyn0kXccclVqv3MS6at9JU/Ox+ouns+SF6Z4cSupz7l8+z1ucs7LF1AQjOdxfGZzmx8Iu1TRcfnrioICAQEAgIBgYBAQCAgEBAICAQEAgIBgYBAQCAgEBAICAQEAv8H44b/6ZiGvGAAAAAASUVORK5CYII\x3d",
contentType:"image/png",width:15,height:15},postMixInProperties:function(){this.inherited(arguments);this.i18n=t.clone(t.i18n.getLocalization("arcgisonline","arcgisonline").common);t.mixin(this.i18n,t.i18n.getLocalization("arcgisonline","arcgisonline").generalDlg);t.mixin(this.i18n,t.i18n.getLocalization("arcgisonline","arcgisonline").imgDlg);t.mixin(this.i18n,t.i18n.getLocalization("arcgisonline","arcgisonline").symbolDlg)},postCreate:function(){this.symbolLinePatternSelect._getMenuItemForOption=
function(b){if(b.value||b.label){var m=t.hitch(this,"_setValueAttr",b);b=new p.MenuItem({option:b,label:b.label||this.emptyLabel,onClick:m,ownerDocument:this.ownerDocument,dir:this.dir,disabled:b.disabled||!1,iconClass:b.iconClass});b.focusNode.setAttribute("role","option");return b}return new p.MenuSeparator({ownerDocument:this.ownerDocument})};this.symbolLinePatternSelect.addOption({value:"solid",iconClass:"symbolLinePatternSolid"});this.symbolLinePatternSelect.addOption({value:"dot",iconClass:"symbolLinePatternDot"});
this.symbolLinePatternSelect.addOption({value:"dash",iconClass:"symbolLinePatternDash"});this.symbolLinePatternSelect.addOption({value:"dashdot",iconClass:"symbolLinePatternDashDot"});this.symbolLinePatternSelect.addOption({value:"dashdotdot",iconClass:"symbolLinePatternDashDotDot"});this._symbolCloseIcon&&t.attr(this._symbolCloseIcon,"src",arcgisonline.sharing.util.relativeToExplicitUrl("images/close.gif"));t.connect(this.symbolLinePatternSelect,"onChange",t.hitch(this,"onPatternChange"));this.loadConnections()},
init:function(b){this.savedPictureMarkerSymbol=this.savedSimpleMarkerSymbol=null;if(this.symbol){if(!b||"picturemarkersymbol"!==this.symbol.type&&"simplemarkersymbol"!==this.symbol.type)if(b)t.style(this.symbolFullTemplatePicker,"display","none"),t.style(this.symbolSmallTemplatePicker,"display","none");else if(t.style(this.symbolSmallTemplatePicker,"display","none"),t.style(this.symbolFullTemplatePicker,"display","block"),this.symbolListItems)if(this.templatePickerSymbolClass!==this.symbol.type&&
("simplemarkersymbol"!==this.templatePickerSymbolClass&&"picturemarkersymbol"!==this.templatePickerSymbolClass||"picturemarkersymbol"!==this.symbol.type&&"simplemarkersymbol"!==this.symbol.type)){if("simplemarkersymbol"===this.symbol.type||"picturemarkersymbol"===this.symbol.type)for(b=0;b<this.symbolListItems.length;b++){var m=this.symbolListItems[b];if(-1<m.typeKeywordsString.indexOf("marker")&&-1<m.typeKeywordsString.indexOf("default")){this.symbolColorClasses.set("value",m.title);break}}this.getSymbolListData(!0)}else this.getSymbolListData();
else this.getSymbolListGroup();else t.style(this.symbolFullTemplatePicker,"display","none"),t.style(this.symbolSmallTemplatePicker,"display","block"),setTimeout(t.hitch(this,function(){this.createSimpleMarkerTemplatePicker()}),0);this.updateUI();this.enableEvents();this.symbolClassesTemplatePicker&&this.symbolClassesTemplatePicker.clearSelection();this.simpleMarkerTemplatePicker&&this.simpleMarkerTemplatePicker.clearSelection()}},hide:function(){this.disableEvents();p.popup.close(this.symbolColorTooltip);
this.destroySymbolClassesTemplatePicker();this.destroySimpleMarkerTemplatePicker()},loadConnections:function(){t.query(".jevent").connect("onclick",function(b){b.preventDefault()});t.connect(this.symbolColorTooltipClose,"onclick",t.hitch(this,function(b){b.preventDefault();p.popup.close(this.symbolColorTooltip)}));t.connect(this.symbolBackgroundColor,"onclick",this,"onBackgroundColorClick");t.connect(this.symbolOutlineColor,"onclick",this,"onOutlineColorClick");t.connect(this.symbolAddImage,"onclick",
this,"onAddImage")},updateUI:function(){this.symbolImage.innerHTML="";if("simplemarkersymbol"===this.symbol.type||"picturemarkersymbol"===this.symbol.type)t.style(this.symbolClassesDiv,"display","block"),t.style(this.symbolClassesTemplatePickerDiv,"display","block"),t.style(this.symbolSizeRow,"display",""),this.symbolSizeLabel.innerHTML=this.i18n.symbolSizeLabel,t.style(this.symbolEndSizeRow,"display","none"),t.style(this.symbolEndWidthRow,"display","none"),t.style(this.symbolAddImageDiv,"display",
""),"simplemarkersymbol"===this.symbol.type?(t.style(this.symbolBackgroundColorRow,"display",this.showNoBgColor?"none":""),t.style(this.symbolLinePatternRow,"display","none"),t.style(this.symbolOutlineColorRow,"display",""),t.style(this.symbolWidthRow,"display",""),this.symbolWidthLabel.innerHTML=this.i18n.outlineWidthLabel,t.style(this.symbolTransparencyRow,"display",""),this.symbolSize.set("value",this.symbol.size,!1),this.symbolSizeInput.set("value",Math.round(this.symbol.size),!1),this.showEndSize&&
(this.symbolSizeLabel.innerHTML=this.i18n.symbolStartSizeLabel,this.symbolEndSize.set("value",this.endSize,!1),this.symbolEndSizeInput.set("value",Math.round(this.endSize),!1),t.style(this.symbolEndSizeRow,"display","")),t.style(this.symbolBackgroundColor,"background",this.symbol.color.toHex()),this.symbolTransparency.set("value",1-this.symbol.color.toRgba()[3],!1),this.symbolTransparencyInput.set("value",Math.round(100*(1-this.symbol.color.toRgba()[3])),!1),t.style(this.symbolOutlineColor,"background",
this.symbol.outline.color.toHex()),this.symbolWidth.set("value",this.symbol.outline.width,!1),this.symbolWidthInput.set("value",Math.round(this.symbol.outline.width),!1)):"picturemarkersymbol"===this.symbol.type&&(t.style(this.symbolBackgroundColorRow,"display","none"),t.style(this.symbolLinePatternRow,"display","none"),t.style(this.symbolOutlineColorRow,"display","none"),t.style(this.symbolWidthRow,"display","none"),t.style(this.symbolTransparencyRow,"display","none"),this.symbolSize.set("value",
this.symbol.width,!1),this.symbolSizeInput.set("value",Math.round(this.symbol.width),!1),this.showEndSize&&(this.symbolSizeLabel.innerHTML=this.i18n.symbolStartSizeLabel,this.symbolEndSize.set("value",this.endSize,!1),this.symbolEndSizeInput.set("value",Math.round(this.endSize),!1),t.style(this.symbolEndSizeRow,"display","")));else if("simplelinesymbol"===this.symbol.type||"cartographiclinesymbol"===this.symbol.type)t.style(this.symbolBackgroundColorRow,"display",this.showNoBgColor?"none":""),t.style(this.symbolAddImageDiv,
"display","none"),t.style(this.symbolClassesDiv,"display","none"),t.style(this.symbolClassesTemplatePickerDiv,"display","block"),t.style(this.symbolSizeRow,"display","none"),t.style(this.symbolTransparencyRow,"display",""),t.style(this.symbolEndSizeRow,"display","none"),this.setLinePattern(),t.style(this.symbolLinePatternRow,"display",""),this.symbolTransparency.set("disabled",!1),this.symbolTransparencyInput.set("disabled",!1),t.style(this.symbolOutlineColorRow,"display","none"),t.style(this.symbolWidthRow,
"display",""),this.symbolWidthLabel.innerHTML=this.i18n.symbolWidthLabel,t.style(this.symbolEndWidthRow,"display","none"),t.style(this.symbolBackgroundColor,"background",this.symbol.color.toHex()),this.symbolTransparency.set("value",1-this.symbol.color.toRgba()[3],!1),this.symbolTransparencyInput.set("value",Math.round(100*(1-this.symbol.color.toRgba()[3])),!1),this.symbolWidth.set("value",this.symbol.width,!1),this.symbolWidthInput.set("value",Math.round(this.symbol.width),!1),this.showEndSize&&
(this.symbolWidthLabel.innerHTML=this.i18n.symbolStartWidthLabel,this.symbolEndWidth.set("value",this.endSize,!1),this.symbolEndWidthInput.set("value",Math.round(this.endSize),!1),t.style(this.symbolEndWidthRow,"display","")),this.onPatternChange();else if("simplefillsymbol"===this.symbol.type||"picturefillsymbol"===this.symbol.type)t.style(this.symbolBackgroundColorRow,"display",this.showNoBgColor?"none":""),t.style(this.symbolAddImageDiv,"display","none"),t.style(this.symbolClassesDiv,"display",
"none"),t.style(this.symbolClassesTemplatePickerDiv,"display","block"),t.style(this.symbolSizeRow,"display","none"),t.style(this.symbolTransparencyRow,"display",""),t.style(this.symbolEndSizeRow,"display","none"),t.style(this.symbolEndWidthRow,"display","none"),t.style(this.symbolLinePatternRow,"display","none"),t.style(this.symbolOutlineColorRow,"display",""),t.style(this.symbolWidthRow,"display",""),t.style(this.symbolEndWidthRow,"display","none"),this.symbolWidthLabel.innerHTML=this.i18n.outlineWidthLabel,
this.symbolTransparency.set("disabled",!1),this.symbolTransparencyInput.set("disabled",!1),t.style(this.symbolBackgroundColor,"backgroundColor",this.symbol.color.toHex()),this.symbolTransparency.set("value",1-this.symbol.color.toRgba()[3],!1),this.symbolTransparencyInput.set("value",Math.round(100*(1-this.symbol.color.toRgba()[3])),!1),t.style(this.symbolOutlineColor,"backgroundColor",this.symbol.outline.color.toHex()),this.symbolWidth.set("value",this.symbol.outline.width,!1),this.symbolWidthInput.set("value",
Math.round(this.symbol.outline.width),!1);this._drawSymbol()},enableEvents:function(){this.eventHandlers=[];this.eventHandlers.push(t.connect(this.symbolSize,"onChange",this,"onSizeChange"));this.eventHandlers.push(t.connect(this.symbolSize._movable,"onMoveStop",this,"onSizeChange"));this.eventHandlers.push(t.connect(this.symbolSizeInput,"onChange",this,"onSizeChangeByInput"));this.eventHandlers.push(t.connect(this.symbolEndSize,"onChange",this,"onEndSizeChange"));this.eventHandlers.push(t.connect(this.symbolEndSize._movable,
"onMoveStop",this,"onEndSizeChange"));this.eventHandlers.push(t.connect(this.symbolEndSizeInput,"onChange",this,"onEndSizeChangeByInput"));this.eventHandlers.push(t.connect(this.symbolTransparency,"onChange",this,"onTransparencyChange"));this.eventHandlers.push(t.connect(this.symbolTransparency._movable,"onMoveStop",this,"onTransparencyChange"));this.eventHandlers.push(t.connect(this.symbolTransparencyInput,"onChange",this,"onTransparencyChangeByInput"));this.eventHandlers.push(t.connect(this.symbolWidth,
"onChange",this,"onWidthChange"));this.eventHandlers.push(t.connect(this.symbolWidth._movable,"onMoveStop",this,"onWidthChange"));this.eventHandlers.push(t.connect(this.symbolWidthInput,"onChange",this,"onWidthChangeByInput"));this.eventHandlers.push(t.connect(this.symbolEndWidth,"onChange",this,"onEndWidthChange"));this.eventHandlers.push(t.connect(this.symbolEndWidth._movable,"onMoveStop",this,"onEndWidthChange"));this.eventHandlers.push(t.connect(this.symbolEndWidthInput,"onChange",this,"onEndWidthChangeByInput"));
this.eventHandlers.push(t.connect(this.symbolLinePatternSelect,"onChange",t.hitch(this,"onSymbolLinePatternChange")));this.eventHandlers.push(t.connect(this.symbolColorClasses,"onChange",this,"onSymbolListChange"))},disableEvents:function(){this.eventHandlers&&(t.forEach(this.eventHandlers,function(b){t.disconnect(b)}),this.eventHandlers=null)},onPatternChange:function(){t.removeClass(this.symbolLinePatternSelect.containerNode,"symbolLinePatternSolid symbolLinePatternDot symbolLinePatternDash symbolLinePatternDashDot symbolLinePatternDashDotDot");
"solid"==this.symbolLinePatternSelect.get("value")?t.addClass(this.symbolLinePatternSelect.containerNode,"symbolLinePatternSolid"):"dot"==this.symbolLinePatternSelect.get("value")?t.addClass(this.symbolLinePatternSelect.containerNode,"symbolLinePatternDot"):"dash"==this.symbolLinePatternSelect.get("value")?t.addClass(this.symbolLinePatternSelect.containerNode,"symbolLinePatternDash"):"dashdot"==this.symbolLinePatternSelect.get("value")?t.addClass(this.symbolLinePatternSelect.containerNode,"symbolLinePatternDashDot"):
"dashdotdot"==this.symbolLinePatternSelect.get("value")&&t.addClass(this.symbolLinePatternSelect.containerNode,"symbolLinePatternDashDotDot")},onBackgroundColorClick:function(b){this.colorPicker="background";p.popup.open({popup:this.symbolColorTooltip,around:b.target})},onOutlineColorClick:function(b){this.colorPicker="outline";p.popup.open({popup:this.symbolColorTooltip,around:b.target})},onColorSelection:function(b){p.popup.close(this.symbolColorTooltip);b=(new t.Color(b)).toRgba();"background"===
this.colorPicker||"simplelinesymbol"===this.symbol.type?(b[3]=this.symbol.color.toRgba()[3],this.symbol.color.setColor(b)):this.symbol.outline.color.setColor(b);this.updateUI()},onTransparencyChange:function(b){b=this.symbol.color.toRgba();var m=this.symbolTransparency.getValue();m=t.number.round(m,2);b[3]=1-m;this.symbol.color.setColor(b);this.updateUI()},onTransparencyChangeByInput:function(b){isNaN(b)?this.symbolTransparencyInput.set("value",Math.round(100*this.symbolTransparency.getValue()),!1):
(b=Math.round(b),0>b||100<b?this.symbolTransparencyInput.set("value",Math.round(100*this.symbolTransparency.getValue()),!1):this.symbolTransparency.set("value",b/100,!1))},onWidthChange:function(b){if(!isNaN(b)){var m=this.symbolWidth.getValue();m=Math.round(m);"simplefillsymbol"===this.symbol.type||"simplemarkersymbol"===this.symbol.type?this.symbol.outline.width!=b&&(this.symbol.outline.setWidth(m),this.symbol.outline.setStyle(esri.symbol.SimpleLineSymbol.STYLE_SOLID),b=this.symbol.outline.color.toRgba(),
b[3]=1,this.symbol.outline.color.setColor(b),this.updateUI()):this.symbol.width!=b&&(this.symbol.setWidth(m),this.updateUI())}},onWidthChangeByInput:function(b){isNaN(b)?this.symbolWidthInput.set("value",this.symbolWidth.getValue(),!1):(b=Math.round(b),0>b||18<b?this.symbolWidthInput.set("value",this.symbolWidth.getValue(),!1):this.symbolWidth.set("value",b,!0))},onEndWidthChange:function(b){isNaN(b)||(b=this.symbolEndWidth.getValue(),b=Math.round(b),b<this.symbolWidthInput.getValue()?this.symbolEndWidth.set("value",
this.symbolEndWidthInput.getValue(),!1):(this.symbolEndWidthInput.set("value",b,!1),this.endSize=b))},onEndWidthChangeByInput:function(b){isNaN(b)?this.symbolEndWidthInput.set("value",Math.round(this.symbolEndWidth.getValue()),!1):(b=Math.round(b),1>b||120<b||b<this.symbolWidth.getValue()?this.symbolEndWidthInput.set("value",Math.round(this.symbolEndWidth.getValue()),!1):(this.symbolEndWidth.set("value",b,!1),this.endSize=b))},onSizeChange:function(b){if(!isNaN(b)){b=this.symbol.width;var m=this.symbolSize.getValue();
m=Math.round(m);if(b!=m)if(this.showEndSize&&m>this.symbolEndSizeInput.getValue())this.symbolSize.set("value",this.symbolSizeInput.getValue(),!1);else{if("picturemarkersymbol"===this.symbol.type){this.symbol.setHeight(this.symbol.height/this.symbol.width*m);this.symbol.setWidth(m);if(!this.symbol.url||"http://"===this.symbol.url||-1==this.symbol.url.indexOf("http://")&&-1==this.symbol.url.indexOf("data:"))return;if(this.symbol.xoffset||this.symbol.yoffset)m=this.symbol.width,b=m/b,this.symbol.setOffset(Math.round(this.symbol.xoffset*
b),Math.round(this.symbol.yoffset*b))}else this.symbol.setSize(m);this.updateUI()}}},onSizeChangeByInput:function(b){isNaN(b)?this.symbolSizeInput.set("value",Math.round(this.symbolSize.getValue()),!1):(b=Math.round(b),1>b||120<b||this.showEndSize&&b>this.symbolEndSize.getValue()?this.symbolSizeInput.set("value",Math.round(this.symbolSize.getValue()),!1):this.symbolSize.set("value",b,!0))},onEndSizeChange:function(b){isNaN(b)||(b=this.symbolEndSize.getValue(),b=Math.round(b),b<this.symbolSizeInput.getValue()?
this.symbolEndSize.set("value",this.symbolEndSizeInput.getValue(),!1):(this.symbolEndSizeInput.set("value",b,!1),this.endSize=b))},onEndSizeChangeByInput:function(b){isNaN(b)?this.symbolEndSizeInput.set("value",Math.round(this.symbolEndSize.getValue()),!1):(b=Math.round(b),1>b||120<b||b<this.symbolSize.getValue()?this.symbolEndSizeInput.set("value",Math.round(this.symbolEndSize.getValue()),!1):(this.symbolEndSize.set("value",b,!1),this.endSize=b))},onUrlChange:function(b){if(b&&!(10>b.length)&&0===
b.indexOf("http")){this.urlChangesNotApplied=!0;for(var m=function(c){clearTimeout(a);a=null;var l=t.style(t.byId(this.id+"_testImage"),"width"),h=t.style(t.byId(this.id+"_testImage"),"height");c.w&&c.h&&(l=c.w,h=c.h);1==l&&1==h?(this.urlChangesNotApplied=!1,this.updateUI(),arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.errorDlgTitle,message:this.i18n.error.invalidUrl})):(0===l&&(l=40),0===h&&(h=l),c.w&&c.h||this.cachedImages.push({url:b,w:l,h:h}),
this.symbol=new esri.symbol.PictureMarkerSymbol,this.symbol.setWidth(Math.min(120,l)),this.symbolSize.set("value",this.symbol.width,!1),this.symbol.setHeight(h/l*this.symbol.width),this.symbol.setUrl(b),this.updateUI(),this.urlChangesNotApplied=!1)},f=0;f<this.cachedImages.length;f++){var d=this.cachedImages[f];if(d.url==b){t.hitch(this,m)(d);return}}this.testImageHandler&&t.disconnect(this.testImageHandler);this.testImageHandler=t.connect(t.byId(this.id+"_testImage"),"onload",this,m,{});var a=setTimeout(t.hitch(this,
function(){clearTimeout(a);a=null;this.urlChangesNotApplied=!1;arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.errorDlgTitle,message:this.i18n.error.invalidUrl})}),5E3);t.byId(this.id+"_testImage").src=b}},onAddImage:function(b){this.onImageChangeHandler&&t.unsubscribe(this.onImageChangeHandler);this.onImageChangeHandler=t.subscribe("onUrlChange",t.hitch(this,"onUrlChange"));arcgisonline.sharing.dijit.dialog.ImgDlg.prototype.statics.getInstance().show()},
onSymbolLinePatternChange:function(){if("simplelinesymbol"===this.symbol.type||"cartographiclinesymbol"===this.symbol.type){switch(this.symbolLinePatternSelect.getValue()){case "dot":this.symbol.setStyle(esri.symbol.SimpleLineSymbol.STYLE_DOT);break;case "dash":this.symbol.setStyle(esri.symbol.SimpleLineSymbol.STYLE_DASH);break;case "dashdot":this.symbol.setStyle(esri.symbol.SimpleLineSymbol.STYLE_DASHDOT);break;case "dashdotdot":this.symbol.setStyle(esri.symbol.SimpleLineSymbol.STYLE_DASHDOTDOT);
break;default:this.symbol.setStyle(esri.symbol.SimpleLineSymbol.STYLE_SOLID)}this.updateUI()}},getSymbolListGroup:function(){arcgisonline.sharing.geow.Community.searchGroups(esriGeowConfig.symbolSetsGroupQuery,t.hitch(this,function(b,m){b&&b.results&&0<b.results.length&&this.getSymbolListItems(b.results[0].id)}),t.hitch(this,function(b,m){}))},getSymbolListItems:function(b){b=esriGeowConfig.restBaseUrl+"search?num\x3d20\x26q\x3dgroup:"+b+' AND type:"Symbol Set"';b="vml"===x.gfx.renderer?b+' AND -typekeywords:"by value"':
b+' AND ((typekeywords:"by value" AND typekeywords:"marker") OR typekeywords:"fill" OR typekeywords:"line")';arcgisonline.sharing.util.getJson(b,t.hitch(this,function(m,f){m.results&&0<m.results.length&&(this.symbolListItems=m.results,this.symbolListItems.sort(function(d,a){return d.title==a.title?0:d.title<a.title?-1:1}),t.forEach(this.symbolListItems,function(d,a){d.typeKeywordsString=d.typeKeywords.toString();if(-1<d.typeKeywordsString.indexOf("default")&&-1<d.typeKeywordsString.indexOf("marker")){var c=
this.symbolListItems.splice(a,1);0<c.length&&(this.symbolListItems.splice(0,0,c[0]),this.symbolColorClasses.set("value",d.title))}},this),this.symbolClassStore=new t.data.ItemFileWriteStore({data:{identifier:"id",items:[]}}),t.forEach(this.symbolListItems,function(d){-1<d.typeKeywordsString.indexOf("marker")&&(this.symbolClassStore.newItem({name:d.title,id:d.id}),this.symbolColorClasses.set("store",this.symbolClassStore))},this),this.getSymbolListData(!0))}),t.hitch(this,function(m,f){}))},getSymbolListData:function(b){this.destroySymbolClassesTemplatePicker();
t.forEach(this.symbolListItems,function(m){if(("simplemarkersymbol"===this.symbol.type||"picturemarkersymbol"===this.symbol.type)&&-1<m.typeKeywordsString.indexOf("marker")||("simplelinesymbol"===this.symbol.type||"cartographiclinesymbol"===this.symbol.type)&&-1<m.typeKeywordsString.indexOf("line")||("simplefillsymbol"===this.symbol.type||"picturefillsymbol"===this.symbol.type)&&-1<m.typeKeywordsString.indexOf("fill"))m.data?"simplemarkersymbol"!==this.symbol.type&&"picturemarkersymbol"!==this.symbol.type?
this.processSymbolListData(m):this.symbolColorClasses.get("value")==m.title&&this.processSymbolListData(m):arcgisonline.sharing.util.getJson(esriGeowConfig.restBaseUrl+"/content/items/"+m.id+"/data",t.hitch(this,function(f,d,a){d&&0<d.length&&(f.data=d,"simplemarkersymbol"===this.symbol.type||"picturemarkersymbol"===this.symbol.type?(b&&-1<f.typeKeywordsString.indexOf("default")||!b)&&this.processSymbolListData(f):this.processSymbolListData(f))},m),t.hitch(this,function(f,d){}))},this)},processSymbolListData:function(b){setTimeout(t.hitch(this,
function(){this.createSymbolListTemplatePicker(b.data)}),0)},createSymbolListTemplatePicker:function(b){b=t.map(b,function(m){var f={};f.symbol=esri.symbol.fromJson(m);f.description=m.name;return f},this);this.symbolClassesTemplatePicker||(this.symbolClassesTemplatePicker=new esri.dijit.editing.TemplatePicker({items:b,rows:"auto",columns:"auto",_assumedCellWidth:40,grouping:!1,style:"position: relative; width: 100%; height: 120px;"},this.id+"_symbolClassesTemplatePicker"),this.symbolClassesTemplatePicker.startup(),
this.templatePickerSymbolClass=this.symbol.type,this.templatePickerOnSelectionChangeHandler=t.connect(this.symbolClassesTemplatePicker,"onSelectionChange",this,function(){var m=this.symbolClassesTemplatePicker.getSelected();if(m){var f=this.symbol;this.symbol=esri.symbol.fromJson(m.item.symbol.toJson());if("simplemarkersymbol"===this.symbol.type||"picturemarkersymbol"===this.symbol.type)"simplemarkersymbol"===this.symbol.type?this.symbol.size="simplemarkersymbol"===f.type?f.size:f.width:"simplemarkersymbol"===
f.type?(this.symbol.xoffset&&(this.symbol.xoffset=f.size/(this.symbol.width/this.symbol.xoffset)),this.symbol.yoffset&&(this.symbol.yoffset=this.symbol.height/this.symbol.width*f.size/(this.symbol.height/this.symbol.yoffset)),this.symbol.height=this.symbol.height/this.symbol.width*f.size,this.symbol.width=f.size):(this.symbol.xoffset&&(this.symbol.xoffset=f.width/(this.symbol.width/this.symbol.xoffset)),this.symbol.yoffset&&(this.symbol.yoffset=this.symbol.height/this.symbol.width*f.width/(this.symbol.height/
this.symbol.yoffset)),this.symbol.height=this.symbol.height/this.symbol.width*f.width,this.symbol.width=f.width);(this.symbol.width||this.symbol.size)>=this.endSize&&(this.endSize=(this.symbol.width?this.symbol.width:this.symbol.size)+("simplelinesymbol"==this.symbol.type?10:20),this.symbolEndSize.set("value",this.endSize,!1));this.updateUI()}}))},destroySymbolClassesTemplatePicker:function(){this.symbolClassesTemplatePicker&&(t.disconnect(this.templatePickerOnSelectionChangeHandler),this.symbolClassesTemplatePicker.destroy(),
this.symbolClassesTemplatePicker=null,t.byId("symbolClassesTemplatePicker")||t.create("div",{id:this.id+"_symbolClassesTemplatePicker"},this.symbolClassesTemplatePickerDiv))},onSymbolListChange:function(b){if(b){this.destroySymbolClassesTemplatePicker();for(var m=null,f=0;f<this.symbolListItems.length;f++)this.symbolListItems[f].title==b&&(m=this.symbolListItems[f]);m&&m.data&&setTimeout(t.hitch(this,function(){this.createSymbolListTemplatePicker(m.data)}),0)}},createSimpleMarkerTemplatePicker:function(){var b=
t.map(this.simpleMarkerSymbols,function(m){var f={};f.symbol=esri.symbol.fromJson(m);f.description=m.name;return f},this);this.simpleMarkerTemplatePicker||(this.simpleMarkerTemplatePicker=new esri.dijit.editing.TemplatePicker({items:b,rows:"auto",columns:"auto",_assumedCellWidth:40,grouping:!1,style:"position: relative; width: 100%; height: 45px;"},this.id+"_symbolSimpleMarkerTemplatePicker"),this.simpleMarkerTemplatePicker.startup(),this.simpleMarkerTemplatePickerOnSelectionChangeHandler=t.connect(this.simpleMarkerTemplatePicker,
"onSelectionChange",this,function(){var m=this.simpleMarkerTemplatePicker.getSelected();m&&(this.symbol=esri.symbol.fromJson(m.item.symbol.toJson()),this.updateUI())}))},destroySimpleMarkerTemplatePicker:function(){this.simpleMarkerTemplatePicker&&(t.disconnect(this.simpleMarkerTemplatePickerOnSelectionChangeHandler),this.simpleMarkerTemplatePicker.destroy(),this.simpleMarkerTemplatePicker=null,t.byId(this.id+"_symbolSimpleMarkerTemplatePicker")||t.create("div",{id:this.id+"_symbolSimpleMarkerTemplatePicker"},
this.symbolSimpleMarkerTemplatePickerDiv))},getSymbolUrl:function(){var b=this.symbol.url;0!==b.indexOf("http://")&&this.symbol.imageData&&0<this.symbol.imageData.length&&(b=this.symbol.imageData);return b},setLinePattern:function(){switch(this.symbol.style){case esri.symbol.SimpleLineSymbol.STYLE_DOT:this.symbolLinePatternSelect.set("value","dot",!1);break;case esri.symbol.SimpleLineSymbol.STYLE_DASH:this.symbolLinePatternSelect.set("value","dash",!1);break;case esri.symbol.SimpleLineSymbol.STYLE_DASHDOT:this.symbolLinePatternSelect.set("value",
"dashdot",!1);break;case esri.symbol.SimpleLineSymbol.STYLE_DASHDOTDOT:this.symbolLinePatternSelect.set("value","dashdotdot",!1);break;default:this.symbolLinePatternSelect.set("value","solid",!1)}},getMarkerJson:function(){var b=this.markerJson;b.url=arcgisonline.sharing.util.getRedSphereUrl();return b},_drawSymbol:function(){var b=this.symbolImage,m=this.symbol,f=this.template,d=80,a=30;if("simplemarkersymbol"===m.type)a=d=Math.min(m.size+12,125);else if("picturemarkersymbol"===m.type){if(!this.symbol.url||
"http://"===m.url||-1==m.url.indexOf("http://")&&-1==m.url.indexOf("https://")&&-1==m.url.indexOf("data:"))return;a=d=Math.min(Math.max(m.width,m.height),125)}else if("simplelinesymbol"===this.symbol.type||"cartographiclinesymbol"===this.symbol.type)d=190,a=20;b=x.gfx.createSurface(b,d,a);if("vml"===x.gfx.renderer){var c=b.getEventSource();t.style(c,"position","relative");t.style(c.parentNode,"position","relative")}m=this._getDrawingToolShape(m,f)||esri.symbol.getShapeDescriptors(m);try{var l=b.createShape(m.defaultShape).setFill(m.fill).setStroke(m.stroke)}catch(h){b.clear();
b.destroy();return}m=b.getDimensions();m={dx:m.width/2,dy:m.height/2};c=l.getBoundingBox();f=c.width;c=c.height;if(f>d||c>a)d=((d<a?d:a)-5)/(f>c?f:c),t.mixin(m,{xx:d,yy:d});l.applyTransform(m);return b},_getDrawingToolShape:function(b,m){if("simplelinesymbol"==b.type||"cartographiclinesymbol"==b.type){var f={type:"path",path:"M -90,0 L 90,0 E"};return{defaultShape:f,fill:null,stroke:b.getStroke()}}switch(m?m.drawingTool||null:null){case "esriFeatureEditToolArrow":f={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 E"};
break;case "esriFeatureEditToolTriangle":f={type:"path",path:"M -10,14 L 2,-10 L 14,14 L -10,14 E"};break;case "esriFeatureEditToolRectangle":f={type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 E"};break;case "esriFeatureEditToolCircle":f={type:"circle",cx:0,cy:0,r:10};break;case "esriFeatureEditToolEllipse":f={type:"ellipse",cx:0,cy:0,rx:10,ry:5};break;default:return null}return{defaultShape:f,fill:b.getFill(),stroke:b.getStroke()}},_repaintItems:function(){t.forEach(this._surfaceItems,
function(b){this._repaint(b)},this)},_repaint:function(b){b.getStroke&&b.setStroke&&b.setStroke(b.getStroke());b.getFill&&b.setFill&&b.setFill(b.getFill());b.children&&t.isArray(b.children)&&t.forEach(b.children,this._repaint,this)}})})},"arcgisonline/sharing/dijit/dialog/ImgDlg":function(){define(["dojo","dijit","dojox","dojo/require!dijit/Dialog,dijit/_Widget,dijit/_Templated,arcgisonline/sharing/dijit/dialog/GeneralDlg"],function(t,p,x){t.provide("arcgisonline.sharing.dijit.dialog.ImgDlg");t.require("dijit.Dialog");
t.require("dijit._Widget");t.require("dijit._Templated");t.require("arcgisonline.sharing.dijit.dialog.GeneralDlg");t.declare("arcgisonline.sharing.dijit.dialog.ImgDlg",[p._Widget,p._Templated],{widgetsInTemplate:!0,templateString:'\x3cdiv class\x3d"widgetContent" \x3e\r\n  \x3cdiv dojotype\x3d"dijit.Dialog" id\x3d"image-dialog" title\x3d"${i18n.imgDlgTitle}" execute\x3d""\x3e\r\n    \x3cdiv\x3e\r\n      \x3cdiv style\x3d"line-height:17px;padding-top:10px;padding-right:10px;"\x3e\x3cspan\x3e${i18n.specifyImage}\x3c/span\x3e\x3c/div\x3e\r\n      \x3cbr /\x3e\r\n      \x3clabel style\x3d"line-height:12px;"\x3e${i18n.urlLabel}\x3c/label\x3e\r\n      \x3cdiv dojoAttachPoint\x3d"urlInput" dojotype\x3d"dijit.form.TextBox" trim\x3d"true" value\x3d"http://" style\x3d"width:330px;" dir\x3d"ltr"\x3e\x3c/div\x3e\r\n\t\t\t\x3cdiv style\x3d"line-height:17px;padding-top:10px;padding-right:10px;"\x3e\x3cspan\x3e${i18n.imgDetailMessage}\x3c/span\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\t  \x3cbr /\x3e\x26nbsp;  \r\n\t  \x3cbutton dojoAttachEvent\x3d"onClick:onCancelClick" class\x3d"jevent cancel" style\x3d"float:right;" dojoType\x3d"dijit.form.Button"\x3e${i18n.cancel}\x3c/button\x3e\r\n\t  \x3cbutton dojoAttachEvent\x3d"onClick:onDoneClick" class\x3d"jevent primary" style\x3d"float:right;" dojoType\x3d"dijit.form.Button"\x3e${i18n.done}\x3c/button\x3e\r\n\t  \x3cbr /\x3e\x26nbsp; \r\n\t\t\x3cbr/\x3e \r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
i18n:null,statics:{_instance:null,getInstance:function(){null==this._instance&&(this._instance=new arcgisonline.sharing.dijit.dialog.ImgDlg);return this._instance}},postMixInProperties:function(){this.inherited(arguments);this.i18n=t.i18n.getLocalization("arcgisonline","arcgisonline").common;t.mixin(this.i18n,t.i18n.getLocalization("arcgisonline","arcgisonline").generalDlg);t.mixin(this.i18n,t.i18n.getLocalization("arcgisonline","arcgisonline").imgDlg)},postCreate:function(){this.loadConnections()},
show:function(b){p.byId("image-dialog").show()},hide:function(){this.urlInput.setValue("http://");p.byId("image-dialog").hide()},loadConnections:function(){t.query(".jevent").connect("onclick",function(b){b.preventDefault()})},onDoneClick:function(b){b=this.urlInput.getValue();10>b.length?arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.errorDlgTitle,message:this.i18n.error.invalidUrl}):(0!==b.indexOf("http")&&(b="http://"+b),t.publish("onUrlChange",
[b]),this.hide())},onCancelClick:function(b){t.publish("onUrlChange",[]);this.hide()}})})},"arcgisonline/sharing/dijit/dialog/SetIdentityProviderDlg":function(){define("require dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/dom-attr dojo/number dojo/promise/all dojo/sniff dojo/string dojo/topic dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/a11yclick dijit/Dialog dijit/form/Button dijit/form/CheckBox dijit/form/SimpleTextarea dijit/form/TextBox esri/lang ../../../pages/pageUtil ../../../pages/utils/arrays ../../../pages/utils/dom ../../../pages/utils/tooltips ../../util ../_LevelAwareMixin ./GeneralDlg ../../geow/Roles ../../geow/Licenses dojo/i18n!../../../nls/arcgisonline dojo/text!./templates/SetIdentityProviderDlg.html".split(" "),
function(t,p,x,b,m,f,d,a,c,l,h,n,g,e,k,w,q,u,r,v,z,B,A,y,D,G,E,F,I,M,P){var W=p([h,n,g,G["default"]],{declaredClass:"arcgisonline.sharing.dijit.dialog.SetIdentityProviderDlg",templateString:P,widgetsInTemplate:!0,basePath:t.toUrl("arcgisonline/sharing/dijit/dialog"),baseClass:"esriAGOSetIdentityProviderDlg orgDlg",SIGN_UP_MODE_AUTOMATIC:"Automatic",SIGN_UP_MODE_INVITE:"Invitation",BINDING_TYPE_REDIRECT:"HTTP_REDIRECT",BINDING_TYPE_POST:"HTTP_POST",orgAdminRole:"org_admin",orgPublisherRole:"org_publisher",
orgUserRole:"org_user",_currentIDP:null,_isEditing:!1,_roles:[],_tooltips:[],postMixInProperties:function(){this.inherited(arguments);this.i18n=x.mixin(M.common,M.myOrganization);x.mixin(this.i18n,M.setIdentityProviderDlg);x.mixin(this.i18n,{adminRoleName:M.organizationInvite.userRoles.admin})},postCreate:function(){this.inherited(arguments);this._loadConnections();this._setupTooltips();this._licensesAPI=new I;this._rolesAPI=new F},show:function(H,O){this._isFederation=v.isDefined(H)&&H.isFederation;
this._isPortal=D.isPortal();this._defaultUserType=O;this._setupRoleFlags();this.clear();d({rolesResult:this._canManageRoles?this.getRoles():null,userTypesResult:this._canAccessLicenses?this.getUserTypes():null,signedProviderResult:this.getSignedProviderMetadataInfo()}).then(function(){this._dialog.set("title",this._isFederation?this.i18n.setFederationOfIdentityProvidersTitle:this.i18n.setIdentityProviderTitle);this._configureFormForIdentityProviderType();var K=RegExp(":\\d*/","g");K=this._isPortal?
esriGeowConfig.self.portalHostname.replace(K,".").replace("/","."):esriGeowConfig.self.urlKey+"."+esriGeowConfig.self.customBaseUrl;this._entityIDInput&&this._entityIDInput.set("value",K);this._dialog.show()}.bind(this))},getSignedProviderMetadataInfo:function(){var H=new b,O=D.getSecureUrl(esriGeowConfig.restBaseUrl)+"portals/self/sp";D.request({url:O}).then(function(K){this._signedServiceProviderUrl=K&&K.signedServiceProviderUrl?K.signedServiceProviderUrl:"";H.resolve()}.bind(this),function(){this._signedServiceProviderUrl=
"";H.resolve("")}.bind(this));return H},getUserTypes:function(){var H=new b;this._licensesAPI.getLicenseTypes().then(function(O){this._userTypes=O.userLicenseTypes.filter(function(K){return 0<K.maxUsers});H.resolve()}.bind(this));return H},getRoles:function(){var H=new b;this._rolesAPI.getAllRoles(!0).then(function(O){this._roles=O;this._viewerRole=this._localizeViewerRole(this._roles);this._viewerEditRole=this._localizeViewerEditRole(this._roles);this._facilitatorRole=this._localizeCollaboratorRole(this._roles);
H.resolve()}.bind(this));return H},_localizeViewerRole:function(H){if(H)for(var O=0;O<H.length;O++)if(H[O]&&H[O].id===this.SYSTEM_ROLES.VIEWER)return H[O].name=this.i18n.viewerRoleName,H[O]},_localizeViewerEditRole:function(H){if(H)for(var O=0;O<H.length;O++)if(H[O]&&H[O].id===this.SYSTEM_ROLES.DATA_EDITOR)return H[O].name=this.i18n.viewerEditRoleName,H[O]},_localizeFacilitatorRole:function(H){if(H)for(var O=0;O<H.length;O++)if(H[O]&&H[O].id===this.SYSTEM_ROLES.FACILITATOR)return H[O].name=this.i18n.facilitatorRoleName,
H[O]},_coreRoleSelected:function(H){return B.includes([this.orgUserRole,this.orgPublisherRole,this.orgAdminRole],H)},_hasAdminPrivileges:function(H){if(H&&H.privileges)for(var O=0;O<H.privileges.length;O++){var K=H.privileges[O];if(-1<K.indexOf(":admin"))return!0}return!1},edit:function(H,O){this._setupRoleFlags();this.clear();this._isFederation=H.isFederation;this._currentIDP=H;this._isPortal=D.isPortal();this._isEditing=!0;this._defaultUserType=O;var K=RegExp(":\\d*/","g"),R=this._isPortal?esriGeowConfig.self.portalHostname.replace(K,
".").replace("/","."):esriGeowConfig.self.urlKey+"."+esriGeowConfig.self.customBaseUrl,da=esriGeowConfig.self.creditAssignments&&"enabled"===esriGeowConfig.self.creditAssignments;d({rolesResult:this._canManageRoles?this.getRoles():null,userTypesResult:this._canAccessLicenses?this.getUserTypes():null,signedProviderResult:this.getSignedProviderMetadataInfo()}).then(function(){if(v.isDefined(H)){this._configureFormForIdentityProviderType();this._dialog.set("title",this._isFederation?this.i18n.editFederationOfIdentityProvidersTitle:
this.i18n.editIdentityProviderTitle);this._nameInput.set("value",v.isDefined(H.name)?H.name:"");this._encryptionSupported.set("value",v.isDefined(H.encryptionSupported)?H.encryptionSupported:!1);this._signedRequestSupported.set("value",v.isDefined(H.supportSignedRequest)?H.supportSignedRequest:!1);this._signUsingSHA256.set("value",v.isDefined(H.useSHA256)?H.useSHA256:!1);A.showHide(this._sha256Container,v.isDefined(H.supportSignedRequest)&&H.supportSignedRequest);this._loginUrlInput.set("value",v.isDefined(H.bindingUrl)?
H.bindingUrl:"");this._loginUrlPostInput.set("value",v.isDefined(H.bindingPostUrl)?H.bindingPostUrl:"");this._logoutUrlInput.set("value",v.isDefined(H.logoutUrl)?H.logoutUrl:"");this._certificateInput.set("value",v.isDefined(H.certificate)?H.certificate:"");this._logoutRequestSupported.set("value",v.isDefined(H.supportsLogoutRequest)?H.supportsLogoutRequest:!1);this._updateProfile.set("value",v.isDefined(H.updateProfileAtSignin)?H.updateProfileAtSignin:!1);this._updateGroups.set("checked",v.isDefined(H.updateGroupsAtSignin)?
H.updateGroupsAtSignin:!1);this._federationDiscoveryServiceUrl.set("value",v.isDefined(H.discoveryServiceUrl)?H.discoveryServiceUrl:"");this._metadataAggregateUrl.set("value",v.isDefined(H.metadataServiceUrl)?H.metadataServiceUrl:"");this._aggregatedMetadataCertificate.set("value",v.isDefined(H.certificate)?H.certificate:"");var U=!!(this._canAccessLicenses&&H.userLicenseType||this._canManageRoles&&H.roleId||this._canManageCredits&&da&&v.isDefined(H.userCreditAssignment)&&-1<H.userCreditAssignment||
H.groups&&0<H.groups.length||H.userType);R=v.isDefined(H.entityId)&&""!==H.entityId?H.entityId:R;this._entityIDInput.set("value",R);v.isDefined(H.signUpMode)&&(H.signUpMode===this.SIGN_UP_MODE_AUTOMATIC?(this._automaticOption.set("checked",!0),A.showHide(this._levelOptions,!this._isPortal&&this._canAccessLicenses),this._canManageRoles&&A.showHide(this._roleOptions,!this._isPortal),this._canManageCredits&&A.showHide(this._creditOptions,!(this._isPortal||!da)),A.showHide(this._groupOptions,!this._isPortal),
A.showHide(this._esriAccessOptions,!this._isPortal),A.showNode(this._automaticDefaults),A.showNode(this._toConfigureDefaults)):H.signUpMode===this.SIGN_UP_MODE_INVITE&&(this._inviteOption.set("checked",!0),A.hideNodes([this._automaticDefaults,this._toConfigureDefaults])));if(this._canAccessLicenses)if(H.userLicenseType){var Z=B.find(this._userTypes,function(L){return L.id===H.userLicenseType},this);Z?m.set(this._userTypeDefault,"innerHTML",Z.name):m.set(this._userTypeDefault,"innerHTML",this.i18n.notSet)}else m.set(this._userTypeDefault,
"innerHTML",this.i18n.notSet);this._canManageRoles&&(H.roleId?(Z=B.find(this._roles,function(L){return L.id===H.roleId},this))?m.set(this._roleDefault,"innerHTML",Z.name):this._coreRoleSelected(H.roleId)?H.roleId===this.orgUserRole?m.set(this._roleDefault,"innerHTML",this.i18n.userRoleName):H.roleId===this.orgPublisherRole?m.set(this._roleDefault,"innerHTML",this.i18n.publisherRoleName):H.roleId===this.orgAdminRole&&m.set(this._roleDefault,"innerHTML",this.i18n.adminRoleName):m.set(this._roleDefault,
"innerHTML",this.i18n.notSet):m.set(this._roleDefault,"innerHTML",this.i18n.notSet));da?v.isDefined(H.userCreditAssignment)?-1<H.userCreditAssignment?m.set(this._creditsDefault,"innerHTML",f.format(parseInt(H.userCreditAssignment,10))):m.set(this._creditsDefault,"innerHTML",this.i18n.notSet):m.set(this._creditsDefault,"innerHTML",this.i18n.notSet):A.hideNode(this._creditOptions);v.isDefined(H.groups)&&0<H.groups.length?this._fetchSelectedGroups(H.groups):(this._selectedGroups=[],this._toggleGroups());
v.isDefined(H.userType)&&("both"===H.userType?m.set(this._esriAccessDefault,"innerHTML",this.i18n.esriAccessEnabled):m.set(this._esriAccessDefault,"innerHTML",this.i18n.esriAccessDisabled));A.showHide(this._automaticDefaults,U);this._parametersOption.set("checked",!0);this.showParametersInputs();v.isDefined(H.logoutUrl)&&0<H.logoutUrl.length||v.isDefined(H.userIdAttribute)&&0<H.userIdAttribute.length?this.showAdvancedSettings():this.hideAdvancedSettings()}else this._entityIDInput.set("value",R),this._encryptionSupported.set("value",
!1),this._signedRequestSupported.set("value",!1),this._signUsingSHA256.set("value",!1),A.hideNode(this._sha256Container),this._logoutRequestSupported.set("value",!1),this._updateGroups.set("checked",!1),A.showHide(this._levelOptions,!this._isPortal&&this._canAccessLicenses);this._setBtn.set("label",this.i18n.updateIdentityProviderLabel);this._dialog.show()}.bind(this))},_configureFormForIdentityProviderType:function(){A.showHide(this._metadataSourceContainer,!this._isFederation);A.showHide(this._updateGroupsContainer,
!this._isFederation);A.showHide(this._logoutUrlContainer,!this._isFederation);this._certificateInput.set("disabled",this._isFederation?!0:!1);A.showHide(this._federationDiscoveryServiceContainer,this._isFederation);A.showHide(this._metadataAggregateUrlContainer,this._isFederation);A.showHide(this._aggregatedMetadataCertificateContainer,this._isFederation);this._aggregatedMetadataCertificate.set("disabled",this._isFederation?!1:!0);var H=!!this._signedServiceProviderUrl;m.set(this._signedProviderMetadataUrl,
"href",this._signedServiceProviderUrl);m.set(this._signedProviderMetadataUrl,"textContent",this._signedServiceProviderUrl);A.showHide(this._providerMetadataDownloadContainer,H)},_fetchSelectedGroups:function(H){var O=esriGeowConfig.restBaseUrl+"community/groups",K;H&&0<H.length?(H.forEach(function(R){K=K?K+(" OR id:"+R):"id:"+R}),K?(H="orgid:"+esriGeowConfig.self.id+" AND ("+K+") AND -provider:enterprise",z.fetchAllResources(O,{q:H},"results").then(function(R){this._selectedGroups=this._selectedGroups.concat(R);
this._toggleGroups()}.bind(this),function(R){this._selectedGroups=[];this._toggleGroups()}.bind(this))):(this._selectedGroups=[],this._toggleGroups())):(this._selectedGroups=[],this._toggleGroups())},_toggleGroups:function(){var H=x.clone(this._selectedGroups),O=this._selectedGroups&&0<this._selectedGroups.length,K=O?H.splice(0,3).map(function(da){return da.title}):[],R=O?H.map(function(da){return da.title}):[];O?(A.showNode(this._hasGroupDefaults),A.hideNode(this._noGroupDefaults)):(A.hideNode(this._hasGroupDefaults),
A.showNode(this._noGroupDefaults));m.set(this._groupListContainer,"innerHTML",K.join(", "));A.showHide(this._groupListContainer,O);A.showHide(this._otherLinkContainer,0<H.length);0<H.length&&(this._otherLinkTooltip&&this._otherLinkTooltip.destroyRecursive(),this._otherLinkTooltip=y.createTooltip(this.id+"-other-link",R.join(",\x3cbr\x3e"),200,400))},_setupTooltips:function(){this._tooltips&&0===this._tooltips.length&&this._tooltips.push(y.createTooltip(this.id+"-noLimitTooltip-"+this.baseClass,this.i18n.orgLimit,
200,300))},clear:function(){this._dialog.set("title",this.i18n.setIdentityProviderTitle);var H=D.isPortal()||!1===esriGeowConfig.isMultiTenant;H?(m.set(this._description,"innerHTML",this.i18n.setIdentityProviderDescPortal),this._logoutUrlInput.set("title",this.i18n.logoutUrlTooltipPortal),m.set(this._inviteOptionLabel,"innerHTML",this.i18n.onAddOption)):(m.set(this._description,"innerHTML",this.i18n.setIdentityProviderDesc),this._logoutUrlInput.set("title",this.i18n.logoutUrlTooltip),m.set(this._inviteOptionLabel,
"innerHTML",this.i18n.onInviteOption));this._nameInput.set("placeHolder",this._isFederation?this.i18n.federationNamePlaceholder:this.i18n.namePlaceHolder);this._bindingUrlInput.set("placeHolder",this.i18n.metadataUrlPlaceHolder);this._loginUrlInput.set("placeHolder",this.i18n.parametersUrlPlaceHolder);this._loginUrlPostInput.set("placeHolder",this.i18n.parametersUrlPostPlaceHolder);this._logoutUrlInput.set("placeHolder",this.i18n.logoutUrlPlaceHolder);this._entityIDInput.set("placeHolder","");this._federationDiscoveryServiceUrl.set("placeHolder",
this.i18n.federationDiscoveryServiceUrlPlaceholder);this._metadataAggregateUrl.set("placeHolder",this.i18n.metadataAggregateUrlPlaceholder);this._inviteOption.set("checked",!0);A.hideNodes([this._automaticDefaults,this._toConfigureDefaults]);m.set(this._userTypeDefault,"innerHTML",this.i18n.notSet);m.set(this._roleDefault,"innerHTML",this.i18n.notSet);m.set(this._creditsDefault,"innerHTML",this.i18n.notSet);m.set(this._esriAccessDefault,"innerHTML",this.i18n.notSet);m.set(this._groupListContainer,
"innerHTML",this.i18n.notSet);H||(this._selectedGroups=[],this._toggleGroups());this._metadataUrlOption.set("checked",!0);this.showMetadataUrlInputs();this.hideAdvancedSettings();this._nameInput.set("value","");this._bindingUrlInput.set("value","");m.set(this._metadataFileInput,"value","");this._encryptionSupported.set("value",!1);this._signedRequestSupported.set("value",!1);A.hideNode(this._sha256Container);this._signUsingSHA256.set("value",!1);this._logoutRequestSupported.set("value",!1);this._loginUrlInput.set("value",
"");this._loginUrlPostInput.set("value","");this._certificateInput.set("value","");m.set(this._certificateFileInput,"value","");this._logoutUrlInput.set("value","");this._updateProfile.set("value","");this._updateGroups.set("checked",!1);this._federationDiscoveryServiceUrl.set("value","");this._metadataAggregateUrl.set("value","");this._aggregatedMetadataCertificate.set("value","");m.set(this._signUpMode,"value","");m.set(this._bindingType,"value","");this._setBtn.set("disabled",!1);this._selectedUserType=
this._currentIDP=null;this._isEditing=!1;this._roles=[];this._userTypes=[];this._selectedGroups=[]},_setupRoleFlags:function(){var H=!!esriGeowConfig.userRole;this._canAccessLicenses=(this._isAdmin=H&&esriGeowConfig.userRole.isAdmin())||H&&(esriGeowConfig.userRole.canManageLicenses()||esriGeowConfig.userRole.canInviteUsers()||esriGeowConfig.userRole.canManageRoles());this._canManageCredits=this._isAdmin||H&&esriGeowConfig.userRole.canManageCredits();this._canManageRoles=this._isAdmin||H&&esriGeowConfig.userRole.canManageRoles()},
_loadConnections:function(){this.own(e(this._metadataUrlOption,this.onMetadataUrlOption.bind(this)),e(this._metadataFileOption,this.onMetadataFileOption.bind(this)),e(this._parametersOption,this.onParametersOption.bind(this)),e(this._setBtn,this.onSetProvider.bind(this)),e(this._cancelBtn,this.onCancel.bind(this)),e(this._signedRequestSupported,this.onSignedRequestSupported.bind(this)))},hide:function(){this._dialog.hide()},showMetadataUrlInputs:function(){A.hideNodes([this._metadataFileInputs,this._parametersInputs]);
A.showNode(this._metadataUrlInputs);m.set(this._bindingType,"value","")},showMetadataFileInputs:function(){A.hideNodes([this._metadataUrlInputs,this._parametersInputs]);A.showNode(this._metadataFileInputs);m.set(this._bindingType,"value","")},showParametersInputs:function(){A.hideNodes([this._metadataUrlInputs,this._metadataFileInputs]);A.showNode(this._parametersInputs)},showAdvancedSettings:function(){m.set(this._toggleAdvancedSettings,"innerHTML",this.i18n.hideAdvancedSettings);A.showNode(this._advancedSettings);
this._showingAdvancedSettings=!0},hideAdvancedSettings:function(){m.set(this._toggleAdvancedSettings,"innerHTML",this.i18n.showAdvancedSettings);A.hideNode(this._advancedSettings);this._showingAdvancedSettings=!1},validParameters:function(){var H=this.i18n.noticeLabel,O=this._nameInput.get("value");if(!v.isDefined(O)||0===O.length)return z.createSpecifiedDialog(E).show({title:H,message:this.i18n.errors.nameRequired}),!1;if(!this._isFederation){O=this._metadataUrlOption.get("checked");var K=this._bindingUrlInput.get("value");
if(O&&(!v.isDefined(K)||0===K.length))return z.createSpecifiedDialog(E).show({title:H,message:this.i18n.errors.metadataUrlMustBeSet}),!1;O=this._metadataFileOption.get("checked");K=m.get(this._metadataFileInput,"value");if(O&&(!v.isDefined(K)||0===K.length))return dlg.show({title:H,message:this.i18n.errors.metadataFileMustBeSet}),!1;if(this._parametersOption.get("checked")){O=this._loginUrlInput.get("value");if(!v.isDefined(O)||0===O.length)return z.createSpecifiedDialog(E).show({title:H,message:this.i18n.errors.loginUrlMustBeSet}),
!1;O=this._loginUrlPostInput.get("value");if(!v.isDefined(O)||0===O.length)return z.createSpecifiedDialog(E).show({title:H,message:this.i18n.errors.loginUrlPostMustBeSet}),!1;O=this._certificateInput.get("value");if(!v.isDefined(O)||0===O.length)return z.createSpecifiedDialog(E).show({title:H,message:this.i18n.errors.certificateMustBeSet}),!1}}return!0},onAutomaticClicked:function(){var H=esriGeowConfig.self.creditAssignments&&"enabled"===esriGeowConfig.self.creditAssignments,O=!(!this._currentIDP||
!(this._canAccessLicenses&&this._currentIDP.userLicenseType||this._canManageRoles&&this._currentIDP.roleId||this._canManageCredits&&H&&v.isDefined(this._currentIDP.userCreditAssignment)&&-1<this._currentIDP.userCreditAssignment||this._currentIDP.groups&&0<this._currentIDP.groups.length||this._currentIDP.userType));!this._isPortal||this._defaultUserType&&"none"!==this._defaultUserType?(A.showHide(this._automaticDefaults,O),A.showNode(this._toConfigureDefaults),this._canManageRoles&&A.showHide(this._roleOptions,
!this._isPortal),this._canManageCredits&&A.showHide(this._creditOptions,!(this._isPortal||!H)),A.showHide(this._groupOptions,!this._isPortal),A.showHide(this._hasGroupDefaults,this._selectedGroups&&0<this._selectedGroups.length),A.showHide(this._noGroupDefaults,!(this._selectedGroups&&0<this._selectedGroups.length)),A.showHide(this._esriAccessOptions,!this._isPortal),A.showHide(this._levelOptions,!this._isPortal&&this._canAccessLicenses)):(z.createSpecifiedDialog(E).show({title:this.i18n.errorLabel,
message:this.i18n.mustHaveDefaultUserType}),setTimeout(function(){this._automaticOption.setChecked(!1);this._inviteOption.setChecked(!0)}.bind(this)))},onInvitationClicked:function(){A.hideNodes([this._automaticDefaults,this._toConfigureDefaults])},onMetadataUrlOption:function(){this.showMetadataUrlInputs()},onMetadataFileOption:function(){this.showMetadataFileInputs()},onParametersOption:function(){this.showParametersInputs()},onToggleAdvancedSettings:function(){this._showingAdvancedSettings?this.hideAdvancedSettings():
this.showAdvancedSettings()},onSetProvider:function(H){H&&H.preventDefault();this._setBtn.set("disabled",!0);this.validParameters()?(9>a("ie")&&(this._form.encoding="multipart/form-data"),this._automaticOption.get("checked")?m.set(this._signUpMode,"value",this.SIGN_UP_MODE_AUTOMATIC):m.set(this._signUpMode,"value",this.SIGN_UP_MODE_INVITE),m.set(this._supportEncryption,"value",this._encryptionSupported.get("checked")),m.set(this._supportSignedRequest,"value",this._signedRequestSupported.get("checked")),
m.set(this._useSHA256,"value",this._signedRequestSupported.get("checked")&&this._signUsingSHA256.get("checked")),m.set(this._supportsLogoutRequest,"value",this._logoutRequestSupported.get("checked")),m.set(this._updateProfileAtSignIn,"value",this._updateProfile.get("checked")),m.set(this._updateGroupsAtSignIn,"value",this._updateGroups.get("checked")),this._metadataUrlOption.get("checked")?(m.set(this._metadataFileInput,"value",""),this._loginUrlInput.set("value",""),m.set(this._bindingType,"value",
""),this._certificateInput.set("value",""),m.set(this._certificateFileInput,"value","")):this._metadataFileOption.get("checked")?(this._bindingUrlInput.set("value",""),this._loginUrlInput.set("value",""),m.set(this._bindingType,"value",""),this._certificateInput.set("value",""),m.set(this._certificateFileInput,"value","")):(this._bindingUrlInput.set("value",""),m.set(this._metadataFileInput,"value",""),m.set(this._bindingType,"value",this.BINDING_TYPE_REDIRECT)),H=esriGeowConfig.restBaseUrl+"portals/self/idp/",
this._isEditing?(H+=(this._isFederation?"federation/":"")+this._currentIDP.id+"/update",m.set(this._clearEmptyFields,"value",!0)):(H+=(this._isFederation?"federation/":"")+"register",m.set(this._clearEmptyFields,"value",!1)),D.request({url:H,form:this._form},{usePost:!0}).then(function(O){v.isDefined(O)&&!v.isDefined(O.error)&&(this._setBtn.set("disabled",!1),l.publish("setIdentityProvider",[]),this.hide())}.bind(this),function(O){if(v.isDefined(O.messageCode)){var K=this.i18n.errors[O.messageCode];
v.isDefined(O.details)&&v.isDefined(O.details[0])&&(K=c.substitute(K,{details:O.details[0]}))}else K=this._isEditing?this.i18n.errors.unableToUpdateIdentityProvider:this.i18n.errors.unableToSetIdentityProvider;z.createSpecifiedDialog(E).show({title:this.i18n.errorLabel,message:K});this._setBtn.set("disabled",!1)}.bind(this))):this._setBtn.set("disabled",!1)},onSignedRequestSupported:function(){this._signedRequestSupported.get("checked")?A.showNode(this._sha256Container):(this._signUsingSHA256.set("checked",
!1),A.hideNode(this._sha256Container))},onSubmit:function(){return!1},onCancel:function(H){H&&H.preventDefault();this.hide()},onHide:function(){}});W.prototype.statics={_instance:null,getInstance:function(){null===this._instance&&(this._instance=new W);return this._instance}};return W})},"arcgisonline/sharing/dijit/dialog/SharingDlg":function(){define(["dojo","dijit","dojox","dojo/require!dijit/Dialog,dijit/_Widget,dijit/_Templated,arcgisonline/sharing/dijit/ShareOptions"],function(t,p,x){t.provide("arcgisonline.sharing.dijit.dialog.SharingDlg");
t.require("dijit.Dialog");t.require("dijit._Widget");t.require("dijit._Templated");t.require("arcgisonline.sharing.dijit.ShareOptions");t.declare("arcgisonline.sharing.dijit.dialog.SharingDlg",[p._Widget,p._Templated],{widgetsInTemplate:!0,templateString:'\x3cdiv class\x3d"widgetContent"\x3e\r\n  \x3cdiv dojotype\x3d"dijit.Dialog" dojoAttachPoint\x3d"_shareDialog" id\x3d"share-dialog" title\x3d"${i18n.sharingDlgTitle}" execute\x3d""\x3e\r\n    \x3clabel class\x3d"trailer-half share-title"\x3e${i18n.shareItemsLabel}\x3c/label\x3e\r\n    \x3cdiv dojotype\x3d"arcgisonline.sharing.dijit.ShareOptions" dojoAttachPoint\x3d"_shareOptions"\x3e\x3c/div\x3e\r\n    \x3cdiv\x3e\r\n      \x3cp class\x3d"trailer-half font-size--1"\x3e\r\n        ${i18n.settingsMsg}\r\n      \x3c/p\x3e\r\n      \x3cdiv dojoAttachPoint\x3d"_shareNoGroupsDiv" style\x3d"display:none;" class\x3d"alert alert-yellow trailer-half is-active"\x3e\r\n        ${i18n.notAMemberMsg}\r\n      \x3c/div\x3e\r\n      \x3cdiv dojoAttachPoint\x3d"_shareOwnerNoneDiv" style\x3d"display:none;" class\x3d"alert alert-yellow trailer-half is-active"\x3e\r\n        ${i18n.notOwnerMsg}\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"_editableLayerMsg" class\x3d"label-yellow hide js-sharing-help"\x3e\r\n        ${i18n.layerIsEditable} \x3ca href\x3d"${_helpLink}" target\x3d"_blank"\x3e${i18n.learnHow}\x3c/a\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"_premiumContentMsg" class\x3d"label-yellow hide js-premium-help"\x3e\r\n      ${i18n.premiumLayerMsg} \x3ca href\x3d"${_helpLinkPremium}" target\x3d"_blank"\x3e${i18n.premiumLayerMsgLearnMore}\x3c/a\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriFloatTrailing right clearfix share-action-bar leader-half" style\x3d"padding-bottom:1em;"\x3e\r\n      \x3cspan class\x3d"disabled padding-right-1" style\x3d"display:none;"\x3e${i18n.sharingItems}\x3c/span\x3e\r\n      \x3cbutton id\x3d"button_share-cancel" class\x3d"jevent cancel" type\x3d"cancel" dojotype\x3d"dijit.form.Button" dojoAttachEvent\x3d"onClick:_handleCancelClick"\x3e\r\n        ${i18n.cancel}\r\n      \x3c/button\x3e\r\n      \x3cbutton class\x3d"jevent primary" dojotype\x3d"dijit.form.Button"  dojoAttachEvent\x3d"onClick:_handleOkResponse"\x3e\r\n        ${i18n.ok}\r\n      \x3c/button\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
i18n:null,_shareDialog:null,_shareOptions:null,_shareNoGroupsDiv:null,_shareOwnerNoneDiv:null,statics:{_instance:null,getInstance:function(){null===this._instance&&(this._instance=new arcgisonline.sharing.dijit.dialog.SharingDlg);return this._instance}},postMixInProperties:function(){this.inherited(arguments);this.i18n=t.i18n.getLocalization("arcgisonline","arcgisonline").common;t.mixin(this.i18n,t.i18n.getLocalization("arcgisonline","arcgisonline").sharingDlg);t.mixin(this.i18n,t.i18n.getLocalization("arcgisonline",
"arcgisonline").shareCheckDlg);t.mixin(this.i18n,t.i18n.getLocalization("arcgisonline","arcgisonline").shareMapDlg);this._helpLink=esriGeowConfig.helpBase+esriGeowConfig.helpMap["120001067"];this._helpLinkPremium=esriGeowConfig.helpBase+esriGeowConfig.helpMap["120001307"];this._handles=[]},postCreate:function(){this.loadConnections()},destroy:function(){t.forEach(this._handles,"item.remove();");this._shareDialog.destroyRecursive();this._shareDialog=null;this.inherited(arguments)},_setDisabledAttr:function(b){t.forEach(p.registry.findWidgets(this._shareDialog.domNode),
function(m){m.set("disabled",b)});t.query("input").forEach(function(m){t.attr(m,"disabled",b)});t.query(".disabled").forEach(function(m){t.style(m,"display",b?"":"none")})},loadConnections:function(){t.connect(this._shareDialog,"hide",t.hitch(this,function(b){(b=b&&b.target)&&t.hasClass(b,"dijitDialogCloseIcon")&&(this.isCancelled=!0);this.set("disabled",!1);this._shareOptions.clear()}));this._handles.push(t.subscribe("shareOptionsSetup",t.hitch(this,function(){this._shareDialog.show()})));this._handles.push(t.subscribe("onShareUpdate",
t.hitch(this,function(b){this.set("disabled",!1);b&&b.length&&"string"!==typeof b||this._shareDialog.hide()})));this._handles.push(t.subscribe("doesNotOwnGroups",t.hitch(this,function(){t.style(this._shareOwnerNoneDiv,"display","block")})));this._handles.push(t.subscribe("notMemberOfAnyGroups",t.hitch(this,function(){t.style(this._shareNoGroupsDiv,"display","block")})))},_handleOkResponse:function(b){b.preventDefault();this.set("disabled",!0);this._shareOptions.share(b)},_handleCancelClick:function(b){b.preventDefault();
this.isCancelled=!0;this._shareDialog.hide()},hide:function(){this._shareDialog.hide()},show:function(b,m,f,d){this._shareOptions.show(b,m,f,d)},showAdmin:function(b,m,f,d){this._shareOptions.showAdmin(b,m,f,d)},showGroups:function(b,m){this._shareOptions.showGroups(b,m)}})})},"arcgisonline/sharing/dijit/dialog/TagsDlg":function(){define(["dojo","dijit","dojox","dojo/require!dijit/_Widget,dijit/_Templated,dijit/Dialog,dijit/form/MultiSelect,dijit/form/SimpleTextarea,arcgisonline/sharing/geow/Content"],
function(t,p,x){t.provide("arcgisonline.sharing.dijit.dialog.TagsDlg");t.require("dijit._Widget");t.require("dijit._Templated");t.require("dijit.Dialog");t.require("dijit.form.MultiSelect");t.require("dijit.form.SimpleTextarea");t.require("arcgisonline.sharing.geow.Content");t.declare("arcgisonline.sharing.dijit.dialog.TagsDlg",[p._Widget,p._Templated],{widgetsInTemplate:!0,templateString:'\x3cdiv class\x3d"widgetContent" \x3e\r\n  \x3cdiv dojotype\x3d"dijit.Dialog" dojoAttachPoint\x3d"_tagsDialog" dojoAttachPoint\x3d"onHide:clear" title\x3d"${i18n.tagDlgTitle}" class\x3d"tagsForm"\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"_tagsErrorDiv"\x3e\x3c/div\x3e\r\n\t\x3cdiv dojoAttachPoint\x3d"_contentTagsDiv" style\x3d"display:block;"\x3e\r\n\t\t\x3clabel \x3e${i18n.selectTag}\x3c/label\x3e\r\n\t\t\x3cbr /\x3e\r\n\t\t\x3cbr /\x3e\r\n\t    \x3cselect dojoAttachPoint\x3d"_tagsSelect" dojoType\x3d"dijit.form.MultiSelect" style\x3d"width:100%;height:150px;"\x3e\x3c/select\x3e\r\n\t\t\x3cbr /\x3e\r\n\t\t\x3cdiv dojoAttachPoint\x3d"_cancelBtn" dojotype\x3d"dijit.form.Button" class\x3d"cancel" dojoAttachEvent\x3d"onClick:_handleCancelClick" style\x3d"float:right;"\x3e${i18n.cancel}\x3c/div\x3e\r\n\t\t\x3cdiv dojoAttachPoint\x3d"_submitBtn" dojotype\x3d"dijit.form.Button" class\x3d"primary" type\x3d"submit" dojoAttachEvent\x3d"onClick:getSelectedTags" style\x3d"float:right;"\x3e${i18n.useSelected}\x3c/div\x3e  \r\n\t\t\x3cbr /\x3e\r\n\t\t\x3cbr /\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv dojoAttachPoint\x3d"_contentNoTagsDiv" style\x3d"display:none;"\x3e\r\n\t\t\x3clabel\x3e${i18n.tagsNotAvailable}\x3c/label\x3e\r\n\t\t\x3cbr /\x3e\r\n\t\t\x3cbr /\x3e\r\n\t\t\x3cdiv id\x3d"button_tags-ok" dojoAttachPoint\x3d"_okBtn" dojotype\x3d"dijit.form.Button" class\x3d"primary" dojoAttachEvent\x3d"onClick:_handleCancelClick" style\x3d"float:right;"\x3e${i18n.ok}\x3c/div\x3e\r\n\t\t\x3cbr/\x3e\r\n\t\t\x3cbr/\x3e\r\n\t\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
_tagsDialog:null,_contentTagsDiv:null,_contentNoTagsDiv:null,_tagsSelect:null,i18n:null,statics:{_instance:null,getInstance:function(){null==this._instance&&(this._instance=new arcgisonline.sharing.dijit.dialog.TagsDlg);return this._instance}},postMixInProperties:function(){this.inherited(arguments);this.i18n=t.i18n.getLocalization("arcgisonline","arcgisonline").common;t.mixin(this.i18n,t.i18n.getLocalization("arcgisonline","arcgisonline").tagsDlg)},postCreate:function(){},_handleCancelClick:function(b){b.preventDefault();
this._tagsDialog.hide()},clear:function(){this._tagsSelect.reset();t.style(this._contentTagsDiv,"display","none");t.style(this._contentNoTagsDiv,"display","none")},hide:function(){this._tagsDialog.hide()},show:function(b){this.clear();var m=arcgisonline.sharing.util.getUser(),f=esriGeowConfig.restBaseUrl+"community/users/";f=b&&(b.username||b.email)?f+(b.username?b.username:b.email):f+m.username;arcgisonline.sharing.util.getJson(f+"/tags",t.hitch(this,this._handleTagResponse),t.hitch(this,this._handleError));
this._tagsDialog.show()},_handleTagResponse:function(b){0==b.tags.length?t.style(this._contentNoTagsDiv,"display",""):(t.style(this._contentTagsDiv,"display",""),t.empty(this._tagsSelect.domNode),t.forEach(b.tags,function(m){t.create("option",{innerHTML:m.tag,value:m.tag},this._tagsSelect.domNode)},this))},_handleError:function(b){},getSelectedTags:function(b){b.preventDefault();b=[];b=this._tagsSelect.get("value");t.publish("onSelectedTagsUpdate",[b.toString()])}})})},"arcgisonline/sharing/dijit/dialog/TermsOfUseDlg":function(){define(["dojo",
"dijit","dojox","dojo/require!dijit/_Widget,dijit/_Templated,arcgisonline/sharing/util,dijit/Dialog"],function(t,p,x){t.provide("arcgisonline.sharing.dijit.dialog.TermsOfUseDlg");t.require("dijit._Widget");t.require("dijit._Templated");t.require("arcgisonline.sharing.util");t.require("dijit.Dialog");t.declare("arcgisonline.sharing.dijit.dialog.TermsOfUseDlg",[p._Widget,p._Templated],{util:arcgisonline.sharing.util,widgetsInTemplate:!0,templateString:'\x3cdiv class\x3d"widgetContainer"\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/Dialog" id\x3d"terms-of-use-dialog" data-dojo-attach-point\x3d"_dialog" title\x3d"${i18n.title}" execute\x3d"" style\x3d"overflow-y:auto;"\x3e\r\n    \x3cform id\x3d"terms-of-use-form" method\x3d"POST" action\x3d"" style\x3d"height:100%;overflow-y:auto;padding-left:10px;"\x3e\r\n      \x3cdiv style\x3d"height:30px; text-align:center;"\x3e\r\n        \x3cspan style\x3d"font-size:1.1em; font-weight:bold"\x3e${i18n.termsOfUseTitle}\x3c/span\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-type\x3d"dijit/layout/ContentPane" id\x3d"tos" style\x3d"background:#FFF;border:solid 1px #000;overflow-x:hidden;overflow-y:hidden;width:400px;height:250px;"\x3e\r\n        \x3ca href\x3d\'\'\x3e\x3c/a\x3e\r\n        \x3ciframe id\x3d"termsFrame" src\x3d"termsofuse.html" style\x3d"width:100%;height:250px;max-width:100%;max-height:250px;"\x3e\x3c/iframe\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv style\x3d"padding-top:10px;"\x3e\r\n        \x3cspan class\x3d"esriItemLinks"\x3e\x3ca href\x3d"http://www.esri.com/legal/licensing-translations" target\x3d"_blank"\x3e${i18n.otherLanguages}\x3c/a\x3e\x3c/span\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv style\x3d"height:40px; padding-top:10px;"\x3e\r\n        \x3cbutton id\x3d"button_accept" type\x3d"submit" class\x3d"primary" data-dojo-type\x3d"dijit/form/Button"\x3e\r\n            ${i18n.accept}\r\n        \x3c/button\x3e\r\n        \x3cbutton id\x3d"button_decline" class\x3d"jevent cancel" type\x3d"cancel" data-dojo-type\x3d"dijit/form/Button"\x3e\r\n            ${i18n.noaccept}\r\n        \x3c/button\x3e\r\n      \x3c/div\x3e\r\n    \x3c/form\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
_firstLoad:!0,statics:{_instance:null,getInstance:function(){null==this._instance&&(this._instance=new arcgisonline.sharing.dijit.dialog.TermsOfUseDlg);return this._instance}},postMixInProperties:function(){this.inherited(arguments);this.i18n=t.i18n.getLocalization("arcgisonline","arcgisonline").common;t.mixin(this.i18n,t.i18n.getLocalization("arcgisonline","arcgisonline").termsOfUseDlg)},postCreate:function(){this.loadConnections()},show:function(b){p.byId("terms-of-use-dialog").show();esri.isTouchEnabled?
(t.style(t.byId("terms-of-use-dialog"),"width","500px"),t.style(t.byId("tos"),"width","455px"),t.style(t.byId("tos"),"overflow-y","scroll")):this._firstLoad&&(t.style(t.byId("terms-of-use-dialog"),"width","455px"),t.isFF||10>t.isIE?(t.isFF&&t.style(t.byId("tos"),"height",parseInt(t.style(t.byId("terms-of-use-dialog"),"height"))-169+"px"),9>t.isIE&&t.style(t.byId("tos"),"height",parseInt(t.style(t.byId("terms-of-use-dialog"),"height"))-208+"px"),8>t.isIE&&t.style(t.byId("tos"),"height",parseInt(t.style(t.byId("terms-of-use-dialog"),
"height"))-133+"px")):t.style(t.byId("tos"),"height",parseInt(t.style(t.byId("terms-of-use-dialog"),"height"))-169+"px"),t.style(t.byId("terms-of-use-form"),"overflow-y","hidden"),this._firstLoad=!1)},loadConnections:function(){t.query(".jevent").connect("onclick",function(b){b.preventDefault()});t.connect(t.byId("button_decline"),"onclick",this,"declineTerms");t.connect(t.byId("terms-of-use-form"),"onsubmit",this,"registerUser")},hide:function(){p.byId("terms-of-use-dialog").hide()},registerUser:function(b){b.preventDefault();
this.hide();t.publish("registerUser",["true"])},declineTerms:function(b){b.preventDefault();this.hide();t.publish("declineTermsOfUse",["true"])}})})},"arcgisonline/sharing/dijit/dialog/UpdateItemDlg":function(){define(["dojo","dijit","dojox","dojo/require!dijit/form/SimpleTextarea,dijit/form/TextBox,dijit/form/CheckBox,dijit/form/Button,dijit/InlineEditBox,dijit/Dialog,dijit/_Widget,dijit/_Templated,arcgisonline/pages/pageUtil,arcgisonline/pages/utils/dom,arcgisonline/pages/dijit/UploadProgressBar,arcgisonline/sharing/util,arcgisonline/sharing/geow/Community,arcgisonline/sharing/geow/Content,arcgisonline/sharing/geow/Item,arcgisonline/sharing/dijit/dialog/GeneralDlg,arcgisonline/sharing/dijit/dialog/TagsDlg,dojo/promise/all,dojo/number"],
function(t,p,x){t.provide("arcgisonline.sharing.dijit.dialog.UpdateItemDlg");t.require("dijit.form.SimpleTextarea");t.require("dijit.form.TextBox");t.require("dijit.form.CheckBox");t.require("dijit.form.Button");t.require("dijit.InlineEditBox");t.require("dijit.Dialog");t.require("dijit._Widget");t.require("dijit._Templated");t.require("arcgisonline.pages.pageUtil");t.require("arcgisonline.pages.utils.dom");t.require("arcgisonline.pages.dijit.UploadProgressBar");t.require("arcgisonline.sharing.util");
t.require("arcgisonline.sharing.geow.Community");t.require("arcgisonline.sharing.geow.Content");t.require("arcgisonline.sharing.geow.Item");t.require("arcgisonline.sharing.dijit.dialog.GeneralDlg");t.require("arcgisonline.sharing.dijit.dialog.TagsDlg");t.require("dojo.promise.all");t.require("dojo.number");t.declare("arcgisonline.sharing.dijit.dialog.UpdateItemDlg",[p._Widget,p._Templated],{util:arcgisonline.sharing.util,community:arcgisonline.sharing.geow.Community,content:arcgisonline.sharing.geow.Content,
itemAPI:arcgisonline.sharing.geow.Item,pageUtil:arcgisonline.pages.pageUtil,domUtil:arcgisonline.pages.utils.dom,widgetsInTemplate:!0,templateString:'\x3cdiv class\x3d"widgetContainer"\x3e\r\n  \x3cdiv dojotype\x3d"dijit.Dialog" dojoAttachPoint\x3d"_updateItemDialog" title\x3d"${i18n.updateItem}" dojoAttachEvent\x3d"hide:clear" execute\x3d"" class\x3d"update-item-dlg"\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"_errorDiv"\x3e\x3c/div\x3e\r\n    \x3cform dojoAttachPoint\x3d"_updateItemForm" enctype\x3d"multipart/form-data"\x3e\r\n      \x3cdiv dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateItemFolderInput" type\x3d"hidden" value\x3d"0"\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"id" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateItemIdInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"name" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateItemNameInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"title" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateItemTitleInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"tags" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateItemTagsInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"type" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateItemTypeInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"typeKeywords" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateItemKeywordsInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"description" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateDescriptionInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"snippet" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateSnippetInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"accessInformation" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateAccessInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"licenseInfo" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateLicenseInfoInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"extent" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateExtentInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"overwrite" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateOverwriteInput" type\x3d"hidden" value\x3d"true"\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"async" dojotype\x3d"dijit.form.TextBox" type\x3d"hidden" dojoAttachPoint\x3d"_updateAsyncInput" value\x3d"true"\x3e\x3c/div\x3e\r\n\r\n      \x3cdiv\x3e\x3clabel class\x3d"font-size--1" dojoAttachPoint\x3d"_replaceUpdateVerLabel"\x3e${i18n.replaceUpdatedVersionMsg}\x3c/label\x3e\x3c/div\x3e\r\n\r\n      \x3cdiv style\x3d"padding-top:4px;margin-bottom:1.0em;"\x3e\r\n        \x3clabel class\x3d"esriFloatLeading esriTrailingMargin2" style\x3d"margin-top:6px;" for\x3d"update-item-file"\x3e${i18n.itemLabel}\x3c/label\x3e\r\n        \x3cinput type\x3d"file" dojoAttachPoint\x3d"_updateItemFile" id\x3d"update-item-file" name\x3d"file" size\x3d"40" class\x3d"esriFileInput"\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cdiv id\x3d"overwrite_section" class\x3d"hide" style\x3d"padding-top:4px;margin-bottom:1.0em;"\x3e\r\n        \x3cinput id\x3d"overwriteService" type\x3d"checkbox" name\x3d"overwriteService" dojotype\x3d"dijit.form.CheckBox" checked\x3d"checked" dojoAttachPoint\x3d"_overwriteService"/\x3e\r\n        \x3clabel id\x3d"overwriteServiceLbl" for\x3d"overwriteService"\x3e${i18n.overwriteService} ${i18n.keepFieldsSame}\x3c/label\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cdiv id\x3d"update-item-keepdescription" style\x3d"width:100%;display:none;"\x3e\r\n        \x3cdiv style\x3d"padding-bottom:5px; padding-top:2px;"\x3e\r\n          \x3clabel\x3e${i18n.updateItemDescription}\x3c/label\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv style\x3d"line-height:23px"\x3e\r\n          \x3cinput type\x3d"radio" name\x3d"useDescription" dojotype\x3d"dijit.form.RadioButton" checked\x3d"checked" dojoAttachPoint\x3d"_useDescKeepRadio" id\x3d"useDescription:keep"/\x3e\r\n          \x3clabel for\x3d"useDescription:keep"\x3e${i18n.keepExistingProperties}\x3c/label\x3e\r\n          \x3cinput type\x3d"radio" name\x3d"useDescription" dojotype\x3d"dijit.form.RadioButton" dojoAttachPoint\x3d"_useDescUpdateRadio" id\x3d"useDescription:update"/\x3e\r\n          \x3clabel for\x3d"useDescription:update"\x3e${i18n.useUploadedProperties}\x3c/label\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cdiv class\x3d"leader-half trailer-half flex"\x3e\r\n        \x3cdiv class\x3d"flex flex-1"\x3e\r\n          \x3cspan data-dojo-attach-point\x3d"_waitingSpan" class\x3d"hide flex-column-justify-center"\x3e${i18n.uploadingItem}\x3c/span\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_uploadProgressBar"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cbutton dojotype\x3d"dijit.form.Button" dojoAttachEvent\x3d"onClick:_handleCancel" dojoAttachPoint\x3d"_cancelBtn" id\x3d"button_update-item-cancel" class\x3d"jevent cancel margin-right-half" type\x3d"cancel"\x3e${i18n.cancel}\x3c/button\x3e\r\n        \x3cbutton id\x3d"button_update-item" type\x3d"button" dojotype\x3d"dijit.form.Button" dojoAttachEvent\x3d"onClick:uploadItem" class\x3d"primary" dojoAttachPoint\x3d"_updateItemBtn"\x3e${i18n.updateItem}\x3c/button\x3e\r\n      \x3c/div\x3e\r\n    \x3c/form\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
item:null,admin:null,i18n:null,_replaceUpdateVerLabel:null,_updateItemDialog:null,_updateItemForm:null,_updateItemBtn:null,_cancelBtn:null,_waitingSpan:null,_useDescUpdateRadio:null,_useDescKeepRadio:null,_updateItemFile:null,_errorDiv:null,_updateItemFolderInput:null,_updateItemIdInput:null,_updateItemNameInput:null,_updateItemTitleInout:null,_updateItemTagsInput:null,_updateItemTypeInput:null,_updateItemKeywordsInput:null,_updateDescriptonInput:null,_updateSnippetInput:null,_updateAccessInput:null,
_updateLicenseInfoInput:null,_updateExtentInput:null,_updateOverwriteInput:null,_updateAsyncInput:null,statics:{_instance:null,getInstance:function(){null===this._instance&&(this._instance=new arcgisonline.sharing.dijit.dialog.UpdateItemDlg);return this._instance}},postMixInProperties:function(){this.inherited(arguments);this.i18n=t.i18n.getLocalization("arcgisonline","arcgisonline").common;t.mixin(this.i18n,t.i18n.getLocalization("arcgisonline","arcgisonline").updateItemDlg);t.mixin(this.i18n,{updating:t.i18n.getLocalization("arcgisonline",
"arcgisonline").addItemFrm.updating})},postCreate:function(){},show:function(b,m){var f={Shapefile:1,"File Geodatabase":1,GeoJson:1,CSV:1,"Microsoft Excel":1},d=b&&b.publishParameters&&"address"===b.publishParameters.locationType;this.item=b;m&&null!==this.adminUser&&(this.admin=m);"Layer Package"==b.type&&t.style(t.byId("update-item-keepdescription"),"display","block");"Vector Tile Service"===b.type?(t.attr(this._replaceUpdateVerLabel,"innerHTML",this.i18n.overwriteStyle),this._updateItemDialog.set("title",
this.i18n.updateStyle),this._updateItemBtn.set("label",this.i18n.updateStyle)):(this.itemName=this.item.sourceData&&this.item.sourceData.name||this.item.name,t.attr(this._replaceUpdateVerLabel,"innerHTML",t.string.substitute(this.i18n.replaceUpdatedVersionMsg,[this.itemName])));b&&b.type in f&&b.relatedService?this._overwriteService.set("checked",!1):b&&b.sourceData?(this._updateItemDialog.set("title",this.i18n.updateFeatures),this._updateItemBtn.set("label",this.i18n.updateFeatures),f=t.string.substitute(d?
this.i18n.overwriteServiceWithCreditsMsg:this.i18n.overwriteServiceMsg,[b.title,b.sourceData.name]),t.attr(this._replaceUpdateVerLabel,"innerHTML",f)):this._overwriteService.set("checked",!1);b&&b.sourceData&&(esri.hide(this._overwriteService.domNode),t.attr("overwriteServiceLbl","innerHTML",this.i18n.keepFieldsSame),t.removeClass("overwrite_section","hide"));this._updateItemDialog.show();this._uploadProgressBar=new arcgisonline.pages.dijit.UploadProgressBar({},this._uploadProgressBar);this._uploadProgressBar.startup();
this._uploadProgressBar.hide()},clear:function(){this._updateItemFile.value="";this._useDescKeepRadio.set("checked",!0);this._useDescUpdateRadio.set("checked",!1);this._overwriteService.set("checked",!0)},_handleCancel:function(b){b.preventDefault();this._updateItemDialog.hide()},hide:function(){this._disable(!1);this._updateItemDialog.hide()},uploadItem:function(b){b.preventDefault();if(0===this._updateItemFile.value.length)return arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.errorLabel,
message:this.i18n.error.providePath}),!1;b=this._fetchItem(this.item).then(t.hitch(this,"loadFile"));if(this.item.sourceData||this.item.relatedService&&this._overwriteService.get("checked"))t.attr(this._waitingSpan,"innerHTML",this.i18n.updating),b=b.then(t.hitch(this,"_updateServiceData",this.item.sourceData||this.item)).then(t.hitch(this,"_resetServiceTitle",this.item));return b.then(t.hitch(this,function(m){m&&!m.success&&m.error&&arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.updateItemErrorTitle,
message:m.error.message||this.i18n.error.errorWhileUpdate});m&&m.serviceItemId?(this._disable(!1),this._updateItemDialog.hide(),window.location="item.html?id\x3d"+m.serviceItemId+(m.jobId?"\x26jobid\x3d"+m.jobId:"")):t.publish("itemData/update",[""]);return!0}),t.hitch(this,function(m){t.isObject(m)&&arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.updateItemErrorTitle,message:m.message||this.i18n.error.errorWhileUpdate});this._disable(!1)}))},_updateServiceData:function(b){var m=
new t.Deferred;this._checkStatus(b,500,t.hitch(this,function(f){var d=esriGeowConfig.restBaseUrl+"content/users/"+f.owner+"/publish",a,c,l={itemid:f.id,filetype:{"file geodatabase":"filegeodatabase",shapefile:"shapefile",geojson:"geojson",csv:"CSV","microsoft excel":"excel"}[f.type.toLowerCase()],overwrite:!0,publishParameters:t.json.stringify({name:this.item.title?this.item.title.replace(/ /g,"_"):f.title.replace(/ /g,"_")})};t.attr(this._waitingSpan,"innerHTML",this.i18n.updating);t.promise.all([this._fetchPublishParameters(this.item),
this._fetchServiceInfo(this.item.relatedService||this.item)]).then(t.hitch(this,function(h){a=h[1];(c=h[0])&&"CSV"===f.type?(h=t.mixin(t.mixin({},a.layers&&a.layers[0]),{fields:c.layerInfo.fields}),l.publishParameters=t.mixin(c,{layerInfo:h,name:c.name||f.title.replace(/ /g,"_")})):c&&"Microsoft Excel"===f.type?(l.publishParameters=this._generateExcelOverwritePublishParameters(c,a),a=null):l.publishParameters={name:f.title?f.title.replace(/ /g,"_"):this.item.title.replace(/ /g,"_")};l.publishParameters=
a?t.json.stringify(t.mixin(l.publishParameters,a)):l.publishParameters;return this.util.request({url:d,content:l},{usePost:!0}).then(t.hitch(this,function(n){m.resolve(n&&n.services&&n.services[0]||{serviceItemId:f.id})}),t.hitch(this,function(n){m.reject(n)}))}))}));return m},_generateExcelOverwritePublishParameters:function(b,m){m.name=b.name;m.sourceSR=b.sourceSR;m.targetSR=b.targetSR;for(var f=0;f<m.tables.length;f++)"Review"!=m.tables[f].name&&(m.layers[m.layers.length]=m.tables[f]);for(f=0;f<
m.layers.length;f++)m.layers[f].excelSheetId=b.layers[f].excelSheetId,m.layers[f].locationType=b.layers[f].locationType,m.layers[f].latitudeFieldName=b.layers[f].latitudeFieldName,m.layers[f].longitudeFieldName=b.layers[f].longitudeFieldName,m.layers[f].geocodeServiceUrl=b.layers[f].geocodeServiceUrl,m.layers[f].sourceLocale=b.layers[f].sourceLocale,m.layers[f].sourceCountry=b.layers[f].sourceCountry,m.layers[f].standardizedFieldNames=b.layers[f].standardizedFieldNames,m.layers[f].addressFields=b.layers[f].addressFields;
return JSON.stringify(m)},_resetServiceTitle:function(b,m){var f=new t.Deferred,d=this.util.getUser(),a=b.title||"",c=b.folderId||b.ownerFolder;d=esriGeowConfig.restBaseUrl+"content/users/"+(b.owner||d.username)+"/"+(c?c+"/":"")+"items/"+b.id+"/update";a=-1!==b.typeKeywords.indexOf("Involved Lookup")?{title:a,typeKeywords:b.typeKeywords.toString()+",showUnmatchedAddresses"}:{title:a};this.util.request({url:d,content:a},{usePost:!0}).then(t.hitch(this,function(){f.resolve(m)}),t.hitch(this,function(){f.resolve(m)}));
return f},_fetchServiceInfo:function(b){b=b.url;var m={addToken:(this.util.isHostedService(b)||this.util.isAgolService(b))&&!1!==esriGeowConfig.isMultiTenant},f=new t.Deferred,d;t.promise.all([this.util.request({url:b},m),this.util.request({url:b+"/layers"},m)]).then(t.hitch(this,function(a){var c={},l=a&&1<a.length&&a[1],h=l&&l.layers;l=l&&l.tables;h&&h.length&&(t.forEach(h,function(n){delete n.fields}),c.layers=h);l&&l.length&&(c.tables=l);d=t.mixin(a[0],c);f.resolve(d)}));return f},_fetchPublishParameters:function(b){var m=
esriGeowConfig.restBaseUrl+"content/items/"+b.id+"/info/publishParameters.json";b.publishParameters?(m=new t.Deferred,m.resolve(b.publishParameters)):!b.sourceData||"CSV"!==b.sourceData.type&&"Microsoft Excel"!==b.sourceData.type?(m=new t.Deferred,m.resolve(!1)):m=this.util.request({url:m}).then(t.hitch(this,function(f){return f}));return m},_fetchItem:function(b){if(b.sourceData)var m=this.util.request({url:esriGeowConfig.restBaseUrl+"content/items/"+b.sourceData.id}).then(t.hitch(this,function(f){f.folderId=
f.ownerFolder;return f}));else m=new t.Deferred,m.resolve(b);return m},loadFile:function(b){var m=new t.Deferred,f=this._updateItemFile.value,d=f.lastIndexOf("\\"),a=b.type;-1<d&&(f=f.substring(d+1,f.length));f=f.replace(/ /g,"_");if("Vector Tile Service"!==b.type&&this.itemName!=f)return b=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance(),b.show({title:this.i18n.errorLabel,message:t.string.substitute(this.i18n.error.sameFileName,[this.itemName])}),this._updateItemFile.value=
"",m.reject(!0),m;if("Vector Tile Service"===b.type){d=/(?:\.([^.]+))?$/;var c=f.replace(/^.*(\\|\/|:)/,"");if("json"!==(f?d.exec(c)[1].toLowerCase():""))return b=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance(),b.show({title:this.i18n.errorLabel,message:this.i18n.error.invalidStyleFileExtension}),this._updateItemFile.value="",m.reject(!0),m}this._disable(!0);f=!0;"Layer Package"==a&&(f=t.byId("useDescription:keep").checked);this._updateItemNameInput.set("value",this.itemName);
this._updateItemTitleInput.set("value",b.title);this._updateItemTagsInput.set("value",b.tags);this._updateItemTypeInput.set("value",a);this._updateItemKeywordsInput.set("value",b.typeKeywords);this._updateAccessInput.set("value",b.accessInformation);this._updateLicenseInfoInput.set("value",b.licenseInfo);this._updateItemFolderInput.set("value",b.folderId);f?(this._updateDescriptionInput.set("value",b.description),this._updateSnippetInput.set("value",b.snippet),this._updateExtentInput.set("value",
b.extent)):(this._updateDescriptionInput.set("value",""),this._updateSnippetInput.set("value",""),this._updateExtentInput.set("value",""));var l=function(h,n){if(!h.success||"completed"!==h.status&&h.status){var g=this.i18n.error.errorWhileUpdate;h&&h.error&&h.error.message&&(g=h.error.message);-1<g.indexOf("The request size is greater than the max allowed of 1024MB")&&(g=this.i18n.error.exceedFileSizeLimit);arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.updateItemErrorTitle,
message:g});m.reject(!0)}else m.resolve(!0)};a=function(h){this._disable(!1);m.reject(h)};b&&"Vector Tile Service"===b.type?this._updateItemResource(b,this._updateItemForm).then(t.hitch(this,l),t.hitch(this,a)):(this._uploadProgressBar.reset(),this._uploadProgressBar.show(),this.itemAPI.update.call(this.itemAPI,b,this._updateItemForm,this._updateItemFile.files[0]).then(function(h){this._uploadProgressBar.hide();l(h)}.bind(this),a.bind(this)));return m},_updateItemResource:function(b,m){var f=this.util.getUser(),
d=b.folderId||b.ownerFolder;f={url:esriGeowConfig.restBaseUrl+"content/users/"+(b.owner||f.username)+"/"+(d?d+"/":"")+"/items/"+b.id+"/updateResources",form:m,content:{resourcesPrefix:"styles",filename:"root.json"}};t.query("input",m).forEach(t.hitch(this,function(a){a&&"file"!==a.name&&t.attr(a,"name","")}));return this.util.request(f,{usePost:!0}).then(t.hitch(this,function(a){return a}),t.hitch(this,function(a){throw{message:this.i18n.error.invalidStyleFile};}))},_checkStatus:function(b,m,f){this.util.request({url:esriGeowConfig.restBaseUrl+
"content/users/"+b.owner+(b.ownerFolder&&"/"!==b.ownerFolder?"/"+b.ownerFolder:"")+"/items/"+b.id+"/status"}).then(t.hitch(this,function(d){d=d||{status:"failed"};"completed"===d.status?f(b):(m=(m||500)+250,setTimeout(t.hitch(this,function(){this._checkStatus(b,m,f)}),m))}))},_disable:function(b){this._updateItemBtn.set("disabled",b);this._cancelBtn.set("disabled",b);this.domUtil.showHide(this._waitingSpan,b);t.style(this._waitingSpan,"display",b?"inline-block":"none")}})})},"arcgisonline/pages/dijit/UploadProgressBar":function(){define("require exports tslib dojo/topic dojo/text!./UploadProgressBar/UploadProgressBar.html dojo/i18n!../../nls/arcgisonline dijit/_TemplatedMixin dijit/_WidgetBase ../utils/dom ../utils/culture ../../tsutils/declareDecorator".split(" "),
function(t,p,x,b,m,f,d,a,c,l,h){b=x.__importDefault(b);m=x.__importDefault(m);f=x.__importDefault(f);d=x.__importDefault(d);a=x.__importDefault(a);c=x.__importDefault(c);l=x.__importDefault(l);h=x.__importDefault(h);return function(){function n(g,e){this.templateString=m["default"];this.i18n=f["default"]}n.prototype.startup=function(){this.inherited(arguments);this.own(b["default"].subscribe("item/upload-progress-update",this._onProgressUpdate.bind(this)))};n.prototype.hide=function(){c["default"].hideNode(this.domNode)};
n.prototype.show=function(){c["default"].showNode(this.domNode)};n.prototype.reset=function(){this._uploadPercentLabel.textContent=this._uploadProgressFill.style.width="0%";this._uploadPercentLabel.innerHTML=l["default"].getPercentString(0);this._uploadProgressFill.style.width="0%"};n.prototype._onProgressUpdate=function(g){this._uploadProgressFill.classList[100===g?"add":"remove"]("upload-progress-bar__fill--full");this._uploadPercentLabel.innerHTML=l["default"].getPercentString(g/100);this._uploadProgressFill.style.width=
g+"%"};return n=x.__decorate([h["default"](a["default"],d["default"])],n)}()})},"arcgisonline/sharing/geow/Item":function(){define("require exports tslib ../../esriGeowConfig ../util dojo/Deferred dojo/dom-form dojo/topic dojo/promise/all esri/request".split(" "),function(t,p,x,b,m,f,d,a,c,l){b=x.__importDefault(b);m=x.__importDefault(m);f=x.__importDefault(f);d=x.__importDefault(d);a=x.__importDefault(a);c=x.__importDefault(c);l=x.__importDefault(l);return function(){function h(){}h.addItem=function(n,
g,e){return h._action(n,g,e,"addItem")};h.update=function(n,g,e){return h._action(n,g,e,"update")};h._action=function(n,g,e,k){if(m["default"].getUser())return k=h._getActionItemUrl(n,k),n=5242880<e.size?h._multiPartAction(k,g,e,n):h._postForm(k,g)};h._multiPartAction=function(n,g,e,k){var w=new f["default"],q=function(z){w.reject(z)},u=function(z){z.isMultipart=!0;w.resolve(z)},r=function(z){h._commitItem(k,g).then(u,q)},v=function(z){h._cancelItem(k);"Request canceled"!==z.message&&q.call(h,z)};
h._startMultipartRequest(n,k.fileName?k.fileName:e.name).then(function(z){z.success?(k.id=z.id,h._addItemParts(k,e).then(r,v)):q.call(h,z.error)},q);return w};h._postForm=function(n,g){return m["default"].request({url:n,form:g,timeout:0},{usePost:!0})};h._startMultipartRequest=function(n,g){return m["default"].request({url:n,content:{multipart:!0,filename:g,async:!0}},{usePost:!0})};h.generatePart=function(n,g){var e,k,w,q,u,r,v,z,B;return x.__generator(this,function(A){switch(A.label){case 0:e=n.name,
k=n.size,w=5242880,q=Math.ceil(k/w),u=0,1E4<q&&(w=Math.ceil(k/1E4),q=Math.ceil(k/w)),A.label=1;case 1:if(!(u<q))return[3,3];r=new FormData;v=u*w;z=n.slice(v,v+w);u++;B={partNum:u,size:z.size};r.append("partNum",String(B.partNum));r.append("streamdata","true");r.append("f","json");r.append("token",g);r.append("file",z,e);return[4,{partData:B,formData:r}];case 2:return A.sent(),[3,1];case 3:return[2]}})};h._addItemParts=function(n,g){var e=this,k=g.size,w=new f["default"],q={};this.pendingRequests=
[];var u=3;a["default"].subscribe("cancel-item-upload",function(){e.pendingRequests.forEach(function(B){B&&!B.isFulfilled()&&B.cancel()})});var r=h.generatePart(g,m["default"].getToken()),v=!0,z=function(){if(v){var B=[];h.uploadError=!1;for(var A=0;A<u;A++){var y=r.next(),D=y.value;if(y.done){v=!1;break}B.push(D)}c["default"](B.map(function(G){var E=new f["default"];return h._addPartWithRetries(n,G.partData,G.formData,1,k,q,E)})).then(function(){v||w.resolve();u=h.uploadError?Math.ceil(u/2):Math.min(++u,
10);z()},function(G){v=!1;w.reject(G)})}};z();return w};h._addPartWithRetries=function(n,g,e,k,w,q,u){var r=h._getActionItemUrl(n,"addPart");r=l["default"]({url:r,form:e,timeout:0},{returnProgress:!0,disableIdentityLookup:!0}).then(function(v){v.success?u.resolve(v):u.reject(v.error)},function(v){k++;h.uploadError=!0;"Request canceled"!==v.message&&7>=k?h._addPartWithRetries(n,g,e,k,w,q,u):u.reject(v)},function(v){v.loaded&&"upload"===v.transferType&&(q[g.partNum.toString()]=v.loaded,v=Object.keys(q).reduce(function(z,
B){return z+q[B]},0),a["default"].publish("item/upload-progress-update",Math.floor(v/w*100)))});h.pendingRequests.push(r);return u};h._commitItem=function(n,g){var e=h._getActionItemUrl(n,"commit");var k=g instanceof FormData?{title:n.fileName,type:n.fileType}:x.__assign({},d["default"].toObject(g));return m["default"].request({url:e,content:k},{usePost:!0})};h._cancelItem=function(n){n=h._getActionItemUrl(n,"cancel");return m["default"].request({url:n},{usePost:!0})};h._getUserUrl=function(n){var g=
m["default"].getUser();g=g.username||g.email;return b["default"].restBaseUrl+"content/users/"+(n.owner||g)};h._getActionItemUrl=function(n,g){var e=this._getUserUrl(n);n.folderId&&(e=e+"/"+n.folderId);return e="addItem"===g?e+"/addItem":e+"/items/"+n.id+"/"+g};h.uploadError=!1;return h}()})},"arcgisonline/sharing/dijit/_GalleryFiltersMixin":function(){define(["dojo/_base/declare"],function(){return{rootNodes:{organization:{all:{},maps:{},layers:{},scenes:{},applications:{},tools:{},files:{}},maps:{all:{},
imagery:{tags:["imagery"]},basemaps:{tags:["basemap"]},historical:{tags:["historical"]},demographics:{tags:"demographics"},landscape:{tags:"landscape"},oceans:{tags:"oceans"},earth:{tags:["earth observations"]},urban:{tags:["urban"]},transportation:{tags:["transportation"]},boundariesplaces:{tags:["boundaries"]},storymaps:{tags:["story maps","story map"]}},apps:{configurable:{typekeywords:["Configurable"]},readytouse:{typekeywords:["Ready To Use"]},appbuilder:{typekeywords:["Web AppBuilder for ArcGIS"]}}},
imagery:{basemapimagery:{parent:"imagery"},multiimagery:{parent:"imagery"},temporalimagery:{parent:"imagery"},eventimagery:{parent:"imagery"}},basemaps:{esribasemaps:{parent:"basemaps"},partnerbasemaps:{parent:"basemaps"},userbasemaps:{parent:"basemaps"}},demographics:{income:{parent:"demographics"},spending:{parent:"demographics"},population:{parent:"demographics"},business:{parent:"demographics"},atrisk:{parent:"demographics"}},landscape:{agriculture:{parent:"landscape"},climate:{parent:"landscape"},
ecology:{parent:"landscape"},biology:{parent:"landscape"},disturbance:{parent:"landscape"},elevation:{parent:"landscape"},landcover:{parent:"landscape"},hazards:{parent:"landscape"},soils:{parent:"landscape"},subsurface:{parent:"landscape"},water:{parent:"landscape"}},urban:{threed:{parent:"urban"},movement:{parent:"urban"},parcels:{parent:"urban"},people:{parent:"urban"},planning:{parent:"urban"},publicFilter:{parent:"urban"},work:{parent:"urban"}},transportation:{accessibility:{parent:"transportation"},
infrastructure:{parent:"transportation"},logistics:{parent:"transportation"},traffic:{parent:"transportation"},transit:{parent:"transportation"}},boundariesplaces:{boundaries:{parent:"boundariesplaces"},places:{parent:"boundariesplaces"}},maps:{webmaps:{parent:"maps"},mapfiles:{parent:"maps"}},layers:{weblayers:{parent:"layers"},layerfiles:{parent:"layers"}},applications:{web:{parent:"applications"},mobile:{parent:"applications"},desktop:{parent:"applications"}},weblayers:{features:{parent:"weblayers"},
tiles:{parent:"weblayers"},mapimage:{parent:"weblayers"},imagery:{parent:"weblayers"},scenelayers:{parent:"weblayers"},tables:{parent:"weblayers"}},readytouse:{web:{parent:"readytouse"},ios:{parent:"readytouse"},android:{parent:"readytouse"},windows:{parent:"readytouse"},desktop:{parent:"readytouse"}},configurable:{narrate:{parent:"configurable"},collect:{parent:"configurable"},compare:{parent:"configurable"},"3dscene":{parent:"configurable"},analyze:{parent:"configurable"},present:{parent:"configurable"},
social:{parent:"configurable"},local:{parent:"configurable"},route:{parent:"configurable"},showcase:{parent:"configurable"}},files:{document:{parent:"files"},image:{parent:"files"},pdf:{parent:"files"}},tools:{locators:{parent:"tools"},geodatabase:{parent:"tools"},geometric:{parent:"tools"},geoprocessing:{parent:"tools"},network:{parent:"tools"}},"imagery-root":{tags:["imagery"]},"imagery-basemapimagery":{tags:["baseimagery"]},"imagery-multiimagery":{tags:["multispectral"]},"imagery-temporalimagery":{tags:["temporal"]},
"imagery-eventimagery":{tags:["event_imagery"]},"basemaps-root":{tags:["basemap"]},"basemaps-esribasemaps":{tags:["esri_basemap"]},"basemaps-partnerbasemaps":{tags:["partner_basemap"]},"basemaps-userbasemaps":{tags:["user_basemap"]},"historical-root":{tags:["historical"]},"demographics-root":{tags:["demographics"]},"demographics-income":{tags:["income"]},"demographics-spending":{tags:["spending","behaviors"]},"demographics-population":{tags:["population","housing"]},"demographics-segmentation":{tags:["segmentation"]},
"demographics-business":{tags:["business","jobs"]},"demographics-atrisk":{tags:["at risk","poverty"]},"landscape-root":{tags:["landscape"]},"landscape-agriculture":{tags:["agriculture"]},"landscape-climate":{tags:["climate","weather"]},"landscape-ecology":{tags:["ecology"]},"landscape-biology":{tags:["species"]},"landscape-disturbance":{tags:["disturbance"]},"landscape-elevation":{tags:["elevation"]},"landscape-landcover":{tags:["landcover"]},"landscape-hazards":{tags:["hazards"]},"landscape-soils":{tags:["soils",
"geology"]},"landscape-subsurface":{tags:["subsurface"]},"landscape-water":{tags:["water"]},"oceans-root":{tags:["oceans"]},"earth-root":{tags:["earth observations"]},"urban-root":{tags:["urban"]},"urban-threed":{tags:["3D"]},"urban-movement":{tags:["movement"]},"urban-parcels":{tags:["parcels"]},"urban-people":{tags:["people"]},"urban-planning":{tags:["planning"]},"urban-publicFilter":{tags:["public"]},"urban-work":{tags:["work"]},"transportation-root":{tags:["transportation"]},"transportation-accessibility":{tags:["accessibility"]},
"transportation-infrastructure":{tags:["infrastructure"]},"transportation-logistics":{tags:["logistics"]},"transportation-traffic":{tags:["traffic"]},"transportation-transit":{tags:["transit"]},"boundariesplaces-root":{tags:["boundaries"]},"boundariesplaces-boundaries":{tags:["boundaries"]},"boundariesplaces-places":{tags:["places"]},"storymaps-root":{tags:["story maps","story map"]},"scenes-root":{tags:["scenes"]},"readytouse-root":{typekeywords:["Ready To Use"]},"configurable-root":{typekeywords:["Configurable"]},
"appbuilder-root":{typekeywords:["Web AppBuilder for ArcGIS"]},"readytouse-web":{typekeywords:["Web Mapping Application"]},"readytouse-ios":{typekeywords:["ArcGIS for iPhone"]},"readytouse-android":{typekeywords:["ArcGIS for Android"]},"readytouse-windows":{typekeywords:["ArcGIS for Windows Phone"]},"readytouse-desktop":{typekeywords:["Application","Desktop Application"]},"configurable-narrate":{typekeywords:["story"]},"configurable-collect":{typekeywords:["collect"]},"configurable-compare":{typekeywords:["compare"]},
"configurable-3dscene":{typekeywords:["3Dscene"]},"configurable-analyze":{typekeywords:["summarize"]},"configurable-present":{typekeywords:["gallery"]},"configurable-social":{typekeywords:["social"]},"configurable-local":{typekeywords:["local"]},"configurable-route":{typekeywords:["route"]},"configurable-showcase":{typekeywords:["showcase"]},mappings:{"demographics-behaviors":{mappedCategory:"demographics-spending"},"demographics-segmentation":{mappedCategory:"demographics"},"landscape-oceans":{mappedCategory:"oceans"}}}})},
"arcgisonline/sharing/dijit/dialog/AdvancedOfflineOptionsDlg":function(){define("dojo/_base/declare dojo/on dojo/dom-attr dojo/query dojo/dom dojo/dom-style dojo/_base/lang dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/dom-construct dojo/string dojo/_base/window dojo/promise/all dojo/when dojo/Deferred dojo/_base/array dojo/cookie dojo/dom-class dojo/json dijit/registry dijit/form/Select dijit/form/CheckBox ./ConfirmDialog dijit/focus dojo/_base/event dojo/keys ./_CreateItemUtilMixin dojo/topic esri/Evented esri/arcgis/Portal ../../geow/Account ../../geow/Content ../../util dojo/i18n!arcgisonline/nls/arcgisonline".split(" "),
function(t,p,x,b,m,f,d,a,c,l,h,n,g,e,k,w,q,u,r,v,z,B,A,y,D,G,E,F,I,M,P,W,H,O,K){return t("arcgisonline.sharing.dijit.dialog.AdvancedOfflineOptionsDlg",[a,c,l,M],{baseClass:"esriAdvancedOfflineOptionsDlg",templateString:'\x3cdiv\x3e\x3cdiv class\x3d"main"\x3e\x3ch2\x3e${i18n.advancedOfflineOptionsDlg.editableLayersTitle}\x3c/h2\x3e\x3cp class\x3d"" data-dojo-attach-point\x3d"_editMessage"\x3e${i18n.advancedOfflineOptionsDlg.editMessage}\x3c/p\x3e\x3cdiv class\x3d"edit"\x3e\x3clabel class\x3d"esriLeadingMargin1 trailer-0 editFeatures"\x3e\x3cinput class\x3d"" data-dojo-attach-point\x3d"editFeatures" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-props\x3d\'checked:true\'/\x3e\x26nbsp;${i18n.advancedOfflineOptionsDlg.editFeatures}\x26nbsp;\x3c/label\x3e\x3cbr /\x3e\x3clabel class\x3d"esriLeadingMargin26 editAttachments padding-left-2"\x3e\x3cinput class\x3d"editAttachments" data-dojo-attach-point\x3d"editAttachments" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-props\x3d\'checked:true, disabled:false\'/\x3e\x26nbsp;${i18n.advancedOfflineOptionsDlg.editAttachments}\x26nbsp;\x3c/label\x3e\x3c/div\x3e\x3ch2\x3e${i18n.advancedOfflineOptionsDlg.readOnlyLayersTitle}\x3c/h2\x3e\x3cp class\x3d"" data-dojo-attach-point\x3d"_readOnlyMessage"\x3e${i18n.advancedOfflineOptionsDlg.readOnlyMessage}\x3c/p\x3e\x3cdiv class\x3d"readonly"\x3e\x3clabel class\x3d"esriLeadingMargin1 "\x3e\x3cinput class\x3d"" data-dojo-attach-point\x3d"downloadAttachments" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-props\x3d\'checked:true\'/\x3e\x26nbsp;${i18n.advancedOfflineOptionsDlg.editAttachments}\x26nbsp;\x3c/label\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
onDone:function(){},postMixInProperties:function(){this.inherited(arguments);this.i18n=d.mixin({},K);this._portalUser=(this._portal=esriGeowConfig.portal||esriGeowConfig.self)&&(this._portal.user||this._portal.getPortalUser())},postCreate:function(){this.inherited(arguments);W.getSelf(d.hitch(this,function(R){this._loadConnections();this.set("item",this.data)}))},destroy:function(){this._errorDlg&&(this._errorDlg.destroyRecursive(),this._errorDlg=null);this.inherited(arguments);this._portalUser=this._portal=
null},showModal:function(){var R=new w,da=new y({title:K.advancedOfflineOptionsDlg.title,buttonOk:K.common.ok,buttonCancel:K.common.cancel,style:{width:"475px",height:"auto"},className:"esriAdvancedOptions"}),U=b(".dijitDialogTitle",da.domNode).shift(),Z,L=this._portal.helpMap.m["120000899"];L=h.create("a",{className:"esriHelpIcon",title:K.common.help,href:this._portal.helpBase+(L?L:""),target:"_blank"});h.place(L,U,"last");da.setContent(this.domNode);da.show().then(d.hitch(this,function(T){"onOk"===
T&&this._supportsAdvancedSyncOptions&&(this.set("disabled",!0,K.advancedOfflineOptionsDlg.pleaseWait),Z=this.get("offlineProperties"),this._webMap=d.mixin(this._webMap,{applicationProperties:d.mixin(this._webMap.applicationProperties||{},Z)}));da.hide().then(d.hitch(this,function(){R.resolve(this._webMap)}))}));return R},_loadConnections:function(){this.own(p(this.editFeatures,"click",d.hitch(this,function(){this.editFeatures.get("checked")?(b(".editAttachments").removeClass("disabled"),this.editAttachments.set("disabled",
!1)):(b(".editAttachments").addClass("disabled"),this.editAttachments.set("checked",!1),this.editAttachments.set("disabled",!0))})))},_setItemAttr:function(R){this._item=R.portal?R:new P.PortalItem(d.mixin({},R,{portal:this._portal}));R=this._item.itemData?d.clone(this._item.itemData):{};this._item.updatedOffline&&(R.applicationProperties||(R.applicationProperties={}),R.applicationProperties.offline=d.clone(this._item.updatedOffline));this.set("webmap",R)},_setWebmapAttr:function(R){this._webMap=
R||{};this._mapSupportsAdvancedSyncOptions(R).then(d.hitch(this,function(da){(this._supportsAdvancedSyncOptions=da)?this.set("offlineProperties",this._webMap.applicationProperties&&this._webMap.applicationProperties.offline||{}):(b(".dijitCheckBox",this.domNode).map(z.byNode).forEach(function(U){U.set("disabled",!0)}),b("label").addClass("disabled"))}))},_setOfflinePropertiesAttr:function(R){var da=R||{},U=da.editableLayers,Z=da.readonlyLayers;da=!U||U.download&&("featuresAndAttachments"===U.download||
"features"===U.download);U=!U||U.sync&&"syncFeaturesAndAttachments"===U.sync;Z=!Z||Z.downloadAttachments;this._offlineProperties=R||{};this.editFeatures.set("checked",da);this.editAttachments.set("disabled",!da);b(".editAttachments")[da?"removeClass":"addClass"]("disabled");this.editAttachments.set("checked",U);this.downloadAttachments.set("checked",Z)},_getOfflinePropertiesAttr:function(){var R=this._offlineProperties||{},da=this.editFeatures.get("checked"),U=this.editAttachments.get("checked"),
Z=this.downloadAttachments.get("checked");da||U?da&&U?R=d.mixin(R,{editableLayers:{download:"featuresAndAttachments",sync:"syncFeaturesAndAttachments"}}):da&&!U&&(R=d.mixin(R,{editableLayers:{download:"features",sync:"syncFeaturesUploadAttachments"}})):R=d.mixin(R,{editableLayers:{download:"none",sync:"uploadFeaturesAndAttachments"}});R=d.mixin(R,{readonlyLayers:{downloadAttachments:Z}});return d.mixin({},{offline:R})},_setDisabledAttr:function(R,da){this.set("readOnly",R,da)},_setReadOnlyAttr:function(R,
da,U){b(".dijit",this.domNode).map(z.byNode).forEach(function(Z){Z.set("disabled",R)});b("a",this.domNode)[R?"addClass":"removeClass"]("disabledLink");b("label, p, span, h2, .hint",this.domNode)[R?"addClass":"removeClass"]("disabled");R&&da&&I.publish("/dlg/busyMessage",da);I.publish("/esri/disable",R,da)},_mapSupportsAdvancedSyncOptions:function(R){var da=new w,U=R.operationalLayers||[],Z={},L=[];if(R&&R.applicationProperties&&R.applicationProperties.offline)da.resolve(!0);else{q.forEach(U,function(Y){T=
Y.url&&Y.url.replace(/(\/\d+)+$/g,"");Z[T]=T});for(var T in Z)Z.hasOwnProperty(T)&&Z[T]&&L.push(O.request({url:Z[T]},{addToken:!1}).then(function(Y){return Y&&Y.syncCapabilities&&Y.syncCapabilities.supportsAttachmentsSyncDirection},function(Y){return!1}));e(L).then(function(Y){da.resolve(q.every(Y,"return item;"))})}return da},_showError:function(R){R=d.mixin(d.mixin({},K.publishWizard.errors.error),R);this._errorDlg=this._errorDlg||new y({showCancel:!1,style:{width:"400px",height:"auto"}});this._errorDlg.show(R).then(d.hitch(this,
function(){this.set("disabled",!1);this._errorDlg.hide()}));return!1}})})},"arcgisonline/sharing/dijit/dialog/getWFSConfig":function(){define(["dojo/_base/array","esri/renderers/SimpleRenderer","esri/symbols/jsonUtils","arcgisonline/map/popup/getDefaultPopupInfo"],function(t,p,x,b){function m(c){var l,h=c.fields,n=c.selectedLayer||{},g;h&&h.length&&(g=t.filter(h,function(e){return"esriFieldTypeGeometry"!==e.type}))&&g.length&&(l=b({name:n.title,fields:h},!1,c));return l}var f={type:"esriSMS",style:"esriSMSCircle",
color:[34,114,162,128],size:6,outline:{color:[34,114,162,255],width:1}},d={type:"esriSLS",style:"esriSLSSolid",color:[77,77,77,255],width:2},a={type:"esriSFS",style:"esriSFSSolid",color:[227,139,79,204],outline:{type:"esriSLS",style:"esriSLSSolid",color:[255,255,255,255],width:.75}};return function(c){var l=c.geometryType,h=c.toJson(),n=h.url,g=h.mode;h={version:h.version,name:h.name,wfsNamespace:c.layerNamespace,featureUrl:c.getFeatureUrl,supportedSpatialReferences:c.spatialReferences};var e;"esriGeometryPoint"===
l?e=new p(x.fromJson(f)):"esriGeometryPolyline"===l?e=new p(x.fromJson(d)):"esriGeometryPolygon"===l&&(e=new p(x.fromJson(a)));e=e.toJson();return{url:n,mode:g,wfsInfo:h,layerDefinition:{geometryType:l,drawingInfo:{renderer:e},spatialReference:{wkid:4326},fields:c.fields},popupInfo:m(c)}}})},"arcgisonline/map/popup/getDefaultPopupInfo":function(){define(["./isImageServiceLayer","./isTiledImageServiceLayer","dojo/_base/array","dojo/_base/lang"],function(t,p,x,b){return function(m,f,d){f=m.displayField;
f=m.name+(f&&f.length?": {"+f+"}":"");var a=m.fields,c=!1,l=!1,h=!1;if(t(d)||p(d))a=d.getCustomRasterFields({rasterAttributeTableFieldPrefix:"Raster."}),h=0>x.indexOf(["F32","F64"],d.pixelType),d&&d.capabilities&&(l=(c=d.capabilities&&-1<d.capabilities.toLowerCase().indexOf("catalog")||d.fields&&0<d.fields.length)&&("esriImageServiceDataTypeVector-UV"===d.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===d.serviceDataType));var n={esriFieldTypeDouble:1,esriFieldTypeSingle:1},g={esriFieldTypeInteger:1,
esriFieldTypeSmallInteger:1},e={esriFieldTypeDate:1},k=",";m.editFieldsInfo&&(m.editFieldsInfo.creatorField&&(k+=m.editFieldsInfo.creatorField+","),m.editFieldsInfo.creationDateField&&(k+=m.editFieldsInfo.creationDateField+","),m.editFieldsInfo.editorField&&(k+=m.editFieldsInfo.editorField+","),m.editFieldsInfo.editDateField&&(k+=m.editFieldsInfo.editDateField+","),k=k.toLowerCase());a=x.map(a,b.hitch(this,function(w,q){var u="esriFieldTypeOID"!==w.type&&"esriFieldTypeGlobalID"!==w.type&&"esriFieldTypeGeometry"!==
w.type,r=null,v=w.editable&&"esriFieldTypeOID"!==w.type&&"esriFieldTypeGlobalID"!==w.type;if(u){var z=w.name.toLowerCase(),B=k+"stretched value,fnode_,tnode_,lpoly_,rpoly_,poly_,subclass,subclass_,rings_ok,rings_nok,";c&&(B+="raster.itempixelvalue,",l&&(B+="raster.magnitude,raster.direction,"));if(-1<B.indexOf(","+z+",")||-1<z.indexOf("shape")||-1<z.indexOf("perimeter")||-1<z.indexOf("objectid")||-1<z.indexOf("raster.servicepixelvalue.")||z.indexOf("_i")==z.length-2)u=!1;w.type in g?r={places:0,digitSeparator:!0}:
w.type in n?r={places:h&&(-1<z.indexOf("raster.servicepixelvalue")||-1<z.indexOf("raster.itempixelvalue"))?0:2,digitSeparator:!0}:w.type in e&&(10<=m.currentVersion||d&&10<=d.version)&&(r={dateFormat:"longMonthDayYear"})}v=v?-1===k.indexOf(","+w.name.toLowerCase()+","):v;return b.mixin({},{fieldName:w.name,label:w.alias,isEditable:v,tooltip:"",visible:u,format:r,stringFieldOption:"textbox"})}));f={title:f,fieldInfos:a,description:null,showAttachments:!0,mediaInfos:[]};t(d)?(f.layerOptions={},f.layerOptions.showNoDataRecords=
!0,f.layerOptions.returnTopmostRaster=!0):p(d)&&(f.layerOptions={},f.layerOptions.showNoDataRecords=!0);return f}})},"arcgisonline/map/popup/isImageServiceLayer":function(){define(["esri/layers/ArcGISImageServiceLayer","esri/layers/ArcGISImageServiceVectorLayer"],function(t,p){return function(x){return x instanceof esri.layers.ArcGISImageServiceLayer||x instanceof esri.layers.ArcGISImageServiceVectorLayer}})},"arcgisonline/map/popup/isTiledImageServiceLayer":function(){define(["esri/layers/RasterXLayer"],
function(t){return function(p){return p instanceof esri.layers.RasterXLayer}})},"arcgisonline/sharing/dijit/dialog/getWMTSConfig":function(){define("dojo/Deferred dojo/json dojo/_base/array dojo/_base/lang esri/renderers/SimpleRenderer esri/symbols/jsonUtils esri/SpatialReference esri/geometry/Extent arcgisonline/map/core/sameSpatialReference arcgisonline/map/core/projectExtent".split(" "),function(t,p,x,b,m,f,d,a,c,l){function h(g){var e=new t;n(g.selectedLayer.gcsExtent,g.selectedTileInfo.fullExtent).then(function(k){e.resolve(k&&
k.toJson())});return e}function n(g,e){var k=new t,w=e.spatialReference||new d({wkid:4326});handler=b.hitch(this,function(q){k.resolve(q&&q.length&&q[0]&&q[0].type&&"extent"===q[0].type?q[0]:null)});l(g,w,handler,handler);return k}return function(g){var e=new t,k=g.selectedLayer||{},w=g.selectedTileInfo||{},q;h(g).then(b.hitch(this,function(u){var r=g.selectedLayer;var v=g.selectedTileInfo,z=-1<dojo.indexOf(r.formats,"image/png")?"image/png":r.formats[0];g.resourceUrls=r.resourceUrls;r=g.getTileUrlTemplate({identifier:r.identifier,
tileMatrixSet:v.tileMatrixSet,format:z});(v=g.copyright)&&"none"!==v.toLowerCase()?180<v.length&&(v=v.substring(0,180)+".."):v="";z=u||g.selectedTileInfo.fullExtent;var B=g.selectedTileInfo.tileInfo||{};if(96!==B.dpi){for(var A=0;A<B.lods.length;A++){var y=B.lods[A];y.scale=96*y.scale/B.dpi}B.dpi=96}B=B.toJson();q={templateUrl:r,copyright:v,fullExtent:z,tileInfo:B,wmtsInfo:{url:g.wmtsUrl,layerIdentifier:k.identifier,tileMatrixSet:w.tileMatrixSet}};e.resolve({wmtsConfig:q,fullExtent:u})}));return e}})},
"url:esri/dijit/editing/templates/Editor.html":'\x3cdiv class\x3d"esriEditor"\x3e\r\n    \x3cdiv class\x3d"esriTemplatePicker" dojoAttachPoint\x3d"templatePickerDiv"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"esriDrawingToolbar" dojoAttachPoint\x3d"drawingToolbarDiv"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"progressBar" dojoAttachPoint\x3d"progressBar" indeterminate\x3d"true" dojoType\x3d"dijit.ProgressBar" /\x3e\r\n\x3c/div\x3e',"url:esri/dijit/templates/InfoWindow.html":'\x3cdiv id\x3d"${id}.infowindow" class\x3d"infowindow" dojoAttachPoint\x3d"_infowindow"\r\n  \x3e\x3cdiv style\x3d"position:relative;"\r\n    \x3e\x3cdiv class\x3d"window" dojoAttachPoint\x3d"_window"\r\n      \x3e\x3cdiv class\x3d"top"\r\n        \x3e\x3cdiv class\x3d"left" dojoAttachPoint\x3d"_topleft"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n    \t\t\x3e\x3cdiv class\x3d"right" dojoAttachPoint\x3d"_topright"\r\n    \t\t\t\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\r\n    \t\t\t\x3e\x3cdiv class\x3d"user" dojoAttachPoint\x3d"_user"\r\n    \t\t\t  \x3e\x3cdiv class\x3d"titlebar" dojoAttachPoint\x3d"_titlebar"\r\n    \t\t\t    \x3e\x3ca class\x3d"hide" dojoAttachPoint\x3d"_hide" dojoAttachEvent\x3d"onclick:hide"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/a\r\n              \x3e\x3cdiv class\x3d"title" dojoAttachPoint\x3d"_title"\x3e${title}\x3c/div\r\n    \t\t\t  \x3e\x3c/div\r\n            \x3e\x3cdiv class\x3d"border" dojoAttachPoint\x3d"_border"\x3e\x3c/div\r\n    \t\t\t  \x3e\x3cdiv class\x3d"layout content" dojoAttachPoint\x3d"_content, containerNode"\r\n    \t\t\t  \x3e\x3c/div\r\n    \t\t\t\x3e\x3c/div\r\n    \t\t\x3e\x3c/div\r\n        \x3e\x3cdiv class\x3d"bottom"\r\n          \x3e\x3cdiv class\x3d"left" dojoAttachPoint\x3d"_bottomleft"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n\t\t      \x3e\x3cdiv class\x3d"right" dojoAttachPoint\x3d"_bottomright"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n        \x3e\x3c/div\r\n      \x3e\x3c/div\r\n    \x3e\x3c/div\r\n    \x3e\x3cdiv class\x3d"pointer" dojoAttachPoint\x3d"_pointer"\x3e\x3cdiv dojoAttachPoint\x3d"_sprite" class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n  \x3e\x3c/div\r\n\x3e\x3c/div\x3e',
"url:esri/dijit/templates/OverviewMap.html":'\x3cdiv class\x3d"esriOverviewMap"\x3e\r\n  \x3cdiv class\x3d"ovwContainer" dojoattachpoint\x3d"_body" style\x3d"width: ${width}px; height: ${height}px;"\x3e\r\n    \x3cdiv id\x3d"${id}-map" style\x3d"width: 100%; height: 100%;"\x3e\r\n      \x3cdiv class\x3d"ovwHighlight" dojoattachpoint\x3d"_focusDiv" title\x3d"${NLS_drag}" style\x3d"border: 1px solid ${color}; background-color: ${color};"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"ovwButton ovwController" title\x3d"${NLS_show}" dojoattachpoint\x3d"_controllerDiv" dojoattachevent\x3d"onclick: _visibilityHandler"\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"ovwButton ovwMaximizer" title\x3d"${NLS_maximize}" dojoattachpoint\x3d"_maximizerDiv" dojoattachevent\x3d"onclick: _maximizeHandler"\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:esri/dijit/templates/TimeSlider.html":'   \x3cdiv class\x3d"esriTimeSlider"\x3e\r\n   \x3ctable width\x3d"100%" cellspacing\x3d"0" cellpadding\x3d"0" border\x3d"0"\x3e\r\n   \x3ctr\x3e\r\n   \x3ctd align\x3d"right" valign\x3d"middle"\x3e\x3cbutton dojoType\x3d"dijit.form.Button" showLabel\x3d"false" iconClass\x3d"tsButton tsPlayButton" dojoAttachEvent\x3d"onClick:_onPlay" dojoAttachPoint\x3d"playPauseBtn" type\x3d"button"\x3e${NLS_play}\x3c/button\x3e\x3c/td\x3e\r\n   \x3ctd align\x3d"center" valign\x3d"middle" width\x3d"80%" class\x3d"tsTmp"\x3e\x3c/td\x3e\r\n   \x3ctd align\x3d"left" valign\x3d"middle" width\x3d"30"\x3e\x3cbutton dojoType\x3d"dijit.form.Button" showLabel\x3d"false" iconClass\x3d"tsButton tsPrevButton" dojoAttachEvent\x3d"onClick:_onPrev" dojoAttachPoint\x3d"previousBtn" type\x3d"button"\x3e${NLS_previous}\x3c/button\x3e\x3c/td\x3e\r\n   \x3ctd align\x3d"left" valign\x3d"middle"\x3e\x3cbutton dojoType\x3d"dijit.form.Button" showLabel\x3d"false" iconClass\x3d"tsButton tsNextButton" dojoAttachEvent\x3d"onClick:_onNext" dojoAttachPoint\x3d"nextBtn" type\x3d"button"\x3e${NLS_next}\x3c/button\x3e\x3c/td\x3e\r\n   \x3c/tr\x3e    \r\n   \x3c/table\x3e\r\n   \x3c/div\x3e',
"url:esri/dijit/templates/MultidimensionalSlider_vertical.html":'\x3cdiv class\x3d"esriMdSliderVertical esriMdSliderPassive"\x3e\r\n  \x3ctable class\x3d"esriMdSliderTableVertical" data-dojo-attach-point\x3d"mdSliderTable"\x3e\r\n    \x3ctr\x3e\r\n      \x3ctd colspan\x3d"3" class\x3d"esriMdSliderInfoCellVertical"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"dimensionInfo" class\x3d"esriMdSliderInfo"\x3e\r\n          \x3cbr/\x3e\x3cbr/\x3e\r\n        \x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr\x3e\r\n      \x3ctd colspan\x3d"3" class\x3d"esriMdSliderCellVertical" data-dojo-attach-point\x3d"mdSliderCell"\x3e\x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr  class\x3d"esriMdSliderPlayButtonRow"  data-dojo-attach-point\x3d"playPauseBtnRow"\x3e\r\n      \x3ctd class\x3d"esriMdSliderPrevButtonCell"\x3e\r\n        \x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass: \'mdsButton mdsPrevButton\'" data-dojo-attach-event\x3d"onClick:decrement" data-dojo-attach-point\x3d"prevBtn" type\x3d"button"\r\n                title\x3d"${_i18n.widgets.mdSlider.NLS_previous}"\x3e\r\n        \x3c/button\x3e\x3c/td\x3e\r\n      \x3ctd class\x3d"esriMdSliderPlayButtonCell"\x3e\r\n        \x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass: \'mdsButton mdsPlayButton\'" data-dojo-attach-event\x3d"onClick:_onPlay" data-dojo-attach-point\x3d"playPauseBtn" type\x3d"button"\r\n                title\x3d"${_i18n.widgets.mdSlider.NLS_play}"\x3e\r\n        \x3c/button\x3e\x3c/td\x3e\r\n      \x3ctd class\x3d"esriMdSliderNextButtonCell"\x3e\r\n        \x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass: \'mdsButton mdsNextButton\'" data-dojo-attach-event\x3d"onClick:increment" data-dojo-attach-point\x3d"nextBtn" type\x3d"button"\r\n                title\x3d"${_i18n.widgets.mdSlider.NLS_next}"\x3e\r\n        \x3c/button\x3e\x3c/td\x3e\r\n    \x3c/tr\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e',
"url:esri/dijit/templates/MultidimensionalSlider_horizontal.html":'\x3cdiv class\x3d"esriMdSliderHorizontal"\x3e\r\n  \x3ctable class\x3d"esriMdSliderTableHorizontal"\x3e\r\n    \x3ccolgroup\x3e\r\n      \x3ccol class\x3d"esriMdSliderHorizontalCol1"\x3e\r\n      \x3ccol\x3e\r\n    \x3c/colgroup\x3e\r\n    \x3ctr\x3e\r\n      \x3ctd class\x3d"esriMdSliderDimensionInfoCellHorizontal" colspan\x3d"2"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"dimensionInfo"\x3e\x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr\x3e\r\n      \x3ctd align\x3d"right" valign\x3d"middle"\x3e\x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass: \'mdsButton mdsPlayButton\'" data-dojo-attach-event\x3d"onClick:_onPlay" \r\n                                               data-dojo-attach-point\x3d"playPauseBtn" type\x3d"button" title\x3d"${_i18n.widgets.mdSlider.NLS_play}"\x3e\x3c/button\x3e\x3c/td\x3e\r\n      \x3ctd class\x3d"esriMdSliderCellHorizontal" data-dojo-attach-point\x3d"mdSliderCell"\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e\r\n',
"url:esri/dijit/templates/BasemapGallery.html":'\x3cdiv class\x3d"esriBasemapGallery"\x3e\r\n  \x3cdiv dojoAttachPoint\x3d"flowContainer"\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:esri/dijit/templates/HomeButton.html":'\x3cdiv class\x3d"${theme}" role\x3d"presentation"\x3e\r\n    \x3cdiv class\x3d"${_css.container}"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"_homeNode" title\x3d"${_i18n.widgets.homeButton.home.title}" role\x3d"button" class\x3d"${_css.home}" tabindex\x3d"0"\x3e\x3cspan\x3e${_i18n.widgets.homeButton.home.button}\x3c/span\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:esri/dijit/templates/LocateButton.html":'\x3cdiv class\x3d"${theme}" role\x3d"presentation"\x3e\r\n    \x3cdiv class\x3d"${_css.container}"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"_locateNode" role\x3d"button" class\x3d"${_css.locate}" tabindex\x3d"0"\x3e\x3cspan\x3e${_i18n.widgets.locateButton.locate.button}\x3c/span\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e\r\n',"url:esri/dijit/templates/Geocoder.html":'\x3cdiv class\x3d"${theme}" role\x3d"presentation"\x3e\r\n    \x3cdiv class\x3d"${_css.GeocoderContainerClass}" role\x3d"presentation"\x3e\r\n    \t\x3cdiv class\x3d"${_css.GeocoderClass}" data-dojo-attach-point\x3d"containerNode" role\x3d"presentation"\x3e\r\n    \t\t\x3cdiv title\x3d"${_i18n.widgets.Geocoder.main.searchButtonTitle}" tabindex\x3d"0" class\x3d"${_css.searchButtonClass} ${_css.GeocoderIconClass}" data-dojo-attach-point\x3d"submitNode" role\x3d"button"\x3e\x3c/div\x3e\r\n    \t\t\x3cdiv aria-haspopup\x3d"true" id\x3d"${id}_menu_button" title\x3d"${_i18n.widgets.Geocoder.main.geocoderMenuButtonTitle}" tabindex\x3d"0" class\x3d"${_css.geocoderMenuArrowClass} ${_css.GeocoderIconClass}" data-dojo-attach-point\x3d"geocoderMenuArrowNode" role\x3d"button" aria-expanded\x3d"false"\x3e\x3c/div\x3e\r\n    \t\t\x3cinput aria-haspopup\x3d"true" id\x3d"${id}_input" tabindex\x3d"0" placeholder\x3d"" value\x3d"${value}" autocomplete\x3d"off" type\x3d"text" data-dojo-attach-point\x3d"inputNode" role\x3d"textbox"\x3e\r\n    \t\t\x3cdiv tabindex\x3d"0" class\x3d"${_css.clearButtonClass} ${_css.GeocoderIconClass}" data-dojo-attach-point\x3d"clearNode" role\x3d"button"\x3e\x3c/div\x3e\r\n    \t\t\x3cdiv class\x3d"${_css.GeocoderClearClass}" role\x3d"presentation"\x3e\x3c/div\x3e\r\n    \t\x3c/div\x3e\r\n    \t\x3cdiv class\x3d"${_css.resultsContainerClass}" data-dojo-attach-point\x3d"resultsNode" aria-labelledby\x3d"${id}_input" role\x3d"menu" aria-hidden\x3d"true"\x3e\x3c/div\x3e\r\n    \t\x3cdiv class\x3d"${_css.geocoderMenuClass}" data-dojo-attach-point\x3d"geocoderMenuNode" role\x3d"presentation"\x3e\r\n    \t\t\x3cdiv class\x3d"${_css.geocoderMenuHeaderClass}"\x3e\r\n    \t\t\t${_i18n.widgets.Geocoder.main.geocoderMenuHeader}\r\n    \t\t\t\x3cdiv role\x3d"button" data-dojo-attach-point\x3d"geocoderMenuCloseNode" title\x3d"${_i18n.widgets.Geocoder.main.geocoderMenuCloseTitle}" tabindex\x3d"0" class\x3d"${_css.geocoderMenuCloseClass}"\x3e\x3c/div\x3e\r\n    \t\t\t\x3cdiv class\x3d"${_css.GeocoderClearClass}" role\x3d"presentation"\x3e\x3c/div\x3e\r\n    \t\t\x3c/div\x3e\r\n    \t\t\x3cdiv data-dojo-attach-point\x3d"geocoderMenuInsertNode" aria-labelledby\x3d"${id}_menu_button" role\x3d"menu" aria-hidden\x3d"true"\x3e\x3c/div\x3e\r\n    \t\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:esri/dijit/templates/Directions.html":'\x3cdiv class\x3d"${options.theme}" role\x3d"presentation"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_widgetContainer" class\x3d"${_css.widgetContainerClass}" role\x3d"presentation"\x3e\r\n        \x3cdiv class\x3d"${_css.stopsContainerClass}" role\x3d"presentation"\x3e\r\n            \x3cdiv id\x3d"search-source-container" class\x3d"${_css.searchSourceContainerClass}" data-dojo-attach-point\x3d"_searchSourceContainerNode"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"_searchSourceSelectorContainer"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.stopsTableContainerClass}"\x3e\r\n                \x3ctable class\x3d"${_css.stopsClass}" data-dojo-attach-point\x3d"_dndNode"\x3e\x3c/table\x3e\r\n                \x3cdiv class\x3d"${_css.stopsTableCoverClass}" data-dojo-attach-point\x3d"_stopsTableCover"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.stopsButtonContainerClass}"\x3e\r\n                \x3cdiv class\x3d"${_css.stopsAddDestinationClass}"\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" data-dojo-attach-point\x3d"_activateButtonNode" title\x3d"${_i18n.widgets.directions.activate}" class\x3d"${_css.activateButtonClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass} ${_css.stopsPressedButtonClass}" data-blur-on-click\x3d"true"\x3e\x3c/div\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" data-dojo-attach-point\x3d"_lineBarrierButtonNode" title\x3d"${_i18n.widgets.directions.lineBarrier}" class\x3d"${_css.lineBarrierButtonClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass}" data-blur-on-click\x3d"true"\x3e\x3c/div\x3e\r\n                    \x3cdiv role\x3d"button" tabindex\x3d"0" class\x3d"${_css.linkButtonClass} ${_css.stopsAddDestinationBtnClass}" data-dojo-attach-point\x3d"_addDestinationNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.addDestination}\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"${_css.travelModesContainerClass}" data-dojo-attach-point\x3d"_travelModeContainerNode"\x3e\r\n                    \x3cdiv data-dojo-attach-point\x3d"_travelModeSelectorContainer"\x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.linkButtonClass} startTimeMenuButton" data-blur-on-click\x3d"true" data-dojo-attach-point\x3d"_startTimeButtonNodeContainer"\x3e\r\n                    \x3cdiv data-dojo-attach-point\x3d"_startTimeButtonNode"\x3e\r\n                        \x3cspan data-dojo-attach-point\x3d"_startTimeButtonLabel"\x3e${_i18n.widgets.directions.leaveNow}\x3c/span\x3e\r\n                        \x3cdiv data-dojo-attach-point\x3d"_startTimeDDLArrow" class\x3d"esriDirectionsDDLArrow"\x3e\x3c/div\x3e\r\n                    \x3c/div\x3e\r\n                    \x3cdiv class\x3d"startTimeMenu" data-dojo-attach-point\x3d"_startTimeMenu"\x3e\r\n                        \x3cul role\x3d"menu"\x3e\r\n                            \x3cli data-dojo-attach-point\x3d"_startTimeMenuLeaveNow" tabindex\x3d"0" class\x3d"esriRouteZoom startTimeMenuItem" role\x3d"menuitemradio" aria-checked\x3d"true"\x3e${_i18n.widgets.directions.leaveNow}\x3c/li\x3e\r\n                            \x3cli data-dojo-attach-point\x3d"_startTimeMenuDepartAt" tabindex\x3d"0" class\x3d"esriRouteZoom startTimeMenuItem" role\x3d"menuitemradio"\x3e${_i18n.widgets.directions.departAt}\x3c/li\x3e\r\n                            \x3cli data-dojo-attach-point\x3d"_startTimeMenuNone" tabindex\x3d"0" class\x3d"esriRouteZoom startTimeMenuItem" role\x3d"menuitemradio"\x3e${_i18n.widgets.directions.noStartTime}\x3c/li\x3e\r\n                        \x3c/ul\x3e\r\n                    \x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.linkButtonClass} ${_css.stopsOptionsButtonClass}" data-dojo-attach-point\x3d"_optionsButtonNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.showOptions}\x3c/div\x3e\r\n            \t\x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n                \x3cdiv class\x3d"departAtContainer" data-dojo-attach-point\x3d"_departAtContainer"\x3e\r\n                    \x3cdiv id\x3d"${id}_directionsDepartAtTime" data-dojo-attach-point\x3d"_departAtTimeContainer"\x3e\x3c/div\x3e\r\n                    \x3cdiv id\x3d"${id}_directionsDepartAtDate" data-dojo-attach-point\x3d"_departAtDateContainer"\x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv role\x3d"presentation" class\x3d"${_css.stopsOptionsMenuClass}" data-dojo-attach-point\x3d"_optionsMenuNode"\x3e\r\n                \x3cdiv class\x3d"${_css.stopsOptionsCheckboxesClass}"\x3e\r\n                    \x3cul\x3e\r\n                        \x3cli class\x3d"${_css.stopsFindOptimalOrderClass}" data-dojo-attach-point\x3d"_findOptimalOrderItemNode"\x3e\x3cinput tabindex\x3d"0" data-dojo-attach-point\x3d"_findOptimalOrderNode" type\x3d"checkbox" id\x3d"${id}_find_optimal_order" /\x3e\x3clabel for\x3d"${id}_find_optimal_order"\x3e${_i18n.widgets.directions.findOptimalOrder}\x3c/label\x3e\x3c/li\x3e\r\n                        \x3cli class\x3d"${_css.stopsReturnToStartClass}" data-dojo-attach-point\x3d"_returnToStartItemNode"\x3e\x3cinput tabindex\x3d"0" data-dojo-attach-point\x3d"_returnToStartNode" type\x3d"checkbox" id\x3d"${id}_stopsReturnToStart" /\x3e\x3clabel for\x3d"${id}_stopsReturnToStart"\x3e${_i18n.widgets.directions.returnToStart}\x3c/label\x3e\x3c/li\x3e\r\n                        \x3cli class\x3d"${_css.stopsUseTrafficClass}" data-dojo-attach-point\x3d"_useTrafficItemNode" title\x3d"${_i18n.widgets.directions.trafficLabelLive}"\x3e\r\n                            \x3cinput tabindex\x3d"0" data-dojo-attach-point\x3d"_useTrafficNode" type\x3d"checkbox" id\x3d"${id}_stopsUseTraffic" /\x3e\x3clabel for\x3d"${id}_stopsUseTraffic"\x3e${_i18n.widgets.directions.useTraffic}\x3c/label\x3e\r\n                            \x3ca data-dojo-attach-point\x3d"_trafficAvailabilityButton" style\x3d"display: none;" href\x3d"http://www.arcgis.com/home/item.html?id\x3db7a893e8e1e04311bd925ea25cb8d7c7" target\x3d"_blank"\x3e\x3cdiv class\x3d"esriTrafficAvailabilityButton" title\x3d"${_i18n.widgets.directions.seeTrafficAvailability}"\x3e\x3c/div\x3e\x3c/a\x3e\r\n                        \x3c/li\x3e\r\n                    \x3c/ul\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"${_css.stopsOptionsToggleContainerClass}"\x3e\r\n                    \x3cdiv class\x3d"${_css.stopsOptionsUnitsContainerClass}"  data-dojo-attach-point\x3d"_agolDistanceUnitsNode"\x3e\r\n                        \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsOptionsUnitsMiClass} ${_css.stopsButtonClass}" data-dojo-attach-point\x3d"_useMilesNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.units.esriMiles.abbr}\x3c/div\x3e\r\n                        \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsOptionsUnitsKmClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabLastClass} ${_css.stopsPressedButtonClass}" data-dojo-attach-point\x3d"_useKilometersNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.units.esriKilometers.abbr}\x3c/div\x3e\r\n                        \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n                    \x3c/div\x3e\r\n                    \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.stopsGetDirectionsContainerClass}"\x3e\r\n                \x3cdiv class\x3d"getDirectionsBtnContainer"\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsButtonClass} ${_css.stopsGetDirectionsClass} esriDisabledDirectionsButton" data-dojo-attach-point\x3d"_getDirectionsButtonNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.getDirections}\x3c/div\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.linkButtonClass} ${_css.stopsClearDirectionsClass}" data-dojo-attach-point\x3d"_clearDirectionsButtonNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.clearDirections}\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"savePrintBtnContainer" data-dojo-attach-point\x3d"_savePrintBtnContainer"\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.resultsSaveClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass}" data-blur-on-click\x3d"true" data-dojo-attach-point\x3d"_saveMenuButton" title\x3d"${_i18n.widgets.directions.saveTitle}" \x3e\x3c/div\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.resultsPrintClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass}" data-blur-on-click\x3d"true" data-dojo-attach-point\x3d"_printButton" title\x3d"${_i18n.widgets.directions.print}" \x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv role\x3d"presentation" class\x3d"${_css.stopsOptionsMenuClass} esriSaveContainer" data-dojo-attach-point\x3d"_saveMenuNode"\x3e\r\n                \x3cdiv class\x3d"esriLayerNameLabel"\x3e${_i18n.widgets.directions.layerName}\x3c/div\x3e\r\n                \x3cinput type\x3d"text" data-dojo-attach-point\x3d"_outputLayerContainer"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"_folderSelectorContainer"\x3e\x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsButtonClass} esriSaveButton esriDisabledDirectionsButton" data-dojo-attach-point\x3d"_saveButton" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.save}\x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"esriLinkButton esriSaveAsButton" data-dojo-attach-point\x3d"_saveAsButton" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.saveAs}\x3c/div\x3e\r\n            \x3c/div\x3e\r\n    \t\x3c/div\x3e\r\n    \t\x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n    \t\x3cdiv data-dojo-attach-point\x3d"_msgNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n    \t\x3cdiv class\x3d"${_css.resultsContainerClass}" role\x3d"presentation"\x3e\r\n        \t\x3cdiv class\x3d"${_css.routesContainerClass}" data-dojo-attach-point\x3d"_resultsNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n    \t\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:arcgisonline/sharing/dijit/templates/OrganizationSetup.html":'\x3cdiv data-dojo-type\x3d"dijit/layout/ContentPane" data-dojo-attach-point\x3d"containerNode"\x3e\r\n  \x3cdiv  class\x3d"esriFloatLeading" style\x3d"width:780px; clear:both; padding-left:10px;"\x3e${i18n.thankYou}\x3c/div\x3e\r\n\r\n  \x3cdiv style\x3d"width:780px; clear:both; margin-top:2em; padding-left:10px;" class\x3d"esriFloatLeading"\x3e\r\n\r\n    \x3ctable\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"2" class\x3d"valignTop"\x3e\x3cstrong\x3e${i18n.orgName}\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d"titleColumn"\x3e\r\n            \x3cimg data-dojo-attach-point\x3d"_orgNameImg" src\x3d"" alt\x3d"${i18n.orgName}"\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"valignTop"\x3e\r\n            ${i18n.orgNameDesc}\r\n            \x3cbr\x3e\x3cbr\x3e\r\n            \x3clabel\x3e\r\n              \x3cinput class\x3d"orgTextBox" data-dojo-attach-point\x3d"_nameTextBox" data-dojo-type\x3d"dijit/form/TextBox" type\x3d"text" data-dojo-props\x3d"trim:true"\x3e\r\n            \x3c/label\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\x3ctd colspan\x3d"2"\x3e\x3cdiv class\x3d"spacerRow"\x3e\x26nbsp;\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\r\n        \x3ctr\x3e\r\n            \x3ctd colspan\x3d"2" class\x3d"valignTop"\x3e\x3cstrong\x3e${i18n.orgAbbr}\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d"titleColumn"\x3e\r\n            \x3cimg data-dojo-attach-point\x3d"_orgAbbrImg" src\x3d"" alt\x3d"${i18n.orgAbbr}"\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"valignTop"\x3e\r\n            ${!i18n.orgAbbrDesc}\r\n            \x3cbr\x3e\x3cbr\x3e\r\n            \x3cinput class\x3d"orgTextBox" id\x3d"urlKeyTextBox" data-dojo-attach-point\x3d"_urlKeyTextBox" data-dojo-type\x3d"dijit/form/TextBox" type\x3d"text" data-dojo-props\x3d"trim:true"\x3e\r\n            \x3clabel for\x3d"urlKeyTextBox" data-dojo-attach-point\x3d"_urlKeyStatusLabel" style\x3d"vertical-align:middle; width:125px;"\x3e\x3c/label\x3e\r\n            \x3cbr\x3e\x3cbr\x3e\r\n            ${i18n.sampleOrgUrl}\r\n            \x3cbr\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"_sampleUrlTextBox"\x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\x3ctd colspan\x3d"2"\x3e\x3cdiv class\x3d"spacerRow"\x3e\x26nbsp;\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"2" class\x3d"valignTop"\x3e\x3cstrong\x3e${i18n.languageSetting}\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d"titleColumn"\x3e\r\n            \x3cimg data-dojo-attach-point\x3d"_languageImg" src\x3d"" alt\x3d"${i18n.languageSetting}"\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"valignTop"\x3e\r\n            ${i18n.languageDesc} ${i18n.browserDefaultAGOL}\r\n            \x3cbr\x3e\x3cbr\x3e\r\n            \x3clabel\x3e${i18n.languageLabel} \x3cselect class\x3d"orgComboBox" data-dojo-attach-point\x3d"_languageSelect" data-dojo-type\x3d"dijit/form/FilteringSelect" data-dojo-props\x3d"type:\'select\'"\x3e\x3c/select\x3e\x3c/label\x3e\r\n\r\n            \x3cdiv class\x3d"hide" data-dojo-attach-point\x3d"_languageFormatContainer"\x3e\r\n              \x3cbr\x3e\r\n              \x3clabel\x3e\r\n                \x3cstrong\x3e${i18n.numDateFormat}\x3c/strong\x3e \x3cspan id\x3d"languageFormatTooltip"\x3e\x3ca data-dojo-attach-point\x3d"_languageFormatHelpLink" href\x3d"" target\x3d"_blank"\x3e\x3cimg class\x3d"help-icon" data-dojo-attach-point\x3d"_languageFormatImg" src\x3d"" alt\x3d"${i18n.learnNumDateFormat}"\x3e\x3c/a\x3e\x3c/span\x3e\r\n                \x3cbr\x3e\r\n                \x3cselect class\x3d"orgComboBox leader-half" data-dojo-attach-point\x3d"_languageFormatSelect" data-dojo-type\x3d"dijit/form/FilteringSelect" data-dojo-props\x3d"type:\'select\',required:false"\x3e\x3c/select\x3e\r\n              \x3c/label\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\x3ctd colspan\x3d"2"\x3e\x3cdiv class\x3d"spacerRow"\x3e\x26nbsp;\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"2" class\x3d"valignTop"\x3e\x3cstrong\x3e${i18n.regionSetting}\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d"titleColumn"\x3e\r\n            \x3cimg data-dojo-attach-point\x3d"_regionImg" src\x3d"" alt\x3d"${i18n.regionSetting}"\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"valignTop"\x3e\r\n            ${!i18n.regionDesc}\r\n            \x3cbr\x3e\x3cbr\x3e\r\n            \x3clabel for\x3d"regionSelect"\x3e${i18n.regionLabel}\x3c/label\x3e \x3cselect id\x3d"regionSelect" name\x3d"regionSelect" class\x3d"orgComboBox" data-dojo-attach-point\x3d"_regionSelect" data-dojo-type\x3d"dijit/form/FilteringSelect" data-dojo-props\x3d"type:\'select\'"\x3e\x3c/select\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\x3ctd colspan\x3d"2"\x3e\x3cdiv class\x3d"spacerRow"\x3e\x26nbsp;\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\r\n        \x3ctr class\x3d"hide"\x3e\r\n          \x3ctd colspan\x3d"2" class\x3d"valignTop"\x3e\x3cstrong\x3e${i18n.security}\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr class\x3d"hide"\x3e\r\n          \x3ctd class\x3d"titleColumn"\x3e\r\n            \x3cimg data-dojo-attach-point\x3d"_securityImg" src\x3d"" alt\x3d"${i18n.security}"\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"valignTop"\x3e\r\n            \x3cinput id\x3d"sslCheckBox" name\x3d"sslCheckBox" data-dojo-attach-point\x3d"_sslCheckBox" data-dojo-type\x3d"dijit/form/CheckBox" type\x3d"checkBox"\x3e\r\n            \x3clabel for\x3d"sslCheckBox" data-dojo-attach-point\x3d"_sslCheckBoxLabel"\x3e\x3c/label\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\x3ctd colspan\x3d"2"\x3e\x3cdiv class\x3d"spacerRow"\x3e\x26nbsp;\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\r\n        \x3ctr\x3e\r\n            \x3ctd colspan\x3d"2" class\x3d"valignTop"\x3e\x3cstrong\x3e${i18n.link}\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n            \x3ctd class\x3d"titleColumn"\x3e\r\n                \x3cimg data-dojo-attach-point\x3d"_linkImg" src\x3d"" alt\x3d"${i18n.link}"\x3e\r\n            \x3c/td\x3e\r\n            \x3ctd class\x3d"valignTop"\x3e\r\n              \x3clabel\x3e${i18n.linkDesc}\x3c/label\x3e\x3cbr\x3e\x3cbr\x3e\r\n              \x3ctable\x3e\r\n                \x3ctbody\x3e\r\n                  \x3ctr\x3e\r\n                    \x3ctd class\x3d"valignTop" style\x3d"width:15em;"\x3e\r\n                      \x3cinput data-dojo-attach-point\x3d"_linkCheckBox" id\x3d"linkCheckBox" data-dojo-type\x3d"dijit/form/CheckBox" type\x3d"checkbox"\x3e\r\n                      \x3clabel data-dojo-attach-point\x3d"_linkTooltip" id\x3d"linkTooltip" for\x3d"linkCheckBox"\x3e\x3c/label\x3e\r\n                    \x3c/td\x3e\r\n                    \x3ctd class\x3d"valignTop"\x3e\r\n                      \x3clabel\x3e\r\n                        \x3cinput class\x3d"orgTextBox" data-dojo-attach-point\x3d"_link" data-dojo-type\x3d"dijit/form/TextBox" data-dojo-props\x3d"trim:true" type\x3d"text" style\x3d"width:25em;"\x3e\x3c/div\x3e\r\n                      \x3c/label\x3e\r\n                    \x3c/td\x3e\r\n                  \x3c/tr\x3e\r\n                \x3c/tbody\x3e\r\n              \x3c/table\x3e\r\n            \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\x3ctd colspan\x3d"2"\x3e\x3cdiv class\x3d"spacerRow"\x3e\x26nbsp;\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\r\n        \x3ctr\x3e\r\n            \x3ctd colspan\x3d"2" class\x3d"valignTop"\x3e\x3cstrong\x3e${i18n.usageTrackingSetting}\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n            \x3ctd class\x3d"titleColumn"\x3e\r\n                \x3cimg data-dojo-attach-point\x3d"_usageTrackingImg" src\x3d"" alt\x3d"${i18n.usageTrackingSetting}"\x3e\r\n            \x3c/td\x3e\r\n            \x3ctd class\x3d"valignTop"\x3e\r\n              \x3clabel\x3e${i18n.usageTrackingDesc}\x3c/label\x3e\x3cbr\x3e\x3cbr\x3e\r\n              \x3ctable\x3e\r\n                \x3ctbody\x3e\r\n                  \x3ctr\x3e\r\n                    \x3ctd class\x3d"valignTop white-space-no-wrap" style\x3d"width:15em;"\x3e\r\n                      \x3clabel\x3e\r\n                        \x3cinput data-dojo-attach-point\x3d"_usageTrackingCheckBox" data-dojo-type\x3d"dijit/form/CheckBox" type\x3d"checkbox"\x3e\r\n                        ${i18n.allowArcgisOnlineToCollectInfo}\r\n                      \x3c/label\x3e\r\n                    \x3c/td\x3e\r\n                  \x3c/tr\x3e\r\n                \x3c/tbody\x3e\r\n              \x3c/table\x3e\r\n            \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\x3ctd colspan\x3d"2"\x3e\x3cdiv class\x3d"spacerRow"\x3e\x26nbsp;\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"2"\x3e\r\n            \x3cdiv class\x3d"esriFloatLeading"\x3e\r\n              \x3cbutton data-dojo-attach-point\x3d"_saveBtn" data-dojo-type\x3d"dijit/form/Button" type\x3d"button" class\x3d"calcite blue" data-dojo-props\x3d"iconClass:\'esriSaveIcon\'"\x3e${i18n.saveContinue}\x3c/button\x3e\r\n              \x3cbutton data-dojo-attach-point\x3d"_signOutBtn" data-dojo-type\x3d"dijit/form/Button" type\x3d"button" class\x3d"calcite transparent" data-dojo-props\x3d"iconClass:\'esriOpenIcon\'"\x3e${i18n.signOut}\x3c/button\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n\r\n\x3c/div\x3e\r\n',
"url:arcgisonline/sharing/dijit/templates/SaveItem.html":'\x3cdiv class\x3d"${baseClass}" data-dojo-attach-point\x3d"containerNode"\x3e\r\n\r\n  \x3clabel class\x3d"calcite-web-label trailer-half calcite-web-label-textbox"\x3e\r\n    ${i18n.titleLabel}\r\n    \x3cdiv data-dojo-attach-point\x3d"saveItemTitle"\r\n         data-dojo-type\x3d"dijit/form/TextBox"\r\n         placeHolder\x3d"${i18n.defaultTextTitle}" trim\x3d"true"\x3e\x3c/div\x3e\r\n\r\n  \x3c/label\x3e\r\n  \x3clabel class\x3d"calcite-web-label trailer-half clearfix"\x3e\r\n    ${i18n.tagsLabel}\r\n    \x3cdiv data-dojo-attach-point\x3d"saveItemTagsContainer"\x3e\x3c/div\x3e\r\n  \x3c/label\x3e\r\n  \x3cdiv class\x3d"categories-container"\x3e\r\n    \x3clabel class\x3d"calcite-web-label trailer-0 clearfix categories-container"\r\n      data-dojo-attach-point\x3d"saveItemCategoriesContainer"\r\n      for\x3d"saveItemCategoryPicker"\x3e\r\n      ${i18n.categoriesLabel}\r\n    \x3c/label\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"saveItemCategories" id\x3d"saveItemCategoryPicker"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3clabel class\x3d"calcite-web-label trailer-half calcite-web-label-textbox"\x3e\r\n    ${i18n.summaryLabel}\r\n    \x3cdiv data-dojo-attach-point\x3d"saveItemSummary"\r\n         data-dojo-type\x3d"dijit/form/TextBox"\r\n         placeHolder\x3d"${i18n.defaultTextSummary}" maxlength\x3d"250" trim\x3d"true"\x3e\x3c/div\x3e\r\n\r\n  \x3c/label\x3e\r\n  \x3clabel class\x3d"calcite-web-label trailer-half calcite-web-label-select" for\x3d"itemFolderComboBox"\x3e\r\n    ${i18n.saveInFolderLabel}\r\n    \x3cdiv data-dojo-attach-point\x3d"saveItemFolder"\r\n         data-dojo-type\x3d"arcgisonline/sharing/dijit/ComboBox"\r\n         id\x3d"itemFolderComboBox"\x3e\x3c/div\x3e\r\n  \x3c/label\x3e\r\n\r\n\x3c/div\x3e',
"url:arcgisonline/sharing/dijit/dialog/templates/ExportDlg.html":'\x3cdiv class\x3d"widgetContent"\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/Dialog" data-dojo-attach-point\x3d"exportDialog" id\x3d"export-dialog" title\x3d"${i18n.exportDialogTitle}" execute\x3d""\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"saveItemForm"\x3e\x3c/div\x3e\r\n    \x3cfieldset data-dojo-attach-point\x3d"featureCollectionDiv" class\x3d"featureCollectionOnly hide"\x3e\r\n      \x3clabel\x3e\x3cinput type\x3d"radio" data-dojo-attach-point\x3d"generalizeChk" name\x3d"generalize"\x3e${i18n.generalize}\x3c/label\x3e\r\n      \x3clabel\x3e\x3cinput type\x3d"radio" name\x3d"generalize" checked\x3e${i18n.keepOrig}\x3c/label\x3e\r\n    \x3c/fieldset\x3e\r\n\r\n    \x3cp data-dojo-attach-point\x3d"_message" class\x3d"break_word"\x3e\x3c/p\x3e\r\n    \x3cdiv class\x3d"esriFloatTrailing right"\x3e\r\n      \x3cspan data-dojo-attach-point\x3d"exportingLabel" style\x3d"visibility:hidden;"\x3e${i18n.exportingLabel}\x3c/span\x3e\r\n      \x3cbutton class\x3d"btn btn-clear" type\x3d"button" data-dojo-attach-point\x3d"cancelBtn"\x3e${i18n.cancel}\x3c/button\x3e\r\n      \x3cbutton class\x3d"btn" type\x3d"button" data-dojo-attach-point\x3d"exportBtn"\x3e${i18n.exportLabel}\x3c/button\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:arcgisonline/sharing/dijit/dialog/templates/InvitationsDlg.html":'\x3cdiv\x3e\r\n  \t\x3cdiv data-dojo-type\x3d"dijit/Dialog" class\x3d"${baseClass} invitations-dialog" data-dojo-attach-point\x3d"_dialog" title\x3d"${i18n.invitationsDlgTitle}"\x3e\r\n      \x3cdiv class\x3d"trailer-half"\x3e${i18n.invitationMsg}\x3c/div\x3e\r\n      \x3cdiv class\x3d"${baseClass} invitations-container padding-leader-quarter"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_invitationsGridContainer"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"clearfix"\x3e\r\n        \x3cdiv class\x3d"esriFloatTrailing right" style\x3d"padding-top:1rem; padding-bottom:5px;"\x3e\r\n          \x3cbutton data-dojo-attach-point\x3d"_closeBtn" class\x3d"jevent primary" data-dojo-type\x3d"dijit/form/Button" tabIndex\x3d"1"\x3e${i18n.close}\x3c/button\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n  \t\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:arcgisonline/sharing/dijit/dialog/templates/InvitationsDlgGroup.html":'\x3cdiv class\x3d"avenir-regular"\x3e\r\n  \x3cdiv class\x3d"panel panel-white panel-no-padding padding-leader-half padding-trailer-quarter padding-left-1 padding-right-1 border-bottom-clear"\x3e\r\n    \x3cdiv class\x3d"left"\x3e\r\n      \x3cdiv class\x3d"inline-block  ${isPrivate:show}"\x3e\r\n        \x3ca href\x3d"group.html?id\x3d${id}" class\x3d"card-image-small display-block margin-right-1 margin-left-0 group-card-thumbnail" title\x3d"${i18n.GroupsWidget.viewGroupDetails}"\x3e\r\n          \x3cimg src\x3d"${thumbnailUrl}" alt\x3d"${title}" class\x3d"${thumbnail:hide}"\x3e\r\n          \x3csvg xmlns\x3d"http://www.w3.org/2000/svg" width\x3d"65" height\x3d"65" viewBox\x3d"0 0 65 65" class\x3d"${thumbnail:show}"\x3e\r\n            \x3cpath fill\x3d"${fillColor}" d\x3d"M0 0h65v65H0z"/\x3e\r\n            \x3cpath fill\x3d"#ccc" d\x3d"M0 0h65v65H0z" fill-opacity\x3d"0.8"/\x3e\r\n            \x3cpath class\x3d"${useLetter:show}" fill\x3d"#FFF" d\x3d"M24.25 15.625a6.875 6.875 0 1 0-.008 13.75 6.875 6.875 0 0 0 .008-13.75zm0 11c-2.272 0-4.125-1.851-4.125-4.125s1.848-4.125 4.125-4.125c2.279 0 4.125 1.846 4.125 4.125s-1.846 4.125-4.125 4.125zm3.118 16.5H14.774c.596-4.641 4.647-8.25 9.473-8.25 2.855 0 5.426 1.283 7.188 3.316a15.168 15.168 0 0 1 2.311-1.518 12.22 12.22 0 0 0-9.496-4.549c-6.369 0-11.551 4.82-12.238 11l-.137 2.75h14.424a15.49 15.49 0 0 1 1.066-2.75h.003zm25.62 5.5c-.693-6.18-5.873-11-12.238-11s-11.545 4.82-12.238 11l-.137 2.75h24.75l-.137-2.75zm-21.711 0c.596-4.641 4.647-8.25 9.473-8.25a9.578 9.578 0 0 1 9.464 8.25H31.277zm9.473-27.5a6.875 6.875 0 1 0-.008 13.75c3.797.003 6.877-3.072 6.88-6.87s-3.072-6.877-6.869-6.88h-.003zm0 11c-2.271 0-4.125-1.851-4.125-4.125s1.848-4.125 4.125-4.125a4.125 4.125 0 0 1 0 8.25z"/\x3e\r\n            \x3ctext class\x3d"${useLetter:hide} font-size-4" x\x3d"50%" y\x3d"50%" fill\x3d"white" dominant-baseline\x3d"central" text-anchor\x3d"middle"\x3e\r\n              \x3ctspan class\x3d"group-thumbnail-default-text" dominant-baseline\x3d"central" text-anchor\x3d"middle"\x3e${title:firstChar}\x3c/tspan\x3e\r\n              \x3ctspan class\x3d"group-thumbnail-ie-text" y\x3d"70%" x\x3d"55%" dominant-baseline\x3d"central" text-anchor\x3d"middle"\x3e${title:firstChar}\x3c/tspan\x3e\r\n            \x3c/text\x3e\r\n          \x3c/svg\x3e\r\n        \x3c/a\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"inline-block  ${isPrivate:hide}"\x3e\r\n        \x3cdiv class\x3d"card-image-small display-block margin-right-1 margin-left-0 group-card-thumbnail"\x3e\r\n          \x3csvg xmlns\x3d"http://www.w3.org/2000/svg" width\x3d"65" height\x3d"65" viewBox\x3d"0 0 65 65" class\x3d"${thumbnail:show}"\x3e\r\n            \x3cpath fill\x3d"#AAA" d\x3d"M0 0h65v65H0z"/\x3e\r\n            \x3cpath fill\x3d"#ccc" d\x3d"M0 0h65v65H0z" fill-opacity\x3d"0.8"/\x3e\r\n            \x3cpath fill\x3d"#FFF" d\x3d"M42.5 30.5h-20c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2v-14c0-1.1-.9-2-2-2zm0 16h-20v-14h20v14zm-14-20c0-2.205 1.794-4 4-4s4 1.795 4 4v4h2v-4c0-3.309-2.691-6-6-6s-6 2.691-6 6v4h2v-4zm-4 0c0-4.4 3.6-8 8-8s8 3.6 8 8v4h2v-4c0-5.514-4.486-10-10-10s-10 4.486-10 10v4h2v-4zm10 12v-2h-2v-2h-2v10h2v-2h2v-2h-2v-2h2z"/\x3e\r\n          \x3c/svg\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"group-card-content border-box right"\x3e\r\n      \x3ch4 class\x3d"trailer-0 leader-quarter font-size-1 full-width text-ellipsis margin-right-1 text-left"\x3e\r\n        \x3ca href\x3d"group.html?id\x3d${id}" title\x3d"${title}" class\x3d"text-ellipsis ${isPrivate:show}"\x3e${title:stripHTML}\x3c/a\x3e\r\n        \x3cspan class\x3d"text-ellipsis ${isPrivate:hide}" title\x3d"${title}"\x3e${title:stripHTML}\x3c/span\x3e\r\n      \x3c/h4\x3e\r\n      \x3cp class\x3d"trailer-0 text-left"\x3e${notificationSummary}\x3c/p\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"panel panel-no-padding padding-leader-quarter padding-trailer-quarter padding-left-quarter padding-right-quarter clearfix"\x3e\r\n    \x3cdiv class\x3d"right"\x3e\r\n      \x3cbutton class\x3d"js-accept-invitation btn btn-link btn-link-off-black margin-right-1 margin-left-0 inline-block"\x3e\x3cspan class\x3d"text-green"\x3e${icons.inline.check.16}\x3c/span\x3e${i18n.invitationsGrid.joinThisGroup}\x3c/button\x3e\r\n      \x3cbutton class\x3d"js-decline-invitation btn btn-link btn-link-off-black margin-right-1 margin-left-0 inline-block"\x3e\x3cspan class\x3d"text-red"\x3e${icons.inline.minus-circle.16}\x3c/span\x3e${i18n.invitationsGrid.decline}\x3c/button\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:arcgisonline/sharing/dijit/dialog/templates/JoinGroupDlg.html":'\x3cdiv class\x3d"widgetContent"\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/Dialog" data-dojo-attach-point\x3d"_dialog" id\x3d"join_group-dialog" class\x3d"join-group-dialog" title\x3d"${i18n.joinGroupTitle}"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_joinGroupContent"\x3e\r\n      ${i18n.yourRequestForReview}\r\n      \x3cbr\x3e\r\n      ${i18n.youCanCheckStatus}\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"hide leader-half" data-dojo-attach-point\x3d"_administrativeGroup"\x3e\r\n      ${i18n.leavingDisabled}\r\n    \x3c/div\x3e\r\n    \x3cbr\x3e\r\n      \x3cdiv class\x3d"esriFloatTrailing right leader-1"\x3e\r\n        \x3cbutton data-dojo-attach-point\x3d"_okBtn" class\x3d"btn btn-blue"\x3e${i18n.submitRequest}\x3c/button\x3e\r\n        \x3cbutton data-dojo-attach-point\x3d"_cancelBtn" class\x3d"btn btn-clear"\x3e${i18n.cancel}\x3c/button\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:arcgisonline/sharing/dijit/dialog/templates/ManageSubscriptionDlg.html":'\x3cdiv class\x3d"widgetContent" \x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit.Dialog" id\x3d"manage-subscription-dialog" data-dojo-attach-point\x3d"_dialog" title\x3d"${i18n.manageSubscriptionTitle}" execute\x3d"" style\x3d"width:400px;"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_upgradeSubscriptionDiv" class\x3d"hide"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_inUSDiv"\x3e\x3c/div\x3e\x3cbr/\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_outsideUSDiv"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_manageSubscriptionDiv" class\x3d"hide"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_manageSubscriptionContainer"\x3e\r\n        \x3cp\x3e${i18n.manageSubscriptionDesc}\x3c/p\x3e\r\n        \x3cinput type\x3d"radio" name\x3d"manageOption" data-dojo-attach-point\x3d"_upgradeRadioBtn" id\x3d"upgrade-radio-button" value\x3d"upgrade" checked\x3d"true"\x3e\r\n        \x3cspan\x3e\x3clabel for\x3d"upgrade-radio-button"\x3e\x3cb\x3e${i18n.upgradeOption}\x3c/b\x3e\x3c/label\x3e\x3c/span\x3e\x3cbr/\x3e\r\n        \x3cdiv class\x3d"esriLeadingMargin15"\x3e${i18n.upgradeDesc}\x3c/div\x3e\x3cbr/\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_convertOptionDiv"\x3e\r\n          \x3cinput type\x3d"radio" name\x3d"manageOption" data-dojo-attach-point\x3d"_convertRadioBtn" id\x3d"convert-radio-button" value\x3d"convert"\x3e\r\n          \x3cspan\x3e\x3clabel for\x3d"convert-radio-button"\x3e\x3cb\x3e${i18n.convertOption}\x3c/b\x3e\x3c/label\x3e\x3c/span\x3e\x3cbr/\x3e\r\n          \x3cdiv class\x3d"esriLeadingMargin15"\x3e${i18n.convertDesc}\x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_evalSubscriptionContainer" class\x3d"hide"\x3e\r\n        \x3cp\x3e${i18n.upgradeOption} ${i18n.upgradeDesc}\x3c/p\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_purchaseInUSDiv"\x3e\x3c/div\x3e\x3cbr/\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_purchaseOutsideUSDiv"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_convertSubscriptionDiv" class\x3d"hide"\x3e\r\n      \x3cp\x3e${i18n.convertSubscriptionDesc}\x3c/p\x3e\r\n      \x3cp\x3e\x3cb\x3e${i18n.deleteHostedMsg}\x3c/b\x3e\x3cbr/\x3e${i18n.notAvailableMsg}\x3c/p\x3e\r\n      \x3cdiv\x3e\x3cb\x3e${i18n.importantMsg}\x3c/b\x3e\x3cdiv data-dojo-attach-point\x3d"_importantMsgDiv"\x3e\x3c/div\x3e\x3c/div\x3e\r\n      \x3cp\x3e\x3cb\x3e${i18n.intendToUpgradeMsg}\x3c/b\x3e\x3c/p\x3e\r\n    \x3c/div\x3e\r\n    \x3cbr/\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_buttonDiv" class\x3d"right esriFloatTrailing"\x3e\r\n      \x3cbutton data-dojo-attach-point\x3d"_okBtn" class\x3d"btn btn-clear" type\x3d"button"\x3e${i18n.ok}\x3c/button\x3e\r\n      \x3cbutton data-dojo-attach-point\x3d"_nextBtn" class\x3d"btn" type\x3d"button"\x3e${i18n.next}\x3c/button\x3e\r\n      \x3cbutton data-dojo-attach-point\x3d"_convertBtn" class\x3d"btn" type\x3d"button"\x3e${i18n.convertLabel}\x3c/button\x3e\r\n      \x3cbutton data-dojo-attach-point\x3d"_cancelBtn" class\x3d"btn btn-clear" type\x3d"button"\x3e${i18n.cancel}\x3c/button\x3e\r\n    \x3c/div\x3e\r\n    \x3cbr style\x3d"clear:both;"/\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:arcgisonline/sharing/dijit/dialog/templates/ManageTilesDlg.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"${baseClass} manage-tiles-dialog js-tab-group" data-dojo-type\x3d"dijit/Dialog"\r\n       data-dojo-attach-point\x3d"dialog" title\x3d"${i18n.dialogTitle}"\x3e\r\n    \x3cnav class\x3d"tab-nav" data-dojo-attach-point\x3d"_tabNav"\x3e\r\n      \x3ca class\x3d"tab-title js-tab is-active" data-dojo-attach-point\x3d"_levelsTab"\x3e${i18n.levelsTab}\x3c/a\x3e\r\n      \x3ca class\x3d"tab-title js-tab" data-dojo-attach-point\x3d"_extentTab"\x3e${i18n.extentTab}\x3c/a\x3e\r\n    \x3c/nav\x3e\r\n\r\n    \x3csection class\x3d"tab-contents"\x3e\r\n      \x3carticle class\x3d"tab-section js-tab-section is-active" data-dojo-attach-point\x3d"_levelsSection"\x3e\r\n        \x3cspan data-dojo-attach-point\x3d"_dialogDescription"\x3e\x3c/span\x3e\r\n        \x3cbr\x3e\r\n        \x3cdiv class\x3d"selected-scales-container"\x3e\x3cspan data-dojo-attach-point\x3d"_scalesSelectedSpan"\x3e\x3c/span\x3e\x3cbr\x3e\x3c/div\x3e\r\n\r\n        \x3cdiv class\x3d"scaleContainer" data-dojo-attach-point\x3d"_gridContainer"\x3e\x3c/div\x3e\r\n      \x3c/article\x3e\r\n      \x3carticle class\x3d"tab-section js-tab-section" data-dojo-attach-point\x3d"_extentSection"\x3e\r\n        \x3c!-- Add Extent UI here --\x3e\r\n        \x3cdiv class\x3d"extentContainer hide" data-dojo-attach-point\x3d"_extentContainer"\x3e\x3c/div\x3e\r\n      \x3c/article\x3e\r\n    \x3c/section\x3e\r\n\r\n    \x3cdiv class\x3d"controlDiv clearfix" data-dojo-attach-point\x3d"_controlDiv"\x3e\r\n      \x3cdiv class\x3d"left messageContainer"\x3e\r\n        \x3cdiv class\x3d"message" data-dojo-attach-point\x3d"_messageDiv"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"right buildContainer"\x3e\r\n        \x3cbutton data-dojo-attach-point\x3d"_buildButton" class\x3d"calcite secondary btn btn-blue"\x3e${i18n.buildButton}\x3c/button\x3e\r\n        \x3cbutton data-dojo-attach-point\x3d"_cancelButton" class\x3d"calcite secondary btn btn-blue hide"\x3e${i18n.cancelButton}\x3c/button\x3e\r\n        \x3cbutton data-dojo-attach-point\x3d"_closeButton" class\x3d"calcite transparent btn btn-clear"\x3e${i18n.close}\x3c/button\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:arcgisonline/sharing/dijit/dialog/templates/MembershipRequestsDlg.html":'\x3cdiv\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/Dialog" class\x3d"${baseClass} membership-requests-dialog" data-dojo-attach-point\x3d"_dialog" title\x3d"${i18n.membershipRequests}"\x3e\r\n    \x3cdiv class\x3d"membership-requests-label"\x3e${i18n.requestedMemberShip}\x3c/div\x3e\r\n    \x3cdiv class\x3d"${baseClass} requests-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_requestsGridContainer"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cbr style\x3d"clear:both;"\x3e\r\n    \x3cdiv class\x3d"esriFloatTrailing right" style\x3d"padding-top:1rem;padding-bottom:5px;"\x3e\r\n      \x3cbutton data-dojo-attach-point\x3d"_closeBtn" class\x3d"jevent primary" data-dojo-type\x3d"dijit/form/Button"\x3e${i18n.close}\x3c/button\x3e\r\n    \x3c/div\x3e\r\n    \x3cbr/\x3e\x26nbsp;\x3cbr/\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:arcgisonline/sharing/dijit/dialog/templates/SetIdentityProviderDlg.html":'\x3cdiv class\x3d"widgetContent" \x3e\r\n  \x3cdiv class\x3d"${baseClass}" data-dojo-type\x3d"dijit/Dialog" data-dojo-attach-point\x3d"_dialog" id\x3d"set-identity-provider-dialog" title\x3d"${i18n.setIdentityProviderTitle}" execute\x3d""\x3e\r\n    \x3cform data-dojo-attach-point\x3d"_form" enctype\x3d"multipart/form-data" method\x3d"post" onsubmit\x3d"return false;"\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"_signUpMode" name\x3d"signUpMode" type\x3d"hidden" value\x3d""\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"_bindingType" name\x3d"bindingType" type\x3d"hidden" value\x3d""\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"_supportEncryption" name\x3d"encryptionSupported" type\x3d"hidden" value\x3d""\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"_supportSignedRequest" name\x3d"supportSignedRequest" type\x3d"hidden" value\x3d""\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"_useSHA256" name\x3d"useSHA256" type\x3d"hidden" value\x3d""\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"_supportsLogoutRequest" name\x3d"supportsLogoutRequest" type\x3d"hidden" value\x3d""\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"_updateProfileAtSignIn" name\x3d"updateProfileAtSignin" type\x3d"hidden" value\x3d""\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"_updateGroupsAtSignIn" name\x3d"updateGroupsAtSignin" type\x3d"hidden" value\x3d""\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"_clearEmptyFields" name\x3d"clearEmptyFields" type\x3d"hidden" value\x3d"false"\x3e\r\n\r\n      \x3cdiv data-dojo-attach-point\x3d"_description"\x3e\x3c/div\x3e\r\n      \x3cbr\x3e\r\n      \x3cspan\x3e${i18n.nameLabel}\x3c/span\x3e\x3cbr\x3e\r\n      \x3cdiv name\x3d"name" data-dojo-attach-point\x3d"_nameInput" type\x3d"text" data-dojo-type\x3d"dijit/form/TextBox" data-dojo-props\x3d"trim:true"\x3e\x3c/div\x3e\r\n      \x3cbr\x3e\x3cbr\x3e\r\n\r\n      \x3cspan\x3e${i18n.signUpLabel}\x3c/span\x3e\x3cbr\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_signUpModeOptions"\x3e\r\n        \x3cdiv id\x3d"automatic-option" name\x3d"signUpModeOption" type\x3d"radio"\r\n             data-dojo-attach-point\x3d"_automaticOption" data-dojo-type\x3d"dijit/form/RadioButton"\r\n             data-dojo-attach-event\x3d"onClick:onAutomaticClicked"\x3e\x3c/div\x3e \x3clabel data-dojo-attach-point\x3d"_automaticOptionLabel" for\x3d"automatic-option"\x3e${i18n.automaticOption}\x3c/label\x3e\r\n        \x3cdiv id\x3d"invite-option" name\x3d"signUpModeOption" type\x3d"radio"\r\n             data-dojo-attach-point\x3d"_inviteOption" data-dojo-type\x3d"dijit/form/RadioButton"\r\n             data-dojo-attach-event\x3d"onClick:onInvitationClicked" data-dojo-props\x3d"checked:true"\x3e\x3c/div\x3e \x3clabel data-dojo-attach-point\x3d"_inviteOptionLabel" for\x3d"invite-option"\x3e${i18n.onInviteOption}\x3c/label\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"leader-half" data-dojo-attach-point\x3d"_automaticDefaults"\x3e\r\n        ${i18n.membersGetValues}\r\n        \x3cdiv class\x3d"margin-left-1"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_levelOptions"\x3e${i18n.defaultLevel} \x3cspan data-dojo-attach-point\x3d"_userTypeDefault"\x3e\x3c/span\x3e\x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_roleOptions"\x3e${i18n.roleAssigned} \x3cspan data-dojo-attach-point\x3d"_roleDefault"\x3e\x3c/span\x3e\x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_creditOptions"\x3e${i18n.defaultCredits} \x3cspan data-dojo-attach-point\x3d"_creditsDefault"\x3e\x3c/span\x3e\x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_esriAccessOptions"\x3e${i18n.defaultEsriAccess} \x3cspan data-dojo-attach-point\x3d"_esriAccessDefault"\x3e\x3c/span\x3e\x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_groupOptions"\x3e\r\n            \x3cspan data-dojo-attach-point\x3d"_hasGroupDefaults"\x3e${i18n.groupsSelected}\r\n                \x3cdiv class\x3d"inline-block specified-group-list hide" data-dojo-attach-point\x3d"_groupListContainer"\x3e\x3c/div\x3e\r\n                \x3cspan class\x3d"esriItemLinks hide" data-dojo-attach-point\x3d"_otherLinkContainer"\x3e\x3ca id\x3d"${id}-other-link" data-dojo-attach-point\x3d"_otherLink"\x3e${i18n.otherLink}\x3c/a\x3e\x3c/span\x3e\r\n            \x3c/span\x3e\r\n            \x3cspan data-dojo-attach-point\x3d"_noGroupDefaults"\x3e${i18n.noGroupsSelected}\x3c/span\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"leader-half" data-dojo-attach-point\x3d"_toConfigureDefaults"\x3e${i18n.toConfigureDefaults}\x3c/div\x3e\r\n      \x3cbr\x3e\r\n      \x3c!-- start federation of identity provider fields --\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_federationDiscoveryServiceContainer"\x3e\r\n        \x3cspan\x3e${i18n.federationDiscoveryServiceUrlLabel}\x3c/span\x3e\r\n        \x3cbr\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_federationDiscoveryServiceUrl" name\x3d"discoveryServiceUrl" type\x3d"text" data-dojo-type\x3d"dijit/form/TextBox" data-dojo-props\x3d"trim:true"\x3e\x3c/div\x3e\r\n        \x3cbr\x3e\r\n        \x3cbr\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_metadataAggregateUrlContainer"\x3e\r\n        \x3cspan\x3e${i18n.metadataAggregateUrlLabel}\x3c/span\x3e\r\n        \x3cbr\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_metadataAggregateUrl" name\x3d"metadataServiceUrl" type\x3d"text" data-dojo-type\x3d"dijit/form/TextBox" data-dojo-props\x3d"trim:true"\x3e\x3c/div\x3e\r\n        \x3cbr\x3e\r\n        \x3cbr\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_aggregatedMetadataCertificateContainer"\x3e\r\n        \x3cspan\x3e${i18n.aggregatedMetadataCertificateLabel}\x3c/span\x3e\r\n        \x3cbr\x3e\r\n        \x3ctextarea data-dojo-attach-point\x3d"_aggregatedMetadataCertificate" name\x3d"certificate" data-dojo-type\x3d"dijit/form/SimpleTextarea" data-dojo-props\x3d"rows:3"\r\n          title\x3d"${i18n.aggregatedMetadataCertificatePlaceholder}"\x3e\x3c/textarea\x3e\r\n        \x3cbr\x3e\r\n        \x3cbr\x3e\r\n      \x3c/div\x3e\r\n      \x3c!-- end federation of identity provider fields --\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_metadataSourceContainer"\x3e\r\n        \x3cspan\x3e${i18n.sourceLabel}\x3c/span\x3e\r\n        \x3cbr\x3e\r\n        \x3cspan data-dojo-attach-point\x3d"_sourceOptions"\x3e\r\n          \x3cdiv id\x3d"metadata-url-option" name\x3d"providerOptions" type\x3d"radio" data-dojo-attach-point\x3d"_metadataUrlOption" data-dojo-type\x3d"dijit/form/RadioButton"\r\n            checked\x3d"true"\x3e\x3c/div\x3e\r\n          \x3clabel for\x3d"metadata-url-option"\x3e${i18n.metadataUrlOption}\x3c/label\x3e\r\n          \x3cdiv id\x3d"metadata-file-option" name\x3d"providerOptions" type\x3d"radio" data-dojo-attach-point\x3d"_metadataFileOption" data-dojo-type\x3d"dijit/form/RadioButton"\x3e\x3c/div\x3e\r\n          \x3clabel for\x3d"metadata-file-option"\x3e${i18n.metadataFileOption}\x3c/label\x3e\r\n          \x3cdiv id\x3d"parameters-option" name\x3d"providerOptions" type\x3d"radio" data-dojo-attach-point\x3d"_parametersOption" data-dojo-type\x3d"dijit/form/RadioButton"\x3e\x3c/div\x3e\r\n          \x3clabel for\x3d"parameters-option"\x3e${i18n.parametersOption}\x3c/label\x3e\r\n        \x3c/span\x3e\r\n        \x3cbr\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_sourceInputs"\x3e\r\n          \x3cbr\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_metadataUrlInputs"\x3e\r\n            \x3cspan\x3e${i18n.metadataUrlLabel}\x3c/span\x3e\r\n            \x3cbr\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"_bindingUrlInput" name\x3d"idpMetadataUrl" type\x3d"text" data-dojo-type\x3d"dijit/form/TextBox" data-dojo-props\x3d"trim:true"\x3e\x3c/div\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_metadataFileInputs"\x3e\r\n            \x3cspan\x3e${i18n.metadataFileLabel}\x3c/span\x3e\r\n            \x3cbr\x3e\r\n            \x3cinput data-dojo-attach-point\x3d"_metadataFileInput" name\x3d"idpMetadataFile" type\x3d"file" title\x3d"${i18n.metadataFilePlaceHolder}"\r\n            /\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_parametersInputs"\x3e\r\n            \x3cspan\x3e${i18n.parametersUrlLabel}\x3c/span\x3e\r\n            \x3cbr\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"_loginUrlInput" name\x3d"bindingUrl" data-dojo-type\x3d"dijit/form/TextBox" data-dojo-props\x3d"trim:true"\x3e\x3c/div\x3e\r\n            \x3cbr\x3e\r\n            \x3cbr\x3e\r\n            \x3cspan\x3e${i18n.parametersPostUrlLabel}\x3c/span\x3e\r\n            \x3cbr\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"_loginUrlPostInput" name\x3d"postBindingUrl" type\x3d"text" data-dojo-type\x3d"dijit/form/TextBox" data-dojo-props\x3d"trim:true"\x3e\x3c/div\x3e\r\n            \x3cbr\x3e\r\n            \x3cbr\x3e\r\n            \x3c!--\x3cspan"\x3e${i18n.parametersBindingTypeLabel}\x3c/span\x3e--\x3e\r\n            \x3c!--\x3cdiv id\x3d"binding-type-redirect-option" name\x3d"bindingTypeOptions" data-dojo-attach-point\x3d"_bindingTypeRedirect" type\x3d"radio" data-dojo-type\x3d"dijit/form/RadioButton" data-dojo-attach-point\x3d"_bindingTypeRedirectOption" checked\x3d"true"\x3e\x3c/div\x3e \x3clabel\x3e${i18n.parametersBindingTypeRedirect}\x3c/label\x3e--\x3e\r\n            \x3c!--\x3cdiv id\x3d"binding-type-post-option" name\x3d"bindingTypeOptions" data-dojo-attach-point\x3d"_bindingTypePost" type\x3d"radio" data-dojo-type\x3d"dijit/form/RadioButton" data-dojo-attach-point\x3d"_bindingTypePostOption"\x3e\x3c/div\x3e \x3clabel\x3e${i18n.parametersBindingTypePost}\x3c/label\x3e--\x3e\r\n            \x3c!--\x3cbr\x3e\x3cbr\x3e--\x3e\r\n            \x3cspan\x3e${i18n.parametersCertificateLabel}\x3c/span\x3e\r\n            \x3cbr\x3e\r\n            \x3ctextarea data-dojo-attach-point\x3d"_certificateInput" name\x3d"certificate" data-dojo-type\x3d"dijit/form/SimpleTextarea" data-dojo-props\x3d"rows:3"\r\n              title\x3d"${i18n.parametersCertificatePlaceHolder}"\x3e\x3c/textarea\x3e\r\n            \x3cdiv style\x3d"display:none;"\x3e\r\n              \x3cbr\x3e\r\n              \x3cspan\x3e${i18n.orLabel}\x3c/span\x3e\r\n              \x3cbr\x3e\r\n              \x3cbr\x3e\r\n              \x3cspan\x3e${i18n.parametersCertificateFileLabel}\x3c/span\x3e\r\n              \x3cbr\x3e\r\n              \x3cinput type\x3d"file" data-dojo-attach-point\x3d"_certificateFileInput" name\x3d"certificateFile" title\x3d"${i18n.parametersCertificateFilePlaceHolder}"\r\n              /\x3e\r\n            \x3c/div\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cbr\x3e\r\n      \x3c/div\x3e\r\n      \x3c!--\x3cdiv\x3e--\x3e\r\n        \x3c!--\x3cbr\x3e--\x3e\r\n        \x3c!--\x3cspan\x3e--\x3e\r\n          \x3c!--\x3cinput type\x3d"checkbox" id\x3d"encryptionSupported" data-dojo-attach-point\x3d"_encryptionSupported" data-dojo-type\x3d"dijit/form/CheckBox"\x3e--\x3e\r\n          \x3c!--\x3clabel for\x3d"encryptionSupported"\x3e${i18n.encryptionSupported}\x3c/label\x3e--\x3e\r\n        \x3c!--\x3c/span\x3e--\x3e\r\n        \x3c!--\x3cbr\x3e--\x3e\r\n        \x3c!--\x3cspan\x3e--\x3e\r\n          \x3c!--\x3cinput type\x3d"checkbox" id\x3d"supportSignedRequest" data-dojo-attach-point\x3d"_signedRequestSupported" data-dojo-type\x3d"dijit/form/CheckBox"\x3e--\x3e\r\n          \x3c!--\x3clabel for\x3d"supportSignedRequest"\x3e${i18n.supportSignedRequest}\x3c/label\x3e--\x3e\r\n        \x3c!--\x3c/span\x3e--\x3e\r\n        \x3c!--\x3cbr\x3e--\x3e\r\n      \x3c!--\x3c/div\x3e\x3cbr\x3e--\x3e\r\n\r\n      \x3cspan class\x3d"esriItemLinks"\x3e\x3ca data-dojo-attach-point\x3d"_toggleAdvancedSettings" data-dojo-attach-event\x3d"onclick:onToggleAdvancedSettings"\x3e${i18n.showAdvancedSettings}\x3c/a\x3e\x3c/span\x3e\x3cbr\x3e\r\n      \x3cdiv id\x3d"advancedSettings" data-dojo-attach-point\x3d"_advancedSettings"\x3e\r\n        \x3cbr\x3e\r\n        \x3cspan\x3e\r\n          \x3cinput type\x3d"checkbox" id\x3d"encryptionSupported" data-dojo-attach-point\x3d"_encryptionSupported" data-dojo-type\x3d"dijit/form/CheckBox"\x3e\r\n          \x3clabel for\x3d"encryptionSupported"\x3e${i18n.encryptionSupported}\x3c/label\x3e\r\n        \x3c/span\x3e\r\n        \x3cbr\x3e\x3cbr\x3e\r\n        \x3cspan\x3e\r\n          \x3cinput type\x3d"checkbox" id\x3d"supportSignedRequest" data-dojo-attach-point\x3d"_signedRequestSupported" data-dojo-type\x3d"dijit/form/CheckBox"\x3e\r\n          \x3clabel for\x3d"supportSignedRequest"\x3e${i18n.supportSignedRequest}\x3c/label\x3e\x3cbr\x3e\r\n          \x3cspan class\x3d"esriLeadingMargin15" data-dojo-attach-point\x3d"_sha256Container"\x3e\r\n            \x3cinput type\x3d"checkbox" id\x3d"signUsingSHA256" data-dojo-attach-point\x3d"_signUsingSHA256" data-dojo-type\x3d"dijit/form/CheckBox"\x3e\r\n            \x3clabel for\x3d"signUsingSHA256"\x3e${i18n.signUsingSHA256}\x3c/label\x3e\x3cbr\x3e\r\n          \x3c/span\x3e\r\n        \x3c/span\x3e\r\n        \x3cbr\x3e\r\n        \x3cspan\x3e\r\n          \x3cinput type\x3d"checkbox" id\x3d"supportsLogoutRequest" data-dojo-attach-point\x3d"_logoutRequestSupported" data-dojo-type\x3d"dijit/form/CheckBox"\x3e\r\n          \x3clabel for\x3d"supportsLogoutRequest"\x3e${i18n.propagateLogout}\x3c/label\x3e\r\n        \x3c/span\x3e\r\n        \x3cbr\x3e\x3cbr\x3e\r\n        \x3cspan\x3e\r\n          \x3clabel\x3e\r\n            \x3cinput type\x3d"checkbox" data-dojo-attach-point\x3d"_updateProfile" data-dojo-type\x3d"dijit/form/CheckBox"\x3e\r\n            ${i18n.updateProfileAtSignIn}\r\n          \x3c/label\x3e\r\n        \x3c/span\x3e\r\n        \x3cbr\x3e\x3cbr\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_updateGroupsContainer"\x3e\r\n          \x3cspan\x3e\r\n            \x3clabel\x3e\r\n              \x3cinput type\x3d"checkbox" data-dojo-attach-point\x3d"_updateGroups" data-dojo-type\x3d"dijit/form/CheckBox"\x3e\r\n              ${i18n.updateGroupsAtSignIn}\r\n            \x3c/label\x3e\r\n          \x3c/span\x3e\r\n          \x3cbr\x3e\x3cbr\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_logoutUrlContainer"\x3e\r\n          \x3cspan\x3e${i18n.logoutUrlLabel}\x3c/span\x3e\r\n          \x3cbr\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_logoutUrlInput" name\x3d"logoutUrl" type\x3d"text" data-dojo-type\x3d"dijit/form/TextBox" data-dojo-props\x3d"trim:true"\x3e\x3c/div\x3e\r\n          \x3clabel\x3e${i18n.optionalLabel}\x3c/label\x3e\r\n          \x3cbr\x3e\r\n          \x3cbr\x3e\r\n        \x3c/div\x3e\r\n        \x3cspan\x3e${i18n.entityIDLabel}\x3c/span\x3e\x3cbr\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_entityIDInput" name\x3d"entityId" type\x3d"text" data-dojo-type\x3d"dijit/form/TextBox" data-dojo-props\x3d"trim:true"\x3e\x3c/div\x3e\r\n        \x3c!--\x3cspan\x3e${i18n.userIdAttrLabel}\x3c/span\x3e\x3cbr\x3e--\x3e\r\n        \x3c!--\x3cdiv data-dojo-attach-point\x3d"_userIdAttrInput" name\x3d"userIdAttribute" type\x3d"text" data-dojo-type\x3d"dijit/form/TextBox" data-dojo-props\x3d"trim:true" title\x3d"${i18n.userIdAttrTooltip}"\x3e\x3c/div\x3e \x3clabel\x3e${i18n.optionalLabel}\x3c/label\x3e--\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cdiv data-dojo-attach-point\x3d"_providerMetadataDownloadContainer"\x3e\r\n        \x3cbr\x3e\r\n        \x3cspan\x3e${i18n.downloadProviderMetadata}\x3c/span\x3e\r\n        \x3cbr\x3e\r\n        \x3cdiv class\x3d"esriItemLinks signedMetadataUrl"\x3e\x3ca href\x3d"#" data-dojo-attach-point\x3d"_signedProviderMetadataUrl" target\x3d"_blank"\x3e\x3c/a\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cbr\x3e\x3cbr\x3e\r\n      \x3cdiv class\x3d"esriAlignTrailing" data-dojo-attach-point\x3d"_buttons"\x3e\r\n        \x3cbutton data-dojo-attach-point\x3d"_setBtn" class\x3d"primary" data-dojo-type\x3d"dijit/form/Button"\x3e${i18n.setIdentityProviderLabel}\x3c/button\x3e\r\n        \x3cbutton data-dojo-attach-point\x3d"_cancelBtn" class\x3d"cancel" data-dojo-type\x3d"dijit/form/Button"\x3e${i18n.cancel}\x3c/button\x3e\r\n      \x3c/div\x3e\r\n    \x3c/form\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:arcgisonline/pages/dijit/UploadProgressBar/UploadProgressBar.html":'\x3cdiv class\x3d"upload-progress-bar flex-1 flex-column-justify-center margin-right-1 margin-left-half position-relative"\x3e\r\n  \x3cdiv class\x3d"progress-bar"\x3e\r\n    \x3cdiv class\x3d"progress-bar-fill" data-dojo-attach-point\x3d"_uploadProgressFill"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"font-size--3 upload-percent-label" data-dojo-attach-point\x3d"_uploadPercentLabel"\x3e0%\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"*now":function(t){t(['dojo/i18n!*preload*arcgisonline/nls/arcgisonline*["ar","bg","bs","ca","cs","da","de","de-ch","el","en-au","en-ca","en-gb","en-us","es","es-mx","et","fi","fr","fr-ch","he","hr","hu","id","it","it-ch","ja","ko","lt","lv","nl","nb","pl","pt","pt-br","pt-pt","ro","ru","sk","sl","sr","sv","th","tr","uk","vi","zh-cn","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("arcgisonline/arcgisonline",["dojo","dijit","dojox","dojo/require!esri/main,dijit/_base,dijit/form/DropDownButton,dijit/form/ComboButton,dijit/form/ToggleButton,dijit/form/HorizontalSlider,dijit/form/VerticalSlider,dijit/form/HorizontalRule,dijit/form/VerticalRule,dijit/form/HorizontalRuleLabels,dijit/form/VerticalRuleLabels,esri/map,esri/dijit/editing/Editor,esri/dijit/editing/TemplatePicker,esri/dijit/InfoWindow,esri/dijit/OverviewMap,esri/dijit/Attribution,esri/dijit/Scalebar,esri/dijit/Legend,esri/dijit/TimeSlider,esri/dijit/MultidimensionalSlider,esri/dijit/BasemapGallery,esri/dijit/HomeButton,esri/dijit/LocateButton,esri/dijit/Popup,esri/layers/graphics,esri/layers/agstiled,esri/layers/agsdynamic,esri/layers/agsimageservice,esri/layers/CSVLayer,esri/layers/StreamLayer,esri/layers/KMLLayer,esri/layers/FeatureLayer,esri/layers/VectorTileLayer,esri/layers/osm,esri/SnappingManager,esri/tasks/geometry,esri/tasks/identify,esri/tasks/locator,esri/toolbars/draw,esri/virtualearth/VETiledLayer,esri/virtualearth/VEGeocoder,esri/dijit/Geocoder,dojo/dnd/Moveable,dojo/parser,arcgisonline/map/classBreaks,arcgisonline/map/dynLayer,arcgisonline/map/edit,arcgisonline/map/featColl,arcgisonline/map/fileImport,arcgisonline/map/geocode,arcgisonline/map/geocodeReview,arcgisonline/map/geoRSS,arcgisonline/map/itemData,arcgisonline/map/layer,arcgisonline/map/kml,arcgisonline/map/mapNotes,arcgisonline/map/mapUtil,arcgisonline/map/role,arcgisonline/map/print,arcgisonline/map/popup,arcgisonline/map/save_open,arcgisonline/map/symbol,arcgisonline/map/table,arcgisonline/map/thumbnail,arcgisonline/map/time,arcgisonline/map/multiDimensions,arcgisonline/map/vectorTile,arcgisonline/map/webTile,arcgisonline/map/wms,arcgisonline/map/dijit/About,arcgisonline/map/dijit/AddContent,arcgisonline/map/dijit/Directions,arcgisonline/map/dijit/Edit,arcgisonline/map/dijit/Geocode,arcgisonline/map/dijit/LeftPanel,arcgisonline/map/dijit/Legend,arcgisonline/map/dijit/ManageTemplates,arcgisonline/map/dijit/MosaicRule,arcgisonline/map/dijit/PopupBuilder,arcgisonline/map/dijit/RendererLabels,arcgisonline/map/dijit/DefineAOI,arcgisonline/map/dijit/RenderingRule,arcgisonline/map/dijit/StructuredPopupWidget,arcgisonline/map/dijit/TOC,arcgisonline/map/dijit/MultidimensionalFilter,arcgisonline/map/dijit/renderer/AttributeTransparency,arcgisonline/map/dijit/renderer/AttributeTransparencyDlg,arcgisonline/map/dijit/renderer/Color,arcgisonline/map/dijit/renderer/ColorGrid,arcgisonline/map/dijit/renderer/Gallery,arcgisonline/map/dijit/renderer/HeatMap,arcgisonline/map/dijit/renderer/MultiAttributes,arcgisonline/map/dijit/renderer/Simple,arcgisonline/map/dijit/renderer/Size,arcgisonline/map/dijit/renderer/SizeGrid,arcgisonline/map/dijit/renderer/SymbolStylerDlg,arcgisonline/map/dijit/renderer/UniqueValues,arcgisonline/map/dijit/renderer/UniqueValuesGrid,esri/tasks/RelationshipQuery,esri/tasks/StatisticDefinition,esri/tasks/PrintParameters,esri/tasks/LegendLayer,esri/tasks/GenerateRendererParameters,esri/tasks/ClassificationDefinition,esri/tasks/ClassBreaksDefinition,esri/tasks/UniqueValueDefinition,esri/tasks/ColorRamp,esri/tasks/AlgorithmicColorRamp,esri/tasks/MultipartColorRamp,esri/tasks/RouteTask,esri/tasks/RouteParameters,esri/tasks/RouteResult,esri/tasks/NAMessage,esri/tasks/NATypes,esri/tasks/DirectionsFeatureSet,esri/layers/wmts,esri/layers/WMTSLayer,esri/layers/WMTSLayerInfo,esri/dijit/Directions,dijit/layout/AccordionPane,dojox/data/QueryReadStore,arcgisonline/sharing/util,arcgisonline/sharing/utilShare,arcgisonline/sharing/geow/Account,arcgisonline/sharing/geow/Community,arcgisonline/sharing/geow/Geow,arcgisonline/sharing/geow/MemberReadStore,arcgisonline/sharing/geow/QueryReadStore,arcgisonline/sharing/geow/TooltipQueryReadStore,dijit/Dialog,dijit/form/ComboBox,dijit/layout/TabContainer,arcgisonline/sharing/dijit/ArcGISOnlineServicesGrid,arcgisonline/sharing/dijit/ArcGISServerServicesGrid,arcgisonline/sharing/dijit/BasemapGallery,arcgisonline/sharing/dijit/BasemapGalleryGrid,arcgisonline/sharing/dijit/Button,arcgisonline/sharing/dijit/ComboBox,arcgisonline/sharing/dijit/DataGrid,arcgisonline/sharing/dijit/DropDownButton,arcgisonline/sharing/dijit/FeatureLayerQueryResult,arcgisonline/sharing/dijit/FeatureLayerQueryStore,arcgisonline/sharing/dijit/GoogleServicesGrid,arcgisonline/sharing/dijit/HelpManager,arcgisonline/sharing/dijit/OrganizationSetup,arcgisonline/sharing/dijit/Troubleshoot,arcgisonline/sharing/dijit/SingleFilter,arcgisonline/sharing/dijit/SingleInteractiveFilter,arcgisonline/sharing/dijit/dialog/AddLayerFromFileDlg,arcgisonline/sharing/dijit/dialog/AddLayerFromUrlDlg,arcgisonline/sharing/dijit/dialog/BrowseLayersDlg,arcgisonline/sharing/dijit/dialog/CsvLocationDlg,arcgisonline/sharing/dijit/dialog/DeleteWarningDlg,arcgisonline/sharing/dijit/dialog/ExportDlg,arcgisonline/sharing/dijit/dialog/ExtentDlg,arcgisonline/sharing/dijit/dialog/FeatureTemplateDlg,arcgisonline/sharing/dijit/dialog/FieldsDlg,arcgisonline/sharing/dijit/dialog/FilterDlg,arcgisonline/sharing/dijit/dialog/FeatureTypeDlg,arcgisonline/sharing/dijit/dialog/GeneralDlg,arcgisonline/sharing/dijit/dialog/InvitationsDlg,arcgisonline/sharing/dijit/dialog/JoinGroupDlg,arcgisonline/sharing/dijit/dialog/ManageSubscriptionDlg,arcgisonline/sharing/dijit/dialog/ManageTilesDlg,arcgisonline/sharing/dijit/dialog/MapSettingsDlg,arcgisonline/sharing/dijit/dialog/MapNotesDlg,arcgisonline/sharing/dijit/dialog/MembershipRequestsDlg,arcgisonline/sharing/dijit/dialog/MdSliderSettingsDlg,arcgisonline/sharing/dijit/dialog/OpenMapDlg,arcgisonline/sharing/dijit/dialog/OpenPresentationDlg,arcgisonline/sharing/dijit/dialog/QueryLayerDlg,arcgisonline/sharing/dijit/dialog/RenameDlg,arcgisonline/sharing/dijit/dialog/RendererDlg,arcgisonline/sharing/dijit/dialog/SaveWebMapDlg,arcgisonline/sharing/dijit/dialog/SetIdentityProviderDlg,arcgisonline/sharing/dijit/dialog/ShareCheckDlg,arcgisonline/sharing/dijit/dialog/SharingDlg,arcgisonline/sharing/dijit/dialog/ShareMapDlg,arcgisonline/sharing/dijit/dialog/SubscriptionStatusDlg,arcgisonline/sharing/dijit/dialog/SymbolDlg,arcgisonline/sharing/dijit/dialog/TagsDlg,arcgisonline/sharing/dijit/dialog/TermsOfUseDlg,arcgisonline/sharing/dijit/dialog/TimeSettingsDlg,arcgisonline/sharing/dijit/dialog/UpdateItemDlg,arcgisonline/sharing/dijit/dialog/WaitingDlg,arcgisonline/sharing/dijit/_GalleryFiltersMixin,arcgisonline/sharing/dijit/Grid,arcgisonline/sharing/dijit/dialog/ItemPropertiesDlg,arcgisonline/sharing/dijit/dialog/BrowseItemsDlg,arcgisonline/sharing/dijit/dialog/_CreateItemUtilMixin,arcgisonline/sharing/dijit/dialog/ConfirmDialog,arcgisonline/sharing/dijit/dialog/AdvancedOfflineOptionsDlg,arcgisonline/sharing/dijit/dialog/getWFSConfig,arcgisonline/sharing/dijit/dialog/getWMTSConfig"],function(t,
p,x){t.provide("arcgisonline.arcgisonline");t.require("esri.main");t.require("dijit._base");t.require("dijit.form.DropDownButton");t.require("dijit.form.ComboButton");t.require("dijit.form.ToggleButton");t.require("dijit.form.HorizontalSlider");t.require("dijit.form.VerticalSlider");t.require("dijit.form.HorizontalRule");t.require("dijit.form.VerticalRule");t.require("dijit.form.HorizontalRuleLabels");t.require("dijit.form.VerticalRuleLabels");t.require("esri.map");t.require("esri.dijit.editing.Editor");
t.require("esri.dijit.editing.TemplatePicker");t.require("esri.dijit.InfoWindow");t.require("esri.dijit.OverviewMap");t.require("esri.dijit.Attribution");t.require("esri.dijit.Scalebar");t.require("esri.dijit.Legend");t.require("esri.dijit.TimeSlider");t.require("esri.dijit.MultidimensionalSlider");t.require("esri.dijit.BasemapGallery");t.require("esri.dijit.HomeButton");t.require("esri.dijit.LocateButton");t.require("esri.dijit.Popup");t.require("esri.layers.graphics");t.require("esri.layers.agstiled");
t.require("esri.layers.agsdynamic");t.require("esri.layers.agsimageservice");t.require("esri.layers.CSVLayer");t.require("esri.layers.StreamLayer");t.require("esri.layers.KMLLayer");t.require("esri.layers.FeatureLayer");t.require("esri.layers.VectorTileLayer");t.require("esri.layers.osm");t.require("esri.SnappingManager");t.require("esri.tasks.geometry");t.require("esri.tasks.identify");t.require("esri.tasks.locator");t.require("esri.toolbars.draw");t.require("esri.virtualearth.VETiledLayer");t.require("esri.virtualearth.VEGeocoder");
t.require("esri.dijit.Geocoder");t.require("dojo.dnd.Moveable");t.require("dojo.parser");t.require("arcgisonline.map.classBreaks");t.require("arcgisonline.map.dynLayer");t.require("arcgisonline.map.edit");t.require("arcgisonline.map.featColl");t.require("arcgisonline.map.fileImport");t.require("arcgisonline.map.geocode");t.require("arcgisonline.map.geocodeReview");t.require("arcgisonline.map.geoRSS");t.require("arcgisonline.map.itemData");t.require("arcgisonline.map.layer");t.require("arcgisonline.map.kml");
t.require("arcgisonline.map.mapNotes");t.require("arcgisonline.map.mapUtil");t.require("arcgisonline.map.role");t.require("arcgisonline.map.print");t.require("arcgisonline.map.popup");t.require("arcgisonline.map.save_open");t.require("arcgisonline.map.symbol");t.require("arcgisonline.map.table");t.require("arcgisonline.map.thumbnail");t.require("arcgisonline.map.time");t.require("arcgisonline.map.multiDimensions");t.require("arcgisonline.map.vectorTile");t.require("arcgisonline.map.webTile");t.require("arcgisonline.map.wms");
t.require("arcgisonline.map.dijit.About");t.require("arcgisonline.map.dijit.AddContent");t.require("arcgisonline.map.dijit.Directions");t.require("arcgisonline.map.dijit.Edit");t.require("arcgisonline.map.dijit.Geocode");t.require("arcgisonline.map.dijit.LeftPanel");t.require("arcgisonline.map.dijit.Legend");t.require("arcgisonline.map.dijit.ManageTemplates");t.require("arcgisonline.map.dijit.MosaicRule");t.require("arcgisonline.map.dijit.PopupBuilder");t.require("arcgisonline.map.dijit.RendererLabels");
t.require("arcgisonline.map.dijit.DefineAOI");t.require("arcgisonline.map.dijit.RenderingRule");t.require("arcgisonline.map.dijit.StructuredPopupWidget");t.require("arcgisonline.map.dijit.TOC");t.require("arcgisonline.map.dijit.MultidimensionalFilter");t.require("arcgisonline.map.dijit.renderer.AttributeTransparency");t.require("arcgisonline.map.dijit.renderer.AttributeTransparencyDlg");t.require("arcgisonline.map.dijit.renderer.Color");t.require("arcgisonline.map.dijit.renderer.ColorGrid");t.require("arcgisonline.map.dijit.renderer.Gallery");
t.require("arcgisonline.map.dijit.renderer.HeatMap");t.require("arcgisonline.map.dijit.renderer.MultiAttributes");t.require("arcgisonline.map.dijit.renderer.Simple");t.require("arcgisonline.map.dijit.renderer.Size");t.require("arcgisonline.map.dijit.renderer.SizeGrid");t.require("arcgisonline.map.dijit.renderer.SymbolStylerDlg");t.require("arcgisonline.map.dijit.renderer.UniqueValues");t.require("arcgisonline.map.dijit.renderer.UniqueValuesGrid");t.require("esri.tasks.RelationshipQuery");t.require("esri.tasks.StatisticDefinition");
t.require("esri.tasks.PrintParameters");t.require("esri.tasks.LegendLayer");t.require("esri.tasks.GenerateRendererParameters");t.require("esri.tasks.ClassificationDefinition");t.require("esri.tasks.ClassBreaksDefinition");t.require("esri.tasks.UniqueValueDefinition");t.require("esri.tasks.ColorRamp");t.require("esri.tasks.AlgorithmicColorRamp");t.require("esri.tasks.MultipartColorRamp");t.require("esri.tasks.RouteTask");t.require("esri.tasks.RouteParameters");t.require("esri.tasks.RouteResult");t.require("esri.tasks.NAMessage");
t.require("esri.tasks.NATypes");t.require("esri.tasks.DirectionsFeatureSet");t.require("esri.layers.wmts");t.require("esri.layers.WMTSLayer");t.require("esri.layers.WMTSLayerInfo");t.require("esri.dijit.Directions");t.require("dijit.layout.AccordionPane");t.require("dojox.data.QueryReadStore");t.require("arcgisonline.sharing.util");t.require("arcgisonline.sharing.utilShare");t.require("arcgisonline.sharing.geow.Account");t.require("arcgisonline.sharing.geow.Community");t.require("arcgisonline.sharing.geow.Geow");
t.require("arcgisonline.sharing.geow.MemberReadStore");t.require("arcgisonline.sharing.geow.QueryReadStore");t.require("arcgisonline.sharing.geow.TooltipQueryReadStore");t.require("dijit.Dialog");t.require("dijit.form.ComboBox");t.require("dijit.layout.TabContainer");t.require("arcgisonline.sharing.dijit.ArcGISOnlineServicesGrid");t.require("arcgisonline.sharing.dijit.ArcGISServerServicesGrid");t.require("arcgisonline.sharing.dijit.BasemapGallery");t.require("arcgisonline.sharing.dijit.BasemapGalleryGrid");
t.require("arcgisonline.sharing.dijit.Button");t.require("arcgisonline.sharing.dijit.ComboBox");t.require("arcgisonline.sharing.dijit.DataGrid");t.require("arcgisonline.sharing.dijit.DropDownButton");t.require("arcgisonline.sharing.dijit.FeatureLayerQueryResult");t.require("arcgisonline.sharing.dijit.FeatureLayerQueryStore");t.require("arcgisonline.sharing.dijit.GoogleServicesGrid");t.require("arcgisonline.sharing.dijit.HelpManager");t.require("arcgisonline.sharing.dijit.OrganizationSetup");t.require("arcgisonline.sharing.dijit.Troubleshoot");
t.require("arcgisonline.sharing.dijit.SingleFilter");t.require("arcgisonline.sharing.dijit.SingleInteractiveFilter");t.require("arcgisonline.sharing.dijit.dialog.AddLayerFromFileDlg");t.require("arcgisonline.sharing.dijit.dialog.AddLayerFromUrlDlg");t.require("arcgisonline.sharing.dijit.dialog.BrowseLayersDlg");t.require("arcgisonline.sharing.dijit.dialog.CsvLocationDlg");t.require("arcgisonline.sharing.dijit.dialog.DeleteWarningDlg");t.require("arcgisonline.sharing.dijit.dialog.ExportDlg");t.require("arcgisonline.sharing.dijit.dialog.ExtentDlg");
t.require("arcgisonline.sharing.dijit.dialog.FeatureTemplateDlg");t.require("arcgisonline.sharing.dijit.dialog.FieldsDlg");t.require("arcgisonline.sharing.dijit.dialog.FilterDlg");t.require("arcgisonline.sharing.dijit.dialog.FeatureTypeDlg");t.require("arcgisonline.sharing.dijit.dialog.GeneralDlg");t.require("arcgisonline.sharing.dijit.dialog.InvitationsDlg");t.require("arcgisonline.sharing.dijit.dialog.JoinGroupDlg");t.require("arcgisonline.sharing.dijit.dialog.ManageSubscriptionDlg");t.require("arcgisonline.sharing.dijit.dialog.ManageTilesDlg");
t.require("arcgisonline.sharing.dijit.dialog.MapSettingsDlg");t.require("arcgisonline.sharing.dijit.dialog.MapNotesDlg");t.require("arcgisonline.sharing.dijit.dialog.MembershipRequestsDlg");t.require("arcgisonline.sharing.dijit.dialog.MdSliderSettingsDlg");t.require("arcgisonline.sharing.dijit.dialog.OpenMapDlg");t.require("arcgisonline.sharing.dijit.dialog.OpenPresentationDlg");t.require("arcgisonline.sharing.dijit.dialog.QueryLayerDlg");t.require("arcgisonline.sharing.dijit.dialog.RenameDlg");t.require("arcgisonline.sharing.dijit.dialog.RendererDlg");
t.require("arcgisonline.sharing.dijit.dialog.SaveWebMapDlg");t.require("arcgisonline.sharing.dijit.dialog.SetIdentityProviderDlg");t.require("arcgisonline.sharing.dijit.dialog.ShareCheckDlg");t.require("arcgisonline.sharing.dijit.dialog.SharingDlg");t.require("arcgisonline.sharing.dijit.dialog.ShareMapDlg");t.require("arcgisonline.sharing.dijit.dialog.SubscriptionStatusDlg");t.require("arcgisonline.sharing.dijit.dialog.SymbolDlg");t.require("arcgisonline.sharing.dijit.dialog.TagsDlg");t.require("arcgisonline.sharing.dijit.dialog.TermsOfUseDlg");
t.require("arcgisonline.sharing.dijit.dialog.TimeSettingsDlg");t.require("arcgisonline.sharing.dijit.dialog.UpdateItemDlg");t.require("arcgisonline.sharing.dijit.dialog.WaitingDlg");t.require("arcgisonline.sharing.dijit._GalleryFiltersMixin");t.require("arcgisonline.sharing.dijit.Grid");t.require("arcgisonline.sharing.dijit.dialog.ItemPropertiesDlg");t.require("arcgisonline.sharing.dijit.dialog.BrowseItemsDlg");t.require("arcgisonline.sharing.dijit.dialog._CreateItemUtilMixin");t.require("arcgisonline.sharing.dijit.dialog.ConfirmDialog");
t.require("arcgisonline.sharing.dijit.dialog.AdvancedOfflineOptionsDlg");t.require("arcgisonline.sharing.dijit.dialog.getWFSConfig");t.require("arcgisonline.sharing.dijit.dialog.getWMTSConfig")});